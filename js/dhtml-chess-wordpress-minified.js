/* Generated Sat Jun 30 14:02:30 CEST 2018 */
/*
* Copyright 2018. dhtmlchess.com. All Rights Reserved.
* This is a commercial software. See dhtmlchess.com for licensing options.
*
* You are free to use/try this software for 30 days without paying any fees.
*
* IN NO EVENT SHALL DHTML CHESS BE LIABLE TO ANY PARTY FOR DIRECT, INDIRECT, SPECIAL, INCIDENTAL,
* OR CONSEQUENTIAL DAMAGES, INCLUDING LOST PROFITS, ARISING OUT OF THE USE OF THIS SOFTWARE AND
* ITS DOCUMENTATION, EVEN IF DHTML CHESS HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*
* DHTML CHESS SPECIFICALLY DISCLAIMS ANY WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
* THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.
* THE SOFTWARE AND ACCOMPANYING DOCUMENTATION, IF ANY, PROVIDED HEREUNDER IS PROVIDED "AS IS".
* DHTML CHESS HAS NO OBLIGATION TO PROVIDE MAINTENANCE, SUPPORT, UPDATES, ENHANCEMENTS, OR MODIFICATIONS.
*
*/
/*!
Web Build: https://mootools.net/core/builder/e7289bd0058c6790cb2b769822285f97
*/
/*! MooTools: the javascript framework. license: MIT-style license. copyright: Copyright (c) 2006-2015 [Valerio Proietti](https://github.com/kamicane/).*/
(function(){this.MooTools={version:"1.6.0",build:"529422872adfff401b901b8b6c7ca5114ee95e2b"};var f=this.typeOf=function(u){if(u==null){return"null"}if(u.$family!=null){return u.$family()}if(u.nodeName){if(u.nodeType==1){return"element"}if(u.nodeType==3){return(/\S/).test(u.nodeValue)?"textnode":"whitespace"}}else{if(typeof u.length=="number"){if("callee" in u){return"arguments"}if("item" in u){return"collection"}}}return typeof u};var t=this.instanceOf=function(w,u){if(w==null){return false}var v=w.$constructor||w.constructor;while(v){if(v===u){return true}v=v.parent}if(!w.hasOwnProperty){return false}return w instanceof u};var m=Object.prototype.hasOwnProperty;var q=true;for(var p in {toString:1}){q=null}if(q){q=["hasOwnProperty","valueOf","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","constructor"]}function g(v,x,y){if(q){for(var w=q.length;w--;){var u=q[w];if(m.call(v,u)){x.call(y,u,v[u])}}}}var h=this.Function;h.prototype.overloadSetter=function(v){var u=this;return function(x,w){if(x==null){return this}if(v||typeof x!="string"){for(var y in x){u.call(this,y,x[y])}g(x,u,this)}else{u.call(this,x,w)}return this}};h.prototype.overloadGetter=function(v){var u=this;return function(x){var y,w;if(typeof x!="string"){y=x}else{if(arguments.length>1){y=arguments}else{if(v){y=[x]}}}if(y){w={};for(var z=0;z<y.length;z++){w[y[z]]=u.call(this,y[z])}}else{w=u.call(this,x)}return w}};h.prototype.extend=function(u,v){this[u]=v}.overloadSetter();h.prototype.implement=function(u,v){this.prototype[u]=v}.overloadSetter();var n=Array.prototype.slice;Array.convert=function(u){if(u==null){return[]}return(l.isEnumerable(u)&&typeof u!="string")?(f(u)=="array")?u:n.call(u):[u]};h.convert=function(u){return(f(u)=="function")?u:function(){return u}};Number.convert=function(v){var u=parseFloat(v);return isFinite(u)?u:null};String.convert=function(u){return u+""};h.from=h.convert;Number.from=Number.convert;String.from=String.convert;h.implement({hide:function(){this.$hidden=true;return this},protect:function(){this.$protected=true;return this}});var l=this.Type=function(x,w){if(x){var v=x.toLowerCase();var u=function(y){return(f(y)==v)};l["is"+x]=u;if(w!=null){w.prototype.$family=(function(){return v}).hide()}}if(w==null){return null}w.extend(this);w.$constructor=l;w.prototype.$constructor=w;return w};var o=Object.prototype.toString;l.isEnumerable=function(u){return(u!=null&&typeof u.length=="number"&&o.call(u)!="[object Function]")};var b={};var d=function(u){var v=f(u.prototype);return b[v]||(b[v]=[])};var j=function(v,z){if(z&&z.$hidden){return}var u=d(this);for(var w=0;w<u.length;w++){var y=u[w];if(f(y)=="type"){j.call(y,v,z)}else{y.call(this,v,z)}}var x=this.prototype[v];if(x==null||!x.$protected){this.prototype[v]=z}if(this[v]==null&&f(z)=="function"){s.call(this,v,function(A){return z.apply(A,n.call(arguments,1))})}};var s=function(u,w){if(w&&w.$hidden){return}var v=this[u];if(v==null||!v.$protected){this[u]=w}};l.implement({implement:j.overloadSetter(),extend:s.overloadSetter(),alias:function(u,v){j.call(this,u,this.prototype[v])}.overloadSetter(),mirror:function(u){d(this).push(u);return this}});new l("Type",l);var c=function(u,z,x){var w=(z!=Object),D=z.prototype;if(w){z=new l(u,z)}for(var A=0,y=x.length;A<y;A++){var E=x[A],C=z[E],B=D[E];if(C){C.protect()}if(w&&B){z.implement(E,B.protect())}}if(w){var v=D.propertyIsEnumerable(x[0]);z.forEachMethod=function(I){if(!v){for(var H=0,F=x.length;H<F;H++){I.call(D,D[x[H]],x[H])}}for(var G in D){I.call(D,D[G],G)}}}return c};c("String",String,["charAt","charCodeAt","concat","contains","indexOf","lastIndexOf","match","quote","replace","search","slice","split","substr","substring","trim","toLowerCase","toUpperCase"])("Array",Array,["pop","push","reverse","shift","sort","splice","unshift","concat","join","slice","indexOf","lastIndexOf","filter","forEach","every","map","some","reduce","reduceRight","contains"])("Number",Number,["toExponential","toFixed","toLocaleString","toPrecision"])("Function",h,["apply","call","bind"])("RegExp",RegExp,["exec","test"])("Object",Object,["create","defineProperty","defineProperties","keys","getPrototypeOf","getOwnPropertyDescriptor","getOwnPropertyNames","preventExtensions","isExtensible","seal","isSealed","freeze","isFrozen"])("Date",Date,["now"]);Object.extend=s.overloadSetter();Date.extend("now",function(){return +(new Date)});new l("Boolean",Boolean);Number.prototype.$family=function(){return isFinite(this)?"number":"null"}.hide();Number.extend("random",function(v,u){return Math.floor(Math.random()*(u-v+1)+v)});Array.implement({forEach:function(w,x){for(var v=0,u=this.length;v<u;v++){if(v in this){w.call(x,this[v],v,this)}}},each:function(u,v){Array.forEach(this,u,v);return this}});Object.extend({keys:function(v){var w=[];
for(var u in v){if(m.call(v,u)){w.push(u)}}g(v,function(x){w.push(x)});return w},forEach:function(u,v,w){Object.keys(u).forEach(function(x){v.call(w,u[x],x,u)})}});Object.each=Object.forEach;var r=function(u){switch(f(u)){case"array":return u.clone();case"object":return Object.clone(u);default:return u}};Array.implement("clone",function(){var u=this.length,v=new Array(u);while(u--){v[u]=r(this[u])}return v});var a=function(v,u,w){switch(f(w)){case"object":if(f(v[u])=="object"){Object.merge(v[u],w)}else{v[u]=Object.clone(w)}break;case"array":v[u]=w.clone();break;default:v[u]=w}return v};Object.extend({merge:function(B,x,w){if(f(x)=="string"){return a(B,x,w)}for(var A=1,u=arguments.length;A<u;A++){var y=arguments[A];for(var z in y){a(B,z,y[z])}}return B},clone:function(u){var w={};for(var v in u){w[v]=r(u[v])}return w},append:function(y){for(var x=1,v=arguments.length;x<v;x++){var u=arguments[x]||{};for(var w in u){y[w]=u[w]}}return y}});["Object","WhiteSpace","TextNode","Collection","Arguments"].each(function(u){new l(u)});var k=Date.now();String.extend("uniqueID",function(){return(k++).toString(36)})})();Array.implement({every:function(c,d){for(var b=0,a=this.length>>>0;b<a;b++){if((b in this)&&!c.call(d,this[b],b,this)){return false}}return true},filter:function(d,g){var c=[];for(var f,b=0,a=this.length>>>0;b<a;b++){if(b in this){f=this[b];if(d.call(g,f,b,this)){c.push(f)}}}return c},indexOf:function(c,d){var b=this.length>>>0;for(var a=(d<0)?Math.max(0,b+d):d||0;a<b;a++){if(this[a]===c){return a}}return -1},map:function(c,f){var d=this.length>>>0,b=Array(d);for(var a=0;a<d;a++){if(a in this){b[a]=c.call(f,this[a],a,this)}}return b},some:function(c,d){for(var b=0,a=this.length>>>0;b<a;b++){if((b in this)&&c.call(d,this[b],b,this)){return true}}return false},clean:function(){return this.filter(function(a){return a!=null})},invoke:function(a){var b=Array.slice(arguments,1);return this.map(function(c){return c[a].apply(c,b)})},associate:function(c){var d={},b=Math.min(this.length,c.length);for(var a=0;a<b;a++){d[c[a]]=this[a]}return d},link:function(c){var a={};for(var f=0,b=this.length;f<b;f++){for(var d in c){if(c[d](this[f])){a[d]=this[f];delete c[d];break}}}return a},contains:function(a,b){return this.indexOf(a,b)!=-1},append:function(a){this.push.apply(this,a);return this},getLast:function(){return(this.length)?this[this.length-1]:null},getRandom:function(){return(this.length)?this[Number.random(0,this.length-1)]:null},include:function(a){if(!this.contains(a)){this.push(a)}return this},combine:function(c){for(var b=0,a=c.length;b<a;b++){this.include(c[b])}return this},erase:function(b){for(var a=this.length;a--;){if(this[a]===b){this.splice(a,1)}}return this},empty:function(){this.length=0;return this},flatten:function(){var d=[];for(var b=0,a=this.length;b<a;b++){var c=typeOf(this[b]);if(c=="null"){continue}d=d.concat((c=="array"||c=="collection"||c=="arguments"||instanceOf(this[b],Array))?Array.flatten(this[b]):this[b])}return d},pick:function(){for(var b=0,a=this.length;b<a;b++){if(this[b]!=null){return this[b]}}return null},hexToRgb:function(b){if(this.length!=3){return null}var a=this.map(function(c){if(c.length==1){c+=c}return parseInt(c,16)});return(b)?a:"rgb("+a+")"},rgbToHex:function(d){if(this.length<3){return null}if(this.length==4&&this[3]==0&&!d){return"transparent"}var b=[];for(var a=0;a<3;a++){var c=(this[a]-0).toString(16);b.push((c.length==1)?"0"+c:c)}return(d)?b:"#"+b.join("")}});Function.extend({attempt:function(){for(var b=0,a=arguments.length;b<a;b++){try{return arguments[b]()}catch(c){}}return null}});Function.implement({attempt:function(a,c){try{return this.apply(c,Array.convert(a))}catch(b){}return null},bind:function(f){var a=this,b=arguments.length>1?Array.slice(arguments,1):null,d=function(){};var c=function(){var h=f,j=arguments.length;if(this instanceof c){d.prototype=a.prototype;h=new d}var g=(!b&&!j)?a.call(h):a.apply(h,b&&j?b.concat(Array.slice(arguments)):b||arguments);return h==f?g:h};return c},pass:function(b,c){var a=this;if(b!=null){b=Array.convert(b)}return function(){return a.apply(c,b||arguments)}},delay:function(b,c,a){return setTimeout(this.pass((a==null?[]:a),c),b)},periodical:function(c,b,a){return setInterval(this.pass((a==null?[]:a),b),c)}});Number.implement({limit:function(b,a){return Math.min(a,Math.max(b,this))},round:function(a){a=Math.pow(10,a||0).toFixed(a<0?-a:0);return Math.round(this*a)/a},times:function(b,c){for(var a=0;a<this;a++){b.call(c,a,this)}},toFloat:function(){return parseFloat(this)},toInt:function(a){return parseInt(this,a||10)}});Number.alias("each","times");(function(b){var a={};b.each(function(c){if(!Number[c]){a[c]=function(){return Math[c].apply(null,[this].concat(Array.convert(arguments)))}}});Number.implement(a)})(["abs","acos","asin","atan","atan2","ceil","cos","exp","floor","log","max","min","pow","sin","sqrt","tan"]);String.implement({contains:function(b,a){return(a?String(this).slice(a):String(this)).indexOf(b)>-1},test:function(a,b){return((typeOf(a)=="regexp")?a:new RegExp(""+a,b)).test(this)
},trim:function(){return String(this).replace(/^\s+|\s+$/g,"")},clean:function(){return String(this).replace(/\s+/g," ").trim()},camelCase:function(){return String(this).replace(/-\D/g,function(a){return a.charAt(1).toUpperCase()})},hyphenate:function(){return String(this).replace(/[A-Z]/g,function(a){return("-"+a.charAt(0).toLowerCase())})},capitalize:function(){return String(this).replace(/\b[a-z]/g,function(a){return a.toUpperCase()})},escapeRegExp:function(){return String(this).replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")},toInt:function(a){return parseInt(this,a||10)},toFloat:function(){return parseFloat(this)},hexToRgb:function(b){var a=String(this).match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);return(a)?a.slice(1).hexToRgb(b):null},rgbToHex:function(b){var a=String(this).match(/\d{1,3}/g);return(a)?a.rgbToHex(b):null},substitute:function(a,b){return String(this).replace(b||(/\\?\{([^{}]+)\}/g),function(d,c){if(d.charAt(0)=="\\"){return d.slice(1)}return(a[c]!=null)?a[c]:""})}});(function(){var f=this.document;var d=f.window=this;var a=function(m,l){m=m.toLowerCase();l=(l?l.toLowerCase():"");var n=m.match(/(edge)[\s\/:]([\w\d\.]+)/);if(!n){n=m.match(/(opera|ie|firefox|chrome|trident|crios|version)[\s\/:]([\w\d\.]+)?.*?(safari|(?:rv[\s\/:]|version[\s\/:])([\w\d\.]+)|$)/)||[null,"unknown",0]}if(n[1]=="trident"){n[1]="ie";if(n[4]){n[2]=n[4]}}else{if(n[1]=="crios"){n[1]="chrome"}}l=m.match(/ip(?:ad|od|hone)/)?"ios":(m.match(/(?:webos|android)/)||m.match(/mac|win|linux/)||["other"])[0];if(l=="win"){l="windows"}return{extend:Function.prototype.extend,name:(n[1]=="version")?n[3]:n[1],version:parseFloat((n[1]=="opera"&&n[4])?n[4]:n[2]),platform:l}};var k=this.Browser=a(navigator.userAgent,navigator.platform);if(k.name=="ie"&&f.documentMode){k.version=f.documentMode}k.extend({Features:{xpath:!!(f.evaluate),air:!!(d.runtime),query:!!(f.querySelector),json:!!(d.JSON)},parseUA:a});k.Request=(function(){var n=function(){return new XMLHttpRequest()};var m=function(){return new ActiveXObject("MSXML2.XMLHTTP")};var l=function(){return new ActiveXObject("Microsoft.XMLHTTP")};return Function.attempt(function(){n();return n},function(){m();return m},function(){l();return l})})();k.Features.xhr=!!(k.Request);k.exec=function(m){if(!m){return m}if(d.execScript){d.execScript(m)}else{var l=f.createElement("script");l.setAttribute("type","text/javascript");l.text=m;f.head.appendChild(l);f.head._u3d(l)}return m};String.implement("stripScripts",function(m){var l="";var n=this.replace(/<script[^>]*>([\s\S]*?)<\/script>/gi,function(o,p){l+=p+"\n";return""});if(m===true){k.exec(l)}else{if(typeOf(m)=="function"){m(l,n)}}return n});k.extend({Document:this.Document,Window:this.Window,Element:this.Element,Event:this.Event});this.Window=this.$constructor=new Type("Window",function(){});this.$family=Function.convert("window").hide();Window.mirror(function(l,m){d[l]=m});this.Document=f.$constructor=new Type("Document",function(){});f.$family=Function.convert("document").hide();Document.mirror(function(l,m){f[l]=m});f.html=f.documentElement;if(!f.head){f.head=f.getElementsByTagName("head")[0]}if(f.execCommand){try{f.execCommand("BackgroundImageCache",false,true)}catch(c){}}if(this.attachEvent&&!this.addEventListener){var b=function(){this.detachEvent("onunload",b);f.head=f.html=f.window=null;d=this.Window=f=null};this.attachEvent("onunload",b)}var g=Array.convert;try{g(f.html.childNodes)}catch(c){Array.convert=function(m){if(typeof m!="string"&&Type.isEnumerable(m)&&typeOf(m)!="array"){var l=m.length,n=new Array(l);while(l--){n[l]=m[l]}return n}return g(m)};var h=Array.prototype,j=h.slice;["pop","push","reverse","shift","sort","splice","unshift","concat","join","slice"].each(function(l){var m=h[l];Array[l]=function(n){return m.apply(Array.convert(n),j.call(arguments,1))}})}})();(function(){var a=this.Class=new Type("Class",function(j){if(instanceOf(j,Function)){j={initialize:j}}var h=function(){f(this);if(h.$prototyping){return this}this.$caller=null;this.$family=null;var k=(this.initialize)?this.initialize.apply(this,arguments):this;this.$caller=this.caller=null;return k}.extend(this).implement(j);h.$constructor=a;h.prototype.$constructor=h;h.prototype.parent=c;return h});var c=function(){if(!this.$caller){throw new Error('The method "parent" cannot be called.')}var h=this.$caller.$name,j=this.$caller.$owner.parent,k=(j)?j.prototype[h]:null;if(!k){throw new Error('The method "'+h+'" has no parent.')}return k.apply(this,arguments)};var f=function(h){for(var j in h){var l=h[j];switch(typeOf(l)){case"object":var k=function(){};k.prototype=l;h[j]=f(new k);break;case"array":h[j]=l.clone();break}}return h};var b=function(h,j,l){if(l.$origin){l=l.$origin}var k=function(){if(l.$protected&&this.$caller==null){throw new Error('The method "'+j+'" cannot be called.')}var n=this.caller,o=this.$caller;this.caller=o;this.$caller=k;var m=l.apply(this,arguments);this.$caller=o;this.caller=n;return m}.extend({$owner:h,$origin:l,$name:j});return k};var g=function(j,k,h){if(a.Mutators.hasOwnProperty(j)){k=a.Mutators[j].call(this,k);
if(k==null){return this}}if(typeOf(k)=="function"){if(k.$hidden){return this}this.prototype[j]=(h)?k:b(this,j,k)}else{Object.merge(this.prototype,j,k)}return this};var d=function(h){h.$prototyping=true;var j=new h;delete h.$prototyping;return j};a.implement("implement",g.overloadSetter());a.Mutators={Extends:function(h){this.parent=h;this.prototype=d(h)},Implements:function(h){Array.convert(h).each(function(l){var j=new l;for(var k in j){g.call(this,k,j[k],true)}},this)}}})();(function(){this.Chain=new Class({$chain:[],chain:function(){this.$chain.append(Array.flatten(arguments));return this},callChain:function(){return(this.$chain.length)?this.$chain.shift().apply(this,arguments):false},clearChain:function(){this.$chain.empty();return this}});var a=function(b){return b.replace(/^on([A-Z])/,function(c,d){return d.toLowerCase()})};this.Events=new Class({$events:{},addEvent:function(d,c,b){d=a(d);this.$events[d]=(this.$events[d]||[]).include(c);if(b){c.internal=true}return this},_uBf:function(b){for(var c in b){this.addEvent(c,b[c])}return this},_uif:function(f,c,b){f=a(f);var d=this.$events[f];if(!d){return this}c=Array.convert(c);d.each(function(g){if(b){g.delay(b,this,c)}else{g.apply(this,c)}},this);return this},removeEvent:function(f,d){f=a(f);var c=this.$events[f];if(c&&!d.internal){var b=c.indexOf(d);if(b!=-1){delete c[b]}}return this},_uwc:function(d){var f;if(typeOf(d)=="object"){for(f in d){this.removeEvent(f,d[f])}return this}if(d){d=a(d)}for(f in this.$events){if(d&&d!=f){continue}var c=this.$events[f];for(var b=c.length;b--;){if(b in c){this.removeEvent(f,c[b])}}}return this}});this.Options=new Class({setOptions:function(){var b=this.options=Object.merge.apply(null,[{},this.options].append(arguments));if(this.addEvent){for(var c in b){if(typeOf(b[c])!="function"||!(/^on[A-Z]/).test(c)){continue}this.addEvent(c,b[c]);delete b[c]}}return this}})})();window.ludo={form:{validator:{}},color:{},dialog:{},remote:{},tree:{},model:{},tpl:{},video:{},storage:{},grid:{},effect:{},paging:{},calendar:{},layout:{},progress:{},keyboard:{},chart:{},_une:{},_uoe:{},card:{},svg:{},socket:{},menu:{},view:{},audio:{},ludoDB:{},theme:{}};if(navigator.appName=="Microsoft Internet Explorer"){try{document.execCommand("BackgroundImageCache",false,true)}catch(e){}}ludo.SINGLETONS={};ludo.CmpMgrClass=new Class({Extends:Events,components:{},_uFc:{},_ur7:undefined,_uGc:undefined,_uW4:undefined,initialize:function(){jQuery(document.documentElement).on("keypress",this.autoSubmit.bind(this))},autoSubmit:function(b){if(b.key=="enter"){if(b.target.tagName.toLowerCase()!=="textarea"){if(this._uGc){this._uGc.click()}}}if(b.key=="tab"){var a=b.target.tagName.toLowerCase();if(a!=="input"&&a!=="textarea"){this._uS4()}}},_uH4:function(a){this.components[a.id]=a;if(a.buttonBar||a.buttons){a.addEvent("activate",this.selectFirstButton.bind(this));a.addEvent("hide",this.clearButtons.bind(this))}if(a.singleton&&a.type){ludo.SINGLETONS[a.type]=a}},selectFirstButton:function(c){if(c._uNf()||!c.getButtons){return}this._ur7=c;if(this._uGc){this._uGc.deSelect()}this._uGc=undefined;var b=this._uW4=c.getButtons();var a;for(a=0;a<b.length;a++){if(!b[a]._uNf()&&b[a].selected){this._uGc=b[a];b[a].select();return}}for(a=0;a<b.length;a++){if(!b[a]._uNf()&&b[a].type=="form.SubmitButton"){this._uGc=b[a];b[a].select();return}}for(a=0;a<b.length;a++){if(!b[a]._uNf()&&b[a].type=="form.CancelButton"){this._uGc=b[a];b[a].select();return}}},_uS4:function(){if(this._uGc){this._uGc.deSelect()}var a=this._uW4.indexOf(this._uGc);a++;if(a>=this._uW4.length){a=0}this._uGc=this._uW4[a];this._uGc.select()},clearButtons:function(a){if(this._ur7&&this._ur7.getId()==a.getId()){this._ur7=undefined;this._uGc=undefined;this._uGc=undefined}},_u17:function(a){this.clearButtons(a);delete this.components[a.getId()]},get:function(a){return a.initialize!==undefined?a:this.components[a]},zIndex:1,_uRb:function(){this.zIndex++;return this.zIndex}});ludo.CmpMgr=new ludo.CmpMgrClass();ludo.get=function(a){return ludo.CmpMgr.get(a)};ludo.$=function(a){return ludo.CmpMgr.get(a)};ludo._new=function(a){if(jQuery.type(a)=="string"){a={type:a}}if(a.type&&ludo.SINGLETONS[a.type]){return ludo.SINGLETONS[a.type]}return ludo.factory.create(a)};ludo.FormMgrClass=new Class({Extends:Events,_uFc:{},_uEc:[],posArray:{},forms:{},add:function(b){var a=b.getName();if(!this._uFc[a]){this._uFc[a]=b;this._uEc.push(b);this.posArray[b.getId()]=this._uEc.length-1}b.addEvent("focus",this.setFocus.bind(this));b.addEvent("click",this.setFocus.bind(this))},getNext:function(b){if(this.posArray[b.getId()]){var a=this.posArray[b.getId()];if(a<this._uEc.length-1){return this._uEc[a+1]}}return null},get:function(a){return this._uFc[a]?this._uFc[a]:null},_ui1:undefined,setFocus:function(b,a){if(a._uE9()&&a!==this._ui1){if(this._ui1&&this._ui1.hasFocus()){this._ui1.blur()}this._ui1=a;this._uif("focus",a)}}});ludo.Form=new ludo.FormMgrClass();Events.prototype.on=Events.prototype.addEvent;Events.prototype.off=Events.prototype.removeEvent;
ludo.util={types:{},isIe:function(){return navigator.appName=="Microsoft Internet Explorer"},isArray:function(a){return ludo.util.type(a)=="array"},isObject:function(a){return ludo.util.type(a)==="object"},isString:function(a){return ludo.util.type(a)==="string"},isFunction:function(a){return ludo.util.type(a)==="function"},argsToArray:function(a){return Array.prototype.slice.call(a)},clamp:function(b,c,a){return Math.min(Math.max(b,c),a)},type:function(a){if(a==null){return String(a)}return typeof a==="object"||typeof a==="function"?ludo.util.types[ludo.util.types.toString.call(a)]||"object":typeof a},isLudoJSConfig:function(a){return a.initialize===undefined&&a.type},tabletOrMobile:undefined,_uZ5:function(){if(ludo.util.tabletOrMobile===undefined){var a=false;(function(b){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4))){a=true}})(navigator.userAgent||navigator.vendor||window.opera);ludo.util.tabletOrMobile=a}return ludo.util.tabletOrMobile},cancelEvent:function(){return false},log:function(a){if(window.console){console.log(a)}},warn:function(a){if(window.console){console.warn(a)}},_uRb:function(a){var c=ludo.CmpMgr._uRb();var d=a.getEl().parent();var b;if(!a.els){b=a.el;if(!b){return c}}else{b=a.els.container}if(d.length>0&&d[0]==document.body&&b.css("position")==="absolute"){c+=10000}if(a.alwaysInFront){c+=400000}return c},dispose:function(a){if(a.getParent()){a.getParent()._u3d(a)}a._uwc();this._uE2(a.dependency);a._u43();jQuery.each(a.els,function(b){if(b!="parent"&&a.els[b]&&a.els[b].prop&&a.els[b].prop("tagName")){a.els[b].off();a.els[b].remove()}}.bind(a));ludo.CmpMgr._u17(a);a.els={}},_uE2:function(b){for(var a in b){if(b.hasOwnProperty(a)){if(b[a]._uwc){b[a]._uwc()}if(b[a].dispose){b[a].dispose()}else{if(b[a].dependency&&b[a].dependency.length){ludo.util._uE2(b[a].dependency)}}b[a]=undefined}}},parseDate:function(b,g){if(ludo.util.isString(b)){var f=g.split(/[^a-z%]/gi);var a=b.split(/[\.\-\/]/g);var d={};for(var c=0;c<f.length;c++){d[f[c]]=a[c]}d["%m"]=d["%m"]?d["%m"]-1:0;d["%h"]=d["%h"]||0;d["%i"]=d["%i"]||0;d["%s"]=d["%s"]||0;return new Date(d["%Y"],d["%m"],d["%d"],d["%h"],d["%i"],d["%s"])}return ludo.util.isString(b)?"":b},_uW3:function(){return ludo.util._uZ5()?"touchstart":"mousedown"},_ub5:function(){return ludo.util._uZ5()?"touchmove":"mousemove"},_uE7:function(){return ludo.util._uZ5()?"touchend":"mouseup"},supportsSVG:function(){return !!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg")["createSVGRect"]},lengthOfObject:function(c){if(c.keys!=undefined){return c.keys().length}var a=0;for(var b in c){if(c.hasOwnProperty(b)){a++}}return a},pageXY:function(b){var a=b.touches&&b.touches.length>0?b.touches[0]:b.originalEvent!=undefined&&b.originalEvent.touches!=undefined&&b.originalEvent.touches.length>0?b.originalEvent.touches[0]:b;return{x:a.pageX,y:a.pageY,clientX:a.clientX,clientY:a.clientY,pageX:a.pageX,pageY:a.pageY}}};var ludoUtilTypes="Boolean Number String Function Array Date RegExp Object Error".split(" ");for(var i=0;i<ludoUtilTypes.length;i++){ludo.util.types["[object "+ludoUtilTypes[i]+"]"]=ludoUtilTypes[i].toLowerCase()
}ludo.isMobile=ludo.util._uZ5();ludo.Effect=new Class({Extends:Events,inProgress:false,initialize:function(){if(ludo.util.isIe()){jQuery(document.documentElement).on("selectstart",this._u77.bind(this))}},_uifs:function(a){this._uif("start",a);this._uif("end",a)},start:function(){this._uif("start");this.inProgress=true;this._uX4()},end:function(){this._uif("end");this.inProgress=false;this._uh7()},_uX4:function(){jQuery(document.body).addClass("ludo-unselectable")},_uh7:function(){jQuery(document.body).removeClass("ludo-unselectable")},_u77:function(){return !(this.inProgress)}});ludo._uFb=new ludo.Effect();ludo.language={words:{},set:function(a,b){this.words[a]=b},get:function(a){return this.words[a]?this.words[a]:a},fill:function(a){this.words=Object.merge(this.words,a)}};ludo.RegistryClass=new Class({storage:{},set:function(a,b){this.storage[a]=b},get:function(a){return this.storage[a]}});ludo.registry=new ludo.RegistryClass();ludo.storage.LocalStorage=new Class({supported:false,initialize:function(){this.supported=typeof(Storage)!=="undefined"},save:function(a,c){if(!this.supported){return}var b="simple";if(jQuery.isPlainObject(c)||jQuery.isArray(c)){c=JSON.stringify(c);b="object"}localStorage[a]=c;localStorage[this.getTypeKey(a)]=b},getNumeric:function(b,a){return this.get(b,a)/1},get:function(c,a){if(!this.supported){return a}var d=this.getType(c);if(d==="object"){var b=JSON.parse(localStorage[c]);return b?b:a}var f=localStorage.getItem(c);return f?f:a},getTypeKey:function(a){return a+"___type"},getType:function(a){a=this.getTypeKey(a);if(localStorage[a]!==undefined){return localStorage[a]}return"simple"},empty:function(){localStorage.clear()}});ludo.localStorage=undefined;ludo._uZ6=function(){if(!ludo.localStorage){ludo.localStorage=new ludo.storage.LocalStorage()}return ludo.localStorage};ludo.ObjectFactory=new Class({namespaces:[],_un7:{},create:function(a){if(this.isClass(a)){return a}a.type=a.type||"View";if(this._un7[a.type]!==undefined){return new this._un7[a.type](a)}var c=this._ud8("ludo",a);if(c){return c}for(var b=0;b<this.namespaces.length;b++){var f=this._ud8(this.namespaces[b],a);if(f){return f}}try{var f=this.createInstance(a.type,a);if(f!=undefined){return f}}catch(d){}if(window.console){window.console.trace("Could not find class "+a.type)}return undefined},createInstance:function(g,b){var f=g.split(/\./g);var a=f.pop();var d=window;for(var c=0;c<f.length;c++){var h=f[c];if(d[h]!=undefined){d=d[h]}}if(d[a]!=undefined){return new d[a](b)}return undefined},registerClass:function(a,b){this._un7[a]=b},createAlias:function(a,b){this._un7[a]=b},createNamespace:function(a){if(window[a]===undefined){window[a]={}}if(this.namespaces.indexOf(a)===-1){this.namespaces.push(a)}},ns:function(c){var b=window;var d=c.split(/\./g);for(var a=0;a<d.length;a++){var f=d[a];if(b[f]==undefined){b[f]={}}b=b[f]}},_ud8:function(d,a){var c=a.type.split(/\./g);if(c[0]===d){c.shift()}var f=window[d];for(var b=0;b<c.length;b++){if(f[c[b]]!==undefined){f=f[c[b]]}else{return undefined}}return new f(a)},isClass:function(a){return a&&a.initialize!==undefined}});ludo.factory=new ludo.ObjectFactory();ludo._Config=new Class({storage:{},initialize:function(){this._uU4()},reset:function(){this._uU4()},_uU4:function(){this.storage={url:undefined,documentRoot:"/",socketUrl:"http://your-node-js-server-url:8080/",modRewrite:false,fileUploadUrl:undefined}},setUrl:function(a){this.storage.url=a},getUrl:function(){return this.storage.url},enableModRewriteUrls:function(){this.storage.modRewrite=true},disableModRewriteUrls:function(){this.storage.modRewrite=false},hasModRewriteUrls:function(){return this.storage.modRewrite===true},setSocketUrl:function(a){this.storage.socketUrl=a},getSocketUrl:function(){return this.storage.socketUrl},setDocumentRoot:function(a){this.storage.documentRoot=a==="."?"":a},_uC6:function(){return this.storage.documentRoot},setFileUploadUrl:function(a){this.storage.fileUploadUrl=a},getFileUploadUrl:function(){return this.storage.fileUploadUrl}});ludo.config=new ludo._Config();var Asset={javascript:function(d,b){if(!b){b={}}var a=jQuery('<script src="'+d+'" type="javascript"><\/script>'),f=b.document||document,c=b.onload||b.onLoad;delete b.onload;delete b.onLoad;delete b.document;if(c){if(typeof a.onreadystatechange!="undefined"){a.on("readystatechange",function(){if(["loaded","complete"].contains(this.readyState)){c.call(this)}})}else{a.on("load",c)}}this.addProperties(a,b);jQuery(f.head).append(a);return a},addProperties:function(c,b){for(var a in b){if(b.hasOwnProperty(a)){c.attr(a,b[a])}}},css:function(d,a){if(!a){a={}}var b=jQuery('<link rel="stylesheet" type="text/css" media="screen" href="'+d+'" />');var c=a.onload||a.onLoad,f=a.document||document;delete a.onload;delete a.onLoad;delete a.document;if(c){b.on("load",c)}this.addProperties(b,a);jQuery(f.head).append(b);return b}};ludo.Core=new Class({Extends:Events,id:undefined,name:undefined,module:undefined,submodule:undefined,_uoe:undefined,useController:false,_uXf:false,_uw3:undefined,dependency:undefined,plugins:undefined,initialize:function(a){a=a||{};
this.lifeCycle(a);this.applyplugins()},lifeCycle:function(a){this._ukd(a);this._use()},applyplugins:function(){if(this.plugins){jQuery.each(this.plugins,function(a,b){this.addPlugin(b,a)}.bind(this))}},addPlugin:function(b,a){a=a!=undefined?a:this.plugins.length;b._uB6=this;this.plugins[a]=this._um5("plugins"+a,b)},_ukd:function(a){this._uWf(a,["url","name","_uoe","module","submodule","_uXf","id","useController","plugins"]);this.dependency={};if(a!=undefined){for(var b in a){if(a.hasOwnProperty(b)&&jQuery.type(a[b])=="function"&&this[b]==undefined){this[b]=a[b].bind(this)}}}if(this._uXf&&this._uw3&&this.id){a=this.appendPropertiesFromStore(a);this.on("state",this._urffulProperties.bind(this))}if(a.listeners!==undefined){this._uBf(a.listeners)}if(this._uoe!==undefined){ludo._uoeManager._uk(this._uoe,this)}if(this.module||this.useController){ludo._uoeManager._uH4(this)}if(!this.id){this.id="ludo-"+String.uniqueID()}ludo.CmpMgr._uH4(this)},_uWf:function(a,c){for(var b=0;b<c.length;b++){if(a[c[b]]!==undefined){this[c[b]]=a[c[b]]}}},_use:function(){},appendPropertiesFromStore:function(a){var f=ludo._uZ6().get(this.getKeyForLocalStore());if(f){var d=this._uw3;for(var b=0;b<d.length;b++){a[d[b]]=f[d[b]]}}return a},_urffulProperties:function(){var c={};var b=this._uw3;for(var a=0;a<b.length;a++){c[b[a]]=this[b[a]]}ludo._uZ6().save(this.getKeyForLocalStore(),c)},getKeyForLocalStore:function(){return"state_"+this.id},getId:function(){return this.id},getName:function(){return this.name},getUrl:function(){if(this.url){return this.url}if(this.component){return this.component.getUrl()}if(this.applyTo){return this.applyTo.getUrl()}if(this._uB6){return this._uB6.getUrl()}return undefined},_uCe:function(){return Browser.ie?jQuery(document.documentElement):jQuery(window)},NS:undefined,_uTb:function(){if(this.NS==undefined){if(this.type){var a=this.type.split(/\./g);a.pop();this.NS=a.join(".")}else{this.NS=""}}return this.NS},hasController:function(){return !!this._uoe},getController:function(){return this._uoe},_uv9:function(a){this._uoe=a;this.addControllerEvents()},addControllerEvents:function(){},getModule:function(){return this._ua2("module")},getSubModule:function(){return this._ua2("submodule")},_ua2:function(a){return this[a]!==undefined?this[a]:this._uB6?this._uB6._ua2(a):undefined},_urf:function(){this._uif("state")},_um5:function(b,a){this.dependency[b]=ludo.util.isLudoJSConfig(a)?ludo._new(a):a;return this.dependency[b]},_uF9:function(a){return !!this.dependency[a]},_uIa:function(b,a){if(this.dependency[b]){return this.dependency[b]}return this._um5(b,a)},relayEvents:function(c,b){for(var a=0;a<b.length;a++){c.on(b[a],this.getRelayFn(b[a]).bind(this))}},getRelayFn:function(a){return function(){this._uif.call(this,a,Array.prototype.slice.call(arguments))}.bind(this)}});ludo.svg.Matrix=new Class({a:1,b:0,c:0,d:1,e:0,f:0,_uo3:[0,0],_u8g:undefined,node:undefined,_u82:undefined,_uI6:undefined,initialize:function(a){this.node=a;this._uI6=[0,0,0]},getScale:function(){var a=this.getSVGMatrix();return[a.a,a.d]},setScale:function(a,b){this._u8g=this.getSVGMatrix();this._u8g.a=a;this._u8g.d=arguments.length==1?a:b;this.update()},scale:function(a,b){this._u8g=this.getSVGMatrix.scale(a,this.arguments.length==1?a:b);this.update()},getTranslate:function(){var a=this.getSVGMatrix();return[a.e,a.f]},setTranslate:function(a,b){this._u8g=this.getSVGMatrix();this._u8g.e=a;this._u8g.f=b;this.update()},translate:function(a,b){this._u8g=this.getSVGMatrix().translate(a,b);this.update()},getRotation:function(){return this._uI6},setRotation:function(d,b,f){if(this._uI6!=undefined){var c=this._uI6;this.rotate(-c[0],c[1],c[2])}this.rotate(d,b,f)},rotate:function(b,a,c){if(b<0){b+=360}b=b%360;this.getSVGMatrix();if(arguments.length>1){this._u8g=this._u8g.translate(a,c)}this._u8g=this._u8g.rotate(b,a,c);if(arguments.length>1){this._u8g=this._u8g.translate(-a,-c)}this._uI6[0]=b;this._uI6[1]=a;this._uI6[2]=c;this.update()},commitTranslate:function(){this._uo3[0]=this.e;this._uo3[1]=this.f},getSVGMatrix:function(){if(this._u8g==undefined){this._u8g=ludo.svg.SVGElement.createSVGMatrix()}return this._u8g},update:function(){this.getTransformObject().setMatrix(this._u8g)},getTransformObject:function(){if(this._u82==undefined){if(this.node.el.transform.baseVal.numberOfItems==0){var a;if(this.node.el.ownerSVGElement){a=this.node.el.ownerSVGElement}else{a=document.createElementNS("http://www.w3.org/2000/svg","svg")}var b=a.createSVGTransform();this.node.el.transform.baseVal.appendItem(b)}this._u82=this.node.el.transform.baseVal.getItem(0)}return this._u82}});ludo.svg.setGlobalMatrix=function(a){ludo.svg.SVGElement=a;ludo.svg.globalMatrix=a.createSVGMatrix()};ludo.svg.Engine=new Class({get:function(b,a){if(a.substring(0,6)=="xlink:"){return b.getAttributeNS("http://www.w3.org/1999/xlink",a.substring(6))}else{return b.getAttribute(a)}}});ludo.svgEngine=new ludo.svg.Engine();ludo.svg.Util={pathStyles:function(b){var c=jQuery("<div>");c.addClass(b);c.css("display","none");
ludo.Theme.getThemeEl().append(c);var a={fill:ludo.svg.Util._uDe(c.css("background-color")),"fill-opacity":c.css("opacity"),stroke:ludo.svg.Util._uDe(c.css("border-color")),"stroke-width":c.css("border-width").replace("px","")};c.remove();return a},textStyles:function(c){var d=jQuery("<div>");d.addClass(c);d.css("display","none");ludo.Theme.getThemeEl().append(d);var a=d.css("line-height").replace(/[^0-9\.]/g,"");if(!a){a=d.css("font-size")}var f=parseInt(d.css("font-size"));f++;var b={"font-size":f+"px","font-family":d.css("font-family"),"font-weight":d.css("font-weight"),"font-style":d.css("font-style"),"line-height":a,fill:ludo.svg.Util._uDe(d.css("color")),stroke:"none","stroke-opacity":0};b["line-height"]=b["line-height"]||b["font-size"];d.remove();return b},_uDe:function(b){if(b.indexOf("rgb")>=0){if(this.colorUtil==undefined){this.colorUtil=new ludo.color.Color()}b=b.replace(/[^0-9,]/g,"");var a=b.split(/,/g);if(a.length==4){return b}b=this.colorUtil.rgbCode(a[0]/1,a[1]/1,a[2]/1);return b}return b}};ludo.svg.Node=new Class({Extends:Events,el:undefined,tagName:undefined,id:undefined,dirty:undefined,_bbox:undefined,_attr:undefined,classNameCache:[],tCache:{},tCacheStrings:undefined,initialize:function(b,a,c){this._attr={};a=a||{};a.id=this.id=a.id||"ludo-svg-node-"+String.uniqueID();if(b!==undefined){this.tagName=b}this.createNode(this.tagName,a);if(c!==undefined){this.text(c)}},createNode:function(b,a){if(a!==undefined){if(typeof b=="string"){b=this.createNode(b)}var c=this;Object.each(a,function(f,d){if(f.getUrl!==undefined){f=f.getUrl()}if(d=="css"){this.css(f)}else{if(d.substring(0,6)=="xlink:"){b.setAttributeNS("http://www.w3.org/1999/xlink",d.substring(6),f)}else{b.setAttribute(d,f);c._attr[d]=f}}}.bind(this))}else{b=document.createElementNS("http://www.w3.org/2000/svg",b)}this.el=b;b.style&&(b.style.webkitTapHighlightColor="rgba(0,0,0,0)");return b},getEl:function(){return this.el},_uBf:function(b){for(var a in b){if(b.hasOwnProperty(a)){this.on(a,b[a])}}},on:function(b,a){switch(b.toLowerCase()){case"mouseenter":ludo.canvasEventManager.addMouseEnter(this,a);break;case"mouseleave":ludo.canvasEventManager.addMouseLeave(this,a);break;default:this._addEvent(b,this.getDOMEventFn(b,a),this.el);this.addEvent(b,a)}},_addEvent:(function(){if(document.addEventListener){return function(c,b,a){if(a==undefined){a=this.el}a.addEventListener(c,b,false)}}else{return function(c,b,a){if(a==undefined){a=this.el}a.attachEvent("on"+c,b)}}})(),off:function(a,b){if(this.el.removeEventListener){this.el.removeEventListener(a,b,false)}else{this.el.detachEvent("on"+a,b)}},relativePosition:function(b){var a=this.el.getBoundingClientRect();return{x:b.clientX-a.left,y:b.clientY-a.top}},getDOMEventFn:function(a,b){return function(k){k=k||window.event;var l=k.currentTarget||k.target||k.srcElement;while(l&&l.nodeType==3){l=l.parentNode}l=l.correspondingUseElement||l;var g,f;var h=k.touches;if(!h&&k.originalEvent){h=k.originalEvent.touches}var d=k.pageX;var m=k.pageY;if(h&&h.length>0){g=h[0].clientX;f=h[0].clientY;d=h[0].pageX;m=h[0].pageY}else{g=k.clientX;f=k.clientY}var j=this.el.tagName=="svg"?this.el:this.el.ownerSVGElement;var c=j?j.getBoundingClientRect():{left:0,top:0};k={target:l,pageX:(d!=null)?d:g+document.scrollLeft,pageY:(m!=null)?m:f+document.scrollTop,clientX:g-c.left,clientY:f-c.top,event:k};if(b){b.call(this,k,this,b)}return false}.bind(this)},append:function(a){this.el.appendChild(a.getEl());a.parentNode=this;return this},parent:function(){return this.parentNode},show:function(){this.css("display","")},hide:function(){this.css("display","none")},_uNf:function(){return this.css("display")=="none"},setAttributes:function(a){jQuery.each(a,function(b,c){this.set(b,c)}.bind(this))},setProperties:function(a){this.setAttributes(a)},attr:function(a,b){if(arguments.length==1){return this.get(a)}this.set(a,b)},set:function(a,b){this._attr[a]=b;this.dirty=true;if(a.substring(0,6)=="xlink:"){if(b.id!==undefined){b="#"+b.getId()}this.el.setAttributeNS("http://www.w3.org/1999/xlink",a.substring(6),b)}else{if(b!=undefined&&b.id!==undefined){b="url(#"+b.getId()+")"}this.el.setAttribute(a,b);if(a=="class"&&b.length==0){this.classNameCache=[]}}},_setPlain:function(a,b){this._attr[a]=b;this.dirty=true;this.el.setAttribute(a,b)},removeAttr:function(a){if(a.substring(0,6)=="xlink:"){this.el.removeAttributeNS("http://www.w3.org/1999/xlink",a.substring(6))}else{this.el.removeAttribute(a)}},remove:function(){if(this.el.parentNode){this.el.parentNode._u3d(this.el)}},get:function(a){if(a.substring(0,6)=="xlink:"){return this.el.getAttributeNS("http://www.w3.org/1999/xlink",a.substring(6))}else{return this.el[a]!=undefined&&this.el[a].animVal!=undefined?this.el[a].animVal.value:this.el.getAttribute(a)}},getTranslate:function(){return this._getMatrix().getTranslate()},applyFilter:function(a){this.set("filter",a.getUrl())},applyMask:function(a){this.set("mask",a.getUrl())},clip:function(a){this.set("clip-path",a.getUrl())},_uxe:function(a){this.set("fill",a.getUrl())
},url:function(a,b){this.set(a,b.getUrl!==undefined?b.getUrl():"url(#"+b+")")},href:function(a){this.set("xlink:href",a)},text:function(a){this.el.textContent=a},add:function(b,a,d){var c=new ludo.svg.Node(b,a,d);this.append(c);return c},css:function(a,c){if(arguments.length==1&&jQuery.type(a)=="string"){return this.el.style[String.camelCase(a)]}else{if(arguments.length==1){var b=this.el;jQuery.each(a,function(d,f){b.style[String.camelCase(d)]=f})}else{this.el.style[String.camelCase(a)]=c}}return this},addClass:function(b){if(!this.hasClass(b)){this.classNameCache.push(b);this.updateClsById()}var a=this.el.getAttribute("class");if(a){a=a.split(/\s/g);if(a.indexOf(b)>=0){return}a.push(b);this.set("class",a.join(" "))}else{this.set("class",b)}return this},hasClass:function(b){if(!this.classNameCache){var a=this.el.getAttribute("class");if(a){this.classNameCache=a.split(/\s/g)}else{this.classNameCache=[]}}return this.classNameCache.indexOf(b)>=0},removeClass:function(a){if(this.hasClass(a)){var b=this._attr.id;this.classNameCache.erase(a);this.updateClsById()}return this},removeAllClasses:function(){this.set("class","");this.classNameCache=[]},updateClsById:function(){this.set("class",this.classNameCache.join(" "))},getId:function(){return this.id},getUrl:function(){return"url(#"+this.id+")"},position:function(){var c=this.getBBox();if(this.tagName=="g"){if(this.__u8g!=undefined){var b=this.__u8g.getTranslate();return{left:b[0],top:b[1]}}else{return{left:0,top:0}}}var a=[0,0];if(this.__u8g!=undefined){a=this.__u8g.getTranslate()}return{left:c.x+a[0],top:c.y+a[1]}},offset:function(){var c=this.position();var a=this.parentNode;while(a&&a.tagName!="svg"){var b=a.position();c.left+=b.left;c.top+=b.top;a=a.parentNode}return c},getBBox:function(){if(this.tagName=="g"||this.tagName=="text"){return this.el.getBBox()}if(this._bbox==undefined||this.dirty){var a=this._attr;switch(this.tagName){case"rect":this._bbox={x:a.x||0,y:a.y||0,width:a.width,height:a.height};break;case"circle":this._bbox={x:a.cx-a.r,y:a.cy-a.r,width:a.r*2,height:a.r*2};break;case"ellipse":this._bbox={x:a.cx-a.rx,y:a.cy-a.ry,width:a.rx*2,height:a.ry*2};break;case"path":this._us8("d");break;case"polyline":case"polygon":this._us8("points");break;case"image":var b=this.el.getBoundingClientRect();this._bbox={x:a.x||0,y:a.y||0,width:b.width,height:b.height};break;default:this._bbox={x:0,y:0,width:0,height:0}}}return this._bbox},_us8:function(n){var d=this._attr[n];d=d.replace(/,/g," ");d=d.replace(/([a-z])/g,"$1 ");d=d.replace(/\s+/g," ");if(n=="d2"){if(this.el.getBoundingClientRect!=undefined){var b=this.el.getBoundingClientRect();var j=this.getTranslate();var m=this.el.parentNode.getBoundingClientRect();if(b!=undefined){this._bbox={x:b.left-j[0]-m.left,y:b.top-j[1]-m.top,width:b.width,height:b.height};return}}}d=d.replace(/\s+/g," ");d=d.trim();var o=d.split(/\s/g);var g,f,c,a;var q=undefined;var h=0;while(h<o.length){d=o[h];if(isNaN(d)){d=d.toLowerCase();if(d=="l"||d=="m"){q=d;h++;yi=h+2}}if(!isNaN(o[h])){var l=parseFloat(o[h]);if(g==undefined||l<g){g=l}if(c==undefined||l>c){c=l}var k=parseFloat(o[h+1]);if(f==undefined||k<f){f=k}if(a==undefined||k>a){a=k}h+=2}else{h++}}this._bbox={x:g,y:f,width:c-g,height:a-f}},getSize:function(){var a=this.getBBox();return{x:a.width-a.x,y:a.height-a.y}},svg:function(){return this.el.ownerSVGElement},getViewPort:function(){return this.el.viewPortElement},getRotate:function(){return this._getMatrix().getRotation()},setScale:function(a,b){this._getMatrix().setScale(a,b)},scale:function(a,b){this._getMatrix().scale(a,b)},setRotate:function(b,a,c){this._getMatrix().setRotation(b,a,c)},rotate:function(b,a,c){this._getMatrix().rotate(b,a,c)},setTranslate:function(a,b){this._getMatrix().setTranslate(a,b)},translate:function(a,b){this._getMatrix().translate(a,b)},__u8g:undefined,_getMatrix:function(){if(this.__u8g==undefined){this.__u8g=new ludo.svg.Matrix(this)}return this.__u8g},empty:function(){this.el.textContent=""},animate:function(d,b,f,a){var c={};if(!jQuery.isPlainObject(b)){c.duration=b;c.easing=f;c.complete=a}else{c=b}ludo.svgAnimation.animate(this,d,c);return this},_animation:undefined,animation:function(){if(this._animation===undefined){this._animation=new ludo.svg.Animation(this.getEl())}return this._animation},toFront:function(){if(Browser.ie){this._toFront.delay(20,this)}else{this._toFront()}},_toFront:function(){this.el.parentNode.appendChild(this.el)},toBack:function(){if(Browser.ie){this._toBack.delay(20,this)}else{this._toBack()}},_toBack:function(){this.el.parentNode.insertBefore(this.el,this.el.parentNode.firstChild)}});ludo.svg.View=new Class({Extends:ludo.Core,node:undefined,tag:undefined,engine:ludo.svg,p:undefined,attr:undefined,_ukd:function(a){this.parent(a);this._uWf(a,["tag","attr"]);this.node=new ludo.svg.Node(this.tag,this.attr)},$:function(a,b){return new ludo.svg.Node(a,b)},getNode:function(){return this.node},getEl:function(){return this.node.el},set:function(a,b){this.node.set(a,b)},get:function(a){return this.node.get(a)
},html:function(a){this.node.html(a)},rotate:function(a){this.node.rotate(a)},toFront:function(){this.node.toFront()},toBack:function(){this.node.toBack()},skewX:function(a){this.node.skewX(a)},skewY:function(a){this.node.skewY(a)},hide:function(){this.node.hide()},show:function(){this.node.show()},scale:function(a,b){this.node.scale(a,b)},css:function(a,b){this.node.css(a,b)},append:function(a){this.node.append(a);return this},empty:function(){this.node.empty();return this},add:function(b,a,c){return this.node.add(b,a,c)}});ludo.svg.Canvas=new Class({Extends:ludo.svg.View,tag:"svg",defaultProperties:{xmlns:"http://www.w3.org/2000/svg",version:"1.1"},renderTo:undefined,view:undefined,title:undefined,description:undefined,_ukd:function(a){a=a||{};a.attr=a.attr||{};a.attr=Object.merge(a.attr,this.defaultProperties);this.parent(a);this._uWf(a,["renderTo","title","description"]);if(this.title){this.createTitle()}if(this.description){this.createDescription()}ludo.svg.setGlobalMatrix(this.node.el);if(this.renderTo!==undefined){if(this.renderTo.$b!==undefined){this.view=this.renderTo;this.view.addEvent("resize",this.fitParent.bind(this));this.renderTo=this.view.$b()}else{this.renderTo=jQuery(this.renderTo)}this.renderTo.append(this.getEl());this.setInitialSize(a)}},setInitialSize:function(a){a.width=a.width||this.width;a.height=a.height||this.height;if(a.width&&a.height){this.set("width",a.width);this.set("height",a.height);this.setViewBox(a.width,a.height);this.width=a.width;this.height=a.height}else{this.fitParent();this.renderTo.on("resize",this.fitParent.bind(this))}},fitParent:function(){var a={x:this.renderTo.width(),y:this.renderTo.height()};if(a.x===0||a.y===0){return}this.set("width",a.x);this.set("height",a.y);this.setViewBox(a.x,a.y);this.node.css("width",a.x+"px");this.node.css("height",a.y+"px");this.width=a.x;this.height=a.y;this._uif("resize",a)},getHeight:function(){return this.height},getWidth:function(){return this.width},getCenter:function(){return{x:this.width/2,y:this.height/2}},setViewBox:function(c,b,a,d){this.set("viewBox",(a||0)+" "+(d||0)+" "+c+" "+b)},createTitle:function(){this.append(new ludo.svg.Node("title",{},this.title))},createDescription:function(){this.append(new ludo.svg.Node("desc",{},this.description))},addStyleSheet:function(a,b){var c=new ludo.svg.Paint(b,{className:a});this.appendDef(c)},defsNode:undefined,getDefs:function(){if(this.defsNode===undefined){this.defsNode=new ludo.svg.Node("defs");this.append(this.defsNode)}return this.defsNode},appendDef:function(a){return this.getDefs().append(a)}});ludo.layout.TextBox=new Class({Extends:ludo.svg.Canvas,rotation:270,text:undefined,className:undefined,_uha:undefined,width:200,height:200,size:{x:0,y:0},x:0,y:0,colorUtil:undefined,_ukd:function(a){this.text=a.text;this.rotation=a.rotation;this.className=a.className;this._uha=a._uha||a.className;this.renderTo=a.renderTo;if(a.x!==undefined){this.x=a.x}if(a.y!==undefined){this.y=a.y}if(document.createElementNS===undefined){this.createIE8Box(a);return}this.parent(a);this.createStyles();this.renderText();this.storeSize();this.rotate();this.resizeCanvas()},createIE8Box:function(){var a=document.createElement("span");jQuery(this.renderTo).append(jQuery(a));a.innerHTML=this.text;this.setIE8Transformation(a);return a},setIE8Transformation:function(b){var a=b.style;a.display="block";a.visibility="hidden";a.position="absolute";b.className=this.className;jQuery(document.body).append(b);a.fontSize="12px";a.fontWeight="normal";a.filter="progid:DXImageTransform.Microsoft.Matrix("+this.getIE8Transformation()+", sizingMethod='auto expand')";a.height=b.height()+"px";this.size.x=b.width();this.size.y=b.height();if(this.rotation===90){a.right="0px"}a.visibility="visible";document.id(this.renderTo).appendChild(b)},leave:function(){this.textNode.removeClass(this._uha+"svg");this.textNode.addClass(this.className+"svg")},enter:function(){this.textNode.addClass(this._uha+"svg")},deg2radians:Math.PI*2/360,getIE8Transformation:function(){var a=this.rotation*this.deg2radians;var b=Math.cos(a);var c=Math.sin(a);return["M11="+b,"M12="+(c*-1),"M21="+c,"M22="+b].join(",")},resizeCanvas:function(){var a=this.getSize();this.setViewBox(a.x,a.y);this.set("width",a.x);this.set("height",a.y)},createStyles:function(){this.styles=ludo.svg.Util.textStyles(this.className);var a=ludo.svg.Util.textStyles(this._uha);a["font-size"]=this.styles["font-size"];a["line-height"]=this.styles["line-height"];this.addStyleSheet(this.className+"svg",this.styles);this.addStyleSheet(this._uha+"svg",a)},renderText:function(){var a=this.textNode=new ludo.svg.Node("text",{x:this.x,y:this.y+parseInt(this.styles["font-size"]),"class":this.className+"svg"});a.text(this.text);this.append(a)},storeSize:function(){var a=this.textNode.el.getBBox();this.size={x:a.width+a.x,y:a.height+a.y}},rotate:function(){var a=this.size.x;var d=this.size.y;var c=(this.size.y-parseInt(this.styles["line-height"]))/2;var b="";switch(this.rotation){case 270:b="translate("+(c*-1)+" "+a+") rotate("+this.rotation+")";
break;case 180:b="rotate("+this.rotation+" "+(a/2)+" "+(d/2)+")";break;case 90:b="translate("+(d-c)+" "+0+") rotate("+this.rotation+")";break;case 0:b="translate(0 "+(c*-1)+")"}this.textNode.set("transform",b)},getSize:function(){switch(this.rotation){case 270:case 90:return{x:this.size.y,y:this.size.x};default:return this.size}}});ludo.layout.Resizer=new Class({Extends:ludo.Core,type:"layout.Resizer",layout:{},_uWd:undefined,view:undefined,dd:undefined,pos:undefined,isActive:false,hidden:false,lm:undefined,_ukd:function(a){this.parent(a);this._uWf(a,["_uWd","view","layout","pos","hidden","lm"]);this._unf(a.renderTo);this._ux9();this._uu8();if(this.lm.type=="layout.Docking"&&this.lm.collapsed){this.hidden=true}if(this.hidden){this.hide()}this.lm.on("collapse",this.hide.bind(this));this.lm.on("expand",this.show.bind(this))},_unf:function(d){var c=this._uWd==="horizontal";var a="ludo-resize-handle ludo-resize-handle-"+((this._uWd==="horizontal")?"col":"row")+"ludo-layout-resize-"+(c?"col":"row");var b=this.el=jQuery('<div class="'+a+'">');b.on("mouseenter",this.enterResizer.bind(this));b.on("mouseleave",this.leaveResizer.bind(this));b.css({cursor:(c?"ew-resize":"ns-resize"),zIndex:100000});d.append(b)},enterResizer:function(){if(!this.isActive){this.el.css("z-index",parseInt(this.el.css("z-index"))+1);this.el.addClass("ludo-resize-handle-active")}},leaveResizer:function(){if(!this.isActive){this.el.css("z-index",parseInt(this.el.css("z-index"))-1);this.el.removeClass("ludo-resize-handle-active")}},_uu8:function(){this.dd=new ludo.effect.Drag({directions:this._uWd=="horizontal"?"X":"Y"});this.dd.on("before",this._uGe.bind(this));this.dd.on("end",this._u4g.bind(this));this.dd.add(this.el)},_uGe:function(){this.dd.setMinX(30);this.isActive=true;this.el.removeClass("ludo-resize-handle-active");this.el.addClass("ludo-resize-handle-active");this._uif("before",[this,this.view]);this._uif("_uGd")},_u5e:function(a){if(this.pos==="left"){var b=this.view.getEl();this.dd.setMaxX(b.position().left+b.width()-a)}else{this.dd.setMinX(this.view.getEl().position().left+a)}},_u4e:function(a){var b=this.view.getEl();if(this.pos==="right"){this.dd.setMaxX(b.position().left+a)}else{var c=0;if(this.layout._uS6){c=this.layout._uS6.getEl().position().left+10}this.dd.setMinX(Math.max(c,b.position().left+b.width()-a))}},_u5b:function(b){if(this.pos==="above"){var a=this.view.getEl();this.dd._u7g(a.position().top+a.height()-b)}else{this.dd.setMinY(this.view.getEl().position().top+b)}},_uib:function(c){var a=this.view.getEl();if(this.pos==="below"){this.dd._u7g(a.position().top+c)}else{var b=10;if(this.layout._uS6){b=this.layout._uS6.getEl().position().top+10}this.dd.setMinY(Math.max(b,a.position().top+a.height()-c))}},_u4g:function(b,a){this.el.removeClass("ludo-resize-handle-over");this.el.removeClass("ludo-resize-handle-active");var c=this._uWd==="horizontal"?a._uUeX():a._uUd();if(this.pos==="left"||this.pos==="above"){c*=-1}this._uif("resize",c);this._uif("_uye");this.isActive=false},getEl:function(){return this.el},_ux9:function(){var a=this.view;a.on("maximize",this.show.bind(this));a.on("expand",this.show.bind(this));a.on("minimize",this.hide.bind(this));a.on("collapse",this.hide.bind(this));a.on("hide",this.hide.bind(this));a.on("show",this.show.bind(this))},show:function(){this.el.css("display","");this.hidden=false},hide:function(){this.hidden=true;this.el.css("display","none")},getWidth:function(){return this.hidden?0:5},getHeight:function(){return this.hidden?0:5},resize:function(a){this.el.css({left:"",top:"",right:"",bottom:""});if(a.width!==undefined&&a.width>0){this.el.css("width",a.width)}if(a.height!==undefined&&a.height>0){this.el.css("height",(a.height-ludo.dom._u6g(this.el)))}if(a.left!==undefined){this.el.css("left",a.left)}if(a.top!==undefined){this.el.css("top",a.top)}if(a.bottom!==undefined){this.el.css("bottom",a.bottom)}if(a.right!==undefined){this.el.css("right",a.right)}},getParent:function(){},_uj3:function(){},isVisible:function(){return !this.hidden},_uNf:function(){return this.hidden},hasChildren:function(){return false},_uE9:function(){return false}});ludo.layout.Base=new Class({Extends:Events,view:null,tabStrip:null,_uQe:[],benchmarkTime:false,dependency:{},_uEf:undefined,resized:false,_uoc:undefined,_uA9:undefined,initialize:function(a){this.id=String.uniqueID();this.view=a;this._uEf={top:parseInt(this.view.$b().css("padding-top")),left:parseInt(this.view.$b().css("padding-left")),width:0,height:0,bottom:0,right:0};if(a.$b()){this.onCreate()}this._uoc=!a.layout.weight&&a.layout.width=="wrap";this._uA9=!a.layout.weight&&a.layout.height=="wrap"},_ul:function(){},onCreate:function(){if(this.view.layout.listeners!=undefined){this._uBf(this.view.layout.listeners)}this._uif("create",[this,this.view])},_uVf:function(h,f,g){h=this.getValidChild(h);h=this._ux6(h);var d=this._uM1(h);d=jQuery(d);if(f){var b=[];for(var a=0;a<this.view.children.length;a++){if(g=="after"){b.push(this.view.children[a]);d.append(this.view.children[a].getEl())
}if(this.view.children[a].getId()==f.getId()){b.push(h);d.append(h.getEl())}if(g=="before"){b.push(this.view.children[a]);d.append(this.view.children[a].getEl())}}this.view.children=b}else{this.view.children.push(h);var c=h.getEl();d.append(c)}this._uIe(h);this._uVfEvents(h);this._uif("_uVf",[this,this.view,h]);if(this._uQb){this._uif("_uVfRuntime",[this,this.view,h])}return h},_uM1:function(){return jQuery(this.view.els.body)},layoutProperties:["collapsed"],getValidChild:function(a){return a},_uIe:function(c){var b=this.layoutProperties;for(var a=0;a<b.length;a++){if(c.layout[b[a]]===undefined&&c[b[a]]!==undefined){c.layout[b[a]]=c[b[a]]}}},_uVfEvents:function(){},_uQb:false,_uy8:function(){if(this.benchmarkTime){var a=new Date().getTime()}if(this.view._uNf()){return}if(this.idLastDynamic===undefined){this._u4()}this._uk4();if(!this._uQb){this.beforeFirstResize()}this.resize();if(!this._uQb){this._uQb=true;if(this._uA9){this.view.layout.height=this._uEf.height=this._uh5()}if(this._uoc){this.view.layout.width=this._uEf.width=this._ut6()}if(this._uA9||this._uoc){this.view.resize({height:this.view.layout.height,width:this.view.layout.width});this._uk4();this._uoc=false;this._uA9=false}this._uif("rendered",[this,this.view]);this.afterRendered()}if(this.benchmarkTime){ludo.util.log("Time for resize("+this.view.layout.type+"): "+(new Date().getTime()-a))}},afterRendered:function(){},hasBeenRendered:function(){return this._uQb},beforeFirstResize:function(){},_uh5:function(){return this.view.getEl().outerHeight(true)-this.view.$b().height()},_ut6:function(){return 0},_uk4:function(){var a=this._uEf;a.absWidth=this._uP9();a.absHeight=this._ut8();a.width=this._uP9();a.height=this._ut8()},previousContentWidth:undefined,idLastDynamic:undefined,_u4:function(){for(var a=this.view.children.length-1;a>=0;a--){if(this._uw6(this.view.children[a])){this.idLastDynamic=this.view.children[a].id;return}}this.idLastDynamic="NA"},_uw6:function(a){return a.layout!==undefined&&a.layout.weight!==undefined},_ux6:function(a){a.renderTo=this.view.$b();a.type=a.type||this.view.cType;a._uB6=this.view;return ludo.factory.create(a)},_uZ9:function(b){var a=this.view._ue3;if(a.length){return a[a.length-1].id==b.id}else{return this.view.children[this.view.children.length-1].id==b.id}},_uYd:function(){},resize:function(){var a={};a.width=this.view.$b().width();if(a.width<0){a.width=undefined}var d=this.view.children;for(var b=0;b<d.length;b++){d[b].resize(a)}},_uP9:function(){return this.view.$b().width()},_ut8:function(){return this.view.$b().height()},_u88:function(a){if(a){this._uEf[a.key]=a.value}},_u28:function(){if(this._uHf===undefined){this._uHf=this.dependency._uHf=new ludo.layout.Renderer({view:this.view})}return this._uHf},_uZd:function(){return this._uHf?this._uHf:this._u28()},_uef:function(a){this._ua5(a,{width:0,height:0})},minimize:function(b,a){this._ua5(b,a);this.resize()},_ua5:function(c,b){var a=c.layout;if(b.width!==undefined){a._uqc=a.width;a.width=b.width}else{a._uW9=a.height;a.height=b.height}},_u02:function(b){var a=b.layout;if(a._uqc!==undefined){a.width=a._uqc}if(a._uW9!==undefined){a.height=a._uW9}a._uqc=undefined;a._uW9=undefined;this.resize()},_uMe:function(a){return a.layout.width},_uz4:function(b){var a={width:this._uEf.width,height:this._uEf.height};jQuery.each(this.view.children,function(c,d){if(d.id!=b.id&&d.layout!=undefined&&!isNaN(d.layout.height)){a.height-=d.layout.height}});return a},getHeightOf:function(b){var a=b._uV9!=undefined?b._uV9(this._uz4(b)):undefined;if(a!=undefined){return a}if(b.layout.height=="wrap"){b.layout.height=b.getEl().outerHeight(true)}return isNaN(b.layout.height)?b.getEl().outerHeight(true):b.layout.height}});ludo.color.Color=new Class({randomColor:function(){return this.rgbCode({r:Math.floor(Math.random()*255),g:Math.floor(Math.random()*255),b:Math.floor(Math.random()*255)})},rgbColors:function(b){if(b.substr!==undefined){return this.rgbObject(b)}if(b.h!==undefined){return this.hsvToRGB(b.h,b.s,b.v)}return undefined},rgbObject:function(a){a=a.replace("#","");return{r:a.substr(0,2).toInt(16),g:a.substr(2,2).toInt(16),b:a.substr(4,2).toInt(16)}},rgbCode:function(f,d,h){if(d===undefined){if(f.r!==undefined){d=f.g;h=f.b;f=f.r}else{if(f.h!==undefined){var g=this.hsvToRGB(f.h,f.s,f.v);f=g.r;d=g.g;h=g.b}}}return this.toRGB(f,d,h)},toRGB:function(j,h,c){var f=Math.round(j).toString(16);var d=Math.round(h).toString(16);var a=Math.round(c).toString(16);if(f.length===1){f=["0",f].join("")}if(d.length===1){d=["0",d].join("")}if(a.length===1){a=["0",a].join("")}return["#",f,d,a].join("").toUpperCase()},toRGBFromObject:function(a){return this.toRGB(a.r,a.g,a.b)},brightness:function(a,c){if(arguments.length===1){return this.toHSV(a).v}else{var b=this.toHSV(a);b.v=c;return this.rgbCode(b)}},saturation:function(a,c){if(arguments.length===1){return this.toHSV(a).s}else{var b=this.toHSV(a);b.s=c;return this.rgbCode(b)}},toHSV:function(a){if(a.r===undefined){a=this.rgbObject(a)}return this.toHSVFromRGB(a.r,a.g,a.b)
},toHSVFromRGBCode:function(b){var a=this.rgbObject(b);return this.toHSVFromRGB(a.r,a.g,a.b)},toHSVFromRGB:function(m,l,c){m=m/255;l=l/255;c=c/255;var a=Math.max(m,l,c),f=Math.min(m,l,c);var k,j;var n=a-f;j=a===0?0:n/a;if(a==f){k=0}else{switch(a){case m:k=(l-c)/n+(l<c?6:0);break;case l:k=(c-m)/n+2;break;case c:k=(m-l)/n+4;break}k/=6}return{h:k*360,s:j*100,v:a*100}},hsvToRGBCode:function(d,c,a){if(c===undefined){c=d.s;a=d.v;d=d.h}var b=this.hsvToRGB(d,c,a);return this.toRGB(b.r,b.g,b.b)},hsvToRGB:function(k,w,o){if(w===undefined){w=k.s;o=k.v;k=k.h}k/=360;w/=100;o/=100;var a,l,n;var j=Math.floor(k*6);var m=k*6-j;var d=o*(1-w);var c=o*(1-m*w);var u=o*(1-(1-m)*w);switch(j%6){case 0:a=o;l=u;n=d;break;case 1:a=c;l=o;n=d;break;case 2:a=d;l=o;n=u;break;case 3:a=d;l=c;n=o;break;case 4:a=u;l=d;n=o;break;case 5:a=o;l=d;n=c;break}return{r:a*255,g:l*255,b:n*255}},hslToRgb:function(k,o,j){var a,m,n;if(o==0){a=m=n=j}else{function f(h,g,b){if(b<0){b+=1}if(b>1){b-=1}if(b<1/6){return h+(g-h)*6*b}if(b<1/2){return g}if(b<2/3){return h+(g-h)*(2/3-b)*6}return h}var c=j<0.5?j*(1+o):j+o-j*o;var d=2*j-c;a=f(d,c,k+1/3);m=f(d,c,k);n=f(d,c,k-1/3)}return{r:a*255,g:m*255,b:n*255}},offsetHue:function(a,c){var b=this.toHSV(a);b.h+=c;b.h=b.h%360;return this.rgbCode(b)},offsetBrightness:function(a,c){var b=this.toHSV(a);b.v+=c;if(b.v>100){b.v=100}if(b.v<0){b.v=0}return this.rgbCode(b)},offsetSaturation:function(a,c){var b=this.toHSV(a);b.s+=c;if(b.s>100){b.s=100}if(b.s<0){b.s=0}return this.rgbCode(b)},brighten:function(a,c){var b=this.toHSV(a);a=this.offsetBrightness(a,b.v*c/100);a=this.offsetSaturation(a,b.s*c/100*-1);return a},darken:function(a,c){var b=this.toHSV(a);a=this.offsetBrightness(a,b.v*c/100*-1);a=this.offsetSaturation(a,b.s*c/100);return a}});ludo.svg.Animation=new Class({animationRate:13,color:undefined,_queue:undefined,_animationIds:undefined,testing:false,initialize:function(){this._queue={};this._animationIds={}},colorUtil:function(){if(this.color==undefined){this.color=new ludo.color.Color()}return this.color},getPathSegments:function(b){if(b.substr==undefined){return b}b=b.replace(/,/g," ");b=b.replace(/\s+/g," ");var a=b.split(/\s/g);jQuery.each(a,function(c,d){if(!isNaN(d)){a[c]=parseFloat(d)}});return a},animate:function(c,b,a){if(this.color==undefined){this.colorUtil()}this.queue({node:c,properties:b,options:a})},queue:function(a){a.__finish=this.next.bind(this);a.id=a.node.id;a.animationId=String.uniqueID();this._animationIds[a.id]=a.animationId;var b=this.hasQueue(a);var c=a.options.queue!=undefined?a.options.queue:true;if(this._queue[a.id]==undefined){this._queue[a.id]=[]}if(c){this._queue[a.id].push(a)}if(!c||!b){this.fn.call(this,a)}},hasQueue:function(a){return this._queue[a.id]!=undefined&&this._queue[a.id].length>0},fn:function(h){var f=h.node;var l=h.properties;var p=h.options;var g=p.duration||400;var k=p.easing||ludo.svg.easing.inSine;var n={};var d={};var j={};var c=h.__finish;jQuery.each(l,function(y,w){j[y]=true;switch(y){case"d":var q=f.attr("d");d[y]=this.getPathSegments(q);n[y]=this.getPathSegments(w);jQuery.each(n[y],function(u,C){if(!isNaN(C)){n[y][u]=C-d[y][u]}});break;case"fill":case"stroke":case"stop-color":var B=f.attr(y)||"#000000";if(B.length==4){B=B+B.substr(1)}var z=this.colorUtil();var t=z.rgbColors(B);var v=z.rgbColors(w);n[y]=[v.r-t.r,v.g-t.g,v.b-t.b];d[y]=t;break;case"translate":var A=jQuery.type(w[0])=="string"&&(/[+\-]/.test(w[0]));w[0]=parseInt(w[0]);w[1]=w[1]?parseInt(w[1]):0;var x=A?[0,0]:f.getTranslate();n[y]=[w[0]-x[0],w[1]-x[1]];d[y]=f.getTranslate();j[y]=true;break;case"rotate":var s=f.getRotate();n[y]=[w[0]-s[0],w[1],w[2]];d[y]=s[0];break;case"scale":default:var r=parseFloat(f.get(y));if(isNaN(r)){r=1}n[y]=w-r;d[y]=r;j[y]=false}}.bind(this));var b=p.progress;var o=p.start;var a=p.step;var m=function(L,A){if(p.validate!=undefined){var K=p.validate.call(this,h.animationId,this._animationIds[h.id]);if(!K){c.call(ludo.svgAnimation,h);return}}var s=L>=A;if(!s&&!this.testing){m.delay(this.animationRate,this,[L+1,A])}var E;if(L==0&&o){o.call(f)}if(s){L=A}var J=k(L,0,1,A);var F,D;for(var I in n){if(n.hasOwnProperty(I)){var G=n[I];if(j[I]){switch(I){case"d":var H=[];jQuery.each(d[I],function(r,t){if(isNaN(t)){H.push(t)}else{H.push(t+(G[r]*J))}});if(a!=undefined){G=a.call(this,H,J,L/A)||G}f.set("d",H.join(" "));break;case"stroke":case"fill":case"stop-color":var q=Math.round(d[I].r+(J*G[0]));var z=Math.round(d[I].g+(J*G[1]));var C=Math.round(d[I].b+(J*G[2]));var B=this.color.toRGB(q,z,C);f.el.setAttribute(I,B);f._attr[I]=B;f.dirty=true;break;case"translate":F=d[I][0]+(J*G[0]);D=d[I][1]+(J*G[1]);f._getMatrix().setTranslate(F,D);break;case"rotate":var w=d[I]+(J*G[0]);F=G[1];D=G[2];w=w%360;f._getMatrix().setRotation(w,F,D);break}}else{var u=d[I]+(G*J);if(a!=undefined){u=a.call(this,u,J,L/A)||u}f.el.setAttribute(I,u);f._attr[I]=u;f.dirty=true;if(b){if(E==undefined){E={}}E[I]=u}}}}if(b!=undefined){b.call(f,L/A,E)}if(s){if(p.complete!=undefined){p.complete.call(f)}c.call(ludo.svgAnimation,h)}if(this.testing&&!s){m.call(this,L+1,A)
}}.bind(this);h.startTime=new Date().getTime();m.call(this,1,Math.ceil(g/this.animationRate))},next:function(b){var a=this._queue[b.id].indexOf(b);if(a>=0){this._queue[b.id].splice(a,1)}if(this._queue[b.id].length>0){this.fn(this._queue[b.id][0])}}});ludo.svgAnimation=new ludo.svg.Animation();ludo.svg.easing={linear:function(f,a,h,g){return h*f/g+a},inQuad:function(f,a,h,g){f/=g;return h*f*f+a},outQuad:function(f,a,h,g){f/=g;return -h*f*(f-2)+a},inOutQuad:function(f,a,h,g){f/=g/2;if(f<1){return h/2*f*f+a}f--;return -h/2*(f*(f-2)-1)+a},inCubic:function(f,a,h,g){f/=g;return h*f*f*f+a},outCubic:function(f,a,h,g){f/=g;f--;return h*(f*f*f+1)+a},inOutCubic:function(f,a,h,g){f/=g/2;if(f<1){return h/2*f*f*f+a}f-=2;return h/2*(f*f*f+2)+a},inQuart:function(f,a,h,g){f/=g;return h*f*f*f*f+a},outQuart:function(f,a,h,g){f/=g;f--;return -h*(f*f*f*f-1)+a},inOutQuart:function(f,a,h,g){f/=g/2;if(f<1){return h/2*f*f*f*f+a}f-=2;return -h/2*(f*f*f*f-2)+a},inQuint:function(f,a,h,g){f/=g;return h*f*f*f*f*f+a},outQuint:function(f,a,h,g){f/=g;f--;return h*(f*f*f*f*f+1)+a},inOutQuint:function(f,a,h,g){f/=g/2;if(f<1){return h/2*f*f*f*f*f+a}f-=2;return h/2*(f*f*f*f*f+2)+a},inSine:function(f,a,h,g){return -h*Math.cos(f/g*(Math.PI/2))+h+a},outSine:function(f,a,h,g){return h*Math.sin(f/g*(Math.PI/2))+a},inOutSine:function(f,a,h,g){return -h/2*(Math.cos(Math.PI*f/g)-1)+a},inExpo:function(f,a,h,g){return h*Math.pow(2,10*(f/g-1))+a},outExpo:function(f,a,h,g){return h*(-Math.pow(2,-10*f/g)+1)+a},inOutExpo:function(f,a,h,g){f/=g/2;if(f<1){return h/2*Math.pow(2,10*(f-1))+a}f--;return h/2*(-Math.pow(2,-10*f)+2)+a},inCirc:function(f,a,h,g){f/=g;return -h*(Math.sqrt(1-f*f)-1)+a},outCirc:function(f,a,h,g){f/=g;f--;return h*Math.sqrt(1-f*f)+a},inOutCirc:function(f,a,h,g){f/=g/2;if(f<1){return -h/2*(Math.sqrt(1-f*f)-1)+a}f-=2;return h/2*(Math.sqrt(1-f*f)+1)+a},bounce:function(g,a,j,h){var f=g/h;f=1-ludo.svg.easing._bounce(1-f);return j*f+a},bow:function(g,a,j,h){var f=ludo.svg.easing._bow(g/h,1.5);return j*f+a},elastic:function(g,a,j,h){var f=ludo.svg.easing._elastic(g/h,1.5);return j*f+a},_elastic:function(b,a){return Math.pow(2,10*(b-1))*Math.cos(20*Math.PI*a/3*b)},_bounce:function(f){for(var d=0,c=1;1;d+=c,c/=2){if(f>=(7-4*d)/11){return -Math.pow((11-6*d-11*f)/4,2)+Math.pow(c,2)}}},_bow:function(b,a){return Math.pow(b,2)*((a+1)*b-a)}};ludo.layout.Factory=new Class({getManager:function(b){var a=this._usfClass(b);if(ludo.layout[a]==undefined){console.error("layout class "+a+" is not valid")}return new ludo.layout[a](b)},_usfClass:function(a){if(!a.layout||!a.layout.type){return"Base"}switch(a.layout.type.toLowerCase()){case"docking":return"Docking";case"accordion":return"Accordion";case"table":return"Table";case"navbar":return"NavBar";case"relative":return"Relative";case"fill":return"Fill";case"viewpager":return"ViewPager";case"card":return"Card";case"grid":return"Grid";case"menu":return["Menu",(a.layout._uWd&&a.layout._uWd.toLowerCase()=="horizontal")?"Horizontal":"Vertical"].join("");case"tabs":case"tab":return"Tab";case"column":case"cols":return"LinearHorizontal";case"popup":return"Popup";case"canvas":return"Canvas";case"rows":case"row":return"LinearVertical";case"linear":return["Linear",(a.layout._uWd&&a.layout._uWd.toLowerCase()=="horizontal")?"Horizontal":"Vertical"].join("");default:return"Base"}},getValidLayoutObject:function(a,c){a.layout=this._u78(a.layout);c.layout=this._u78(c.layout);if(!this._uF2(a,c)){return{}}var b=this._uH6(a.layout,c.layout);if(typeof b==="string"){b={type:b}}b=this._u65(a,c,b);if(b.left===undefined&&b.x!==undefined){b.left=b.x}if(b.top===undefined&&b.y!==undefined){b.top=b.y}if(b._u4d){if(b.width){b.height=Math.round(b.width/b._u4d)}else{if(b.height){b.width=Math.round(b.height*b._u4d)}}}b.type=b.type||"Base";return b},_u78:function(a){if(!a){return{}}if(ludo.util.isString(a)){return{type:a}}return a},_uF2:function(a,b){if(a.layout||b.layout){return true}var d=["left","top","height","width","weight","x","y"];for(var c=0;c<d.length;c++){if(b[d[c]]!==undefined||a[d[c]]!==undefined){return true}}return false},_u65:function(a,c,b){var f=["left","top","width","height","weight","x","y"];for(var d=0;d<f.length;d++){if(b[f[d]]===undefined&&(c[f[d]]!==undefined||a[f[d]]!==undefined)){b[f[d]]=c[f[d]]||a[f[d]]}a[f[d]]=undefined}return b},_uH6:function(c,b){for(var a in b){if(b.hasOwnProperty(a)){c[a]=b[a]}}return c}});ludo.layoutFactory=new ludo.layout.Factory();ludo._une.Base=new Class({Extends:ludo.Core,singleton:false,url:undefined,postData:undefined,data:undefined,autoload:true,method:"post",inLoadMode:false,_u0e:undefined,shim:undefined,__waiting:false,_ukd:function(a){this.parent(a);if(a.data!=undefined){this.autoload=false}this._uWf(a,["method","url","autoload","shim","_u0e"]);this.on("init",this.setWaiting.bind(this));this.on("complete",this.setDone.bind(this));if(this.postData==undefined){this.postData={}}if(a.postData!=undefined){this.postData=Object.merge(this.postData,a.postData)}if(this._u0e==undefined){this._u0e=function(b){return jQuery.isArray(b)?b:b.response!=undefined?b.response:b.data!=undefined?b.data:false
}}if(a.data!=undefined){this.setData(a.data)}},setWaiting:function(){this.__waiting=true},setDone:function(){this.__waiting=false},isWaitingData:function(){return this.__waiting},setPostData:function(a,b){this.postData[a]=b},_use:function(){if(this.autoload){this.load()}},_u1e:function(a){this.arguments=arguments;this.beforeLoad();this._uif("init",this)},setData:function(a){},hasData:function(){return(this.data!==undefined)},getData:function(){return this.data},_uuc:function(b,a){this.postData[b]=a},_uHa:function(){return"JSON"},beforeLoad:function(){this.inLoadMode=true;this._uif("beforeload")},load:function(){},loadUrl:function(a){this.url=a;this._request=undefined;this.load()},_uvc:function(){this.inLoadMode=false},isLoading:function(){return this.inLoadMode},_u2e:function(){return this.postData}});ludo._une.JSON=new Class({Extends:ludo._une.Base,type:"_une.JSON",_loaded:false,load:function(){if(this._url()){this.parent();this._u1e(this._u2e())}},_url:function(){return this.url||ludo.config.getUrl()},_u1e:function(a){this.parent();jQuery.ajax({url:this._url(),method:"post",cache:false,dataType:"json",data:a,complete:function(c,b){this._loaded=true;if(b==="success"){var d=c.responseJSON;var f=this._u0e(d);if(f===false){this._uif("fail",["error","error",this])}else{this._uvc(f,d);this._uif("success",[d,this])}}else{this._uif("fail",[c.responseText,b,this])}this._uif("complete")}.bind(this),fail:function(c,b){console.log("error",b);this._uif("fail",[c,b,this]);this._uif("complete")}.bind(this)})},setData:function(a){this._uvc(a)},_uvc:function(a){this.parent();var b=!this.data;this.data=a;this._uif("parsedata");this._uif("load",[this.data,this]);if(b){this._uif("firstLoad",[this.data,this])}}});ludo.factory.registerClass("_une.JSON",ludo._une.JSON);ludo.layout.Renderer=new Class({view:undefined,options:["width","height","rightOf","leftOf","below","above","_uPb","_uZc","offsetWidth","offsetHeight","rightOrLeftOf","leftOrRightOf","alignLeft","alignRight","alignTop","alignBottom","centerIn","left","top","offsetX","offsetY","fitVerticalViewPort"],fn:undefined,_uEf:{x:0,y:0,width:0,height:0},_u3e:{left:undefined,right:undefined,above:undefined,below:undefined,width:undefined,height:undefined},_ua7:{},initialize:function(a){this.view=a.view;this._uB9();this._uY1();this.view.on("show",this.resize.bind(this));ludo.dom._uLe();this._un8();if(this.view._usf!=undefined){this.view._usf().on("_uVf",this.clearFn.bind(this))}this.view.on("_uVf",this.clearFn.bind(this));this.view.on("remove",this._uwc.bind(this))},_uB9:function(){var d;var f=false;for(var c=0;c<this.options.length;c++){var b=this.options[c];switch(b){case"offsetX":case"offsetY":case"width":case"height":case"left":case"top":case"fitVerticalViewPort":break;default:d=undefined;if(this.view.layout[b]!==undefined){f=true;var g=this.view.layout[b];if(typeof g==="string"){var a;if(g==="parent"){a=this.view.getParent()}else{a=ludo.get(g)}if(a){d=a.getEl();a.on("resize",this.clearFn.bind(this))}else{d=jQuery(g)}}else{if(g.getEl!==undefined){d=g.getEl();g.on("resize",this.clearFn.bind(this))}else{d=jQuery(g)}}if(d){this.view.layout[b]=d}else{this.view.layout[b]=undefined}}}}if(f){this.view.getEl().css("position","absolute")}},_uY1:function(){var a=this.view.layout;a.width=a.width||"matchParent";a.height=a.height||"matchParent"},resizeFn:undefined,_un8:function(){if(this.view.isWindow){return}this.resizeFn=this.resize.bind(this);jQuery(window).on("resize",this.resizeFn)},getParentNode:function(){var a=this.view.getEl().parent();if(!a||!a.prop("tagName")){return}if(a.prop("tagName").toLowerCase()!=="body"){a=jQuery(a)}else{a=jQuery(window)}return a},_uwc:function(){if(this.resizeFn){jQuery(window).off("resize",this.resizeFn)}},buildResizeFn:function(){var c=this.view.getEl().parent();if(!c){this.fn=function(){}}var b=[];var d=[];for(var a=0;a<this.options.length;a++){if(this.view.layout[this.options[a]]!==undefined){b.push(this.getFnFor(this.options[a],this.view.layout[this.options[a]]));d.push(this.options[a])}}this.fn=function(){for(a=0;a<b.length;a++){b[a].call(this,this.view,this)}}},getFnFor:function(d,f){var g=this._u3e;switch(d){case"height":if(f==="matchParent"){return function(c,h){g.height=h._uEf.height}}if(f==="wrap"){var b=ludo.dom._uT1(this.view);this.view.layout.height=b.y;return function(){g.height=b.y}}if(f.indexOf!==undefined&&f.indexOf("%")>0){f=parseInt(f);return function(c,h){g.height=(h._uEf.height*f/100)}}return function(){g.height=this.view.layout[d]}.bind(this);case"width":if(f==="matchParent"){return function(c,h){g.width=h._uEf.width}}if(f==="wrap"){var a=ludo.dom._uT1(this.view);this.view.layout.width=a.x;return function(){g.width=a.x}}if(f.indexOf!==undefined&&f.indexOf("%")>0){f=parseInt(f);return function(c,h){g.width=(h._uEf.width*f/100)}}return function(){g.width=this.view.layout[d]}.bind(this);case"rightOf":return function(){g.left=f.offset().left+f.outerWidth()};case"leftOf":return function(){g.left=f.offset().left-g.width};case"leftOrRightOf":return function(){var c=f.offset().left-g.width;
if(c-g.width<0){c+=(f.outerWidth()+g.width)}g.left=c};case"rightOrLeftOf":return function(c,h){var j=f.offset().left+f.outerWidth();if(j+g.width>h._uEf.width){j-=(f.outerWidth()+g.width)}g.left=j};case"above":return function(c,h){g.top=f.offset().top-g.height};case"below":return function(){g.top=f.offset().top+f.height()};case"alignLeft":return function(){g.left=f.offset().left};case"alignTop":return function(){g.top=f.offset().top};case"alignRight":return function(){g.left=f.offset().left+f.outerWidth()-g.width};case"alignBottom":return function(){g.top=f.offset().top+f.outerHeight()-g.height};case"offsetX":return function(){g.left=g.left?g.left+f:f};case"offsetY":return function(){g.top=g.top?g.top+f:f};case"_uPb":return function(){g.height=f.height()};case"offsetWidth":return function(){g.width=g.width+f};case"offsetHeight":return function(){g.height=g.height+f};case"centerIn":return function(){f=f.getEl!=undefined?f.getEl():f;var c=f.offset();g.top=(c.top+(f.height()/2))-(g.height/2);g.left=(c.left+f.outerWidth()/2)-(g.width/2)};case"_uY5In":return function(){g.left=(f.offset().left+f.outerWidth())/2-(g.width/2)};case"_uL7In":return function(){g.top=(f.offset().top+(f.height()/2))-(g.height/2)};case"_uZc":return function(){g.width=f.outerWidth()};case"x":case"left":return function(){g.left=this.view.layout[d]}.bind(this);case"y":case"top":return function(){g.top=this.view.layout[d]}.bind(this);case"fitVerticalViewPort":return function(c,h){if(g.height){var j=g.top!==undefined?g.top:c.getEl().offset().top;if(j+g.height>h._uEf.height-2){g.top=h._uEf.height-g.height-2}}};default:return function(){}}},posKeys:["left","right","top","bottom"],clearFn:function(){this.fn=undefined},resize:function(){if(this.view._uNf()){return}if(this.fn===undefined){this.buildResizeFn()}this.setViewport();this.fn.call(this);var d=this._u3e;this.view.resize(d);if(d.bottom){d.top=undefined}if(d.right){d.left=undefined}for(var b=0;b<this.posKeys.length;b++){var a=this.posKeys[b];if(d[a]!==undefined&&d[a]!==this._ua7[a]){this.view.getEl().css(a,d[a])}}this._ua7=Object.clone(d)},_uy8:function(){if(this.view.children.length>0){this.view._usf()._uy8()}},setViewport:function(){if(!this.view.getEl||!this.view.getEl()){console.trace();console.log(this.view);return}var a=this.view.getEl().parent();if(!a){return}this._uEf.width=a.width();this._uEf.height=a.height()},getMinWidth:function(){return this.view.layout.minWidth||5},getMinHeight:function(){return this.view.layout.minHeight||5},getMaxHeight:function(){return this.view.layout.maxHeight||5000},getMaxWidth:function(){return this.view.layout.maxWidth||5000},_u0d:function(a,b){if(a!==undefined&&a>=0){this._u3e.left=this.view.layout.left=a;this.view.getEl().css("left",a);this._ua7.left=a}if(b!==undefined&&b>=0){this._u3e.top=this.view.layout.top=b;this.view.getEl().css("top",b);this._ua7.top=b}},setSize:function(b){var d=this._u3e;var a=this.view.layout;if(b.left){d.left=a.left=b.left}if(b.top){d.top=a.top=b.top}if(b.width){a.width=d.width=b.width}if(b.height){a.height=d.height=b.height}this.resize()},position:function(){return{x:this._u3e.left,y:this._u3e.top}},getSize:function(){return{x:this._u3e.width,y:this._u3e.height}},setValue:function(a,b){this.view.layout[a]=b},getValue:function(a){return this.view.layout[a]}});ludo.tpl.Parser=new Class({Extends:ludo.Core,type:"tpl.Parser",_u1d:undefined,getCompiled:function(b,f){if(!ludo.util.isArray(b)){b=[b]}var d=[];f=this.getCompiledTpl(f);for(var g=0;g<b.length;g++){var h=[];for(var c=0;c<f.length;c++){var a=f[c]["key"];if(a){h.push(b[g][a]?b[g][a]:"")}else{h.push(f[c])}}d.push(h.join(""))}return d},getCompiledTpl:function(c){if(!this._u1d){var c=this._u1d=[];var f=c.indexOf("{");var b=0;while(f>=0&&b!=-1){if(f>b){var d=b===0?b:b+1;var a=b===0?f-b:f-b-1;c.push(c.substr(d,a))}b=c.indexOf("}",f);if(b!=-1){c.push({key:c.substr(f,b-f).replace(/[{}"]/g,"")})}f=c.indexOf("{",b)}if(b!=-1&&b<c.length){c.push(c.substr(b+1))}}return this._u1d},asString:function(b,a){return this.getCompiled(b,a).join("")},getTplValue:function(a,b){return b}});ludo.dom={cache:{PW:{},PH:{},BW:{},BH:{},MW:{},MH:{}},getMW:function(a){if(!a.id){a.id="el-"+String.uniqueID()}if(ludo.dom.cache.MW[a.id]===undefined){ludo.dom.cache.MW[a.id]=ludo.dom.numStyle(a,"margin-left")+ludo.dom.numStyle(a,"margin-right")}return ludo.dom.cache.MW[a.id]},getBW:function(a){if(!a.id){a.id="el-"+String.uniqueID()}if(ludo.dom.cache.BW[a.id]===undefined){ludo.dom.cache.BW[a.id]=ludo.dom.numStyle(a,"border-left-width")+ludo.dom.numStyle(a,"border-right-width")}return ludo.dom.cache.BW[a.id]},getPW:function(a){if(!a.id){a.id="el-"+String.uniqueID()}if(ludo.dom.cache.PW[a.id]===undefined){ludo.dom.cache.PW[a.id]=ludo.dom.numStyle(a,"padding-left")+ludo.dom.numStyle(a,"padding-right")}return ludo.dom.cache.PW[a.id]},getMH:function(a){this.addId(a);var b=a.attr("id");if(ludo.dom.cache.MH[b]===undefined){ludo.dom.cache.MH[b]=ludo.dom.numStyle(a,"margin-top")+ludo.dom.numStyle(a,"margin-bottom")}return ludo.dom.cache.MH[b]
},getBH:function(a){this.addId(a);var b=a.attr("id");if(ludo.dom.cache.BH[b]===undefined){ludo.dom.cache.BH[b]=ludo.dom.numStyle(a,"border-top-width")+ludo.dom.numStyle(a,"border-bottom-width")}return ludo.dom.cache.BH[b]},getPH:function(a){this.addId(a);var b=a.attr("id");if(ludo.dom.cache.PH[b]===undefined){ludo.dom.cache.PH[b]=ludo.dom.numStyle(a,"padding-top")+ludo.dom.numStyle(a,"padding-bottom")}return ludo.dom.cache.PH[b]},getMBPW:function(a){return ludo.dom.getPW(a)+ludo.dom.getMW(a)+ludo.dom.getBW(a)},_u6g:function(a){return ludo.dom.getPH(a)+ludo.dom.getMH(a)+ludo.dom.getBH(a)},addId:function(a){if(!a.attr("id")){a.attr("id",String.uniqueID())}},_uLe:function(){ludo.dom.cache={PW:{},PH:{},BW:{},BH:{},MW:{},MH:{}}},numStyle:function(b,a){if(!b||!a||!b.css){return 0}var c=b.css(a);return c&&c!="thin"&&c!="auto"&&c!="medium"?parseInt(c):0},isInFamilies:function(c,b){for(var a=0;a<b.length;a++){if(ludo.dom.isInFamily(c,b[a])){return true}}return false},isInFamily:function(a,b){a=jQuery(a);if(a.attr("id")===b){return true}return a.parent("#"+b)},getParent:function(b,a){b=b.parentNode;while(b&&!ludo.dom.hasClass(b,a)){b=b.parentNode}return b},size:function(a){return{x:a.width(),y:a.height()}},_uT1:function(d){d.getEl().css("height","auto");d.$b().css("height","auto");var g=d.getEl();var c=d.$b();c.css("position","absolute");var f=c.outerWidth();c.css("position","relative");var a=c.outerHeight();return{x:f+ludo.dom.getMBPW(g),y:a+ludo.dom._u6g(g)+(d._ux2?d._ux2():0)}},getMeasuredWidth:function(a){var c=a.$b();var b=c.measure(function(){return this.getSize()});return b.x+ludo.dom.getMW(c)}};ludo.view.Shim=new Class({txt:"Loading content...",el:undefined,shim:undefined,renderTo:undefined,initialize:function(a){if(a.txt){this.txt=a.txt}this.renderTo=a.renderTo},getEl:function(){if(this.el===undefined){this.el=jQuery('<div class="ludo-shim-loading" style="display:none">'+this.getText(this.txt)+"</div>");this.getRenderTo().append(this.el)}return this.el},getShim:function(){if(this.shim===undefined){if(ludo.util.isString(this.renderTo)){this.renderTo=ludo.get(this.renderTo).getEl()}this.shim=jQuery('<div class="ludo-loader-shim" style="display:none"></div>');this.getRenderTo().append(this.shim)}return this.shim},getRenderTo:function(){if(ludo.util.isString(this.renderTo)){var a=ludo.get(this.renderTo);if(!a){return undefined}this.renderTo=ludo.get(this.renderTo).getEl()}return this.renderTo},show:function(a){this.getEl().html(this.getText((a&&!ludo.util.isObject(a))?a:this.txt));this.css("");this.resizeShim()},resizeShim:function(){var b=jQuery(this.el).find("span");var a=(b.width()+5);this.el.css("width",a+"px");this.el.css("marginLeft",(Math.round(a/2)*-1)+"px")},getText:function(a){a=ludo.util.isFunction(a)?a.call():a?a:"";return"<span>"+a+"</span>"},hide:function(){this.css("none")},css:function(a){this.getShim().css("display",a);this.getEl().css("display",a===""&&this.txt?"":"none")}});ludo.remote.Shim=new Class({Extends:ludo.view.Shim,initialize:function(a){this.parent(a);this._ua4(a.remoteObj)},_ua4:function(a){if(a){a._uBf({start:this.show.bind(this),complete:this.hide.bind(this)})}}});ludo.View=new Class({Extends:ludo.Core,type:"View",cType:"View",cls:"",bodyCls:"",cssSignature:undefined,closable:true,minimizable:false,movable:false,resizable:false,alwaysInFront:false,_uw3:["layout"],els:{},state:{},defaultDS:"_une.JSON",tagBody:"div",id:null,children:[],child:{},_une:undefined,_uB6:null,objMovable:null,width:undefined,height:undefined,overflow:undefined,_html:"",hidden:false,css:undefined,elCss:undefined,formConfig:undefined,isRendered:false,unRenderedChildren:[],frame:false,form:undefined,layout:undefined,tpl:"",JSONParser:{type:"tpl.Parser"},_ue3:[],contextMenu:undefined,lifeCycleComplete:false,clickable:false,_uDd:undefined,lifeCycle:function(a){this.__unf();if(!a.children){a.children=this.children;this.children=[]}this._ukd(a);if(!a.children||!a.children.length){a.children=this.__children()}if(this.hidden){this.unRenderedChildren=a.children}else{this.remainingLifeCycle(a)}},__children:function(){return this.children},remainingLifeCycle:function(b){if(this.lifeCycleComplete){return}if(!b&&this.unRenderedChildren){b={children:this.unRenderedChildren}}this.lifeCycleComplete=true;this._styleDOM();if(b.children&&b.children.length>0){this._usf()._ul(b.children);for(var c=0;c<b.children.length;c++){b.children[c].id=b.children[c].id||b.children[c].name||"ludo-"+String.uniqueID()}this._ue3=b.children;this._uYc(b.children)}this._uZf();this._u2g();this._use();this._uP8();var a=this.layout;if(a&&a.type&&(a.type==="tabs"||a.type==="docking")){this._usf()._uYd()}this.addCoreEvents();this.__ucf();if(!this._uB6){ludo.dom._uLe();ludo.dom._uLe.delay(50,this);var d=this._usf()._uZd();d.resize()}this._uif("render",this)},_ukd:function(a){this.parent(a);a.els=a.els||{};if(this._uB6){a.renderTo=undefined}var b=["contextMenu","renderTo","tpl","elCss","form","title","hidden","_une","movable","resizable","closable","minimizable","alwaysInFront","_uB6","cls","bodyCls","objMovable","width","height","frame","formConfig","overflow","_uDd","clickable"];
if(a.css!==undefined){if(this.css!==undefined){this.css=Object.merge(this.css,a.css)}else{this.css=a.css}}if(a.html!==undefined){this._html=a.html}this._uWf(a,b);if(this.renderTo){this.renderTo=jQuery(this.renderTo)}this.layout=ludo.layoutFactory.getValidLayoutObject(this,a);this.insertDOMContainer()},insertDOMContainer:function(){if(this.hidden){this.$e.css("display","none")}if(this.renderTo){this.renderTo.append(this.$e)}},_uZf:function(){if(this.contextMenu){var b=this.contextMenu;if(!ludo.util.isArray(b)){b=[b]}for(var a=0;a<b.length;a++){b[a].applyTo=this;b[a].contextEl=this._uE9()?this.getFormEl():this.getEl();new ludo.menu.Context(b[a])}this.contextMenu=undefined}},_u2g:function(){},_use:function(){if(this._une){this._up9()}},__ucf:function(){var a=this.layout;if(!a.height&&!a.above&&!a._uPb&&!a.alignWith){this.autoSetHeight()}if(!this._uB6){this.getEl().addClass("ludo-view-top")}if(!this._uB6){this._usf()._u28()}this.isRendered=true;if(this.form){this.getForm()}if(this.clickable){this.$b().on("click",function(){this._uif("click",this)}.bind(this))}},JSON:function(b,a){a=a||this.tpl;if(a){if(jQuery.isFunction(a)){this.$b().html(a.call(this,b))}else{this.$b().html(this.getTplParser().asString(b,a))}}},getTplParser:function(){if(!this.tplParser){this.tplParser=this._um5("tplParser",this.JSONParser)}return this.tplParser},autoSetHeight:function(){var a=this.$b().outerHeight(true);this.layout.height=a+ludo.dom._u6g(this.getEl())},html:function(a){this.$b().html(a)},setContent:function(){if(this._html){if(this.children.length){var a=jQuery("<div>"+this._html+"</div>");this.$b().append(a)}else{this.$b().html(this._html)}}},load:function(){this._uif("beforeload",[this.getUrl(),this]);if(this._une){this._up9().load()}},getParent:function(){return this._uB6?this._uB6:null},_uj3:function(a){this._uB6=a},__unf:function(){this.els.container=this.$e=jQuery("<div>");this.els.body=jQuery("<"+this.tagBody+">");this.$e.append(this.els.body)},_styleDOM:function(){var a=this.els.body;var c=this.$e;c.addClass("ludo-view");a.addClass("ludo-body");c.attr("id",this.getId());a.css("height","100%");if(this.overflow!=undefined){a.css("overflow-Y",this.overflow)}if(ludo.isMobile){c.addClass("ludo-view-mobile")}if(this.cls){c.addClass(this.cls)}if(this.bodyCls){a.addClass(this.bodyCls)}if(this.type){c.addClass("ludo-"+(this.type.replace(/\./g,"-").toLowerCase()))}if(this.css){a.css(this.css)}if(this.elCss){c.css(this.elCss)}if(this.frame){c.addClass("ludo-container-frame");a.addClass("ludo-body-frame")}if(this.cssSignature!==undefined){c.addClass(this.cssSignature)}this.setContent()},addCoreEvents:function(){if(!this.getParent()&&this.type!=="Application"){this.getEl().on("mousedown",this._uP8.bind(this))}},_uP8:function(a){if(a&&a.target&&a.target.tagName.toLowerCase()=="a"){return}this._uif("activate",this);this._uif("toFront",this);this.setNewZIndex()},setNewZIndex:function(){this.getEl().css("zIndex",ludo.util._uRb(this))},getEl:function(){return this.$e?this.$e:null},$b:function(){return this.els.body},getBody:function(){return this.els.body},hide:function(){if(!this.hidden&&this.getEl().css("display")!=="none"){this.getEl().css("display","none");this.hidden=true;this.resizeParent();this._uif("hide",this)}},_uNf:function(){return this.hidden},isVisible:function(){return !this.hidden},show:function(a){if(this.$e.css("display")==="none"){this.$e.css("display","");this.hidden=false}if(!this.lifeCycleComplete){this.remainingLifeCycle()}if(!a){this._uif("beforeshow",this)}this.setNewZIndex();if(!this._uB6){this._usf()._uZd().resize()}if(!a){this._uif("show",this)}},resizeParent:function(){var a=this.getParent();if(a){if(a.children.length>0){a._usf()._uy8()}}},showChild:function(a){var b=this.getChild(a);if(b){b.show();return true}return false},getChildren:function(){return this.children},_uc8:function(){var a=[];var d=this.children;for(var b=0;b<d.length;b++){a.push(d[b]);if(d[b].hasChildren()){a=a.append(d[b].getChildren())}}return a},hasChildren:function(){return this.children.length>0},_uUf:function(a){this.title=a;this._uif("_uUf",[a,this])},getWidth:function(){return this.layout._uYe?this.layout._uYe:this.layout.width?this.layout.width:this.$b().width()},getHeight:function(){return this.layout._u7e?this.layout._u7e:this.layout.height},_fr:false,resize:function(d){if(this._uNf()){return}var b=this.layout;d=d||{};if(d.width){if(b._u4d&&b._uA2&&d.width&&!this._u8e()){d.height=d.width/b._u4d}b._uYe=d.width;if(!isNaN(b.width)){b.width=d.width}var a=d.width-ludo.dom.getMBPW(this.$e);if(a>0){this.$e.css("width",a)}}if(d.height&&!this.state._u8e){if(!this.state._u8e){b._u7e=d.height;if(!isNaN(b.height)){b.height=d.height}}var c=d.height-ludo.dom._u6g(this.$e);if(c>0){this.$e.css("height",c)}}if(d.left!==undefined||d.top!==undefined){this._u0d(d)}this._ukf();if(d.height||d.width){this._uif("resize",d)}if(this._fr===false){this._uif("rendered",this);this._fr=true}if(this.children.length>0){this._usf()._uy8()}},isChildOf:function(a){var b=this._uB6;
while(b){if(b.id===a.id){return true}b=b._uB6}return false},_u0d:function(a){if(a.left!==undefined&&a.left>=0){this.$e.css("left",a.left)}if(a.top!==undefined&&a.top>=0){this.$e.css("top",a.top)}},_usf:function(){if(!this._uF9("layoutManager")){this._um5("layoutManager",ludo.layoutFactory.getManager(this))}return this._uIa("layoutManager")},_uy8:function(){if(this.children.length>0){this._usf()._uy8()}},_u8e:function(){return false},_ukf:function(){if(this.layout._u7e>0){var a=this.layout._u7e?this.layout._u7e-ludo.dom._u6g(this.$e):this.$e.css("height").replace("px","");a-=ludo.dom._u6g(this.els.body);if(a<=0||isNaN(a)){return}this.els.body.css("height",a)}},_uYc:function(c){var a=[];for(var b=0,d=c.length;b<d;b++){a.push(this._uVf(c[b]))}return a},_uVf:function(c,a,b){c=this._usf()._uVf(c,a,b);if(c.name){this.child[c.name]=c}c.on("remove",this._u3d.bind(this));return c},getChild:function(a){var d=this.children;for(var b=0;b<d.length;b++){if(d[b].id==a||d[b].name==a){return d[b]}}return undefined},_u3d:function(a){this.children.erase(a);a._uB6=null},_u43:function(){for(var a=this.children.length-1;a>=0;a--){this.children[a].remove()}},remove:function(){this._uif("remove",this);ludo.util.dispose(this)},getTitle:function(){return this.title},_ul9:undefined,_up9:function(){if(!this._ul9&&this._une){var a;if(ludo.util.isString(this._une)){a=this._ul9=ludo.get(this._une)}else{if(!this._une.type){this._une.type=this.defaultDS}a=this._ul9=this._um5("viewDataSource",this._une)}if(this._uDd){a.on("init",function(){this.shim().show(this._uDd)}.bind(this));a.on("complete",function(){this.shim().hide()}.bind(this));if(a.isWaitingData()){this.shim().show(this._uDd)}}var b=a._uHa()==="HTML"?"html":"JSON";if(a.hasData()){this[b](a.getData())}a.addEvent("load",this[b].bind(this))}return this._ul9},_shim:undefined,shim:function(){if(this._shim===undefined){this._shim=new ludo.view.Shim({txt:"",renderTo:this.getEl()})}return this._shim},getForm:function(){if(!this._uF9("_uXc")){this._um5("_uXc",{type:"ludo.form.Manager",view:this,form:this.form})}return this._uIa("_uXc")},_uG9:function(){var a=this.getParent();return a?a._uF9("_uXc")?a._uIa("_uXc"):a._uG9():undefined},_uE9:function(){return false},_uK1:function(){return 0},svg:function(){if(this.canvas===undefined){this.canvas=this._um5("canvas",new ludo.svg.Canvas({renderTo:this}))}return this.canvas},canvas:undefined,_utc:function(){return undefined},_uV9:function(){return undefined}});ludo.factory.registerClass("View",ludo.View);ludo.layout.Relative=new Class({Extends:ludo.layout.Base,children:undefined,type:"layout.Relative",_u33:["bottom","right","top","left","width","height","_uM7","_uw4","_uy7","_u46","leftOf","rightOf","below","above","alignLeft","alignRight","alignTop","alignBottom","_uZc","_uPb","_uP7","_uY5","_uL7","fillLeft","fillRight","fillUp","fillDown","absBottom","absWidth","absHeight","absLeft","absTop","absRight","offsetX","offsetY","widthOffset","heightOffset"],_uG2:{},_uW1:{},onCreate:function(){this.parent();this.view.$b().css("position","relative")},resize:function(){if(this.children===undefined){this._uX9()}for(var a=0;a<this.children.length;a++){var b=this.children[a];if(!b._uf8){b._uf8=this.g_uC9(b)}b._uf8.call(b,this)}},_uX9:function(){this._uK2();this._uj6();this._uH1()},_uH1:function(){for(var a=0;a<this.children.length;a++){this.children[a]._uf8=this.g_uC9(this.children[a])}},_uK2:function(){for(var d=0;d<this.view.children.length;d++){var f=this.view.children[d];var a=this.depKeys;for(var b=0;b<a.length;b++){if(f.layout[a[b]]!==undefined){f.layout[a[b]]=this.getReference(f.layout[a[b]])}}}},g_uC9:function(b){var a=this._usfFnsFor(b);return function(c){for(var d=0;d<a.length;d++){a[d].call(b,c)}}},_usfFnsFor:function(f){var a=[];var d=this._u33;for(var b=0;b<d.length;b++){if(f.layout[d[b]]!==undefined&&f.layout[d[b]]!==false){var c=this._usfFn(d[b],f);if(c){a.push(c)}}}a.push(this._uY6(f));return a},_usfFn:function(b,f){var d=this._uG2[f.id];var a;switch(b){case"top":case"left":case"bottom":case"right":return function(){d[b]=f.layout[b]}.bind(f);case"offsetX":return function(){d.left+=f.layout[b]}.bind(f);case"offsetY":return function(){d.top+=f.layout[b]}.bind(f);case"width":case"height":return this._uI9(f,b);case"absLeft":return function(){d.left=0};case"absRight":return function(){d.right=0};case"absBottom":return function(){d.bottom=0};case"absWidth":return function(c){d.width=c._uEf.absWidth};case"absHeight":return function(c){d.height=c._uEf.absHeight};case"_uy7":return function(c){d.left=c._uEf.left};case"_u46":return function(c){d.right=c._uEf.right};case"_uM7":return function(c){d.top=c._uEf.top};case"_uw4":return function(c){d.bottom=c._uEf.bottom};case"leftOf":a=this._uW1[f.layout.leftOf.id];return function(){d.right=a.right+a.width};case"rightOf":a=this._uW1[f.layout.rightOf.id];return function(){d.left=a.left+a.width};case"below":a=this._uW1[f.layout.below.id];return function(){d.top=a.top+a.height};case"above":a=this._uW1[f.layout.above.id];
return function(){d.bottom=a.bottom+a.height};case"_uPb":a=this._uW1[f.layout._uPb.id];return function(){d.height=a.height};case"_uZc":a=this._uW1[f.layout._uZc.id];return function(){d.width=a.width};case"_uP7":return function(c){d.top=parseInt(c._uEf.height/2-d.height/2);d.left=parseInt(c._uEf.width/2-d.width/2)};case"_uY5":return function(c){d.left=parseInt(c._uEf.width/2-d.width/2)};case"_uL7":return function(c){d.top=parseInt(c._uEf.height/2-d.height/2)};case"fillLeft":return function(c){if(d.right!==undefined){d.width=c._uEf.absWidth-d.right}};case"fillRight":return function(c){if(d.left===undefined){d.left=0}d.width=c._uEf.absWidth-d.left-c._uEf.right};case"fillDown":return function(c){if(d.top===undefined){d.top=0}d.height=c._uEf.absHeight-d.top-c._uEf.bottom};case"fillUp":return function(c){if(d.bottom!==undefined){d.height=c._uEf.absHeight-d.bottom-c._uEf.top}};case"alignLeft":return this._uE8(f,b,"left");case"alignRight":return this._uE8(f,b,"right");case"alignTop":return this._uE8(f,b,"top");case"alignBottom":return this._uE8(f,b,"bottom")}return undefined},_uE8:function(g,f,b){var d=this._uG2[g.id];var a=this._uW1[g.layout[f].id];return function(){d[b]=a[b]}},_uI9:function(h,f){var g=this._uG2[h.id];if(isNaN(h.layout[f])){switch(h.layout[f]){case"matchParent":return function(c){var j=h.layout[f+"Offset"]||0;g[f]=c._uEf[f]+j};case"wrap":var a=ludo.dom._uT1(h);var d=f==="width"?"x":"y";return function(){g[f]=a[d]};default:if(h.layout[f].indexOf!==undefined&&h.layout[f].indexOf("%")>=0){var b=parseInt(h.layout[f].replace(/[^0-9]/g));return function(c){g[f]=parseInt(c._uEf[f]*b/100)}}return undefined}}else{return function(){g[f]=h.layout[f]}.bind(h)}},_uJ9:["left","right","bottom","top"],_uY6:function(a){return function(j){var l=j._uG2[a.id];var g=j._uW1[a.id];var k=j._uJ9;if(a.layout.above&&a.layout.below){l.height=j._uEf.height-l.bottom-l.top}if(a.layout.leftOf&&a.layout.rightOf){l.width=j._uEf.width-l.right-l.left}if(a._uNf()){l.width=0;l.height=0}a.resize({width:l.width!==g.width?l.width:undefined,height:l.height!==g.height?l.height:undefined});if(l.right!==undefined&&l.width){l.left=j._uEf.absWidth-l.right-l.width;l.right=undefined}if(l.bottom!==undefined&&l.height){l.top=j._uEf.absHeight-l.bottom-l.height;l.bottom=undefined}if(l.bottom!==undefined){var f=j._uEf.absHeight-l.bottom-(l.top||0);if(f!=g.height){a.resize({height:j._uEf.absHeight-l.bottom-(l.top||0)})}l.bottom=undefined}for(var d=0;d<k.length;d++){var b=k[d];if(l[b]!==undefined){j.positionChild(a,b,l[b])}g[b]=l[b]}g.width=l.width;g.height=l.height;j._uE(a)}},_uE:function(d){var b=this._uW1[d.id];var a=d.getEl();var c=a.position==undefined?{left:a.offsetLeft,top:a.offsetTop}:a.position();if(b.left===undefined){b.left=c.left>0?c.left:0}if(b.top===undefined){b.top=c.top>0?c.top:0}if(b.width===undefined){b.width=a.width!=undefined?a.width():a.offsetWidth}if(b.height===undefined){b.height=a.height!=undefined?a.height():a.offsetHeight}if(b.right===undefined){b.right=this._uEf.width-b.left-b.width}if(b.bottom===undefined){b.bottom=this._uEf.height-b.top-b.height}},positionChild:function(c,b,a){c.getEl().css(b,a);c[b]=a},_uv:function(a){this._uG2[a.id]={};this._uW1[a.id]={}},_uj6:function(){this.children=[];for(var f=0;f<this.view.children.length;f++){var k=this.view.children[f];this.children.push(k);this._uv(k);if(k._uNf()){this._ua5(k,{width:0,height:0})}}this._u05();var h=this._uL();var a=0;while(h&&a<30){var g=this._ug6(h);if(g.length>0){for(var d=0;d<g.length;d++){if(this._u36(h,g[d])){var b=this.children.indexOf(h);this.children.splice(b,1);this.children.push(h)}}}h=this._uL();a++}if(a===30){ludo.util.log("Possible circular layout references defined for children in Relative layout")}},_uqe:{left:"leftOf",right:"rightOf",above:"above",below:"below"},_uQe:{},_u05:function(){for(var b=this.children.length-1;b>=0;b--){var h=this.children[b];if(this._u16(h)){this._uQe[h.id]={};for(var a=0;a<h.layout.resize.length;a++){var d=h.layout.resize[a];var g=this._uQe[h.id][d]=this._ui6(h,d);this._uv(g);this.updateReference(this._uqe[d],h,g);var f=d=="left"||d==="above"?b:b+1;this.children.splice(f,0,g)}}}},_u0b:function(b,a){return this._uQe[b.id][a]},_ui6:function(c,b){var a=(b==="left"||b==="right")?"width":"height";return new ludo.layout.Resizer({name:"resizer-"+c.name,hidden:c._uNf(),_uWd:(b==="left"||b==="right")?"horizontal":"vertical",pos:b,renderTo:this.view.$b(),sibling:this._uz2(c,b),layout:this._uT4(c,b),lm:this,view:c,listeners:{resize:function(d){c.layout[a]+=d;this.resize()}.bind(this),before:this._ujc.bind(this)}})},_uz2:function(b,a){switch(a){case"left":return b.layout.rightOf;case"right":return b.layout.leftOf;case"above":return b.layout.below;case"below":return b.layout.above}return undefined},_ujc:function(b,f){if(b._uWd==="horizontal"){var c=this.toPixels(f.layout.minWidth||10);b._u5e(c);var a=f.layout.maxWidth||this.view.$b().width();a=this.toPixels(a,true);b._u4e(a)}else{var d=this.toPixels(f.layout.minHeight||10);b._u5b(d);b._uib(f.layout.maxHeight||this.view.$b().height())
}},toPixels:function(b,a){if(jQuery.type(b)=="string"&&b.indexOf("%")>0){var c=parseInt(b);return c/100*(a?this._uEf.width:this._uEf.height)}return b},_uT4:function(c,b){var a={};switch(b){case"left":case"right":a._uPb=c;a.alignTop=c;a.width=5;break;default:a._uZc=c;a.alignLeft=c;a.height=5}return a},updateReference:function(b,d,c){for(var a=0;a<this.children.length;a++){if(this.children[a].layout[b]===d){this.children[a].layout[b]=c;c.layout._uS6=this.children[a]}}c.layout[b]=d},_u16:function(a){return a.layout&&a.layout.resize&&a.layout.resize.length>0},_uL:function(){for(var b=0;b<this.children.length;b++){var f=this.children[b];var d=this._ug6(f);if(d.length>0){for(var a=0;a<d.length;a++){if(this._u36(f,d[a])){return f}}}}return undefined},_u36:function(b,a){return this.children.indexOf(b)<this.children.indexOf(a)},depKeys:["above","below","leftOf","rightOf","alignLeft","alignBottom","alignRight","alignTop","_uZc","_uPb"],_ug6:function(d){var a=[];for(var b=0;b<this.depKeys.length;b++){if(d.layout[this.depKeys[b]]!==undefined){var c=d.layout[this.depKeys[b]];if(c!==undefined){a.push(c)}}}return a},getReference:function(a){if(a.getId!==undefined){return a}if(this.view.child[a]!==undefined){return this.view.child[a]}return ludo.get(a)},clearChildren:function(){this.children=undefined},getChildren:function(){return this.children},_uIe:function(b){this.parent(b);if(b.getEl().css!=undefined){b.getEl().css("position","absolute")}var a=b.layout;if(a._uP7!==undefined){a._uY5=undefined;a._uL7=undefined}if(a.fillRight===undefined){if(a.width===undefined){a.width=b.width?b.width:undefined}}if(a.height===undefined){a.height=b.height?b.height:undefined}if(a.leftOf){a.right=undefined}if(a.rightOf){a.left=undefined}if(a.below){a.top=undefined}if(a.above){a.bottom=undefined}},_uVfEvents:function(a){a.on("hide",this._uef.bind(this));a.on("show",this._u02.bind(this));a.on("collapse",this.minimize.bind(this));a.on("minimize",this.minimize.bind(this));a.on("expand",this._u02.bind(this));a.on("maximize",this._u02.bind(this))}});ludo.layout.Canvas=new Class({Extends:ludo.layout.Relative,type:"layout.Canvas",_uVf:function(b){b=this.getValidChild(b);b=this._ux6(b);this.view.children.push(b);var a=b.parentNode?this.view:this.view.svg();a.append(b);this._uIe(b);this._uVfEvents(b);this._uif("_uVf",[b,this]);return b},_uVfEvents:function(a){a.on("hide",this._uef.bind(this));a.on("show",this._u02.bind(this))},positionChild:function(c,b,a){c[b]=a;this.currentTranslate[b]=a;c.position(this.currentTranslate.left,this.currentTranslate.top)},currentTranslate:{left:0,top:0},zIndexAdjusted:false,_ucf:false,resize:function(){this.parent();if(!this.zIndexAdjusted){this.zIndexAdjusted=true;for(var a=0;a<this.children.length;a++){if(this.children[a].layout.zIndex!=undefined){var b=this.view.parentNode?this.view.parentNode:this.view.svg();b.append(this.children[a])}}}if(!this._ucf){this._ucf=true;jQuery.each(this.view.children,function(c,d){if(d.__ucf!=undefined){d.__ucf()}})}},_uP9:function(){if(!this.view.parentNode){return this.parent()}return this.view.width},_ut8:function(){if(!this.view.parentNode){return this.parent()}return this.view.height},_uM1:function(){return this.view.node}});ludo.layout.Linear=new Class({Extends:ludo.layout.Base,onCreate:function(){this.view.$b().css("overflow","hidden");this.view.$b().css("position","relative");this.parent()},_uIe:function(a){this.parent(a);this._uR2(a);a.on("collapse",this.minimize.bind(this));a.on("expand",this._u02.bind(this));a.on("minimize",this.minimize.bind(this));a.on("maximize",this._u02.bind(this));a.on("show",this._u02.bind(this))},_uR2:function(b){b.layout=b.layout||{};var a=b.layout;a.width=a.width||b.width;a.height=a.height||b.height;a.weight=a.weight||b.weight;a.resizable=a.resizable||b.resizable;a.minWidth=a.minWidth||b.minWidth;a.maxWidth=a.maxWidth||b.maxWidth;a.minHeight=a.minHeight||b.minHeight;a.maxHeight=a.maxHeight||b.maxHeight},_u7d:function(a){return a.layout.resizable},_ujc:function(a,b){if(a._uWd==="horizontal"){a._u5e(b.layout.minWidth||10);a._u4e(b.layout.maxWidth||this.view.$b().width())}else{a._u5b(b.layout.minHeight||10);a._uib(b.layout.maxHeight||this.view.$b().height())}},_ui6:function(c,b){var a=(b==="left"||b==="right")?"width":"height";return new ludo.layout.Resizer({name:"resizer-"+c.name,_uWd:(b==="left"||b==="right")?"horizontal":"vertical",pos:b,hidden:c._uNf(),renderTo:this.view.$b(),layout:{width:5,height:5},lm:c._usf(),view:c,listeners:{resize:function(d){c.layout[a]+=d;this.resize()}.bind(this),before:this._ujc.bind(this)}})}});ludo.layout.LinearVertical=new Class({Extends:ludo.layout.Linear,onCreate:function(){this.parent()},resize:function(){var a=this._uEf;var p=a.height;var t={width:a.width,height:p};var k=0;var h=0;var r;var q=a.top;for(var j=0;j<this.view.children.length;j++){if(!this._uw6(this.view.children[j])){r=this.view.children[j]._uNf()?0:this.getHeightOf(this.view.children[j],t);k+=r}else{if(!this.view.children[j]._uNf()){h+=this.view.children[j].layout.weight
}}}h=Math.max(1,h);var o;var d=o=(p-k);var b=this.view.$b().width();for(j=0;j<this.view.children.length;j++){var l=this.view.children[j];if(!l._uNf()){var n=l.layout.width;var m=n&&!isNaN(n)?n:b;var g={width:l.type=="layout.Resizer"?b:m};if(g.width<a.width&&l.layout.anchor!=undefined){var f=this._uEf.width;g.left=f*l.layout.anchor-(g.width*l.layout.anchor)}if(n&&l.layout.align){switch(l.layout.align){case"right":g.left=a.width-l.layout.width;break;case"center":g.left=(a.width/2)-(l.layout.width/2);break}}if(this._uw6(l)){if(l.id==this.idLastDynamic){g.height=o}else{g.height=Math.round(d*l.layout.weight/h);o-=g.height}}else{g.height=this.getHeightOf(l,g)}if(g.height<0){g.height=undefined}if(q>0){g.top=q}this.resizeChild(l,g);q+=l.getEl().outerHeight(true)}}},resizeChild:function(b,a){b.layout.height=a.height;b.resize(a);b._urf()},_uh5:function(){var b=this.parent();for(var a=0;a<this.view.children.length;a++){b+=this.view.children[0].getEl().outerHeight(true)}return b},_uIe:function(d){this.parent(d);if(this._u7d(d)){var b=this._uZ9(d);var a;if(d.layout&&d.layout.resizePos){a=d.layout.resizePos}else{a=b?"above":"below"}var c=this._ui6(d,a);this._uVf(c,d,a=="above"?"before":"after")}d.getEl().css("position","absolute")}});ludo.layout.LinearHorizontal=new Class({Extends:ludo.layout.Linear,type:"layout.Linear",resize:function(){var k=this._uEf.width;var m=this.hasDynamicHeight()?"auto":this._uEf.height;if(m==0){return}var j=0;var g=0;for(var h=0;h<this.view.children.length;h++){if(this.view.children[h].isVisible()){if(!this._uw6(this.view.children[h])){var d=this._uMe(this.view.children[h]);if(d){j+=d}}else{g+=this.view.children[h].layout.weight}}}g=Math.max(1,g);var a;k=a=k-j;var b=this._uEf.left;for(h=0;h<this.view.children.length;h++){var l=this.view.children[h];if(l.isVisible()){var f={height:m,left:b};if(this._uw6(l)){if(l.id==this.idLastDynamic){f.width=a}else{f.width=Math.round(k*l.layout.weight/g);a-=f.width}}else{f.width=this._uMe(l)}this.resizeChild(l,f);b+=f.width}}for(h=0;h<this._uQe.length;h++){this._uQe[h].colResize()}},resizeChild:function(b,a){b.layout.width=a.width;b.layout.left=a.left;b.resize(a);b._urf()},_uIe:function(c){this.parent(c);c.getEl().css("position","absolute");if(this._u7d(c)){var a=this._uZ9(c);var b=this._ui6(c,a?"left":"right");this._uVf(b,c,a?"before":"after")}},hasDynamicHeight:function(){return this.view.layout.height&&this.view.layout.height=="dynamic"}});ludo.layout.Fill=new Class({Extends:ludo.layout.Relative,_uVf:function(d,b,c){if(d.layout==undefined){d.layout={}}var a=d.layout;a.width=a.height="matchParent";a._uM7=true;a._uy7=true;return this.parent(d,b,c)}});ludo.layout.Tabs=new Class({Extends:ludo.View,type:"layout.Tabs",tabPos:"left",lm:undefined,tabs:{},svgTexts:{},currentPos:-1,_ulf:undefined,_uR9:3,_ulfId:undefined,css:{overflow:"hidden"},_uCf:undefined,_uLb:undefined,_uhf:undefined,elLine:undefined,maxPos:undefined,maxSize:undefined,hiddenTabs:undefined,menu:undefined,tabTitles:undefined,alwaysInFront:true,_ukd:function(a){this.parent(a);this._uWf(a,["tabPos"]);this.lm=a.lm;this.hiddenTabs=[];this.tabTitles={}},_use:function(){this.parent();this.lm.on("_uVf",this._uda.bind(this));this.lm.on("_uVfRuntime",this._ume.bind(this));this.lm.on("showChild",this._uT7.bind(this));this.lm.on("_uef",this._uPe.bind(this));this.lm.on("_u3d",this._uNb.bind(this));this.on("resize",this._ume.bind(this))},__ucf:function(){this.parent();this._ume();this.$b().css("overflow","hidden")},_uda:function(b,a,c){if(!this.lm.isTabs(c)){this._ukc(c)}},_ume:function(){this.showAllTabs();if(this._uLb==undefined){this._uLb={}}this._uma();if(this.tabPos==="top"||this.tabPos==="bottom"){this._uI7()}},showAllTabs:function(){jQuery.each(this.tabs,function(a){this.tabs[a].show()}.bind(this))},_uma:function(){var b=0;var a;jQuery.each(this.tabs,function(c){var d=this.tabs[c];if(this.tabPos==="top"||this.tabPos==="bottom"){a=d.outerWidth(true)}else{a=d.outerHeight(true)}this._uLb[c]={pos:b,size:a};d.css(this._u07(),b+"px");b+=a;this.maxPos=b}.bind(this))},_uI7:function(){if(!this._uCf){return}this._uCf.css("left",0);if(!this._ub4()){if(this._uhf){this._uhf.hide()}return}this._uv2();this.hiddenTabs=[];var a=this.$b().width();var b=this._ucd();a-=b.outerWidth(true);var c=Math.abs(this._uCf.position().left);jQuery.each(this._uLb,function(f,d){if(d.pos<c||d.pos+d.size>c+a){this.hiddenTabs.push(f);if(d.pos>=c){this.tabs[f].hide()}}else{this.tabs[f].show()}}.bind(this));b.html(this.hiddenTabs.length);b.css("visibility",this.hiddenTabs.length>0?"visible":"hidden");if(this.hiddenTabs.length>0){this.maxSize=a-b.outerWidth(true);this._uv2();this._ucd().show()}this._uma()},_uv2:function(){var c=this.$b().width();var f=this._ucd();c-=f.outerWidth(true);var h=Math.abs(this._uCf.position().left);var a=this._uLb[this._ulfId];var g=a.pos-h;var d=(a.pos+a.size)-(h+c);if(g<0){this._uCf.css("left",g)}else{if(d>0){var b=h-d;this._uCf.css("left",b)}}},_ub4:function(){return this.maxPos>this.$b().width()},_ucd:function(){if(this._uhf==undefined){if(this.tabPos=="left"||this.tabPos=="right"){this._uhf=this.$b();
return this._uhf}var c=this._uhf=jQuery('<div class="ludo-tab-expand-box ludo-tab-expand-box-'+this.tabPos+'"></div>');this.$b().append(c);var b=this.$b().outerHeight()-this.elLine.height();var a=this.tabPos=="top"||this.tabPos=="bottom"?"height":"width";c.css(a,b);if(this.tabPos=="bottom"){c.css("top",this.elLine.outerHeight())}c.css("line-height",b+"px");c.on("click",this.toggleMenu.bind(this));c.css("visibility","hidden");c.mouseenter(this._ura.bind(this));c.mouseleave(this._uVa.bind(this))}return this._uhf},_ura:function(a){jQuery(a.target).addClass("ludo-tab-expand-box-"+this.tabPos+"-over")},_uVa:function(a){jQuery(a.target).removeClass("ludo-tab-expand-box-"+this.tabPos+"-over")},getMenu:function(){if(this.menu==undefined){var a={type:"menu",_uWd:"vertical",alignLeft:this._uhf,height:"wrap",width:"wrap"};if(this.tabPos=="top"){a.below=this._uhf}else{a.above=this._uhf}this.menu=new ludo.menu.Menu({renderTo:document.body,hidden:true,alwaysInFront:true,layout:a,listeners:{click:function(b){if(b.action&&this.tabs[b.action]!=undefined){ludo.$(b.action).show();this.menu.hide();this._ume()}}.bind(this)}});this.menu.getEl().mousedown(ludo.util.cancelEvent);ludo._uFb.on("start",this.hideMenu.bind(this));jQuery(document.documentElement).mousedown(this.domClick.bind(this))}return this.menu},menuShown:false,domClick:function(a){if(this.menu==undefined){return}if(a.target==this._uhf[0]){return}this.hideMenu()},autoHide:function(){this.hideMenu()},hideMenu:function(){this.getMenu().hide()},toggleMenu:function(){var a=this.getMenu();if(a._uNf()){this.showMenu()}else{this.menu.hide()}},showMenu:function(){this.menuShown=true;var a=this.getMenu();a.show();a._u43();jQuery.each(this.hiddenTabs,function(b,c){a._uVf({label:this.tabTitles[c],action:c})}.bind(this));this.menu._usf().resize()},_ukc:function(c){var b=this.tabPos;if(this._uCf===undefined){this._uCf=jQuery('<div style="position:absolute" class="ludo-tab-layout-parent-for-tabs ludo-tab-layout-parent-for-tabs-'+b+'"></div>');if(b==="top"||b==="bottom"){this._uCf.css({height:this.$b().height(),width:10000})}else{this._uCf.css({width:this.$b().width(),height:10000})}this.$b().append(this._uCf)}var a;if(b==="top"||b==="bottom"){a=this._uV7(c)}else{a=this._uqb(c)}a.on("click",c.show.bind(c,false));this._uCf.append(a);if(c.layout.closable){this._uJ7(a,c)}a.css(this._u07(),this.currentPos);a.addClass("ludo-tab-strip-tab");a.addClass("ludo-tab-strip-tab-"+b);this.tabs[c.getId()]=a;if(!c._uNf()){this._uT7(c)}},_uJ7:function(b,d){var a=jQuery("<div>");a.addClass("ludo-tab-close ludo-tab-close-"+this.tabPos);a.mouseenter(this._u35.bind(this));a.mouseleave(this._un5.bind(this));a.attr("id","tab-close-"+d.id);a.on("click",this._u3d.bind(this));b.append(a);var c;switch(this.tabPos){case"top":case"bottom":c=b.css("padding-right");b.css("paddingRight",(parseInt(c)+a.outerWidth()));break;case"right":c=b.css("padding-right");b.css("paddingBottom",(parseInt(c)+a.outerHeight()));break;case"left":c=b.css("padding-right");b.css("paddingTop",(parseInt(c)+a.outerHeight()));break}},_u3d:function(a){var b=a.target.id.replace("tab-close-","");ludo.get(b).remove();return false},_uNb:function(a){this.tabs[a.getId()].remove();if(this.svgTexts[a.getId()]){this.svgTexts[a.getId()].remove();delete this.svgTexts[a.getId()]}delete this.tabs[a.getId()];this._uLb[a.getId()]=undefined;this._ume()},_u35:function(a){jQuery(a.target).addClass("ludo-tab-close-"+this.tabPos+"-over")},_un5:function(a){jQuery(a.target).removeClass("ludo-tab-close-"+this.tabPos+"-over")},_u07:function(){if(!this._urb){switch(this.tabPos){case"top":case"bottom":this._urb="left";break;case"left":case"right":this._urb="top";break}}return this._urb},_uV7:function(b){var a=jQuery("<div>");this.$b().append(a);a.className="ludo-tab-strip-tab ludo-tab-strip-tab-"+this.tabPos;a.html('<div class="ludo-tab-strip-tab-bg"></div><span style="z-index:2">'+this.getTitleFor(b)+"</span>");return a},_uqb:function(f){var b=jQuery('<div><div class="ludo-tab-strip-tab-bg"></div></div>');this.$b().append(b);var d=jQuery('<div style="z-index:2;position:relative">');b.append(d);var c=new ludo.layout.TextBox({renderTo:d,width:1000,height:1000,className:"ludo-tab-strip-tab-txt-svg",_uha:"ludo-tab-strip-tab-txt-svg-active",text:this.getTitleFor(f),rotation:this.getRotation()});var a=c.getSize();d.css({width:a.x,height:a.y});this.svgTexts[f.getId()]=c;return b},getRotation:function(){if(this.rotation===undefined){switch(this.tabPos){case"left":this.rotation=270;break;case"right":this.rotation=90;break;case"bottom":this.rotation=180;break;default:this.rotation=0;break}}return this.rotation},getTitleFor:function(b){var a=(b.title||b.layout.title||b.getTitle());this.tabTitles[b.id]=a;return a},_uPe:function(){if(this._ulf!==undefined){this._ulf.removeClass("ludo-tab-strip-tab-active");this._uba(this._ulfId,"leave")}},_uba:function(b,c){var a=this.svgTexts[b];if(a!==undefined&&a[c]!==undefined){a[c]()}},_uT7:function(a){this._uPe();if(this.tabs[a.id]!==undefined){this._uba(a.id,"enter");
this.tabs[a.id].addClass("ludo-tab-strip-tab-active");this._ulf=this.tabs[a.id];this._ulf.css("zIndex",this._uR9);this._uR9++;this._ulfId=a.id;if(this.hiddenTabs.length>0){this._ume()}}},_uZf:function(){this.parent();this.getEl().addClass("ludo-tab-strip");this.getEl().addClass("ludo-tab-strip-"+this.tabPos);var a=jQuery("<div>");a.addClass("ludo-tab-strip-line");this.elLine=a;this.$b().append(a);this._ucd()},getTabFor:function(a){return this.tabs[a.id]},_uu3:function(){var a;if(this.tabPos==="top"||this.tabPos==="bottom"){a=this.getEl().outerHeight(true)}else{a=this.getEl().outerWidth(true)}return{key:this.tabPos,value:a}},getCount:function(){return Object.keys(this.tabs).length},resize:function(a){this.parent(a)}});ludo.layout.Tab=new Class({Extends:ludo.layout.Relative,_umb:undefined,tabStrip:undefined,type:"layout.Tab",onCreate:function(){this.parent();this.view.getEl().addClass("ludo-layout-tab");this._uVf(this.getTabs());this._u88(this.tabStrip._uu3())},afterCreate:function(){},_uVf:function(c,a,b){if(!this.isTabs(c)&&(!c.layout||!c.layout.visible)){c.hidden=true}return this.parent(c,a,b)},_uIe:function(b){if(!this.isTabs(b)){var a=b.layout;if(!b._uNf()){this._uF6(b)}a._uy7=true;a._uM7=true;a.fillRight=true;a.fillDown=true}this.parent(b)},_ua5:function(){},_uVfEvents:function(a){if(!this.isTabs(a)){a.on("show",this.showTab.bind(this));a.on("remove",this._uh8.bind(this))}},_u38:function(){return this.view.layout.tabs||"top"},_um2:false,getTabs:function(){if(this.tabStrip===undefined){this.tabStrip=new ludo.layout.Tabs({lm:this,_uB6:this.view,tabPos:this._u38(),renderTo:this.view.$b(),layout:this._uY9(),_um2:this._um2})}return this.tabStrip},_uF6:function(a){if(this._umb){this._umb.hide()}this._umb=a;this._uif("showChild",a)},showTab:function(a){if(a!==this._umb){if(this._umb){this._umb.getEl().css("visibility","hidden")}a.getEl().css("visibility","visible");this._uF6(a);this.resize()}},resize:function(){if(this._umb===undefined&&this._u9a()){if(this.view.children.length>1){this.view.children[1].show()}}else{if(this.children===undefined||(this._umb&&!this._umb._uf8)){this._uX9()}this.tabStrip._uf8.call(this._umb,this);if(this._umb){if(!this._umb._uf8){this._uX9()}this._umb._uf8.call(this._umb,this)}}},_u9a:function(){return true},_uY9:function(){switch(this._u38()){case"top":return{absTop:true,absLeft:true,absWidth:true};case"left":return{absTop:true,absLeft:true,absHeight:true};case"right":return{absTop:true,absRight:true,absHeight:true};case"bottom":return{absBottom:true,absLeft:true,absWidth:true}}return undefined},isTabs:function(a){return a.type==="layout.Tabs"},_uh8:function(b){if(this._umb&&this._umb.id===b.id){var a=this.view.children.indexOf(this._umb);if(a>1){this.view.children[a-1].show()}else{if(this.view.children.length>2){this.view.children[a+1].show()}}}this._uif("_u3d",b)}});ludo.layout.Table=new Class({Extends:ludo.layout.Base,table:undefined,tbody:undefined,_uva:undefined,cols:undefined,currentRow:undefined,fixedWidth:undefined,totalWeight:undefined,countCellsInNextRow:undefined,simple:false,rowHeight:undefined,onCreate:function(){this.parent();this._uva=0;this.cols=this.view.layout.columns;if(this.view.layout.rowHeight!==undefined){this.rowHeight=this.view.layout.rowHeight}this.fixedWidth=0;this.totalWeight=0;this.simple=this.view.layout.simple||this.simple;var f=[];for(var b=0;b<this.cols.length;b++){var a=this.cols[b];var d=a.width!==undefined?a.width:0;this.fixedWidth+=d;this.totalWeight+=(a.weight!=undefined?a.weight:0);var c=d!==undefined&&d>0?' width="'+d+'"':"";f.push("<col"+c+">")}this.table=jQuery('<table style="padding:0;margin:0;border-collapse: collapse"><colgroup>'+(f.join(""))+"</table>");this.tbody=jQuery("<tbody></tbody>");this.table.append(this.tbody);this.view.$b().append(this.table)},_uVf:function(c,a,b){return this.parent(c,a,b)},_uM1:function(g){var b=g.layout;if(this._uva===0||b.row||(this.simple&&this._uva%this.cols.length==0)){b.row=true;this.currentRow=jQuery('<tr style="border:none;padding:0;margin:0"></tr>');this.tbody.append(this.currentRow);this.countCellsInNextRow=this.cols.length}var f=b.colspan?b.colspan:1;var c=b.rowspan?b.rowspan:1;var d=b.vAlign?b.vAlign:"top";var a=jQuery('<td style="vertical-align:'+d+';margin:0;padding:0" colspan="'+f+'" rowspan="'+c+'"></td>');this.currentRow.append(a);this._uva+=f;return a},resize:function(){var g=this.view.children;var b=0;for(var d=0;d<g.length;d++){var f=g[d];if(f.layout.row){b=0}var a={};if(this.rowHeight!=undefined){a.height=this.rowHeight}if(f.layout.height!=undefined){a.height=f.layout.height}a.width=this._uMeChild(f,b);f.resize(a);f._urf();b+=f.layout.colspan?f.layout.colspan:1}},_uh5:function(){return this.parent()+this.table.outerHeight()},_uMeChild:function(h,b){var g=h.layout.colspan?h.layout.colspan:1;if(h.layout.width){return h.layout.width}var d=0;var a=this.view.$b().width();var f=a-this.fixedWidth;for(var c=b;c<b+g;c++){if(this.cols[c].width){d+=this.cols[c].width}else{if(this.cols[c].weight){d+=(f*this.cols[c].weight/this.totalWeight)
}}}return d}});ludo.layout.Grid=new Class({Extends:ludo.layout.Base,columns:undefined,rows:undefined,colWidth:undefined,rowHeight:undefined,padX:undefined,padY:undefined,onCreate:function(){var a=this.view.layout;this.columns=a.columns||5;this.rows=a.rows||5;this.padX=a.padX||0;this.padY=a.padY||0;this.view.$b().css("position","relative")},_uVf:function(g,b,f){g.layout=g.layout||{};var a=g.layout;if(a.x==undefined&&a.y==undefined){var d=this.view.children.length;a.x=d%this.columns;a.y=Math.floor(d/this.columns)}a.colspan=a.colspan||1;a.rowspan=a.rowspan||1;a.x=a.x||0;a.y=a.y||0;return this.parent(g,b,f)},resize:function(){this.storeSize();for(var a=0;a<this.view.children.length;a++){var d=this.view.children[a];var b=this.pos(d);b.width=this._uXd(d);b.height=this._ueb(d);d.resize(b)}},pos:function(a){return{left:a.layout.x*this.colWidth,top:a.layout.y*this.rowHeight}},_uXd:function(c){var b=c.layout.colspan||1;var a=b*this.colWidth;return a-this.padX},_ueb:function(b){var a=b.layout.rowspan||1;return(a*this.rowHeight)-this.padY},storeSize:function(){var a=this._uEf;this.colWidth=a.width/this.columns;this.rowHeight=a.height/this.rows},_uIe:function(a){a.getEl().css("position","absolute")}});ludo._une.Record=new Class({Extends:Events,record:undefined,collection:undefined,_utf:undefined,initialize:function(a,b){this.record=a;this.collection=b},set:function(a,b){this._uif("beforeUpdate",this.record);this.record[a]=b;if(!this._utf||this._utf.indexOf(a)>=0){this._uif("update",this.record)}return this},get:function(a){return this.record[a]},setProperties:function(b){this._uif("beforeUpdate",this.record);for(var a in b){if(b.hasOwnProperty(a)){this.record[a]=b[a]}}this._uif("update",[this.record,undefined,"update"]);return this},_uVf:function(a){a=this._uU7(a);this.record.children=this.record.children||[];this.record.children.push(a);if(a.parentUid){var b=this.collection.getRecord(a.parentUid);if(b){b._u3d(a)}}this._uif("_uVf",[a,this.record,"_uVf"]);return this},getParent:function(){return this.collection.getRecord(this.record.parentUid)},getCollection:function(){return this.collection},isRecordObject:function(a){return a.initialize!==undefined&&a.record!==undefined},getChildren:function(){return this.record.children},_u3d:function(a){a=this._uU7(a);var b=this.record.children.indexOf(a);if(b>=0){this.record.children.splice(b,1);this._uif("_u3d",[a,this.record,"_u3d"])}},_uU7:function(a){return this.isRecordObject(a)?a.record:a},select:function(){this._uif("select",this)},insertBefore:function(a,b){if(this.inject(a,b)){this._uif("insertBefore",[a,b,"insertBefore"])}},insertAfter:function(a,b){if(this.inject(a,b,1)){this._uif("insertAfter",[a,b,"insertAfter"])}},inject:function(a,d,f){f=f||0;a=this._uU7(a);d=this._uU7(d);if(a===d){return false}if(a.parentUid){var c=this.collection.getRecord(a.parentUid);if(c){if(this.isMyChild(a)){this.record.children.splice(this._uNa(a),1)}else{c._u3d(a)}}}var b=this.record.children.indexOf(d);if(b!==-1){this.record.children.splice(b+f,0,a);return true}return false},_uNa:function(a){return this.record.children?this.record.children.indexOf(this._uU7(a)):-1},isMyChild:function(a){return this.record.children&&this.record.children.indexOf(this._uU7(a))!==-1},getUID:function(){return this.record.uid},getData:function(){return this.record},dispose:function(){this._uif("remove",this.record);delete this.record}});ludo._une.SearchParser=new Class({searches:undefined,parsedSearch:{items:[]},branches:[],compiled:undefined,getSearchFn:function(a){this.parse(a);this.compiled=this.parsedSearch;this.compiled=this.compile(Object.clone(this.parsedSearch));return this.compiled},clear:function(){this.parsedSearch={items:[]};this.branches=[]},parse:function(d){this.clear();this.branches.push(this.parsedSearch);for(var a=0;a<d.length;a++){if(this._uPa(d[a])){var b={items:[]};this._up1(b);this.branches.push(b)}else{if(this._udd(d[a])){this._updIfEmpty();if(this.branches.length>1){this.branches.pop()}}else{if(this._uaf(d[a])){if(!this._uod()){this._upd(d[a])}else{if(this._ue(d[a])){this._uY();this._upd(d[a])}else{if(this._uD1(d[a])){var c={operator:d[a],items:[]};c.items.push(this.branches[this.branches.length-1].items.pop());this._up1(c);this.branches.push(c)}}}}else{this._up1(d[a])}}}}this._updIfEmpty()},compile:function(c){var b=this._uo1(c);var a=0;while(b>=0&&a<100){c.items[b]={fn:this.compile(c.items[b])};a++;b=this._uo1(c)}return c.operator==="&"?this.getAndFn(c):this.getOrFn(c)},getAndFn:function(b){var a=b.items;return function(c){for(var d=0;d<a.length;d++){if(a[d].txt!==undefined){if(c._uae.indexOf(a[d].txt)===-1){return false}}else{if(a[d].fn!==undefined){if(!a[d].fn.call(this,c)){return false}}}}return true}},getOrFn:function(b){var a=b.items;return function(c){for(var d=0;d<a.length;d++){if(a[d].txt!==undefined){if(c._uae.indexOf(a[d].txt)>-1){return true}}else{if(a[d].fn!==undefined){if(a[d].fn.call(this,c)){return true}}}}return false}},_uo1:function(b){for(var a=0;a<b.items.length;a++){if(b.items[a].operator!==undefined){return a
}}return -1},_updIfEmpty:function(){var a=this.branches[this.branches.length-1];a.operator=a.operator||"&"},_uPa:function(a){return a==="("},_udd:function(a){return a===")"},_ue:function(a){return a==="|"&&this._ug3()==="&"},_uY:function(){var a=this.branches[this.branches.length-1];var b={operator:a.operator,items:a.items};a.operator=undefined;a.items=[b]},_uD1:function(a){return a==="&"&&this._ue2(a)},_up1:function(a){this.branches[this.branches.length-1].items.push(a)},_uaf:function(a){return a==="|"||a==="&"},_uod:function(){return this.branches[this.branches.length-1].operator!==undefined},_ue2:function(a){return a!==this._ug3()},_ug3:function(){return this.branches[this.branches.length-1].operator},_upd:function(a){this.branches[this.branches.length-1].operator=a}});ludo._une._uL6=new Class({Extends:ludo.Core,_une:undefined,_u8b:undefined,_ut3:false,delay:0,searches:undefined,_uY7:undefined,searchFn:undefined,_uxa:undefined,index:undefined,searchParser:undefined,_ukd:function(a){this.parent(a);this._uWf(a,["_une","index","delay"]);this.searchParser=new ludo._une.SearchParser();this.clear()},_use:function(){this.parent();var a=this._une;if(!a._un6()){a.on("beforeload",this._uj5.bind(this));a.on("beforeload",this._ubb.bind(this));a.on("update",this._uj5.bind(this));a.on("delete",this.onDelete.bind(this))}},search:function(b){if(!b&&this.searches.length==0){return}this.clear();this.where(b);this.endBranch();var a=this._uG7();if(a===0){this._ur9(this.searches[0].txt)}else{this._ur9.delay(a*1000,this,this.searches[0].txt)}},_ur9:function(a){if(a==this.searches[0].txt){this.execute()}},clear:function(){this.searches=[];return this},_ubb:function(){this._uif("_ubb");this._u8b=undefined;this.clear()},where:function(a){this.clear();this._uab(Array.from(arguments));return this},or:function(a){this._uw8("|");this._uab(Array.from(arguments));return this},_uab:function(b){this.preCondition(b);var c=this._uc4(b);var a;if(typeof c==="function"){a={fn:c}}else{a={txt:c.toLowerCase()}}this.searches.push(a);this.postCondition(b)},and:function(a){this._uw8("&");this._uab(Array.from(arguments));return this},preCondition:function(a){if(a.length==2&&a[0]==="("){this.branch()}},postCondition:function(a){if(a.length==2&&a[1]===")"){this.endBranch()}},_uc4:function(a){if(a.length===2){if(a[0]==")"||a[0]=="("){return a[1]}return a[0]}return a[0]},withIn:function(b){for(var a=0;a<b.length;a++){this.or(b[a])}return this},branch:function(){this._uw8("(");return this},endBranch:function(){this._uw8(")");return this},_uw8:function(a){if(a!="("&&this.searches.length==0){return}if(a==="|"&&this.searches.getLast()==="("){return}this.searches.push(a)},execute:function(){if(!this._ut3){this._ul4()}if(!this._uM6()){this._ubb()}else{this._uif("_uEe");this._u8b=[];this._u2a();this._uy9()}this._uif("search");return this},_uy9:function(){var b=this._uu4();for(var a=0;a<b.length;a++){if(this._uQ4(b[a])){this._u8b.push(b[a])}}},_uQ4:function(a){return this.searchFn.call(this,a)},_u2a:function(){this.searchFn=this.searchParser.getSearchFn(this.searches)},_uM6:function(){return this._uQ()||this.searches.length>1},_uQ:function(){if(this.searches.length===0){return false}var a=this.searches[0];return(ludo.util.isArray(a)||a.fn!==undefined||(a.txt!==undefined&&a.txt.length>0))},hasData:function(){return this._u8b!==undefined},getData:function(){return this._u8b},_uu4:function(){return this._une._u4a()},_uG7:function(){return this.delay||0},onDelete:function(a){if(this._u8b&&this._u8b.length>0){for(var b=0;b<this._u8b.length-1;b++){var c=this._u8b[b];if(c.uid==a.uid){this._uj5();this._u8b.splice(b,1)}}}},_uj5:function(){this._ut3=false},_ul4:function(){this._uPd(this._uu4());this._ut3=true},_uPd:function(g,c){c=c||[];var f=this._up3();var b;for(var d=0;d<g.length;d++){b=[];for(var a=0;a<f.length;a++){if(g[d][f[a]]!==undefined){b.push((g[d][f[a]]+"").toLowerCase())}}g[d]._uae=b.join(" ");for(a=0;a<c.length;a++){c[a]._uae=[c[a]._uae,g[d]._uae].join(" ")}if(g[d].children){this._uPd(g[d].children,c.concat(g[d]))}}},_up3:function(){if(this.index!==undefined){return this.index}var f=["children","_uae","uid"];var d=this._uu4();if(d.length>0){var a=Object.clone(d[0]);var b=[];for(var c in a){if(a.hasOwnProperty(c)){if(f.indexOf(c)===-1){b.push(c)}}}return b}return["NA"]},getCount:function(){return this._u8b?this._u8b.length:0},_uW7:function(){return this.hasData()?"":""}});ludo._une.JSONArray=new Class({Extends:ludo._une.JSON,sortFn:undefined,_uc6:undefined,_uze:"id",paging:undefined,_uqf:{},sortedBy:{column:undefined,order:undefined},_utb:undefined,_uw3:["sortedBy","paging"],index:undefined,_u4b:"_une._uL6",uidMap:undefined,selected:undefined,_ukd:function(a){this.parent(a);this.sortFn={};this._uc6=[];this.uidMap={};this._uWf(a,["_utb","sortFn","_uze","sortedBy","paging","selected"]);if(this._uze&&!ludo.util.isArray(this._uze)){this._uze=[this._uze]}if(this.paging){this.paging.offset=this.paging.offset||0;this.paging._uz9=this.paging.offset;if(this.paging._uz9!==undefined){this._uif("page",(this.paging._uz9/this.paging.size)+1)
}if(this._up8()){this.on("load",this._uKa.bind(this))}}this.on("parsedata",this._uQd.bind(this));if(this.selected){this.on("firstLoad",this._uQ2.bind(this))}if(this.data&&!this.index){this._uQd()}},_un6:function(){return this.paging&&this.paging.remotePaging},_uQ2:function(){this._upb(this.selected)},getCount:function(){if(this.paging&&this.paging.rows){return this.paging.rows}if(this.searcher&&this.searcher.hasData()){return this.searcher.getCount()}return this.data?this.data.length:0},_up8:function(){return this.paging&&this.paging.remotePaging&&this.paging.cache},sort:function(){if(this.sortedBy.column&&this.sortedBy.order){this.sortBy(this.sortedBy.column,this.sortedBy.order)}},by:function(a){this.sortedBy.column=a;this.sortedBy.order=this._uo7(a);return this},ascending:function(){this.sortedBy.order="asc";return this},descending:function(){this.sortedBy.order="desc";return this},sortBy:function(b,a){a=a||this._uo7(b);this.sortedBy={column:b,order:a};if(this.paging){this.paging.offset=this.paging._uz9||0;this._uif("page",Math.round(this.paging.offset/this.paging.size)+1)}if(this._uO2()){this._uY2()}else{var c=this._getData();if(!c){return this}c.sort(this._uwb(b,a));this._uif("change")}this._uif("sort",this.sortedBy);if(this.paging){this._uX7()}this._uif("state");return this},getSortedBy:function(){return this.sortedBy.column},_uJb:function(){return this.sortedBy.order},_uO2:function(){return this.paging&&this.paging.remotePaging},_uvf:function(b,a){this.sortFn[b]=a},_uwb:function(b,a){if(this.sortFn[b]!==undefined){return this.sortFn[b][a]}if(a==="asc"){return function(d,c){return d[b]+"_"+d[this._uze]<c[b]+"_"+c[this._uze]?-1:1}}else{return function(d,c){return d[b]+"_"+d[this._uze]<c[b]+"_"+c[this._uze]?1:-1}}},_uo7:function(a){if(this.sortedBy.column===a){return this.sortedBy.order==="asc"?"desc":"asc"}return"asc"},addRecord:function(a){this.data=this.data||[];this.data.push(a);if(!this.index){this._uQd()}this._uif("add",a);return this._uob(a)},find:function(a){return this._upe(a)},_upe:function(b){if(!this.data){return undefined}if(b.getUID!==undefined){b=b.getUID()}if(b.uid){b=b.uid}var d=this.getById(b);if(d){return d}var c=ludo.util.isObject(b)?"_ue1":"_uU1";for(var a=0;a<this.data.length;a++){if(this[c](this.data[a],b)){return this.data[a]}}return undefined},_ue1:function(a,c){for(var b in c){if(c.hasOwnProperty(b)){if(a[b]!=c[b]){return false}}}return true},_uU1:function(a,c){if(this._uze){for(var b=0;b<this._uze.length;b++){if(a[this._uze[b]]===c){return true}}}return false},_upes:function(c){var a=[];for(var b=0;b<this.data.length;b++){if(this._ue1(this.data[b],c)){a.push(this.data[b])}}return a},_u4a:function(){return this.data},_upb:function(a){var b=this._upe(a);if(b){this._uJ3(b);return b}return undefined},_upbs:function(b){this._uc6=this._upes(b);for(var a=0;a<this._uc6.length;a++){this._u2f(this._uc6[a])}return this._uc6},_ux4:function(a){var b=this._getData();if(b.length&&a>=0&&a<b.length){var c=b[a];this._uJ3(c);return c}return undefined},_getData:function(){if(this._uf6()){return this.searcher.getData()}return this.data},_u26:function(a){if(this.data.length&&a>=0&&a<this.data.length){return this.data[a]}return undefined},previous:function(){var a=this._uTa(this._uv4());if(a){this._uJ3(a)}return a},_uTa:function(a){var c=this._getData();if(a){var b=c.indexOf(a);return b>0?c[b-1]:undefined}else{return c.length>0?c[0]:undefined}},next:function(){var a=this.getNextOf(this._uv4());if(a){this._uJ3(a)}return a},getNextOf:function(a){var c=this._getData();if(a){var b=c.indexOf(a);return b<c.length-1?c[b+1]:undefined}else{return c.length>0?c[0]:undefined}},_uJ3:function(a){if(this._uc6.length){this._uif("deselect",this._uc6[0])}this._uc6=[a];this._u2f(Object.clone(a))},_uv4:function(){return this._uc6.length>0?this._uc6[0]:undefined},_uv4s:function(){return this._uc6},_uQa:function(c){var a=this._upes(c);for(var b=0;b<a.length;b++){this.data.erase(a[b]);this._uif("delete",a[b])}this.onChange()},remove:function(a){var b=this._upe(a);if(b){this.data.erase(b);this._uif("delete",b);this.onChange()}},_uDb:function(a){this.remove(a)},onChange:function(){this._uif("count",this.searcher!=undefined?this.searcher.getCount():this.getCount())},selectTo:function(d){var f=this._uv4();if(!f){this._upb(d);return}var g=this._upe(d);if(g){this._uc6=[];var b=this.data.indexOf(g);var a=this.data.indexOf(f);var c;if(b>a){for(c=a;c<=b;c++){this._uc6.push(this.data[c]);this._u2f(this.data[c])}}else{for(c=a;c>=b;c--){this._uc6.push(this.data[c]);this._u2f(this.data[c])}}}},_ucb:function(a,b){var c=this.getRecord(a);if(c){c.setProperties(b)}return c},_u2e:function(){if(!this.paging){return this.parent()}var a=this.postData||{};a._paging={size:this.paging.size,offset:this.paging.offset};a._sort=this.sortedBy;return a},_uBb:function(){if(!this.paging||this._uOa()){return}this.paging.offset-=this.paging.size;this._udb("_uBb")},nextPage:function(){if(!this.paging||this._uAb()){return}this.paging.offset+=this.paging.size;
this._udb("nextPage")},lastPage:function(){if(!this.paging||this._uAb()){return}var b=this.getCount();var a=b%this.paging.size;if(a===0){a=this.paging.size}this.paging.offset=b-a;this._udb("lastPage")},firstPage:function(){if(!this.paging||this._uOa()){return}this.paging.offset=0;this._udb("firstPage")},_uOa:function(){if(!this.paging){return true}return this.paging.offset===undefined||this.paging.offset===0},_uAb:function(){return this.paging.size+this.paging.offset>=this.getCount()},_udb:function(a){if(this.paging.remotePaging){this._uY2()}this._uif("change");this._uif(a);this._uX7()},_uY2:function(){if(this._uga()){this.data=this._uqf[this._uTd()].data;this._uif("change")}else{this.load()}},_uKa:function(){if(this._up8()){this._uqf[this._uTd()]={data:this.data,time:new Date().getTime()}}},_uga:function(){return this._uqf[this._uTd()]!==undefined&&!this._u56()},_uLe:function(){this._uqf={}},_u56:function(){if(!this.paging._ugb){return false}var a=this._uqf[this._uTd()].time;return a+(this.paging._ugb*1000)<(new Date().getTime())},_uTd:function(){var a=["key",this.paging.offset,this.sortedBy.column,this.sortedBy.order];if(this.searcher!==undefined&&this.searcher.hasData()){a.push(this.searcher._uW7())}return a.join("|")},hasData:function(){return this.data!=undefined&&this.data.length>0},_uX7:function(a){if(this._uAb()){this._uif("lastPage")}else{this._uif("notLastPage")}if(this._uOa()){this._uif("firstPage")}else{this._uif("notFirstPage")}this._uif("page",this._u8a());if(a===undefined){this._uif("state")}},toPage:function(a){if(a>0&&a<=this._u6b()&&!this._uQf(a)){this.paging.offset=(a-1)*this.paging.size;this._udb("toPage");return true}return false},_uRd:function(a){if(this.paging){this._uqf={};this.paging.size=parseInt(a);this.paging.offset=0;this._udb("toPage")}},_uQf:function(a){return a==this._u8a()},_u8a:function(){return this.paging?Math.floor(this.paging.offset/this.paging.size)+1:1},_u6b:function(){return this.paging?Math.ceil(this.getCount()/this.paging.size):1},getData:function(){if(this._uf6()){if(this.paging&&this.paging.size){return this._uN7(this.searcher.getData())}return this.searcher.getData()}if(!this.paging||this.paging.remotePaging){return this.parent()}return this._uN7(this.data)},_uN7:function(a){if(!a||a.length==0){return[]}var b=this.paging._uz9||this.paging.offset;if(b>a.length){this.toPage(this._u6b());b=(this._u6b()-1)*this.paging.size}this._uD3.delay(200,this);return a.slice(b,Math.min(a.length,b+this.paging.size))},_uD3:function(){this.paging._uz9=undefined},_uvc:function(b,a){if(a!=undefined){if(this.paging&&a.rows!==undefined){this.paging.rows=a.rows}if(this.paging&&a.response&&a.response.rows!==undefined){this.paging.rows=a.response.rows}}this.parent(b,a);this._uif("count",this.getCount());if(this._uj2()){this.sort()}else{this._uif("change")}if(this.paging!==undefined){this._uX7(true)}},_uQd:function(){this.index={};this._uPd(this.data)},_uPd:function(c,b){for(var a=0;a<c.length;a++){this._uOd(c[a],b);if(c[a].children&&c[a].children.length){this._uPd(c[a].children,c[a])}}},_uOd:function(a,b){if(!this.index){this._uQd()}if(b){a.parentUid=b.uid}var c=this._uk1(a);if(c){this.index[c]=a}if(!a.uid){a.uid=["uid_",String.uniqueID()].join("")}this.index[a.uid]=a},_uj2:function(){if(this.paging&&this.paging.remotePaging){return false}return this.sortedBy!==undefined&&this.sortedBy.column&&this.sortedBy.order},search:function(a){this._uMd().search(a)},_ukb:function(a){this.postData=this.postData||{};this.postData.search=a;this.toPage(1);this.load()},_uNd:function(){var a=this._uMd();this._uif("count",a.hasData()?a.getCount():this.getCount());if(this.paging!==undefined){this.paging.offset=0;this._uX7(true);this._uif("pageCount",this._u6b())}this._uif("change")},searcher:undefined,_uMd:function(){if(this.searcher===undefined){this._utb=this._utb||{};var a=Object.merge({type:this._u4b,_une:this},this._utb);this.searcher=ludo._new(a);this._uo4()}return this.searcher},_uo4:function(){var a=this.searcher;a.on("search",this._uNd.bind(this));a.on("_ubb",this._uNd.bind(this))},_uf6:function(){return this.searcher!==undefined&&this.searcher.hasData()},getById:function(c){if(this.index[c]!==undefined){return this.index[c]}if(this._uze.length===1){return this.index[c]}else{var b=[];for(var a=0;a<this._uze.length;a++){b.push(c[this._uze[a]])}return this.index[b.join("")]}},_usa:{},getRecord:function(a){var b=this._upe(a);if(b){return this._uob(b)}return undefined},_uob:function(a){var b=a.uid;if(!this._usa[b]){this._usa[b]=this._uS7(a,this);this._uz6(this._usa[b])}return this._usa[b]},_uS7:function(a){return new ludo._une.Record(a,this)},_uz6:function(a){a.on("update",this._uO7.bind(this));a.on("remove",this._uq6.bind(this));a.on("select",this._upb.bind(this))},_u2f:function(a){this._uif("select",a)},_uO7:function(a){this._uOd(a);this._uif("update",a)},_uq6:function(a){var c=this._uDfFor(a);if(c){var b=c.indexOf(a);if(b!==-1){c.splice(b,1)}this._uo6(a);this._uif("remove",a)}},_uDfFor:function(a){if(a.parentUid){var b=this._upe(a.parentUid);
return b?b.children:undefined}else{return this.data}},_uo6:function(a){this._usa[a.uid]=undefined;this.index[a.uid]=undefined;var b=this._uk1(a);if(b){this.index[b]=undefined}},_uk1:function(a){if(this._uze){var c=[];for(var b=0;b<this._uze.length;b++){c.push(a[this._uze[b]])}return c.join("")}return undefined}});ludo.factory.registerClass("_une.JSONArray",ludo._une.JSONArray);ludo.Scroller=new Class({Extends:Events,els:{applyTo:null,el:null,elInner:null,parent:null},active:0,wheelSize:5,type:"horizontal",_uLd:0,renderTo:undefined,initialize:function(a){this.type=a.type||this.type;if(a.applyTo){this.setApplyTo(a.applyTo)}this.renderTo=a.parent?jQuery(a.parent):null;if(a.mouseWheelSizeCls){this._uR(a.mouseWheelSizeCls)}this._u19();this.createEvents()},setApplyTo:function(a){if(!ludo.util.isArray(a)){a=[a]}this.els.applyTo=a},_uR:function(a){var b=jQuery("<div>");b.addClass(a);b.css("visibility","hidden");jQuery(document.body).append(b);this.wheelSize=b.height();if(!this.wheelSize){this.wheelSize=25}b.remove()},_u19:function(){var a=this.els.el=jQuery("<div>");a.addClass("ludo-scroller");a.addClass("ludo-scroller-"+this.type);a.css({position:"relative","z-index":1000,overflow:"hidden"});var b="auto";if(this.type=="horizontal"){a.css({"overflow-x":b,width:"100%",height:Browser.ie?"21px":"17px"})}else{a.css({"overflow-y":b,height:"100%",width:Browser.ie?"21px":"17px",right:"0px",top:"0px",position:"absolute"})}a.scroll(this._uka.bind(this));this.els.elInner=jQuery("<div>");this.els.elInner.css("position","relative");this.els.elInner.html("&nbsp;");a.append(this.els.elInner)},createEvents:function(){this.els.elInner.on("resize",this.toggle.bind(this));if(this.type=="vertical"){for(var a=0;a<this.els.applyTo.length;a++){this.els.applyTo[a].on("mousewheel",this._uKd.bind(this))}}jQuery(window).on("resize",this.resize.bind(this))},resize:function(){if(this.type=="horizontal"){this.els.el.css("width",this.renderTo.outerWidth())}else{var a=this.renderTo.outerHeight();if(a==0){return}this.els.el.css("height",a)}this.toggle()},getEl:function(){return this.els.el},_u49:function(a){if(this.type=="horizontal"){this._uLd=a||this._uf();this.els.elInner.css("width",this._uLd)}else{this._uLd=a||this._uc();if(this._uLd<=0){var b=this.els.applyTo.getChildren(".ludo-grid-data-column");if(b.length){this._uLd=b[0].outerHeight()}}this.els.elInner.css("height",this._uLd)}if(this._uLd<=0){this._u49.delay(1000,this)}this.resize();this.toggle()},_uf:function(){return this._u7b("outerWidth")},_uc:function(){return this._u7b("outerHeight")},_u7b:function(c){var a=0;for(var b=0;b<this.els.applyTo.length;b++){a+=this.els.applyTo[b][c]()}return a},_uKd:function(b){var a=this.els.el.scrollTop();this.els.el.scrollTop(a-b.originalEvent.wheelDelta);return false},_uka:function(){if(this.type=="horizontal"){this.scrollTo(this.els.el.scrollLeft())}else{this.scrollTo(this.els.el.scrollTop())}},scrollBy:function(b){var a=this.type==="horizontal"?"scrollLeft":"scrollTop";this.els.el[a]+=b;this.scrollTo(this.els.el[a])},scrollTo:function(c){var b=this.type==="horizontal"?"left":"top";for(var a=0;a<this.els.applyTo.length;a++){this.els.applyTo[a].css(b,(c*-1))}this._uif("scroll",this)},getHeight:function(){return this.active?this.els.el.height():0},getWidth:function(){return this.active?this.els.el.width():0},toggle:function(){this._uf2()?this.show():this.hide()},_uf2:function(){var b=this.type==="horizontal"?"width":"height";var a=this.getParentEl()[b]();return this._uLd>a&&a>0},getParentEl:function(){return this.renderTo?this.renderTo:this.els.el},show:function(){this.active=true;this.els.el.css("display","")},hide:function(){this.active=false;this.scrollTo(0);this.els.el.css("display","none")}});ludo.grid.GridHeader=new Class({Extends:ludo.Core,_uo9:undefined,grid:undefined,cells:{},cellHeight:undefined,spacing:{},headerMenu:false,_ukd:function(a){this.parent(a);this._uWf(a,["_uo9","headerMenu","grid"]);this._uK3();this._unf()},_use:function(){this.parent();var a=this._uo9;a.on("resize",this._uk9.bind(this));a.on("resize",this.resizeHeader.bind(this));a.on("stretch",this._uk9.bind(this));a.on("movecolumn",this._uk9.bind(this));a.on("hidecolumn",this._uk9.bind(this));a.on("showcolumn",this._uk9.bind(this));this.grid.on("render",this._uk9.bind(this));this.grid._up9().addEvent("sort",this._uK6.bind(this))},_unf:function(){this.el=jQuery('<div class="ludo-header">');this.grid.$b().prepend(this.el);this.resizeHeader();this._uk9()},resizeHeader:function(){var b=this._uo9._uZa();var a=this.cellHeight*b+ludo.dom._u6g(this.el);this.el.css("height",Math.max(a,20))},_uk9:function(){var d=this._uo9._uZa();this._uK3();for(var g=0;g<d;g++){var c=this._uo9._ua6(g);var b=0;for(var f=0;f<c.length;f++){var a=this._uo9._uMe(c[f]);if(g===this._uo9._un9(c[f])){var k=this.getCell(c[f]);var l=(this._uo9._u9b(c[f])*this.cellHeight)-this.spacing.height;var h=(f===c.length-1)?this.spacing.width-1:this.spacing.width;k.css({display:"",left:b,top:g*this.cellHeight,width:a-h,height:l,"line-height":l+"px"});
this._ul1(c[f]);k.removeClass("last-header-cell");if(f==c.length-1){k.addClass("last-header-cell")}}b+=a}}this._u74()},_u74:function(){var b=this._uo9._uT5();for(var a=0;a<b.length;a++){if(this._u8f(b[a])){this.cells[b[a]].css("display","none")}}},_u8f:function(a){return this.cells[a]!==undefined},_uK3:function(){if(this.grid._uNf()){return}var a=jQuery("<div>");a.addClass("ludo-grid-header-cell");this.grid.$b().append(a);this.cellHeight=a.height()+ludo.dom.getMH(a);this.spacing={width:a.outerWidth()-a.width(),height:a.outerHeight()-a.height()};a.remove()},menuButtons:{},getCell:function(b){if(this.cells[b]){return this.cells[b]}var a=this._uo9;var d=this.cells[b]=jQuery("<div>");d.attr("col",b);d.addClass("ludo-grid-header-cell");d.addClass("ludo-header-"+a._u42(b));var c=jQuery('<span class="ludo-cell-text">'+a.getHeadingFor(b)+"</span>");d.append(c);this._u9(b);if(a._uwf(b)){this._ub2(d,b)}if(a._u6f(b)){d.on("click",this.sortByDOM.bind(this))}d.on("mouseover",this._u76.bind(this));d.on("mouseout",this._uc9.bind(this));if(this.headerMenu){this.menuButtons[b]=new ludo.menu.Button({renderTo:d,id:this._uv7(b),menu:this.getMenu(b),listeners:{beforeShow:this._uq1.bind(this)}})}this.el.append(d);if(a._uwf(b)){this._u7f().add({el:d,column:b})}return d},_uq1:function(a){if(this._uTe&&this._uTe.isActive()){a.cancelShow()}},cellBg:{},_u9:function(b){var c=jQuery("<div>");c.addClass("ludo-grid-header-cell-top");this.cells[b].append(c);var a=jQuery("<div>");a.addClass("ludo-grid-header-cell-bottom");this.cells[b].append(a);this.cellBg[b]={top:c,bottom:a}},_ul1:function(b){var c=(this._uo9._u9b(b)*this.cellHeight)-this.spacing.height;var a=Math.round(c)/2;this.cellBg[b].top.css("height",a);a=c-a;this.cellBg[b].bottom.css("height",a)},getMenu:function(a){return{singleton:true,id:this.getMenuId(),type:"menu.Menu",direction:"vertical",children:this._uqa(a)}},_uqa:function(c){var a=[];var d=this._uo9._ufd();for(var b=0;b<d.length;b++){a.push({type:"form.Checkbox",disabled:!(this._uo9._utd(d[b])),checked:this._uo9.isVisible(d[b]),label:this._uo9.getHeadingFor(d[b]),action:d[b],height:25,width:150,listeners:{change:this._uO3(d[b],c)}})}a.push({html:ludo.language.get("Sort ascending"),listeners:{click:function(){this.sort("ascending")}.bind(this)}});a.push({html:ludo.language.get("Sort descending"),listeners:{click:function(){this.sort("descending")}.bind(this)}});return a},sort:function(a){this.grid._up9().by(this._uD9)[a]().sort();ludo.get(this._uv7(this._uD9)).hideMenu()},_uO3:function(b,a){return function(c){if(c){this._uo9._uJe(b)}else{this._uo9._uFe(b)}ludo.get(this._uv7(a)).hideMenu()}.bind(this)},getMenuId:function(){return"header-menu-"+this.getId()},_uv7:function(a){return this.getMenuId()+"-"+a},_uD9:undefined,_u76:function(b){var a=this._u2d(b.target);if(!this.grid._ul5.isActive()&&!this.grid._uZ2()&&this._uo9._u6f(a)){this._uD9=a;this.cells[a].addClass("ludo-grid-header-cell-over")}},_uc9:function(b){if(!this.grid._ul5.isActive()){var a=this._u2d(b.target);if(!a){return}this.cells[a].removeClass("ludo-grid-header-cell-over")}},_u2d:function(b){b=jQuery(b);var a=b.attr("col");if(!a&&a!="0"){a=b.parent().attr("col")}return a},getHeight:function(){if(this._u1b===undefined){this._u1b=this._uo9._uZa()*this.cellHeight;this._u1b+=ludo.dom._u6g(this.el)}return this._u1b},getEl:function(){return this.el},sortByDOM:function(b){var a=this._u2d(b.target);this.grid._up9().sortBy(a)},_ub2:function(d,c){var f=jQuery("<div>");f.css({position:"absolute","z-index":15,left:"0px",top:"0px",width:"50%",height:"100%"});d.append(f);var b=jQuery("<div>");b.css({position:"absolute","z-index":15,right:"0px",top:"0px",width:"50%",height:"100%"});d.append(b);var a=this._u7f();a._upa({el:f,column:c,position:"before"});a._upa({el:b,column:c,position:"after"})},_uTe:undefined,_u7f:function(){if(this._uTe===undefined){this._uTe=new ludo.grid.ColumnMove({useShim:true,delay:0.5,_uWa:15,_uCb:15,listeners:{before:this._uYa.bind(this),start:this.grid._uV3.bind(this.grid),end:this.grid._uX3.bind(this.grid),_ur6:this.validateDrop.bind(this),_ud6:this._ud6.bind(this),_uFf:this._uC2.bind(this),drop:this._u0f.bind(this)}})}return this._uTe},_uC2:function(c,a){var b=a._uUe().column;c.html(this._uo9.getHeadingFor(b));c.css("line-height",c.css("height"))},_uYa:function(b,a){if(!this._uo9._uwf(b.column)){a._u1f()}},validateDrop:function(d,f){var c=this._uo9;if(c.canBeMovedTo(d.column,f.column,f.position)){var b=this._u7f();b.showMarkerAt(this.getCell(f.column),f.position);var a=(c._uq7(f.column)+c._u9b(f.column))*this.cellHeight;b.setMarkerHeight(a)}},_ud6:function(){this._u7f().hideMarker()},_u0f:function(a,b){if(b.position=="before"){this._uo9._u13(a.column,b.column)}else{this._uo9._uI4(a.column,b.column)}this._u7f().hideMarker()},_ub:function(){var c=this._uo9._ufd();for(var a=0;a<c.length;a++){if(this.cells[c[a]]!==undefined){var b=this.cells[c[a]].find("span");b.removeClass("ludo-cell-text-sort-asc");b.removeClass("ludo-cell-text-sort-desc")}}},_uK6:function(a){this._ub();
if(this.cells[a.column]){this.cells[a.column].find("span").addClass("ludo-cell-text-sort-"+a.order)}}});ludo.ColResize=new Class({Extends:ludo.Core,component:undefined,_uT9:{},_u15:{},minPos:0,maxPos:10000,_ukd:function(a){this.parent(a);this.component=a.component;this.createEvents()},createEvents:function(){this._uCe().on(ludo.util._ub5(),this._uB2.bind(this));this._uCe().on(ludo.util._uE7(),this._uS9.bind(this))},setPos:function(a,b){this._uT9[a].css("left",b)},_uue:function(a){this._uT9[a].css("display","none")},_uve:function(a){this._uT9[a].css("display","")},_ua9:function(){for(var a in this._uT9){if(this._uT9.hasOwnProperty(a)){this._uue(a)}}},_uL8:function(){for(var a in this._uT9){if(this._uT9.hasOwnProperty(a)){this._uve(a)}}},getHandle:function(b,a){var c=jQuery("<div>");c.addClass("ludo-column-resize-handle");c.css({top:0,position:"absolute",height:"100%",cursor:"col-resize","z-index":15000,display:a?"":"none"});c.attr("col-reference",b);c.on(ludo.util._uW3(),this._uC8.bind(this));if(!ludo.util._uZ5()){c.on("mouseenter",this._uf1.bind(this));c.on("mouseleave",this._uN1.bind(this))}this._uT9[b]=c;return c},_uC8:function(c){var a=jQuery(c.target).attr("col-reference");this._uif("startresize",a);jQuery(c.target).addClass("ludo-resize-handle-active");var d=this._u7();var b=this._u15;b.min=this.getMinPos()-d;b.max=this.getMaxPos()-d;b.mouseX=this._u15.currentX=c.pageX;b.elX=parseInt(jQuery(c.target).css("left").replace("px",""));b.currentX=this._u15.elX;b.active=true;b.el=jQuery(c.target);b.index=a;return false},_u7:function(){if(!this._uT9[0]){return 3}if(!this._ujb){var a=Math.ceil(this._uT9[0].getSize().x/2);if(a>0){this._ujb=a}else{return 3}}return this._ujb},_uB2:function(a){if(this._u15.active){var b=this._u15.elX-this._u15.mouseX+a.pageX;b=Math.max(b,this._u15.min);b=Math.min(b,this._u15.max);this._u15.el.css("left",b);this._u15.currentX=b;return false}return undefined},_uS9:function(){if(this._u15.active){this._u15.active=false;this._u15.el.removeClass("ludo-resize-handle-active");var a=this._u15.currentX-this._u15.elX;this._uif("resize",[this._u15.index,a]);return false}return undefined},getMinPos:function(){return this.minPos},getMaxPos:function(){return this.maxPos},setMinPos:function(a){this.minPos=a},_uff:function(a){this.maxPos=a},_uf1:function(a){jQuery(a.target).addClass("ludo-grid-resize-handle-over")},_uN1:function(a){jQuery(a.target).removeClass("ludo-grid-resize-handle-over")},isActive:function(){return this._u15.active}});ludo.grid.ColumnManager=new Class({Extends:ludo.Core,type:"grid.ColumnManager",fill:true,columns:{},_u5f:[],_uw3:["columns","_u5f"],_uhb:{},_ukd:function(a){this.parent(a);this._uWf(a,["fill","columns"]);this._ux3();if(a._u5f!==undefined&&this._uM2(a._u5f)){this._u5f=a._u5f}else{this._u5f=this._u51()}},_u51:function(d){var a=[];d=d||this.columns;for(var c in d){if(d.hasOwnProperty(c)){a.push(c);if(d[c].columns!==undefined){var f=this._u51(d[c].columns);for(var b=0;b<f.length;b++){a.push(f[b])}}}}return a},_ux3:function(b,c){b=b||this.columns;for(var a in b){if(b.hasOwnProperty(a)){this._uhb[a]=b[a];this._uhb[a].group=c;if(b[a].columns!==undefined){this._ux3(b[a].columns,a)}}}},_uM2:function(b){for(var a=0;a<b.length;a++){if(this._uhb[b[a]]===undefined){return false}}return true},_uu:function(){return this.fill},_uxfs:function(){return this.columns},_uxf:function(a){return this._uhb[a]},_ufd:function(){var a=[];for(var b=0;b<this._u5f.length;b++){if(this._uhb[this._u5f[b]].columns===undefined){a.push(this._u5f[b])}}return a},_uL4:function(){var a={};var d=this._ufd();for(var c=0;c<d.length;c++){var b=d[c];if(!this._uNf(b)){a[b]=this._uhb[b]}}return a},getHeadingFor:function(a){return this._uxfKey(a,"heading")||""},_uu9:function(d){if(this.isGroup(d)){var c=this._uf7(d);var a=0;for(var b=0;b<c.length;b++){a+=this._uu9(c[b])}return a}return this._uxfKey(d,"minWidth")||50},_uza:function(a){return this._uxfKey(a,"maxWidth")||1000},_uMe:function(d){var a=this._u44(d);if(a){return a}if(this.isGroup(d)){var b=this._u24(d);var c=0;Object.each(b,function(g,f){if(!this._uNf(f)){c+=this._uMe(f)}}.bind(this));return c}else{return this._uxfKey(d,"width")||100}},isGroup:function(a){return this._uhb[a]!==undefined&&this._uhb[a].columns!==undefined},_u24:function(a){return this._uhb[a].columns},_u44:function(a){return this._uxfKey(a,"_uHb")},_utd:function(a){return !!this._uxfKey(a,"removable")},_uSe:function(a){return this._uxfKey(a,"group")!==undefined},_ufb:function(a){return this._uxfKey(a,"group")},_urd:function(a){var b=this._ufb(a);return b?this._uhb[b]:undefined},_u7a:function(a){var b=this._uxf(a);if(b.columns!==undefined){return ludo.util.lengthOfObject(b.columns)}return 0},_uf7:function(a){var b=this._uxf(a);if(b){return Object.keys(b.columns)}return 0},_uaa:function(b,a){return this._uSe(b)&&this._ufb(b)==this._ufb(a)},_u6f:function(a){return !!this._uxfKey(a,"sortable")},_uNf:function(a){var b=this._uxfKey(a,"hidden");if(b){return true}var c;if(c=this._ufb(a)){return this._uNf(c)
}return b},isVisible:function(a){return !this._uNf(a)},_u7d:function(b){var a=this._uxfKey(b,"resizable")!==false;if(a&&this._uu()&&this._ul2(b)){a=false}return a},_uwf:function(b){var a=this._ufb(b);if(a&&this._u7a(a)==1){return false}return this._uxfKey(b,"movable")||false},_uM4:function(){for(var a=0;a<this._u5f.length;a++){if(this._uwf(this._u5f[a])){return true}}return false},_uR7:function(a){return this._uxfKey(a,"align")||"left"},_u42:function(a){return this._uxfKey(a,"headerAlign")||"left"},setLeft:function(a,b){this._uhb[a].left=b},getLeftPosOf:function(a){return this._uxfKey(a,"left")||0},_uZdFor:function(a){return this._uxfKey(a,"_uHf")},setWidth:function(b,a){this._uhb[b].width=a},_uF4:function(a){this._uhb[this._ub9()]._uHb=a;this._uif("stretch")},_uO1:function(){for(var a=0;a<this._u5f.length;a++){this._uhb[this._u5f[a]]._uHb=undefined}},_uD7:function(b,c){var a=this._uMe(b);this._uhb[b].width=a+c;this._uif("resize");this._uif("state")},_uxfKey:function(b,a){if(this._uhb[b]!==undefined){return this._uhb[b][a]}return null},_uJa:function(){var c=this._uL4();var b=0;for(var a in c){if(c.hasOwnProperty(a)){b+=this._uMe(a)}}return b},_ugd:function(a){return this._ur(a)+this._uu9(a)},_uqd:function(a){return this._ur(a)+this._uza(a)},_ur:function(c){var d=this._ufd();var a=0;for(var b=0;b<d.length;b++){if(d[b]==c){return a}if(!this._uNf(d[b])){a+=this._uMe(d[b])}}return 0},_u13:function(a,b){this._u0f(a,b,"before")},_uI4:function(a,b){this._u0f(a,b,"after")},_u0f:function(c,b,k){var m=this._uK4(b,k);var l=this._u5f.indexOf(c);if(this._uSe(c)&&!this._uaa(c,b)){this._ut7(c)}var f,d;var g=[l];if(this.isGroup(c)){var a=this._uf7(c);for(f=0;f<a.length;f++){g.push(this._u5f.indexOf(a[f]))}}if(this._uSe(b)){this._uy1(c,b)}var h=[];for(f=0;f<this._u5f.length;f++){if(f==m&&k=="before"){for(d=0;d<g.length;d++){h.push(this._u5f[g[d]])}}if(g.indexOf(f)==-1){h.push(this._u5f[f])}if(f==m&&k=="after"){for(d=0;d<g.length;d++){h.push(this._u5f[g[d]])}}}this._u5f=h;this._uif("movecolumn",[c,this._u5f[m],k]);this._uif("state")},_uK4:function(d,f){var a=this._u5f.indexOf(d);if(f==="after"&&this.isGroup(d)){var c=Object.keys(this._u24(d));for(var b=0;b<c.length;b++){a=Math.max(a,this._u5f.indexOf(c[b]))}}return a},_uy1:function(c,b){var a=this._uhb;var d=a[b].group;a[c].group=d;a[d].columns[c]=a[c];this._uLe()},_ul2:function(c){var d=this._ufd();for(var b=d.length-1;b>=0;b--){var a=d[b];if(!this._uNf([a])){return a===c}}return false},_ut7:function(a){var b=this._urd(a);if(b){delete b.columns[a];this._uxf(a).group=undefined;this._uLe();return true}return false},_uFe:function(a){if(this._u3b(a)&&!this._uNf(a)){this._uhb[a].hidden=true;this._uif("hidecolumn",a);this._uif("state")}},_u3b:function(a){return this._uhb[a]!==undefined},_uF7:function(){var b=this._ufd();for(var a=0;a<b.length;a++){this._uhb[b[a]].hidden=true}},_uJe:function(a){if(this._u3b(a)&&this._uNf([a])){this._uhb[a].hidden=false;this._uif("showcolumn",a);this._uif("state")}},_uF1:function(){var b=this._ufd();for(var a=b.length-1;a>=0;a--){if(!this._uNf(b[a])){return a}}return null},_ub9:function(){return this._ufd()[this._uF1()]},_ul7:undefined,_uZa:function(){if(this._ul7===undefined){var a=0;var c=this._ufd();for(var b=0;b<c.length;b++){a=Math.max(a,this._un9(c[b]))}this._ul7=a+1}return this._ul7},_uw5:{},_un9:function(c){if(this._uw5[c]===undefined){var b=0;if(this._uhb[c].group!==undefined){var a=this._uhb[c].group;while(a){b++;a=this._uhb[a].group}}this._uw5[c]=b}return this._uw5[c]},_uLe:function(){this._uw5={};this.colDCache={}},_ua6:function(a){var d=[];for(var f=0;f<this._u5f.length;f++){if(!this._uNf(this._u5f[f])){var c=this._u5f[f];var b=this._un9(c);if(b<=a&&!this.isGroup(c)){d.push(c)}else{if(b==a){d.push(c)}}}}return d},_u9b:function(a){var b=this._uZa();return b-this._un9(a)-(this.isGroup(a)?this._uq7(a):0)},colDCache:{},_uq7:function(d){if(this.colDCache[d]===undefined){if(this.isGroup(d)){var a=0;var c=this._uf7(d);for(var b=0;b<c.length;b++){a=Math.max(a,this._uq7(c[b]))}a++;this.colDCache[d]=a}else{this.colDCache[d]=0}}return this.colDCache[d]},_uT5:function(){var b=[];var d=this._u5f;for(var c=0;c<d.length;c++){var a=d[c];if(this._uNf(a)){b.push(a)}}return b},canBeMovedTo:function(a,b){return a!==b}});ludo.grid.RowManager=new Class({Extends:ludo.Core,type:"grid.RowManager",rowCls:undefined,_ukd:function(a){this.parent(a);if(a.rowCls){this.rowCls=a.rowCls}}});ludo.grid.Grid=new Class({Extends:ludo.View,type:"Grid",hasMenu:true,_u9f:null,menu:true,menuConfig:[],sb:{},_uX6:true,uniqueId:"",activeRecord:{},headerMenu:true,_u37:true,_uo9:undefined,columns:undefined,_uAe:undefined,emptyText:"No data",defaultDS:"_une.JSONArray",_ukd:function(a){this.parent(a);this._uWf(a,["columns","fill","headerMenu","_uAe","_u37","emptyText","_uX6","keys"]);if(this.columns==undefined){this.columns=this.__columns()}if(this.keys!=undefined){var c={};jQuery.each(this.keys,function(f,d){if(this.columns[d]!=undefined){c[d]=this.columns[d]}}.bind(this));this.columns=c
}if(!this.cm){this.cm={columns:this.columns,fill:this.fill}}if(this.cm){if(!this.cm.type){this.cm.type="grid.ColumnManager"}this.cm._uXf=this._uXf;this.cm.id=this.cm.id||this.id+"_cm";this.cm=this._um5("colManager",this.cm);this.cm._uBf({hidecolumn:this._uWc.bind(this),showcolumn:this._uWc.bind(this),movecolumn:this._usb.bind(this),resize:this._uja.bind(this)})}if(this._uAe){if(!this._uAe.type){this._uAe.type="grid.RowManager"}this._uAe=this._um5("_uAe",this._uAe)}var b=this._une;if(this._uXf&&b!==undefined&&ludo.util.isObject(b)){b.id=b.id||this.id+"_ds";b._uXf=this._uXf}this.uniqueId=String.uniqueID()},__columns:function(){return undefined},_uZf:function(){this.parent();this.getEl().addClass("ludo-grid-Grid");var a=this.$b();var c=this.els._uDaTop=jQuery("<div>");c.addClass("ludo-grid-data-container");c.css({overflow:ludo.util._uZ5()?"auto":"hidden",position:"relative"});a.append(c);a.css("overflow","visible");this.els._uDa=jQuery("<div>");c.append(this.els._uDa);this.els._uDa.css("position","relative");this.gridHeader=this._um5("gridHeader",{type:"grid.GridHeader",headerMenu:this.headerMenu,_uo9:this.cm,grid:this});this._uz();this._uf5();this._u61()},_use:function(){this.parent();if(this._une){if(this._ul9&&this._ul9.hasData()){this._unb()}this._up9()._uBf({change:this._unb.bind(this),select:this._uq4.bind(this),deselect:this._uR1.bind(this),update:this._ur4.bind(this),"delete":this._uC3.bind(this)});this._up9().addEvent("select",this._uE3.bind(this))}var a=this.$b();a.on("selectstart",ludo.util.cancelEvent);if(this._uX6){a.on("click",this.cellClick.bind(this));a.on("dblclick",this._ub7.bind(this))}else{a.css("cursor","default")}if(this._u37){this.els._uDa.on("mouseleave",this._u27.bind(this))}},__ucf:function(){this.parent();this._u8();if(this._uX6){this.els._uDa.css("cursor","pointer")}this._ut.delay(100,this);if(this.getParent()){this.getParent().$b().css({padding:0});ludo.dom._uLe();this.getParent().resize.delay(100,this.getParent())}this._um7()},_up4:undefined,_us4:false,enterCell:function(b){if(this._us4){return}var a=this._uB8(b);if(a){if(this._up4){this._uR1(this._up4,"ludo-grid-record-over")}this._up4=a;this._uE3(a,"ludo-grid-record-over")}},_u27:function(){if(this._up4){this._uR1(this._up4,"ludo-grid-record-over");this._up4=undefined}},cellClick:function(b){var a=this._uB8(b.target);if(a){this._up9()._upb(a);this._uif("click",[a,this._uxfByDom(b.target)])}},_uxfByDom:function(a){a=jQuery(a);if(!a.hasClass("ludo-grid-data-cell")){a=a.closest(".ludo-grid-data-cell")}if(a){return a.attr("col")}return undefined},_uq4:function(a){this._uif("selectrecord",a);this._us1()},_us1:function(){if(this._uX6){var a=this._up9()._uv4();if(a&&a.uid){this._uE3(a,"ludo-active-record")}}},_uE3:function(b,a){a=a||"ludo-active-record";var c=this._u62(b);for(var d in c){if(c.hasOwnProperty(d)){c[d].addClass(a)}}},_uR1:function(b,a){a=a||"ludo-active-record";var c=this._u62(b);for(var d in c){if(c.hasOwnProperty(d)){c[d].removeClass(a)}}},_ur4:function(a){var c=this._u62(a);var f;var b;for(var d in c){if(c.hasOwnProperty(d)){b=this.cm._uZdFor(d);if(b){f=b(a[d],a)}else{f=a[d]}c[d].find("span").html(f)}}},_uC3:function(a){var b=this._u62(a);for(var c in b){if(b.hasOwnProperty(c)){b[c].dispose()}}},_u62:function(b){var d={};var h,a;var g=this.cm._ufd();for(var f=0;f<g.length;f++){var c=this.$b().find("#ludo-grid-column-"+g[f]+"-"+this.uniqueId);a="cell-"+g[f]+"-"+b.uid+"-"+this.uniqueId;h=c.find("#"+a);if(h){d[g[f]]=h}}return d},_upb:function(a){if(ludo.util.isString(a)){a={id:a}}this._up9()._upb(a)},_ub7:function(b){var a=this._uB8(b.target);if(a){this._up9()._upb(a);this._uif("dblclick",[a,this._uxfByDom(b.target)])}},_uB8:function(b){b=jQuery(b);if(!b.hasClass("ludo-grid-data-cell")){b=b.parent(".ludo-grid-data-cell")}if(b&&b.hasClass("ludo-grid-data-cell")){var a=b.attr("uid");return this._up9()._upe({uid:a})}return undefined},_uZ2:function(){return this._u9f&&this._u9f.isActive()},_uV3:function(){this._ul5._ua9()},_uX3:function(){this._ul5._uL8();this._u8()},_uy8:function(){this.parent();if(this._ul5&&this.cm._uu()){this._uja()}},_usb:function(a,b,f){var d=this.els._uSd;if(f=="before"){d[a].insertBefore(d[b])}else{d[a].insertAfter(d[b])}this._ubf();this._uja()},_ubf:function(){var d=Object.keys(this.els._uSd);for(var b=0;b<d.length;b++){var f=this.els._uSd[d[b]];var a=["ludo-grid-data-last-column","ludo-grid-data-column"];jQuery.each(a,function(g,c){f.removeClass(c);f.removeClass(c+"-left");f.removeClass(c+"-center");f.removeClass(c+"-right")});ludo.dom.addClass(f,this._uxfCssClass(d[b]))}},_uWc:function(){if(!this.isRendered){return}this._uz();this._uja();this._unb();this._uX3()},JSON:function(){},addRecord:function(a){this._up9().addRecord(a)},_ukf:function(){this._uja();var a=this.getHeight()-ludo.dom._u6g(this.$e)-ludo.dom._u6g(this.els.body);a-=this.sb.h.getHeight();if(a<0){return}this.$b().css("height",a);var b=this.$b().height();if(b==0){this._ukf.delay(100,this);return}this.els._uDaTop.css("height",b-this.gridHeader.getHeight());
this.sb.v.resize();this.sb.h.resize()},_uf5:function(){this.sb.h=this._um5("scrollHorizontal",new ludo.Scroller({type:"horizontal",applyTo:this.$b(),parent:this.$b()}));this.sb.h.getEl().insertAfter(this.$b());this.sb.v=this._um5("scrollVertical",new ludo.Scroller({type:"vertical",applyTo:this.els._uDa,parent:this.els._uDaTop,mouseWheelSizeCls:"ludo-grid-data-cell"}));this.getEl().append(this.sb.v.getEl());this._ut()},_ut:function(){var a=this.gridHeader.getHeight();if(a==0){this._ut.delay(100,this);return}this.sb.v.getEl().css("top",a)},_u61:function(){this._ul5=new ludo.ColResize({component:this,listeners:{startresize:this._uIb.bind(this),resize:this._uXa.bind(this)}});var c=this.cm._ufd();for(var a=0;a<c.length;a++){var b=this._ul5.getHandle(c[a],this.cm._u7d(c[a]));this.$b().append(b);b.addClass("ludo-grid-resize-handle")}},_uIb:function(b){var a=this._ul5;a.setMinPos(this.cm._ugd(b));a._uff(this.cm._uqd(b));this._us4=true;this._u27()},_uf1:function(a){jQuery(a.target).addClass("ludo-grid-resize-handle-over")},_uN1:function(a){jQuery(a.target).removeClass("ludo-grid-resize-handle-over")},_uja:function(){this._us4=false;var g=0;this._um4();var f=this.cm._ufd();var b=this._ul5;for(var d=0;d<f.length;d++){if(this.cm._uNf(f[d])){b._uue(f[d])}else{var h=this.cm._uMe(f[d]);var c=this.els._uSd[f[d]];var j=ludo.dom.getBW(c)-(d===f.length-1)?1:0;c.css("left",g);c.css("width",(h-ludo.dom.getPW(c)-j));this.cm.setLeft(f[d],g);g+=h;b.setPos(f[d],g);if(this.cm._u7d(f[d])){b._uve(f[d])}else{b._uue(f[d])}}}var a=this.cm._uJa();this.els._uDaTop.css("width",a);this.sb.h._u49(a)},_um4:function(){if(this.cm._uu()){this.cm._uO1();var a=this.cm._uJa();var d=this.$b().width();var b=d-a;if(b<=0){return}var c=this.cm._uMe(this.cm._ub9())+b;this.cm._uF4(c)}},_um7:function(){if(this.emptyText){this.emptyTextEl().css("display",(!this._uAd||this._uAd.length)>0?"none":"")}},_unb:function(){this._uif("state");this._up4=undefined;this._uAd=this._up9().getData();this._um7();var g=[];var d=this.cm._ufd();for(var b=0;b<d.length;b++){var f="ludo-grid-column-"+d[b]+"-"+this.uniqueId;if(this.cm._uNf(d[b])){g.push('<div id="'+f+'" class="ludo-grid-data-column" style="display:none"></div>')}else{g.push('<div id="'+f+'" col="'+d[b]+'" class="ludo-grid-data-column ludo-grid-data-column-'+b+" "+this._uxfCssClass(d[b])+'">'+this._uZ1(d[b])+"</div>")}}this.els._uDa.html(g.join(""));var a=this.els._uDa.find(".ludo-grid-data-column");this.els._uSd={};var c;for(b=0,c=a.length;b<c;b++){this.els._uSd[jQuery(a[b]).attr("col")]=jQuery(a[b])}this._uif("renderdata",[this,this]);this._uja();this._uO();this._us1()},emptyTextEl:function(){if(this.els.emptyText===undefined){this.els.emptyText=jQuery('<div class="ludo-grid-empty-text">'+this.emptyText+"</div>");this.getEl().append(this.els.emptyText)}return this.els.emptyText},_uxfCssClass:function(b){var a;if(this.cm._ul2(b)){a="ludo-grid-data-last-column ludo-grid-data-last-column-"}else{a="ludo-grid-data-column-"}a+=this.cm._uR7(b);return a},_uO:function(){var b=this.els._uSd[this.cm._ub9()];if(!b){return}var a=b.outerHeight();if(a===0){this._uO.delay(300,this)}else{this.els._uDa.css("height",a);this.sb.v._u49()}},_uz:function(){this.els._uSd={};var c=this.cm._ufd();for(var a=0;a<c.length;a++){var b=jQuery("<div>");this.els._uDa.append(b);b.addClass("ludo-grid-data-column");b.attr("col",c[a]);b.addClass(this._uxfCssClass(a));b.id="ludo-grid-column-"+c[a]+"-"+this.uniqueId;this.els._uSd[c[a]]=b}},_uZ1:function(c){var m=[];var f=["ludo-grid-data-odd-row","ludo-grid-data-even-row"];var l;var h=this._uAd;if(!h){return""}var b=this.cm._uZdFor(c);var n=this._uAe?this._uAe.rowCls:undefined;var d="";for(var g=0,j=h.length;g<j;g++){l=h[g][c];if(b){l=b(l,h[g])}var a=["cell-",c,"-",h[g].uid,"-",this.uniqueId].join("");var k=this._u37?" onmouseover=\"ludo.get('"+this.id+"').enterCell(this)\"":"";if(n){d=n(h[g]);if(d){d=" "+d}}m.push('<div id="'+a+'" '+k+' col="'+c+'" class="ludo-grid-data-cell '+(f[g%2])+d+'" uid="'+h[g].uid+'"><span class="ludo-grid-data-cell-text">'+l+"</span></div>")}return m.join("")},_uXa:function(b,a){this.cm._uD7(b,a)},_u8:function(){if(this.cm._uu()){this._ul5._uue(this.cm._ub9())}},scrollBy:function(a,b){if(b){this.sb.v.scrollBy(b)}if(a){this.sb.h.scrollBy(a)}},_uv4:function(){return this._up9()._uv4()},_uxfManager:function(){return this.cm}});ludo.effect._una=new Class({id:undefined,el:undefined,handle:undefined,minX:undefined,maxX:undefined,minY:undefined,maxY:undefined,directions:undefined});ludo.effect.Effect=new Class({Extends:ludo.Core,fadeOut:function(a,b,c){a.animate({opacity:0},{duration:b*1000,complete:c})},slideIn:function(a,b,f,d){d=d||a._uId();var c={x:d.left,y:-a.height()};this.slide(a,c,d,b,f)},slideOut:function(a,b,f,d){d=d||a._uId();var c={x:d.left,y:-a.height()};this.slide(a,d,c,b,f)},slide:function(a,f,d,b,c){if(f.x!=undefined&&f.left==undefined){f.left=f.x}if(d.x!=undefined&&d.left==undefined){d.left=d.x}f.top=f.top||f.y;d.top=d.top||d.y;if(f.left==undefined){f.left=d.left}this.show(a);
a.css(f);a.animate({left:d.left,top:d.top},{duration:b*1000,complete:c})},fadeIn:function(a,b,c){a.css("opacity",0);a.css("visibility","visible");a.animate({opacity:1},{duration:b*1000,complete:c})},show:function(a){if(a.css("visibility")==="hidden"){a.css("visibility","visible")}}});ludo.effect.Drag=new Class({Extends:ludo.effect.Effect,handle:undefined,el:undefined,minX:undefined,minY:undefined,maxX:undefined,maxY:undefined,minPos:undefined,maxPos:undefined,directions:"XY",unit:"px",_u9e:{active:false},_u3eToDrag:undefined,delay:0,_uHd:false,els:{},useShim:false,autoHideShim:true,shimCls:undefined,_uWa:undefined,_uCb:undefined,_uW5:true,_ukd:function(a){this.parent(a);if(a.el!==undefined){this.add({el:a.el,handle:a.handle})}this._uWf(a,["useShim","autoHideShim","directions","delay","minX","maxX","minY","maxY","minPos","maxPos","unit","shimCls","_uWa","_uCb","_uW5"])},_use:function(){this.parent();var a=this._uCe();a.on(ludo.util._ub5(),this.drag.bind(this));a.on(ludo.util._uE7(),this._u4g.bind(this));if(this.useShim){this.on("start",this._uFf.bind(this));if(this.autoHideShim){this.on("end",this.hideShim.bind(this))}}},add:function(b){b=this._uKb(b);var a=jQuery(b.el);this._u0ding(a);var c=b.handle?jQuery(b.handle):a;c.attr("id",c.id||"ludo-"+String.uniqueID());c.addClass("ludo-drag");c.on(ludo.util._uW3(),this.startDrag.bind(this));c.attr("forId",b.id);this.els[b.id]=Object.merge(b,{el:jQuery(a),handle:c});return this.els[b.id]},remove:function(b){if(this.els[b]!==undefined){var a=jQuery("#"+this.els[b].handle);a.off(ludo.util._uW3(),this.startDrag.bind(this));this.els[b]=undefined;return true}return false},removeAll:function(){var b=Object.keys(this.els);for(var a=0;a<b.length;a++){this.remove(b[a])}this.els={}},_uKb:function(a){if(!this._uK5(a)){a={el:jQuery(a)}}if(typeof a.el==="string"){if(a.el.substr(0,1)!="#"){a.el="#"+a.el}a.el=jQuery(a.el)}a.id=a.id||a.el.attr("id")||"ludo-"+String.uniqueID();if(!a.el.attr("id")){a.el.attr("id",a.id)}a.el.attr("forId",a.id);return a},_uK5:function(a){return a.el!==undefined||a.handle!==undefined},_u0ding:function(a){if(!this.useShim){a.css("position","absolute")}else{var b=a.css("position");if(!b||(b!="relative"&&b!="absolute")){a.css("position","relative")}}},getById:function(a){return this.els[a]},getIdByEvent:function(b){var a=jQuery(b.target);if(!a.hasClass("ludo-drag")){a=a.closest(".ludo-drag")}return a.attr("forId")},_uUe:function(){return this.els[this._u9e.dragged]},getEl:function(){return this.els[this._u9e.dragged].el},_uJd:function(){return this.useShim?this.getShim():this.getEl()},getSizeOf:function(a){return a.outerWidth!==undefined?{x:a.outerWidth(),y:a.outerHeight()}:{x:0,y:0}},_uta:function(a){return jQuery(a).position()},_ul3:function(){this._u3eToDrag={x:"x",y:"y"}},startDrag:function(f){var b=this.getIdByEvent(f);var c=this.getById(b).el;var l=this.getSizeOf(c);var g;if(this.useShim){g=c.position()}else{var k=this._uo2(c);g=k?c._uId(k):this._uta(c)}var j=g.left;var h=g.top;var a=ludo.util.pageXY(f);this._u9e={active:true,dragged:b,currentX:j,currentY:h,elX:j,elY:h,width:l.x,height:l.y,mouseX:a.pageX,mouseY:a.pageY};var d=this._u9e;d.el=this._uJd();this._uif("before",[this.els[b],this,{x:j,y:h}]);if(!this.isActive()){return undefined}d.minX=this.getMinX();d.maxX=this.getMaxX();d.minY=this.getMinY();d.maxY=this.getMaxY();d.dragX=this._uea();d.dragY=this._uca();if(this.delay){this._ur2()}else{this._uif("start",[this.els[b],this,{x:j,y:h}]);if(this._uW5){ludo._uFb.start()}}if(!ludo.util._uZ5()){return false}},_uo2:function(b){var a=b.parentNode;while(a){var c=a.getStyle("position");if(c==="relative"||c==="absolute"){return a}a=a.getParent()}return undefined},_u1f:function(){this._u9e.active=false;this._u9e.el=undefined;if(this._uW5){ludo._uFb.end()}},getShimFor:function(a){return a},_ur2:function(){this._uHd=true;this._u9e.active=false;this._uN.delay(this.delay*1000,this)},_uN:function(){if(this._uHd){this._u9e.active=true;this._uHd=false;this._uif("start",[this._uUe(),this,{x:this.getX(),y:this.getY()}]);ludo._uFb.start()}},drag:function(a){if(this._u9e.active&&this._u9e.el){var b={x:undefined,y:undefined};if(this._u9e.dragX){b.x=this.getXDrag(a)}if(this._u9e.dragY){b.y=this._uOf(a)}this.move(b);this._uif("drag",[b,this.els[this._u9e.dragged],this]);return false}return undefined},move:function(a){if(a.x!==undefined){this._u9e.currentX=a.x;this._u9e.el.css("left",a.x+this.unit)}if(a.y!==undefined){this._u9e.currentY=a.y;this._u9e.el.css("top",a.y+this.unit)}},getX:function(){return this._u9e.currentX},getY:function(){return this._u9e.currentY},getXDrag:function(b){var c;var a=ludo.util.pageXY(b);if(this._uCb){c=a.pageX+this._uCb}else{c=a.pageX-this._u9e.mouseX+this._u9e.elX}if(c<this._u9e.minX){c=this._u9e.minX}if(c>this._u9e.maxX){c=this._u9e.maxX}return c},_uOf:function(b){var c;var a=ludo.util.pageXY(b);if(this._uWa){c=a.pageY+this._uWa}else{c=a.pageY-this._u9e.mouseY+this._u9e.elY}if(c<this._u9e.minY){c=this._u9e.minY}if(c>this._u9e.maxY){c=this._u9e.maxY
}return c},_u4g:function(){if(this._u9e.active){this._u1f();this._uif("end",[this._uUe(),this,{x:this.getX(),y:this.getY()}])}if(this._uHd){this._uHd=false}},setMaxX:function(a){this.maxX=a},setMinX:function(a){this.minX=a},setMinY:function(a){this.minY=a},_u7g:function(a){this.maxY=a},setMinPos:function(a){this.minPos=a},_uff:function(a){this.maxPos=a},getMaxX:function(){return this.getMaxPos("maxX")},getMaxY:function(){return this.getMaxPos("maxY")},getMaxPos:function(b){var a=this._ue4(b);return a!==undefined?a:this.maxPos!==undefined?this.maxPos:100000},getMinX:function(){var a=this._ue4("minX");return a!==undefined?a:this.minPos},getMinY:function(){var a=this._uUe();return a&&a.minY!==undefined?a.minY:this.minY!==undefined?this.minY:this.minPos},_uUeX:function(){return this.getX()-this._u9e.elX},_uUd:function(){return this.getY()-this._u9e.elY},_uea:function(){return this._ue4("directions").indexOf("X")>=0},_uca:function(){return this._ue4("directions").indexOf("Y")>=0},_ue4:function(b){var a=this._uUe();return a&&a[b]!==undefined?a[b]:this[b]},getWidth:function(){return this._u9e.width},getHeight:function(){return this._u9e.height},getLeft:function(){return this._u9e.currentX},getTop:function(){return this._u9e.currentY},getShim:function(){if(this.shim===undefined){this.shim=jQuery("<div>");this.shim.addClass("ludo-shim");this.shim.css({position:"absolute","z-index":50000,display:"none"});jQuery(document.body).append(this.shim);if(this.shimCls){for(var a=0;a<this.shimCls.length;a++){this.shim.addClass(this.shimCls[a])}}this._uif("createShim",this.shim)}return this.shim},_uFf:function(){this.getShim().css({display:"",left:this._uJf(),top:this._uIf(),width:this.getWidth()+this._uM5(),height:this.getHeight()+this._uG4()});this._uif("_uFf",[this.getShim(),this])},_uIf:function(){if(this._uWa){return this._u9e.mouseY+this._uWa}else{return this.getTop()+ludo.dom.getMH(this.getEl())-ludo.dom.getMW(this.shim)}},_uJf:function(){if(this._uCb){return this._u9e.mouseX+this._uCb}else{return this.getLeft()+ludo.dom.getMW(this.getEl())-ludo.dom.getMW(this.shim)}},_uM5:function(){return ludo.dom.getMW(this.getEl())-ludo.dom.getMBPW(this.shim)},_uG4:function(){return ludo.dom.getMH(this.getEl())-ludo.dom._u6g(this.shim)},hideShim:function(){this.getShim().css("display","none")},setShimText:function(a){this.getShim().html(a)},isActive:function(){return this._u9e.active}});ludo.effect.Resize=new Class({Extends:ludo.Core,useShim:true,component:undefined,els:{shim:undefined,applyTo:undefined,handle:{}},minX:undefined,maxX:undefined,minWidth:undefined,maxWidth:undefined,minY:undefined,maxY:undefined,minHeight:undefined,maxHeight:undefined,_uA2:false,_u4d:undefined,_uqe:{e:["width"],s:["height"],w:["left","width"],n:["top","height"],nw:["top","left","height","width"],ne:["top","width","height"],se:["width","height"],sw:["left","height","width"]},_u4dKeys:undefined,_ue8:{active:false},xRegions:[["w","nw","sw"],["e","ne","se"]],_uKf:[["n","nw","ne"],["s","sw","se"]],_uc2:false,_ukd:function(a){this._uWf(a,["useShim","minX","maxX","minY","maxY","maxWidth","minWidth","minHeight","maxHeight","_uA2"]);if(a.component){this.component=a.component;this.els.applyTo=this.component.getEl()}else{this.els.applyTo=a.applyTo}if(a.listeners){this._uBf(a.listeners)}this._us9();this._u81.delay(100,this)},_u81:function(){var a=this.getEl().css("display");if(a!=="absolute"&&a!=="relative"){if(Browser.ie&&Browser.version<9){return}this.getEl().css("display","relative")}},_us9:function(){jQuery(document.body).on(ludo.util._uE7(),this._uye.bind(this));jQuery(document.body).on(ludo.util._ub5(),this.resize.bind(this))},addHandle:function(c,a){var b=this.els.handle[c]=jQuery("<div>");b.addClass("ludo-view-resize-el");b.addClass(this.getCssFor(c));if(a){b.addClass(a)}b.html("<span></span>");b.css("cursor",this.cursor(c)+"-resize");b.attr("region",c);b.on(ludo.util._uW3(),this._uGd.bind(this));this.els.applyTo.append(b)},_uGd:function(c){var b=jQuery(c.target).attr("region");this._uif("start",b);ludo._uFb.start();var a=ludo.util.pageXY(c);this._ue8={a:1,active:true,region:b,start:{x:a.pageX,y:a.pageY},current:{x:a.pageX,y:a.pageY},el:this._uB3(),minWidth:this.minWidth,maxWidth:this.maxWidth,minHeight:this.minHeight,maxHeight:this.maxHeight,area:this._uB4(),_uA2:this._uA2?this._uA2:c.shift?true:false};if(this._uA2||c.shift){this._ugc()}this._ue8.minX=this._uid();this._ue8.maxX=this._uhd();this._ue8.minY=this._uNc();this._ue8.maxY=this._ued();this._uua();if(this.useShim){this._uFf()}return ludo.util._uZ5()?false:undefined},_ugc:function(){var g=this._uh9();var f=this._ue8;if(g===0){return}var a,j,l,k;if(this.maxWidth!==undefined){k=this.maxWidth/g}if(this.minWidth!==undefined){l=this.minWidth/g}if(this.maxHeight!==undefined){j=this.maxHeight*g}if(this.minHeight!==undefined){a=this.minHeight*g}var h=this.getEl().offset();var b=this.$bWidth()-h.left;var c=this.$bHeight()-h.top;f.minWidth=Math.max(a||0,this.minWidth||0);f.maxWidth=Math.min(j||b,this.maxWidth||b);
f.minHeight=Math.max(l||0,this.minHeight||0);f.maxHeight=Math.min(k||c,this.maxHeight||c);if(f.maxWidth/g>f.maxHeight){f.maxWidth=f.maxHeight*g}if(f.maxHeight*g>f.maxWidth){f.maxHeight=f.maxWidth/g}},_uid:function(){var a,c=this._ue8,b=c.region;if(c.maxWidth!==undefined&&this.xRegions[0].indexOf(b)>=0){a=c.el.left+c.el.width-c.maxWidth}else{if(c.minWidth!==undefined&&this.xRegions[1].indexOf(b)>=0){a=c.el.left+c.minWidth}}if(this.minX!==undefined){if(a==undefined){a=this.minX}else{a=Math.max(a,this.minX)}}return a},_uhd:function(){var a,c=this._ue8,b=c.region;if(c.minWidth!==undefined&&this.xRegions[0].indexOf(b)>=0){a=c.el.left+c.el.width-c.minWidth}else{if(c.maxWidth!==undefined&&this.xRegions[1].indexOf(b)>=0){a=c.el.left+c.maxWidth}}if(this.maxX!==undefined){if(a==undefined){a=this.maxX}else{a=Math.min(a,this.maxX)}}return a},_uNc:function(){var a,c=this._ue8,b=c.region;if(c.maxHeight!==undefined&&this._uKf[0].indexOf(b)>=0){a=c.el.top+c.el.height-c.maxHeight}else{if(c.minHeight!==undefined&&this._uKf[1].indexOf(b)>=0){a=c.el.top+c.minHeight}}if(this.minY!==undefined){if(a==undefined){a=this.minY}else{a=Math.max(a,this.minY)}}return a},_ued:function(){var a,c=this._ue8,b=c.region;if(c.minHeight!==undefined&&this._uKf[0].indexOf(b)>=0){a=c.el.top+c.el.height-c.minHeight}else{if(c.maxHeight!==undefined&&this._uKf[1].indexOf(b)>=0){a=c.el.top+c.maxHeight}}if(this.maxY!==undefined){if(a==undefined){a=this.maxY}else{a=Math.min(a,this.maxY)}}return a},cursor:function(b){var a=b;if(a=="n"||a=="s"){a="ns"}if(a=="w"||a=="e"){a="we"}if(a=="se"||a=="nw"){a="nwse"}if(a=="ne"||a=="sw"){a="nesw"}return a},_uua:function(){jQuery(document.body).css("cursor",this.cursor(this._ue8.region)+"-resize")},_uu5:function(){jQuery(document.body).css("cursor","default")},resize:function(b){if(this._ue8.active){this._ue8.current=this._uj1(b);var a=this._uA8();this._uif("resize",a);if(this.useShim){this.els.shim.css(a)}else{this.getEl().css(a)}}},_uj1:function(c){var b=ludo.util.pageXY(c);var a={x:b.pageX,y:b.pageY};var f=this._ue8;if(f._uA2&&f.region.length===2){return a}if(f.minX!==undefined&&a.x<f.minX){a.x=f.minX}if(f.maxX!==undefined&&a.x>f.maxX){a.x=f.maxX}if(f.minY!==undefined&&a.y<f.minY){a.y=f.minY}if(f.maxY!==undefined&&a.y>f.maxY){a.y=f.maxY}return a},_uA8:function(){var g=this._ue8;var f=this._uqe[g.region];var a={};if(!g._uA2||g.region.length===1){for(var b=0;b<f.length;b++){a[f[b]]=this._u1a(f[b])}}if(g._uA2){switch(g.region){case"e":case"w":a.height=a.width/this._u4d;break;case"n":case"s":a.width=a.height*this._u4d;break;default:var c=this._ui8();a.width=g.el.width*c;a.height=g.el.height*c;if(g.region=="ne"||g.region=="nw"){a.top=g.el.top+g.el.height-a.height}if(g.region=="nw"||g.region=="sw"){a.left=g.el.left+g.el.width-a.width}a.width+=this._uld();a.height+=this._umd();break}}return a},_ui8:function(){var f=this._ue8;var c=f.region;var b;var a=(f.current.x-f.start.x)*f.area.xFactor/f.area.sum;var g=(f.current.y-f.start.y)*f.area.yFactor/f.area.sum;switch(c){case"se":b=1+a+g;break;case"ne":b=1+a+g*-1;break;case"nw":b=1+a*-1+g*-1;break;case"sw":b=1+a*-1+g;break}if(f.minWidth){b=Math.max(b,f.minWidth/f.el.width)}if(f.minHeight){b=Math.max(b,f.minHeight/f.el.height)}if(f.maxWidth){b=Math.min(b,f.maxWidth/f.el.width)}if(f.maxHeight){b=Math.min(b,f.maxHeight/f.el.height)}return b},_u1a:function(a){var b=this._ue8.region;var c=this._ue8;switch(a){case"width":if(b=="e"||b=="ne"||b=="se"){return c.el.width-c.start.x+c.current.x+this._uld()}else{return c.el.width+c.start.x-c.current.x+this._uld()}break;case"height":if(b=="s"||b=="sw"||b=="se"){return c.el.height-c.start.y+c.current.y+this._umd()}else{return c.el.height+c.start.y-c.current.y+this._umd()}case"top":if(b=="n"||b=="nw"||b=="ne"){return c.el.top-c.start.y+c.current.y}else{return c.el.top+c.start.y-c.current.y}case"left":if(b=="w"||b=="nw"||b=="sw"){return c.el.left-c.start.x+c.current.x}else{return c.el.left+c.start.x-c.current.x}}return undefined},_uld:function(){if(this.useShim){return ludo.dom.getBW(this.getShim())}return 0},_umd:function(){if(this.useShim){return ludo.dom.getBH(this.getShim())}return 0},_uye:function(){if(this._ue8.active){this._ue8.active=false;this._uif("stop",this._uA8());ludo._uFb.end();this._uu5();if(this.useShim){this.hideShim()}}},getCssFor:function(a){return"ludo-view-resize-region-"+a},_uFf:function(){var b=this.getShim();var a=this._uB3();b.css({display:"",left:a.left,top:a.top,width:a.width,height:a.height})},hideShim:function(){this.getShim().css("display","none")},_uB3:function(){var a=this.getEl();var b=a.offset();b.width=a.outerWidth();b.height=a.outerHeight();if(this.useShim){var c=this.getShim();b.width-=ludo.dom.getBW(c);b.height-=ludo.dom.getBH(c)}return b},getShim:function(){if(!this.els.shim){var a=this.els.shim=jQuery("<div>");a.addClass("ludo-shim-resize");a.css({position:"absolute","z-index":50000});jQuery(document.body).append(a)}return this.els.shim},getEl:function(){return this.els.applyTo},_ua9:function(){this.setHandleDisplay("none")
},_uL8:function(){this.setHandleDisplay("")},setHandleDisplay:function(b){for(var a in this.els.handle){if(this.els.handle.hasOwnProperty(a)){this.els.handle[a].css("display",b)}}},_uh9:function(){if(this._u4d===undefined){this._u4d=this.getEl().width()/this.getEl().height()}return this._u4d},$bWidth:function(){return jQuery(document.documentElement).width()},$bHeight:function(){return jQuery(document.documentElement).height()},_uB4:function(){var a={x:this.getEl().width(),y:this.getEl().height()};return{xFactor:a.x/a.y,yFactor:a.y/a.x,sum:a.x+a.y}}});ludo.view.ButtonBar=new Class({Extends:ludo.View,type:"ButtonBar",layout:{type:"linear",_uWd:"horizontal",width:"matchParent",height:"matchParent"},elCss:{height:"100%"},align:"right",cls:"ludo-view-button-container",overflow:"hidden",component:undefined,buttonBarCss:undefined,_ukd:function(a){this._uWf(a,["align","component","buttonBarCss"]);a.children=this.getValidChildren(a.children);if(this.align=="right"||a.align=="center"){a.children=this._ui3(a.children);if(a.align=="center"){a.children.push(this.emptyChild())}}else{a.children[0].elCss=a.children[0].elCss||{};if(!a.children[0].elCss["margin-left"]){a.children[0].elCss["margin-left"]=2}}this.parent(a)},_uZf:function(){this.parent();this.$b().addClass("ludo-content-buttons")},__ucf:function(){this.parent();this.component.on("resize",this._uK7.bind(this));if(this.buttonBarCss){this.getEl().parent().css(this.buttonBarCss)}},_uK7:function(){this._usf()._uZd().resize()},getValidChildren:function(b){for(var a=0;a<b.length;a++){if(b[a].value&&!b[a].type){b[a].type="form.Button"}}return b},getButtons:function(){var a=[];for(var b=0;b<this.children.length;b++){if(this.children[b].isButton&&this.children[b].isButton()){a.push(this.children[b])}}return a},getButton:function(b){var d=this.children;for(var a=0;a<d.length;a++){if(d[a].id==b||d[a].name==b||(d[a].val&&d[a].val().toLowerCase()==b.toLowerCase())){return d[a]}}return undefined},_ui3:function(a){a.splice(0,0,this.emptyChild());return a},emptyChild:function(){return{layout:{weight:1},elCss:{"background-color":"transparent"},css:{"background-color":"transparent"}}},getView_250_40:function(){return this.component}});ludo.view.TitleBar=new Class({Extends:ludo.Core,view:undefined,els:{el:undefined,icon:undefined,title:undefined,buttons:{},buttonArray:[]},_ulb:{},_ukd:function(a){this.parent(a);this._uWf(a,["view","buttons"]);if(!this.buttons){this.buttons=this._ug4()}this.view.on("_uUf",this._uUf.bind(this));this.view.on("resize",this._ukf.bind(this));this._unf();this._uB()},_ug4:function(){var b=[];var a=this.view;if(a.minimizable){b.push("minimize")}if(a.closable){b.push("close")}return b},_unf:function(){var a=this.els.el=jQuery("<div>");a.addClass(this.view.boldTitle?"ludo-framed-view-titlebar":"ludo-view-titlebar");var b=0;if(this.view.icon){this.createIconDOM();b+=a.width()}this._u98();a.append(this._uh3());this._ug1.delay(20,this);this.els.title.css("left",b)},createIconDOM:function(){this.els.icon=ludo.dom.create({renderTo:this.els.el,cls:"ludo-framed-view-titlebar-icon",css:{backgroundImage:"url("+this.view.icon+")"}})},_uUf:function(a){this.els.title.html(a)},_u98:function(){this.els.title=jQuery('<div class="ludo-framed-view-titlebar-title"></div>');this.els.el.append(this.els.title);this._uUf(this.view.title)},_uh3:function(){var b=this.els.controls=jQuery('<div class="ludo-title-bar-button-container"></div>');b.css("cursor","pointer");this._uNe("left",b);this._uNe("right",b);for(var a=0;a<this.buttons.length;a++){b.append(this._uyb(this.buttons[a]))}this._uP2();return b},_uNe:function(c,b){var a=jQuery('<div class="ludo-title-bar-button-container-'+c+'-edge"></div>');b.append(a);a.attr("style","position:absolute;z-index:1;"+c+":0;top:0;width:55%;height:100%;background-repeat:no-repeat;background-position:top "+c);return a},_ug1:function(){this.els.controls.css("width",this._uh4())},button:function(a){return this.els.buttons[a]},_uyb:function(c){c=ludo.util.isString(c)?{type:c}:c;var a=this.els.buttons[c.type]=jQuery("<div>");a.id="b-"+String.uniqueID();a.attr("class","ludo-title-bar-button ludo-title-bar-button-"+c.type);a.on("click",this._uU5(c.type));if(c.listener){a.on("click",c.listener.bind(this))}a.mouseenter(this._uxd.bind(this));a.mouseleave(this._uzd.bind(this));a.attr("title",c.title?c.title:c.type.capitalize());a.attr("buttonType",c.type);if(c.icon){a.css("background-image","url("+c.icon+")")}this.els.buttonArray.push(a);return a},_uU5:function(c){var b=ludo.view._ud4(c);var a=b&&b.toggle?b.toggle:undefined;return function(g){this._uzd(g);var d=jQuery(g.target);var f=c;if(a){if(this._ulb[c]){f=this._ulb[c];ludo.dom.removeClass(g.target,"ludo-title-bar-button-"+f);f=this._uoa(a,f)}d.removeClass("ludo-title-bar-button-"+f);this._ulb[c]=f;d.addClass("ludo-title-bar-button-"+this._uoa(a,f))}this._uif(f)}.bind(this)},_uoa:function(a,c){var b=a.indexOf(c)+1;return a[b>=a.length?0:b]},_uP2:function(){var b=false;for(var a=0;a<this.els.buttonArray.length;
a++){this.els.buttonArray[a].removeClass("ludo-title-bar-button-with-border");if(b){this.els.buttonArray[a].addClass("ludo-title-bar-button-with-border")}b=true}},_uxd:function(c){var b=jQuery(c.target);var a=b.attr("buttonType");b.addClass("ludo-title-bar-button-"+a+"-over")},_uzd:function(b){var a=jQuery(b.target);a.removeClass("ludo-title-bar-button-"+a.attr("buttonType")+"-over")},_uh4:function(){var a=0;var c=this.els.buttonArray;for(var b=0,f=c.length;b<f;b++){var d=c[b].outerWidth();if(d){a+=d}else{a+=c[b].width()}}return a?a:c.length*10},getEl:function(){return this.els.el},_uB:function(){if(this.els.controls){var a=this._uh4();this.els.controls.css("width",a+"px");this.els.controls.css("display",a>0?"":"none")}if(this.icon){this.els.title.css("left",jQuery(this.els.icon).css("width"))}},_ux:function(){var a=this.view.icon?this.els.icon.width():0;return a+this.els.controls.width()},_ukf:function(){var a=(this.view.width-this._ux());if(a>0){this.els.title.css("width",a)}},height:undefined,getHeight:function(){if(this.height===undefined){this.height=this.els.el.outerHeight()}return this.height}});ludo.view._u91=function(b,a){ludo.registry.set("titleBar-"+b,a)};ludo.view._ud4=function(a){return ludo.registry.get("titleBar-"+a)};ludo.view._u91("minimize",{toggle:["minimize","maximize"]});ludo.FramedView=new Class({Extends:ludo.View,type:"FramedView",layout:{minWidth:100,minHeight:100},minimized:false,title:"",movable:false,minimizable:false,resizable:false,closable:false,width:null,height:200,_uA2:false,icon:undefined,titleBar:undefined,_ua8:false,boldTitle:true,hasMenu:false,buttons:[],buttonBar:undefined,menuConfig:null,menuObj:null,state:{_u8e:false},_ukd:function(a){this.parent(a);if(a.buttons){a.buttonBar={children:a.buttons}}this._uWf(a,["buttonBar","hasMenu","menuConfig","icon","_ua8","titleBar","buttons","boldTitle","minimized"])},_uVcConfig:function(){return undefined},_uN2:function(){return undefined},_uZf:function(){this.parent();this.$e.addClass("ludo-framed-view");if(this._uee()){this._uVc().getEl().insertBefore(this.$b())}this.$b().addClass("ludo-framed-view-body");if(!this.getParent()&&this._u7d()){this._ule().addHandle("s")}},__ucf:function(){if(!this.buttonBar){this.buttonBar=this._uN2()}if(this.buttonBar&&!this.buttonBar.children){this.buttonBar={children:this.buttonBar}}if(this.buttonBar){this._uEb()}else{this.$e.addClass("ludo-view-no-buttonbar")}this.parent();if(this.minimized){this.minimize()}},resizer:undefined,_ule:function(){if(this.resizer===undefined){var a=this._usf()._uZd();this.resizer=this._um5("resizer",new ludo.effect.Resize({component:this,_uA2:this.layout._uA2,minWidth:a.getMinWidth(),minHeight:a.getMinHeight(),maxHeight:a.getMaxHeight(),maxWidth:a.getMaxWidth(),listeners:{stop:a.setSize.bind(a)}}));this.resizer.addEvent("stop",this._urf.bind(this))}return this.resizer},_ukf:function(){var a=this.getHeight();a-=(ludo.dom._u6g(this.$e)+ludo.dom._u6g(this.els.body)+this.getHeightOfTitleAndButtonBar());if(a>=0){this.els.body.css("height",a);if(this._ua3){this._ua3.resize()}}},_uq:undefined,getHeightOfTitleAndButtonBar:function(){if(this._uNf()){return 0}if(!this._uq){this._uq=this._ux2()+this._uK1()}return this._uq},_uK1:function(){if(!this.buttonBar){return 0}return this.els.buttonBar.el.outerHeight()},_ux2:function(){if(!this._uee()){return 0}return this._ube.getHeight()},_uee:function(){return !this._ua8},_uQ7:function(a){return this._uVc().button(a)},_uVc:function(){if(this._ube===undefined){if(!this.titleBar){this.titleBar=this._uVcConfig()||{}}this.titleBar.view=this;this.titleBar.type="view.TitleBar";var a=this._ube=this._um5("titleBar",this.titleBar);a._uBf({close:this.close.bind(this),minimize:this.minimize.bind(this),maximize:this.maximize.bind(this)});if(this.movable&&!this.getParent()){this.drag=this._um5("drag",new ludo.effect.Drag({handle:a.getEl(),el:this.getEl(),listeners:{start:this._uP8.bind(this),end:this.stopMove.bind(this)}}));a.getEl().css("cursor","move")}}return this._ube},getHeight:function(){return this._u8e()?this._ux2():this.parent()},close:function(){this.hide();this._uif("close",this)},_u8e:function(){return this.state._u8e},maximize:function(){this.state._u8e=false;if(!this.hidden){this.resize({height:this.layout.height});this.$b().css("visibility","visible");this._uX3();this._uif("maximize",this)}},_uX3:function(){if(this._u7d()){this._ule()._uL8()}},_uV3:function(){if(this._u7d()){this._ule()._ua9()}},minimize:function(){this.state._u8e=true;if(!this.hidden){var a=this.layout.height;var b=this._ux2();this.$e.css("height",this._ux2());this.els.body.css("visibility","hidden");this._uV3();this.layout.height=a;this._uif("minimize",[this,{height:b}])}},_uEb:function(){if(!this.els.buttonBar){this.els.buttonBar=this.els.buttonBar||{};var a=this.els.buttonBar.el=jQuery('<div class="ludo-view-buttonbar"></div>');this.$e.append(a);this.getEl().addClass("ludo-view-with-buttonbar");var b=this.buttonBar;b.renderTo=a;b.component=this;this._ua3=this._um5("buttonBar",new ludo.view.ButtonBar(b))
}return this.els.buttonBar.el},getButton:function(a){return this._uJ8(a)},hideButton:function(a){return this._uGb(a,"hide")},showButton:function(a){return this._uGb(a,"show")},getButtons:function(){return this._ua3?this._ua3.getButtons():[]},_uwa:function(a){return this._uGb(a,"disable")},_uOb:function(a){return this._uGb(a,"enable")},_uGb:function(c,b){var a=this._uJ8(c);if(a){a[b]();return true}return false},_uJ8:function(c){if(this._ua3){return this._ua3.getButton(c)}for(var b=0;b<this.buttons.length;b++){var a=this.buttons[b];if(a.getId()===c||a.val()==c||a.getName()==c){return a}}return null},_u7d:function(){return this.resizable},stopMove:function(b,a){this._usf()._uZd()._u0d(a.getX(),a.getY());this._uif("stopmove",this)}});ludo.Window=new Class({Extends:ludo.FramedView,type:"Window",cssSignature:"ludo-window",movable:true,resizable:true,closable:true,top:undefined,left:undefined,width:300,height:200,resizeTop:true,resizeLeft:true,hideBodyOnMove:false,_uA2:false,_uw3:["layout"],_ukd:function(a){a=a||{};a.renderTo=document.body;var b=["resizeTop","resizeLeft","hideBodyOnMove","_uA2"];this._uWf(a,b);this.parent(a)},_use:function(){this.parent();if(this.hideBodyOnMove){this.addEvent("startmove",this.hideBody.bind(this));this.addEvent("stopmove",this._uLf.bind(this))}this.addEvent("stopmove",this._urf.bind(this))},hideBody:function(){this.$b().css("display","none");if(this.els.buttonBar){this.els.buttonBar.el.css("display","none")}},_uLf:function(){this.$b().css("display","");if(this.els.buttonBar){this.els.buttonBar.el.css("display","")}},__ucf:function(){this.parent();this.getEl().addClass("ludo-window");this._uh2();this._uif("activate",this)},_uZf:function(){this.parent();if(this._u7d()){var a=this._ule();if(this.resizeTop){if(this.resizeLeft){a.addHandle("nw")}a.addHandle("n");a.addHandle("ne")}if(this.resizeLeft){a.addHandle("w");a.addHandle("sw")}a.addHandle("e");a.addHandle("se")}},show:function(){this.parent();this._uh2()},_uh2:function(){var b=this.$b().children("input");for(var a=0,d=b.length;a<d;a++){if(b[a].type&&b[a].type.toLowerCase()==="text"){b[a].focus();return}}var c=this.$b().find("textarea");if(c){c.focus()}},_u12:function(){return true},showAt:function(a,b){this.setXY(a,b);this.show()},setXY:function(a,c){this.layout.left=a;this.layout.top=c;var b=this._usf()._uZd();b.clearFn();b.resize()},center:function(){var c=jQuery(document.body);var d={x:c.width(),y:c.height()};var a=Math.round((d.x/2)-(this.getWidth()/2));var f=Math.round((d.y/2)-(this.getHeight()/2));this.setXY(a,Math.max(0,f))},_uxb:function(){this.center();this.show()},isWindow:function(){return true}});ludo.dialog.Dialog=new Class({Extends:ludo.Window,type:"dialog.Dialog",modal:true,autoRemove:true,autoHideOnBtnClick:true,buttonConfig:undefined,movable:true,closable:false,minimizable:false,_ukd:function(a){a.buttonConfig=a.buttonConfig||this.buttonConfig;if(a.buttonConfig){var c=a.buttonConfig.replace(/([A-Z])/g," $1");c=c.trim();c=c.split(/\s/g);a.buttons=[];for(var b=0;b<c.length;b++){a.buttons.push({value:c[b]})}}this.parent(a);this._uWf(a,["modal","autoRemove","autoHideOnBtnClick"])},_uZf:function(){this.parent();this.getEl().addClass("ludo-dialog")},getShim:function(){if(this.els.shim===undefined){var a=this.els.shim=jQuery("<div>");jQuery(document.body).append(a);a.addClass("ludo-dialog-shim");a.css("display","none")}return this.els.shim},_use:function(){this.parent();if(this.isModal()){this._uCe().on("resize",this.resizeShim.bind(this))}},__ucf:function(){this.parent();if(!this._uNf()){this._uFf()}var c=this.getButtons();var b=this.buttonClick.bind(this);for(var a=0;a<c.length;a++){c[a].on("click",b)}},isModal:function(){return this.modal},show:function(){this._uFf();this.parent()},hide:function(){this.parent();this.hideShim();if(this.autoRemove){this.remove.delay(1000,this)}},_uFf:function(){if(!this.layout){this.center()}if(this.isModal()){this.getShim().css({display:"","z-index":this.getEl().css("z-index")-1});this.resizeShim()}},resizeShim:function(){var a=jQuery(document.body);this.getShim().css({width:a.width(),height:a.height()})},hideShim:function(){if(this.isModal()){this.getShim().css("display","none")}},buttonClick:function(b,a){this._uif(a._get().replace(/\s/g,"").toLowerCase(),this);if(this.autoHideOnBtnClick){this.hide()}}});ludo.dialog.Confirm=new Class({Extends:ludo.dialog.Dialog,type:"dialog.Confirm",_ukd:function(a){if(!a.buttons&&!a.buttonConfig&&!a.buttonBar){a.buttons=[{value:"OK",width:60,defaultSubmit:true,type:"form.Button"},{value:"Cancel",width:60}]}this.parent(a)}});ludo._uoe.Manager=new Class({Extends:ludo.Core,_uoes:[],components:[],_u03:function(b){this._uoes.push(b);for(var a=0;a<this.components.length;a++){var d=this.components[a];if(b._uz1(d)){this._u63(b,d)}}},_uH4:function(a){if(!a.hasController()){this.components.push(a);var b=this._uR5(a);if(b){this._u63(b,a)}}},_uR5:function(a){for(var b=0;b<this._uoes.length;b++){if(this._uoes[b]._uz1(a)){return this._uoes[b]}}return undefined},_uk:function(b,a){if(typeof b==="string"){b=ludo.get(b);
if(b){this._u63(b,a)}return}b=a._um5("_uoe-"+String.uniqueID(),b);this._u63(b,a)},_u63:function(b,a){a._uv9(b);b._ue7(a);b.addView(a)}});ludo._uoeManager=new ludo._uoe.Manager();ludo._uoe.Controller=new Class({Extends:ludo.Core,type:"_uoe.Controller",applyTo:undefined,id:undefined,components:[],_uoe:undefined,useController:false,broadcast:undefined,_ukd:function(a){a=a||{};a._uoe=undefined;a.useController=false;this.parent(a);if(a.broadcast){this.broadcast=a.broadcast}ludo._uoeManager._u03(this)},_ue7:function(a){if(this.broadcast&&this.broadcast[a.type]!==undefined){var c=this.broadcast[a.type];for(var b=0;b<c.length;b++){var d=this._u31(c[b]);a.addEvent(d.component,this._uM8(d._uoe).bind(this))}}},_uM8:function(a){return function(){this._uif(a,arguments)}},_u31:function(b){if(typeof b=="object"){for(var a in b){if(b.hasOwnProperty(a)){return{component:a,_uoe:b[a]}}}}return{component:b,_uoe:b}},_uz1:function(a){if(a===this){return false}if(!this.applyTo){return this._un2(a)}var b=this._uQ6(a);if(this._up(b)){return true}return this._uh(b)},_uQ6:function(a){return a.module+(a.submodule?"."+a.submodule:"")},_up:function(a){return(this.applyTo.indexOf(a)===0)},_uh:function(a){for(var b=0;b<this.applyTo.length;b++){if(a.indexOf(this.applyTo[b])===0){return true}}return false},_un2:function(a){return this._uTb()==a._uTb()}});ludo.getController=function(a){if(a.substr){a=ludo.get(a)}return a};ludo.svg.EventManager=new Class({nodes:{},currentNodeId:undefined,currentNodeFn:undefined,currentNode:undefined,addMouseEnter:function(b,a){b.on("mouseover",this._uN8(a))},addMouseLeave:function(b,a){b.on("mouseout",this._ufa(a))},_uN8:function(a){return function(c,b){if(!c.event.relatedTarget||!this.contains(b.getEl(),c.event.relatedTarget)){a.call(b,c,b)}}.bind(this)},contains:function(a,b){if(a.childNodes&&a.childNodes.length>0){return this._contains(a.childNodes,b)}return false},_contains:function(d,h){for(var b=0,a=d.length;b<a;b++){var g=d[b];if(g==h){return true}if(g.childNodes&&g.childNodes.length>0){var f=this._contains(g.childNodes,h);if(f){return true}}}return false},_ufa:function(a){return function(c,b){if(!c.event.relatedTarget||!this.contains(b.getEl(),c.event.relatedTarget)){a.call(b,c,b)}}.bind(this)}});ludo.canvasEventManager=new ludo.svg.EventManager();ludo.svg.Paint=new Class({Extends:ludo.svg.Node,tagName:"style",css:{},nodes:[],className:undefined,tag:undefined,cssPrefix:undefined,mappings:{color:["stroke-color"],"background-color":["fill-color"],opacity:["fill-opacity","stroke-opacity"]},initialize:function(b,a){a=a||{};this.className=a.className||"css-"+String.uniqueID();this.cssPrefix=a.selectors?a.selectors:"."+this.className;if(a.selectors){delete a.selectors}if(a.className){delete a.className}this.parent(this.tagName,a);if(b!==undefined){this.setStyles(b)}},setStyles:function(a){Object.each(a,function(c,b){this._uc5(b,c)},this);this._uq5()},setStyle:function(a,b){this._uc5(a,b);this._uq5()},_uq5:function(){var a=JSON.stringify(this.css);a=a.replace(/"/g,"");a=a.replace(/,/g,";");this.text(this.cssPrefix+a)},_uc5:function(a,b){b=this.getRealValue(b);if(this.mappings[a]){this.setMapped(a,b)}else{this.css[a]=b}},setMapped:function(c,d){for(var b=0;b<this.mappings[c].length;b++){var a=this.mappings[c][b];this.css[a]=d}},getStyle:function(a){if(this.mappings[a]){a=this.mappings[a][0]}return this.css[a]},getRealValue:function(a){return a&&a.id!==undefined?"url(#"+a.id+")":a},applyTo:function(a){ludo.svg.addClass(a.el?a.el:a,this.className)},getClassName:function(){return this.className},getUrl:function(){return this.className}});ludo.svg.NamedNode=new Class({Extends:ludo.svg.Node,initialize:function(a,b){a=a||{};if(a.listeners){this._uBf(a.listeners);delete a.listeners}this.parent(this.tagName,a,b)}});ludo.svg.Path=new Class({Extends:ludo.svg.NamedNode,tagName:"path",pointString:undefined,_u3f:undefined,size:undefined,position:undefined,initialize:function(b,a){a=a||{};if(b){b=this._ud2(b);a.d=b}this.parent(a);this.pointString=b},_ud2:function(a){return a.replace(/([A-Z])/g,"$1 ").trim().replace(/,/g," ").replace(/\s+/g," ")},setPath:function(a){this.pointString=this._ud2(a);this._u3f=undefined;this.set("d",this.pointString)},getPoint:function(a){if(this._u3f===undefined){this._uR6()}a*=3;return{x:this._u3f[a+1],y:this._u3f[a+2]}},setPoint:function(b,a,c){if(this._u3f===undefined){this._uR6()}b*=3;if(b<this._u3f.length-3){this._u3f[b+1]=a;this._u3f[b+2]=c;this.pointString=this._u3f.join(" ");this.set("d",this.pointString);this.size=undefined;this.position=undefined}},_uR6:function(){var a=this.pointString.replace(/,/g," ").replace(/\s+/g," ");this._u3f=a.split(/([A-Z\s])/g).erase(" ").erase("")},getSize:function(){if(this.size===undefined){var a=this._uUb();this.size={x:Math.abs(a.maxX-a.minX),y:Math.abs(a.maxY-a.minY)}}return this.size},_uId:function(){if(this.position===undefined){var a=this._uUb();this.position={x:a.minX,y:a.minY}}return this.position},_uUb:function(){if(this._u3f===undefined){this._uR6()
}var c=this._u3f;var a=[];var d=[];for(var b=0;b<c.length-2;b+=3){a.push(c[b+1]);d.push(c[b+2])}return{minX:Math.min.apply(this,a),minY:Math.min.apply(this,d),maxX:Math.max.apply(this,a),maxY:Math.max.apply(this,d)}}});ludo.remote.Inject=new Class({data:{},add:function(b,d){var f=b.split(/\//g);var c=f[0];var a=f[1];if(this.data[c]===undefined){this.data[c]={}}this.data[c][a]=d},get:function(c,a){if(this.data[c]&&this.data[c][a]){var b=this.data[c][a];delete this.data[c][a];return b}return undefined}});ludo.remoteInject=new ludo.remote.Inject();ludo.remote.Base=new Class({Extends:Events,remoteData:undefined,method:"post",initialize:function(a){a=a||{};if(a.listeners!==undefined){this._uBf(a.listeners)}this.method=a.method||this.method;if(a.resource!==undefined){this.resource=a.resource}if(a.url!==undefined){this.url=a.url}if(a.shim){new ludo.remote.Shim({renderTo:a.shim.renderTo,remoteObj:this,txt:a.shim.txt})}},send:function(a,d,b,c){this.remoteData=undefined;if(d&&!ludo.util.isArray(d)){d=[d]}ludo._uD4.clear(this,a);this._uif("start");this.sendToServer(a,d,b,c)},onComplete:function(){this._uif("complete",this)},getUrl:function(a,c){var b=this.url!==undefined?this.url:ludo.config.getUrl();if(ludo.config.hasModRewriteUrls()){b=ludo.config._uC6()+this.getServicePath(a,c)}else{b=this.url!==undefined?ludo.util.isFunction(this.url)?this.url.call():this.url:ludo.config.getUrl()}return b},getServicePath:function(a,b){var c=[this.resource];if(b&&b.length){c.push(b.join("/"))}if(a){c.push(a)}return c.join("/")},_u94:function(a,c,g,f){var b={data:g};if(f){if(ludo.util.isObject(f)){b=Object.merge(f,b)}}if(!ludo.config.hasModRewriteUrls()&&this.resource){b.request=this.getServicePath(a,c)}var d=ludo.remoteInject.get(this.resource,a);if(d){b.data=b.data?Object.merge(b.data,d):d}return b},getResponseCode:function(){return this.remoteData&&this.remoteData.code?this.remoteData.code:0},_uS2:function(){return this.remoteData&&this.remoteData.message?this.remoteData.message:undefined},getResource:function(){return this.resource},_uya:function(a){ludo._uD4.broadcast(this,a)}});ludo.remote.JSON=new Class({Extends:ludo.remote.Base,resource:undefined,url:undefined,initialize:function(a){this.parent(a)},sendToServer:function(a,d,b,c){if(d&&!ludo.util.isArray(d)){d=[d]}this._uif("start",this);this._uya(a);var f=this._u94(a,d,b,c);if(!a&&!d){f=f.data}jQuery.ajax({url:this.getUrl(a,d),method:this.method,cache:false,dataType:"json",data:f,success:function(g){this.remoteData=g;if(jQuery.type(g)!="array"||g.success||g.success===undefined){this._uif("success",this)}else{this._uif("failure",this)}this._uya(a);this.onComplete()}.bind(this),fail:function(h,g){this.remoteData={code:500,message:g};this._uif("servererror",this);this._uya(a);this.onComplete()}.bind(this)})},getResponseData:function(){if(this.remoteData&&jQuery.type(this.remoteData)=="array"){return this.remoteData}if(!this.remoteData.response&&!this.remoteData.data){return undefined}return this.remoteData.data?this.remoteData.data:this.remoteData.response.data?this.remoteData.response.data:this.remoteData.response},getResponse:function(){return this.remoteData},setResource:function(a){this.resource=a}});ludo.remote.Message=new Class({Extends:ludo.View,cls:"ludo-remote-message",listenTo:[],messageTypes:["success","failure","error"],_ukd:function(a){this.parent(a);this._uWf(a,["listenTo"]);if(!ludo.util.isArray(this.listenTo)){this.listenTo=[this.listenTo]}this._uD5()},_uD5:function(){for(var a=0;a<this.listenTo.length;a++){this.listenTo[a]=this.listenTo[a].replace(/\//g,".")}},_use:function(){this.parent();var b=this.getResources();for(var a in b){if(b.hasOwnProperty(a)){this._us5(a,b[a])}}},getResources:function(){var b={};var d,a;for(var c=0;c<this.listenTo.length;c++){if(this.listenTo[c].indexOf(".")>=0){var f=this.listenTo[c].split(/\./g);if(f.length===2){a=f.pop();d=f[0];a=a!="*"?a:undefined}}else{d=this.listenTo[c];a=undefined}if(b[d]==undefined){b[d]=[]}if(a&&b[d].indexOf(a)===-1){b[d].push(a)}}return b},_us5:function(c,a){ludo._uD4._uJ6("clear",c,a,this.hideMessage.bind(this));for(var b=0;b<this.messageTypes.length;b++){ludo._uD4._uJ6(this.messageTypes[b],c,a,this._uVd.bind(this))}},_uVd:function(a){this.show();if(a.code&&a.code!==200){this.getEl().addClass("ludo-remote-error-message")}else{this.getEl().removeClass("ludo-remote-error-message")}this.html(a.message);this._uif("_uVd",this)},hideMessage:function(){this.html("")}});ludo.remote.ErrorMessage=new Class({Extends:ludo.remote.Message,messageTypes:["failure","serverError"]});ludo.svg.Group=new Class({Extends:ludo.svg.View,type:"svg.Group",tag:"g",layout:{},width:undefined,children:undefined,parentGroup:undefined,height:undefined,child:undefined,bbox:undefined,_ukd:function(a){this.parent(a);this._uWf(a,["layout","renderTo","_uB6","parentGroup","__ucf"]);this.layout=this.layout||{};this.layout.type="Canvas";a.children=a.children||this.__children();this.children=[];this.child={};if(this.renderTo){this.renderTo.append(this)
}this.bbox={left:0,top:0,width:0,height:0};jQuery.each(a.children,function(b,c){c.layout=c.layout||{};c.parentGroup=this;this.children[b]=c=this._usf()._uVf(c);c.renderTo=this;this.child[c.id||c.name]=c}.bind(this));if(a.css){this.node.css(this.css)}},__children:function(){return this.children||[]},__ucf:function(){},resize:function(a){if(a.width){this.width=this.bbox.width=Math.max(0,a.width);this.set("width",a.width+"px")}if(a.height){this.height=this.bbox.height=Math.max(0,a.height);this.set("height",a.height+"px")}if(this.children.length>0){this._usf()._uy8()}this._uif("resize",a)},getSize:function(){return{x:this.width||this.renderTo.width(),y:this.height||this.renderTo.height()}},getCenter:function(){var a=this.getSize();return{x:a.x/2,y:a.y/2}},_uNf:function(){return false},position:function(a,c){if(arguments.length>0){this.bbox.left=a;this.bbox.top=c;this.node.setTranslate(a,c)}else{var b=this.node.getTranslate();return{left:b[0],top:b[1]}}},_usf:function(){if(!this._uF9("layoutManager")){this._um5("layoutManager",ludo.layoutFactory.getManager(this))}return this._uIa("layoutManager")},$b:function(){return this.node},append:function(a){return this.node.append(a)}});ludo.Notification=new Class({Extends:ludo.View,alwaysInFront:true,duration:3,showEffect:undefined,hideEffect:undefined,effect:"fade",_u79:0.4,autoRemove:true,_ukd:function(a){a.renderTo=a.renderTo||document.body;this._uWf(a,["autoRemove","showEffect","hideEffect","effect","_u79","duration"]);this.showEffect=this.showEffect||this.effect;this.hideEffect=this.hideEffect||this.effect;if(!a.layout&&!this.layout){a.layout={centerIn:a.renderTo}}this.parent(a)},_use:function(){this.parent();if(this.autoRemove){this.addEvent("hide",this.remove.bind(this))}},_uZf:function(){this.parent();this.$e.addClass("ludo-notification")},__ucf:function(){var a=this.layout;if(!a.width||!a.height){var b=ludo.dom._uT1(this);if(!a.width){a.width=b.x}if(!a.height){a.height=b.y}}this.parent();this.show()},hide:function(){if(this.hideEffect){var a=new ludo.effect.Effect();a[this._u89()](this.getEl(),this._u79,this.onHideComplete.bind(this),this._usf()._uZd().position())}else{this.parent()}},show:function(a){if(arguments.length==1){this.html(a)}this.parent();if(this.showEffect){var b=new ludo.effect.Effect();b[this._uH5()](this.getEl(),this._u79,this.autoHide.bind(this),this._usf()._uZd().position())}},_uH5:function(){switch(this.showEffect){case"fade":return"fadeIn";case"slide":return"slideIn";default:return this.showEffect}},_u89:function(){switch(this.hideEffect){case"fade":return"fadeOut";case"slide":return"slideOut";default:return this.hideEffect}},autoHide:function(){this.hide.delay(this.duration*1000,this)},onHideComplete:function(){this.getEl().css("display","none");this._uif("hide",this)}});ludo.form.validator.required=function(a,b){return !b||a.length>0};ludo.form.validator.minLength=function(b,a){return b.length===0||b.length>=a};ludo.form.validator.maxLength=function(b,a){return b.length===0||b.length<=a};ludo.form.validator.regex=function(b,a){return b.length===0||a.test(b)};ludo.form.validator.minValue=function(b,a){return b.length===0||parseInt(b)>=a};ludo.form.validator.maxValue=function(a,b){return a.length===0||parseInt(a)<=b};ludo.form.validator.twin=function(c,a){var b=ludo.get(a);return !b||(b&&c===b.value)};ludo.form.Element=new Class({Extends:ludo.View,value:undefined,onLoadMessage:"",name:undefined,formCss:undefined,stretchField:true,required:false,dirtyFlag:false,initialValue:undefined,_uO5:undefined,isReady:true,overflow:"hidden",twin:undefined,linkWith:undefined,_uw3:["value"],validator:undefined,validatorFn:undefined,validators:[],submittable:true,_ukd:function(b){this.parent(b);var a=this._uX();var c=["label","suffix","formCss","validator","stretchField","required","twin","disabled","submittable","value","data"];this._uWf(b,c);this.elementId=("el-"+this.name).trim();this.formCss=a.formCss||this.formCss;if(a.height&&b.height===undefined){this.layout.height=a.height}if(this.validator){this._up6()}if(b.linkWith!==undefined){this._uce(b.linkWith)}if(this._une&&!this._une.data){this.isReady=false}this.initialValue=this._uO5=this.value;if(!this.name){this.name="ludo-form-el-"+String.uniqueID()}ludo.Form.add(this);if(this.required){this._uN4(["required"])}this._uN4(["twin"])},_uZf:function(){this.parent();this._uMf()},_uN4:function(c){for(var b=0;b<c.length;b++){var a=c[b];if(this[a]!==undefined){this.validators.push({fn:ludo.form.validator[a],key:a})}}},_up6:function(){var b;if(ludo.util.isFunction(this.validator)){b=this.validator}else{var a=this.validator;a.applyTo=this;var c=this.validator=ludo._new(a);b=a.isValid.bind(c)}this.validators.push({fn:b,key:""})},_use:function(){this.parent();if(this._une){this._up9().on("load",this.setReady.bind(this))}var a=this.getFormEl();if(a){a.on("keydown",this.keyDown.bind(this));a.on("keypress",this.keyPress.bind(this));a.on("keyup",this.keyUp.bind(this));a.on("focus",this.focus.bind(this));a.on("change",this.change.bind(this));
a.on("blur",this.blur.bind(this))}},__ucf:function(){this.parent();if(this.disabled){this.disable()}if(this.els.formEl){this.els.formEl.attr("name",this.getName());if(this.value!==undefined){this.els.formEl.val(this.value)}}if(this.linkWith){this._uQ8()}var a=this._uG9();if(a){a.registerFormElement(this)}this.validate()},setEnabled:function(a){if(a){this.enable()}else{this.disable()}},disable:function(){this.getFormEl().attr("disabled","1");this._uif("disable",this)},enable:function(){this.getFormEl().removeAttr("disabled");this._uif("enable",this)},_uX:function(){var a=this.getParent();if(a){return a.formConfig||{}}return{}},_u2g:function(){this.parent();this.getEl().addClass("ludo-form-element");var a=this.els.formEl;if(a){a.id=this.elementId;if(this.formCss){a.css(this.formCss)}}},getFormElId:function(){return this.elementId},getWidth:function(){var a=this.parent();return a?a:20},keyUp:function(a){this._uif("key_up",[a.key,this.value,this])},keyDown:function(a){this._uif("key_down",[a.key,this.value,this])},keyPress:function(a){this._uif("key_press",[a.key,this.value,this])},focus:function(){this._focus=true;this.clearInvalid();this._uif("focus",[this.value,this])},change:function(){if(this.els.formEl){this._set(this.els.formEl.val())}if(this.wasValid){this._uif("change",[this._get(),this])}},blur:function(){this._focus=false;this.validate();if(this.getFormEl()){this.value=this._uI5()}this._uk6();this._uif("blur",[this.value,this])},_uI5:function(){return this.getFormEl().val()},_uk6:function(){if(this.value!==this.initialValue){this.setDirty();this._uif("dirty",[this.value,this])}else{this.setClean();this._uif("clean",[this.value,this])}},hasFocus:function(){return this._focus},JSON:function(a){this.populate(a)},populate:function(){},getLabel:function(){return this.label},val:function(a){if(arguments.length==0){return this._get()}this._set(a)},_get:function(){return this.els.formEl?this.els.formEl.val():this.value},_set:function(a){if(a==this.value){return a}this._ud9(a);this.value=a;this.validate();if(this.wasValid){this._uif("valueChange",[this._get(),this]);if(this._uXf){this._uif("state")}if(this.linkWith){this._ubc()}}this._uif("value",a);return a},_ud9:function(a){if(this.els.formEl&&this.els.formEl.val()!==a){this.els.formEl.val(a);if(this.inlineLabel){this.els.formEl.removeClass("ludo-form-el-inline-label")}}},getFormEl:function(){return this.els.formEl},isValid:function(){if(this.validators.length===0){return true}var b=this.getFormEl()?this._uI5().trim():this.value;for(var a=0;a<this.validators.length;a++){if(!this.validators[a].fn.apply(this,[b,this[this.validators[a].key],this])){return false}}return true},clearInvalid:function(){this.getEl().removeClass("ludo-form-el-invalid")},wasValid:true,validate:function(){this.clearInvalid();if(this.isValid()){this.wasValid=true;this._uif("valid",[this.value,this]);return true}else{this.wasValid=false;this._uif("invalid",[this.value,this]);return false}},_uE9:function(){return true},rollback:function(){this.reset()},reset:function(){this._set(this.initialValue)},clear:function(){this._set(this._uO5)},commit:function(){if(!this.isReady){this.commit.delay(100,this);return}this.initialValue=this.value},isDirty:function(){return this.dirtyFlag},setDirty:function(){this.dirtyFlag=true;this.getEl().addClass("ludo-form-el-dirty")},setClean:function(){this.dirtyFlag=false;var a=this.getEl();if(a){a.removeClass("ludo-form-el-dirty")}},setReady:function(){this.isReady=true;var a=this.value;this.value=undefined;if(a){this._set(a)}},_ubc:function(){var a=this._uie();if(a&&a.value!==this.value){a._set(this.value)}},_uce:function(a){this.linkWith=a;this.on("valueChange",this._ubc.bind(this))},_uQ8:function(a){a=a||0;var b=this._uie();if(b&&!b.linkWith){if(this.value===undefined){this.initialValue=this._uO5=b.value;this._set(b.value)}b._uce(this)}else{if(a<100){this._uQ8.delay(50,this,a+1)}}},_uMf:function(){if(!this.inputTag){return}this.els.inputCell=jQuery('<div class="input-cell"></div>');this.$b().append(this.els.inputCell);var a=this.els.formEl=jQuery("<"+this.inputTag+">");if(this.inputType){a.attr("type",this.inputType)}if(this.maxLength){a.attr("maxlength",this.maxLength)}if(this.readonly){a.attr("readonly",true)}this.getInputCell().append(a);a.css("width","100%");a.attr("id",this.getFormElId())},_uie:function(){var a=ludo.get(this.linkWith);return a?a:this._uB6?this._uB6.child[this.linkWith]:undefined},getInputCell:function(){return this.els.inputCell}});ludo.form.Button=new Class({Extends:ludo.form.Element,type:"form.Button",defaultSubmit:false,inputType:"submit",cssSignature:"ludo-form-button",name:"",value:"",els:{el:null,txt:null},component:null,menu:undefined,submittable:false,toggle:false,toggleGroup:undefined,disableOnInvalid:false,disabled:false,selected:false,overflow:"hidden",_btn:true,icon:undefined,iconPressed:undefined,active:false,size:"m",iconWidths:{s:15,m:25,l:34,xl:44},heights:{s:15,m:25,l:35,xl:45},_ukd:function(b){this.parent(b);var c=b.value||this.value;
var a=c?c.length:5;this.layout.width=this.layout.width||Math.max(a*10,80);this._uWf(b,["size","menu","icon","toggle","disableOnInvalid","defaultSubmit","disabled","selected","formView","iconPressed"]);if(b.toggleGroup!==undefined){if(ludo.util.type(b.toggleGroup)==="string"){b.toggleGroup={type:"form.ToggleGroup",id:"toggleGroup-"+b.toggleGroup}}b.toggleGroup.singleton=true;this.toggleGroup=ludo._new(b.toggleGroup);this.toggleGroup.addButton(this)}},_uZf:function(){this.parent();this.getEl().css("display",this._uNf()?"none":"block");this.getEl().addClass("ludo-form-button-"+this.size);this.addLeftEdge();this.addRightEdge();this.addLabel();if(this.icon){this.addIcon()}var a=this.$b();a.css("padding-left",0);this.getEl().on("selectstart",ludo.util.cancelEvent)},_use:function(){this.parent();var a=this.$b();a.on("click",this.click.bind(this));a.mouseenter(this.mouseOver.bind(this));a.mouseleave(this.mouseOut.bind(this));a.on("mousedown",this.mouseDown.bind(this));this.mouseUpBound=this.mouseUp.bind(this);jQuery(document.body).on("mouseup",this.mouseUpBound);if(this.defaultSubmit){this.keyPressBound=this.keyPress.bind(this);jQuery(window).on("keypress",this.keyPressBound)}},__ucf:function(){this.parent();if(this.disabled){this.disable()}if(this.toggle&&this.active){this.$b().addClass("ludo-form-button-pressed")}this.component=this._u93();if(this.component&&this.disableOnInvalid){var a;if(this.formView!=undefined){a=ludo.get(this.formView)}else{a=this.component.getForm()}a.on("valid",this.enable.bind(this));a.on("invalid",this.disable.bind(this));if(!a.isValid()){this.disable()}}},remove:function(){this.parent();jQuery(document.body).off("mouseup",this.mouseUpBound);if(this.defaultSubmit){jQuery(window).off("keypress",this.keyPressBound)}},addLabel:function(){var a=this.els.txt=jQuery("<div>");a.addClass("ludo-form-button-value");a.css({width:"100%",height:this.heights[this.size]-2,position:"absolute",left:this.icon?this.iconWidths[this.size]+"px":"0px","text-align":this.icon?"left":"center","z-index":7});a.html(this.value);this.$b().append(a)},addIcon:function(){var a=this.els.icon=jQuery("<div>");a.css({position:"absolute",width:this.iconWidths[this.size],"z-index":8,left:0,top:0,height:"100%","background-image":"url("+this.icon+")","background-repeat":"no-repeat","background-position":"center center"});a.insertBefore(this.els.txt)},setIcon:function(a){if(!this.els.icon){this.addIcon()}this.icon=a;this.els.icon.css("background-image","url("+a+")")},addLeftEdge:function(){var a=this.els.buttonLeftludo=jQuery("<div>");a.addClass("ludo-form-button-bg-left");a.addClass("ludo-form-button-"+this.size+"-bg-left");a.css({position:"absolute",left:0,"z-index":5});this.$b().append(a)},addRightEdge:function(){var a=jQuery("<div>");a.addClass("ludo-form-button-bg-right");a.addClass("ludo-form-button-"+this.size+"-bg-right");a.css({position:"absolute",right:0,"z-index":6});this.$b().append(a)},disable:function(){this.disabled=true;var a=this.$b();if(a){a.addClass("ludo-form-button-disabled");a.removeClass("ludo-form-button-over");a.removeClass("ludo-form-button-down")}},enable:function(){this.disabled=false;if(this.els.body){this.els.body.removeClass("ludo-form-button-disabled")}},isDisabled:function(){return this.disabled},setValue:function(a){console.warn("Use of deprecated setValue");console.trace();this.value=a;this.els.txt.html(a)},val:function(a){if(arguments.length!=0){this.value=a;this.els.txt.html(a)}else{return this.value}},getValue:function(){console.warn("Use of deprecated button.getValue");console.trace();return this.value},mouseOver:function(){if(!this.isDisabled()){this.$b().addClass("ludo-form-button-over");this._uif("mouseover",this)}},mouseOut:function(){if(!this.isDisabled()){this.$b().removeClass("ludo-form-button-over");this._uif("mouseout",this)}},isDown:false,mouseDown:function(){if(!this.isDisabled()){this.isDown=true;this.$b().addClass("ludo-form-button-down");this._uif("mousedown",this);if(this.els.icon&&this.iconPressed){this.els.icon.css("background-image","url("+this.iconPressed+")")}}},mouseUp:function(){if(this.isDown&&!this.isDisabled()){this.$b().removeClass("ludo-form-button-down");this._uif("mouseup",this)}if(this.els.icon&&this.icon){this.els.icon.css("background-image","url("+this.icon+")")}},clickAfterDelay:function(){this.click.delay(10,this)},click:function(){this.focus();if(!this.isDisabled()){this.getEl().focus();this._uif("click",[this._get(),this]);if(this.toggle){if(!this.active){this.turnOn()}else{this.turnOff()}}return false}},getName:function(){return this.name},defaultBeforeClickEvent:function(){return true},isButton:function(){return true},borderSize:undefined,_ukf:function(){if(this.borderSize==undefined){this.borderSize=ludo.dom.getBH(this.$b())}this.$b().css("height",this.heights[this.size]-this.borderSize)},validate:function(){},_u93:function(){var a=this.getParent();if(a&&a.type.indexOf("ButtonBar")>=0){return a.getView_250_40()}return a},select:function(){this.$b().addClass("ludo-form-button-selected")
},deSelect:function(){this.$b().removeClass("ludo-form-button-selected")},turnOn:function(){this.active=true;this._uif("on",[this._get(),this]);this.$b().addClass("ludo-form-button-pressed")},turnOff:function(){this.active=false;this._uif("off",[this._get(),this]);this.$b().removeClass("ludo-form-button-pressed")},getToggleGroup:function(){return this.toggleGroup},isActive:function(){return this.active}});ludo.paging.Button=new Class({Extends:ludo.form.Button,type:"grid.paging.Next",width:25,buttonCls:"",tpl:undefined,onLoadMessage:undefined,_uZf:function(){this.parent();this.$b().addClass(this.buttonCls)},_use:function(){this.parent();this._uneEvents()},_uneEvents:function(){var a=ludo.get(this._une);if(a){this._uk2()}else{this._uneEvents.delay(100,this)}},_uk2:function(){},JSON:function(){}});ludo.paging.Next=new Class({Extends:ludo.paging.Button,type:"grid.paging.Next",buttonCls:"ludo-paging-next",_uk2:function(){this.addEvent("click",this.nextPage.bind(this));var a=this._up9();a.on("lastPage",this.disable.bind(this));a.on("notLastPage",this.enable.bind(this))},nextPage:function(){this._up9().nextPage()}});ludo.paging.Previous=new Class({Extends:ludo.paging.Button,type:"grid.paging.Previous",buttonCls:"ludo-paging-previous",_uk2:function(){this.addEvent("click",this.nextPage.bind(this));var a=this._up9();a.on("firstPage",this.disable.bind(this));a.on("notFirstPage",this.enable.bind(this));if(a._uOa()){this.disable()}},nextPage:function(){this._up9()._uBb()}});ludo.paging.Last=new Class({Extends:ludo.paging.Button,type:"grid.paging.Last",buttonCls:"ludo-paging-last",_uk2:function(){this.addEvent("click",this.nextPage.bind(this));var a=this._up9();a.on("lastPage",this.disable.bind(this));a.on("notLastPage",this.enable.bind(this))},nextPage:function(){this._up9().lastPage()}});ludo.paging.First=new Class({Extends:ludo.paging.Button,type:"grid.paging.First",buttonCls:"ludo-paging-first",_uk2:function(){this.on("click",this.firstPage.bind(this));var a=this._up9();a.on("firstPage",this.disable.bind(this));a.on("notFirstPage",this.enable.bind(this));if(a._uOa()){this.disable()}},firstPage:function(){this._up9().firstPage()}});ludo.paging.CurrentPage=new Class({Extends:ludo.View,type:"grid.paging.CurrentPage",width:25,onLoadMessage:"",tpl:"{page}",_uZf:function(){this.parent();this.$e.addClass("ludo-paging-text");this.$e.addClass("ludo-paging-current-page")},_use:function(){this.parent();this._uneEvents()},_uneEvents:function(){if(ludo.get(this._une)){var a=this._up9();if(a){a.addEvent("page",this._ula.bind(this));this._ula(a._u8a())}}else{this._uneEvents.delay(100,this)}},resize:function(a){this.parent(a);this.$b().css("line-height",(this.$b().height()*0.8)+"px")},_ula:function(){this.html(this.tpl.replace("{page}",this._up9()._u8a()))},JSON:function(){}});ludo.paging.TotalPages=new Class({Extends:ludo.View,type:"grid.paging.TotalPages",width:25,onLoadMessage:"",tpl:"/{pages}",_uZf:function(){this.parent();this.$e.addClass("ludo-paging-text");this.$e.addClass("ludo-paging-total-pages")},_use:function(){this.parent();this._uneEvents()},resize:function(a){this.parent(a);this.$b().css("line-height",(this.$b().height()*0.8)+"px")},_uneEvents:function(){if(ludo.get(this._une)){var a=this._up9();if(a){a.on("load",this._ula.bind(this));a.on("pageCount",this._ula.bind(this));this._ula(a._u8a())}}else{this._uneEvents.delay(100,this)}},_ula:function(){this.html(this.tpl.replace("{pages}",this._up9()._u6b()))},JSON:function(){}});ludo.form.Select=new Class({Extends:ludo.form.Element,type:"form.Select",emptyItem:undefined,valueKey:"value",textKey:"text",inputTag:"select",inputType:"",_une:{},options:undefined,defaultDS:"_une.JSONArray",_ukd:function(a){this.parent(a);this._uWf(a,["emptyItem","options","valueKey","textKey"]);if(!this.emptyItem&&this.inlineLabel){this.emptyItem={};this.emptyItem[this.textKey]=this.inlineLabel;this.inlineLabel=undefined}},_use:function(){this.parent();if(this._une){if(this.options&&this._ul9){for(var a=0;a<this.options.length;a++){this._ul9.addRecord(this.options[a])}}this.populate();var b=this._up9();b.on("select",this._upb.bind(this));b.on("update",this.populate.bind(this));b.on("delete",this.populate.bind(this));b.on("sort",this.populate.bind(this))}},_upb:function(a){if(!jQuery.isPlainObject(a)){this.__set(a)}else{this._set(a[this.valueKey])}this._uk6()},populate:function(){var b=this._ul9.getData()||[];this.getFormEl().find("option").remove();if(this.emptyItem){this.addOption(this.emptyItem[this.valueKey],this.emptyItem[this.textKey])}var a=b.length>0&&jQuery.isPlainObject(b[0]);jQuery.each(b,function(c,d){if(a){this.addOption(d[this.valueKey],d[this.textKey])}else{this.addOption(d,d)}}.bind(this));if(this.value){this._set(this.value);this._ud9(this.value)}},addOption:function(b,c){var a=jQuery('<option value="'+b+'">'+c+"</option>");this.getFormEl().append(a)},_ukf:function(){this.parent()}});ludo.paging.PageSize=new Class({Extends:ludo.form.Select,options:[{value:10,text:"10"},{value:25,text:"25"},{value:50,text:"50"},{value:100,text:"100"}],label:"Page size",applyTo:undefined,_ukd:function(a){this.applyTo=ludo.get(a._une||this.applyTo);
a._une=undefined;this.parent(a)},_use:function(){this.parent();this.on("change",this._uRd.bind(this))},_uRd:function(){if(this.applyTo){this.applyTo._uRd(this.val())}}});ludo.theme.Themes=new Class({currentTheme:undefined,themes:{twilight:{c100:"#ffffff",c200:"#eeeeee",c300:"#aeb0b0",c400:"#8b8c8c",c500:"#535353",c600:"#424242",c700:"#383838",c800:"#282828",c900:"#282828",border:"#424242",background:"#535353",background2:"#535353",text:"#aeb0b0"},blue:{c100:"#ffffff",c200:"#d1e7ff",c300:"#c6e1ff",c400:"#a6cbf5",c500:"#354150",c600:"#000000",border:"#a6cbf5",background:"#535353",background2:"#535353",text:"#000000"},"light-gray":{c100:"#FFFFFF",c200:"#f5f5f5",c300:"#e2e2e2",c400:"#d7d7d7",c500:"#c6c6c6",c600:"#AAAAAA",c700:"#777777",c800:"#555555",c900:"#000000",border:"#d7d7d7",background:"#FFFFFF",background2:"#e2e2e2",text:"#555555"}},addTheme:function(b,a){this.themes[b]=a},setTheme:function(b){if(this.themes[b]==undefined){console.warn("Undefined theme "+b)}var a=this._ul6();if(a==b){return}if(a){jQuery(document.body).removeClass("ludo-"+this.currentTheme)}this.currentTheme=b;jQuery(document.body).addClass("ludo-"+b)},getThemeEl:function(){var a=this._ul6();if(a!=undefined){return jQuery(".ludo-"+a)}return jQuery(document.body)},_ul6:function(){if(this.currentTheme==undefined){var a=jQuery(document.documentElement);jQuery.each(this.themes,function(d){if(!this.currentTheme){var b=".ludo-"+d;var c=a.find(b);if(c.length>0){this.currentTheme=d}}}.bind(this))}return this.currentTheme},color:function(a){var b=this._ul6();if(!b){return undefined}if(this.themes[b]!=undefined){return this.themes[b][a]}return undefined},clear:function(){this.currentTheme=undefined}});ludo.Theme=new ludo.theme.Themes();ludo.$C=ludo.Theme.color.bind(ludo.Theme);ludo.form.Label=new Class({Extends:ludo.View,labelFor:undefined,label:undefined,type:"form.Label",_ukd:function(a){this.parent(a);this._uWf(a,["label","labelFor"])},_uZf:function(){this.parent();this.els.label=jQuery('<label class="input-label" for="el-'+this.labelFor+'">'+this.label+"</label>");this.$b().append(this.els.label)},_use:function(){this.parent();this.addInvalidEvents.delay(40,this)},addInvalidEvents:function(){if(!this.labelFor){return}var a=ludo.get(this.labelFor);if(a){a.on("valid",this.onValid.bind(this));a.on("invalid",this.onInvalid.bind(this));a.on("enable",this.onEnable.bind(this));a.on("disable",this.onDisable.bind(this));if(!a.isValid()){this.onInvalid()}}},_ukf:function(){this.parent();this.els.label.css("line-height",this.$b().height()+"px")},onEnable:function(){this.$b().removeClass("ludo-form-label-disabled")},onDisable:function(){this.$b().addClass("ludo-form-label-disabled")},onValid:function(){this.$b().removeClass("ludo-form-el-invalid")},onInvalid:function(){this.$b().removeClass("ludo-form-el-invalid");this.$b().addClass("ludo-form-el-invalid")}});ludo.form.LabelElement=new Class({Extends:ludo.View,label:undefined,field:undefined,_ukd:function(a){this.parent(a);this._uWf(a,["label","field"]);if(!this.label.type){this.label.type="form.Label"}this.label.labelFor=this.field.name;this.layout=this.layout||{};this.layout.type="linear";this.layout._uWd="horizontal"},__children:function(){return[this.label,this.field]},__ucf:function(){this.parent()}});ludo.form.Text=new Class({Extends:ludo.form.Element,type:"form.Text",labelWidth:100,defaultValue:"",placeholder:"",maxLength:undefined,minLength:undefined,ucFirst:false,ucWords:false,inputType:"text",inputTag:"input",regex:undefined,validateKeyStrokes:false,formFieldWidth:undefined,readonly:false,selectOnFocus:false,autoComplete:true,_ukd:function(b){this.parent(b);var c=["placeholder","selectOnFocus","regex","minLength","maxLength","defaultValue","autoComplete","validateKeyStrokes","ucFirst","ucWords","readonly"];this._uWf(b,c);if(this.regex&&ludo.util.isString(this.regex)){var d=this.regex.split(/\//g);var a=d.length>1?d.pop():"";this.regex=new RegExp(d.join("/"),a)}this._uN4(["minLength","maxLength","regex"]);if(this.layout.height===undefined){this.layout.height="wrap"}},_uZf:function(){this.parent();var a=this.getFormEl();if(this.placeholder){a.attr("placeholder",this.placeholder)}if(!this.autoComplete){a.attr("x-autocompletetype",String.uniqueID());a.attr("autocomplete","false")}},_use:function(){this.parent();var a=this.getFormEl();if(this.ucFirst||this.ucWords){this.on("blur",this._uR8.bind(this))}this.on("blur",this.validate.bind(this));if(this.validateKeyStrokes){a.on("keydown",this.validateKey.bind(this))}a.parent().addClass("ludo-form-text-element");a.on("keyup",this._uac.bind(this));if(this.selectOnFocus){a.on("focus",this.selectText.bind(this))}},_uac:function(){this._uif("key",this.els.formEl.val())},validateKey:function(a){if(!a.control&&!a.alt&&this.regex&&a.key&&a.key.length===1){if(!this.regex.test(a.key)){return false}}return undefined},getFieldWidth:function(){return this.formFieldWidth},focus:function(){this.parent();if(!this.getFormEl().is(":focus")){this.getFormEl().focus()}},validate:function(){var a=this.parent();
if(!a&&!this._focus){this.$e.addClass("ludo-form-el-invalid")}return a},keyUp:function(a){this.parent(a);if(this.validateKeyStrokes){this.validate()}},_uR8:function(){if(this.ucFirst||this.ucWords){var c=this._uI5();if(c.length===0){return}if(this.ucWords&&c.length>1){var b=c.split(/\s/g);for(var a=0;a<b.length;a++){if(b[a].length===1){b[a]=b[a].toUpperCase()}else{b[a]=b[a].substr(0,1).toUpperCase()+b[a].substr(1)}}this.getFormEl().val(b.join(" "))}else{c=c.substr(0,1).toUpperCase()+c.substr(1);this.getFormEl().val(c)}}},select:function(){this.getFormEl().select()},selectText:function(){this.select()}});ludo.form.Number=new Class({Extends:ludo.form.Text,type:"form.Number",regex:/^[0-9]+$/,validateKeyStrokes:true,formCss:{"text-align":"right"},stretchField:false,disableWheel:false,reverseWheel:false,shiftIncrement:10,_ukd:function(a){this.parent(a);this._uWf(a,["disableWheel","shiftIncrement","reverseWheel","minValue","maxValue"]);if(this.minValue!==undefined){this.minValue=parseInt(this.minValue)}if(this.maxValue!==undefined){this.maxValue=parseInt(this.maxValue)}this._uN4(["minValue","maxValue"])},_use:function(){this.parent();if(!this.disableWheel){this.getFormEl().on("mousewheel",this._mouseWheel.bind(this))}this.getFormEl().on("keydown",this.keyIncrement.bind(this))},keyIncrement:function(a){if(a.key==="up"||a.key==="down"){if(a.key==="up"){this.incrementBy(1,a.shift)}if(a.key==="down"){this.incrementBy(-1,a.shift)}return false}return undefined},blur:function(){var c=this.getFormEl().val();if(!this.isValid(c)){var b=this.minValue;var a=this.maxValue;if(b!==undefined&&parseInt(c)<b){c=b}if(a!==undefined&&parseInt(c)>a){c=a}this._set(c)}this.parent()},setMinVal:function(a){this.minValue=a},setMaxValue:function(a){this.maxValue=a},_mouseWheel:function(a){var b=(a.originalEvent.wheelDelta||a.originalEvent.detail)/120;if(b==0){return}this.incrementBy(b>0?1:-1,a.shift);return false},incrementBy:function(d,b){var c=this.minValue;var a=this.maxValue;if(!this.value){if(c){this._set(c);return}this._set(0)}if(this.reverseWheel){d=d*-1}d=parseInt(this.value)+(b?d*this.shiftIncrement:d);if(a&&d>a){d=a}if(c!==undefined&&d<c){d=c}if(this.isValid(d)){this._set(d);this._uif("change",[d,this])}},_get:function(){return parseFloat(this.parent())}});ludo.factory.createNamespace("chess");var _w=(function(){return this||(0,eval)("this")}());_w.chess={language:{},action:{},plugins:{},pgn:{},wordpress:{},computer:{},sound:{},view:{popup:{},seek:{},board:{},highlight:{},notation:{},gamelist:{},folder:{},user:{},metadata:{},buttonbar:{},dialog:{},message:{},button:{},eco:{},pgn:{},tree:{},position:{},installer:{},command:{},menuItems:{},score:{}},parser:{},_uoe:{},model:{},remote:{},_une:{}};chess.UserRoles={EDIT_GAMES:1,GAME_IMPORT:2,EDIT_FOLDERS:4,MY_HISTORY:8};chess.Views={buttonbar:{game:"buttonbar.game",bar:"buttonbar.bar"},board:{board:"board"},lists:{game:"gameList"}};ludo.config.setDocumentRoot("../");_w.chess.COOKIE_NAME="chess_cookie";_w.chess.isWordPress=false;_w.chess.events={game:{clearActions:"clearActions",action:"action",loadGame:"loadGame",_u0d:"_u0d",invalidMove:"invalidMove",newMove:"newMove",newMoves:"newMoves",noMoves:"noMoves",deleteMove:"deleteMove",newaction:"newaction",deleteAction:"deleteAction",_uec:"_uec",deleteVariation:"deleteVariation",_uwd:"_uwd",_uv8:"_uv8",_u8d:"_u8d",_ux8:"_ux8",endOfGame:"endOfGame",_uMc:"_uMc",updatecomment:"updatecomment",_u08:"_u08",newGame:"newGame",_uF5:"_uF5",nextmove:"nextmove",verifyPromotion:"verifyPromotion",_uL1:"_uL1",updateMove:"updateMove",colortomove:"colortomove",correctGuess:"correctGuess",wrongGuess:"wrongGuess",_u3a:"_u3a",stopAutoplay:"stopAutoplay",gameSaved:"gameSaved",beforeLoad:"beforeLoad",afterLoad:"afterLoad",fen:"fen"},view:{buttonbar:{game:{play:"play",start:"tostart",end:"toend",previous:"previous",next:"next",pause:"pause",flip:"flip"}}}};ludo.config.setUrl("../router.php");ludo.config.setFileUploadUrl("../router.php");ludo.config.setDocumentRoot("../");ludo.config.disableModRewriteUrls();chess.view.Chess=new Class({Extends:ludo.View,alias:{"chess.wordpress.FenBoard":"chess.view.board.Board"},layout:{width:"matchParent",height:"matchParent"},_ukd:function(a){if(a.theme===undefined){a.theme=chess.THEME||{}}if(chess.THEME_OVERRIDES!==undefined){a.theme=Object.merge(a.theme,chess.THEME_OVERRIDES)}if(a.theme!==undefined){this.theme=a.theme;this._uXe();if(this.theme.css){this.updateCss()}a.children=this.parseChildren(a)}this.parent(a)},_uXe:function(){jQuery.each(this.theme,function(a,b){if(jQuery.isPlainObject(b)){this._um6(b)}}.bind(this))},_um6:function(b){var a=ludo.config._uC6();jQuery.each(b,function(c,d){if(jQuery.type(d)=="string"){b[c]=d.replace("[DOCROOT]",a)}else{if(jQuery.isPlainObject(d)){this._um6(d)}}}.bind(this))},__ucf:function(){this.parent();if(this.theme&&this.theme.name){jQuery(document.documentElement).addClass(this.cssClass())}},cssClass:function(){return"chess-theme-"+this.theme.name},updateCss:function(){new chess.util.DynamicStyles("."+this.cssClass(),this.theme.css)
},parseChildren:function(a){var b=a.children||this.__children();this.parseBranch(b);return b},themeEntry:function(b){if(this.theme[b]){return this.theme[b]}var a=this.alias[b];if(a&&this.theme[a]){return this.theme[a]}return undefined},parseBranch:function(a){jQuery.each(a,function(b,d){if(d.type){var c=this.themeEntry(d.type);if(c){d=Object.merge(d,c)}}if(d.children){this.parseBranch(d.children)}}.bind(this))}});chess.util=chess.util||{};chess.util.DynamicStyles=new Class({parentSelector:undefined,initialize:function(b,a){this.parentSelector=b;jQuery.each(a,function(c,d){this.insertRule(c,d)}.bind(this))},insertRule:function(a,g,f){var d=f||document,c;if(a.indexOf(",")>0){a=a.split(/,/g)}if(!jQuery.isArray(a)){a=[a]}jQuery.each(a,function(h,j){if(j.indexOf("body.")==-1){a[h]=this.parentSelector+" "+j.trim()}}.bind(this));g=this.rulesAsString(g);if(typeof d.styleSheets=="object"){if(d.styleSheets.length){c=d.styleSheets[d.styleSheets.length-1]}if(d.styleSheets.length){if(d.createStyleSheet){c=d.createStyleSheet()}else{d.getElementsByTagName("head")[0].appendChild(d.createElement("style"));c=d.styleSheets[d.styleSheets.length-1]}}if(c.addRule){for(var b=0;b<a.length;++b){c.addRule(a[b],g)}}else{c.insertRule(a.join(",")+"{"+g+"}",c.cssRules.length)}}},rulesAsString:function(b){if(jQuery.isPlainObject(b)){var a="";jQuery.each(b,function(c,d){if(a.length>0){a+=";"}a+=c+":";a+=d});return a}return b}});chess.language={pieces:{p:"",b:"B",r:"R",n:"N",q:"Q",k:"K"},clear:"Clear","Good move":"Good move","Poor move":"Poor move","Very good move":"Very good move","Very poor move":"Very poor move","Questionable move":"Questionable move","Speculative move":"Speculative move","Position Setup":"Position Setup",Castling:"Castling","Side to move":"Side to move","Add comment before":"Add comment before","Add comment after":"Add comment after",OK:"OK",Cancel:"Cancel","Sign in":"Sign in","Sign out":"Sign out","E-mail":"Email address",Username:"Username","Full name":"Full name",Password:"Password","Repeat password":"Repeat password",rememberMe:"Remember me",register:"Register",invalidUserNameOrPassword:"Invalid username or password",InvalidUsername:"This username is taken",invalidEmail:"Invalid email address","My profile":"My profile",country:"Country","Changes saved successfully":"Changes saved successfully","Signed in as":"Signed in as","Import games(PGN)":"Import games(PGN)",saveGame:"Save game",Game:"Game",tactic_uVbTitle:"Well done - Puzzle complete",tactic_uVbMessage:"Good job! You have solved this puzzle. Click OK to load next game",commandWelcome:'Type in your commands. For help, type "help" + enter.',command_help:"Displays help screen",command_move:'Type "move + notation" or notation only(e.g. "e4") to add moves',command_cls:"Clear screen",command_load:"Load a specific game with this id from the database",command_flip:"Flip board",command_grade:"Grade current move",command_forward:"Go to next move",command_back:"Go to previous move",command_fen:'Loads a fen position, example "fen 6k1/8/6p1/8/8/1P6/2b5/5K2 w - - 0 1"',"invalid game":"Invalid game","invalid position":"Invalid game","invalid move":"Invalid move",Moving:"Moving","Move updated to":"Move updated to",Time:"Time","From elo":"From elo","To elo":"To elo",Rated:"Rated","Pgn File":"Pgn File"};chess.__=function(a){return chess.language[a]!==undefined?chess.language[a]:a};chess.view.notation.Panel=new Class({Extends:ludo.View,type:"chess.view.notation.Panel",module:"chess",submodule:"notation",css:{"overflow-y":"auto"},highlightedMove:undefined,moveMap:{},_us7:{},notationKey:"m",figurineHeight:18,notations:"short",contextMenuMove:undefined,_u75:0,_u7c:"",tactics:false,comments:true,_umcMoveId:undefined,interactive:true,figurines:false,showContextMenu:false,showResult:false,_uv9:function(b){this.parent(b);var f=this._uoe=b;var d=this.showMoves.bind(this);var a=this._uG8.bind(this);f.on("_uwd",this._u64.bind(this));f.on("newGame",d);f.on("newMoves",d);f.on("deleteMove",d);f.on("_u0d",a);f.on("nextmove",a);f.on("correctGuess",a);f.on("updateMove",this.updateMove.bind(this));f.on("newMove",this._u4f.bind(this));f.on("beforeLoad",this.beforeLoad.bind(this));f.on("afterLoad",this.afterLoad.bind(this));f.on("updateNotations",d)},beforeLoad:function(){this.shim().show(chess.__("Loading game"))},afterLoad:function(){this.shim().hide()},_ukd:function(a){this.parent(a);if(!this.tactics){this.showResult=true}this._uWf(a,["showEval","notations","showContextMenu","comments","interactive","figurines","figurineHeight","showResult"]);if(this.showContextMenu){this.contextMenu=this._u32()}this.notationKey=this.notations==="long"?"lm":"m";this._u7c="move-"+String.uniqueID()+"-"},_uW8:function(){this.tactics=true},_u32:function(){return{listeners:{click:function(b){var a=this._uc3();switch(b.action){case"grade":this._uif("_uof",[a,b.icon]);break;case"_uBa":this._uif("_uBa",[a,b.icon]);break;case"_uLc":this._uif("_uLc",[a,b.icon]);break;case"deleteMove":this._uif("deleteMove",a);break}}.bind(this),selectorclick:function(a){this._ub3(a)
}.bind(this)},selector:".notation-chess-move",children:[{label:chess.__("Add comment before"),action:"_uBa"},{label:chess.__("Add comment after"),action:"_uLc"},{label:"Grade",children:[{icon:"",label:chess.__("Clear"),action:"grade"},{icon:"!",label:chess.__("Good move"),action:"grade"},{icon:"?",label:chess.__("Poor move"),action:"grade"},{icon:"!!",label:chess.__("Very good move"),action:"grade"},{icon:"??",label:chess.__("Very poor move"),action:"grade"},{icon:"?!",label:chess.__("Questionable move"),action:"grade"},{icon:"!?",label:chess.__("Speculative move"),action:"grade"}]},{label:chess.__("Delete Move"),action:"deleteMove"}]}},_use:function(){if(this.interactive){this.$b().on("click",this._uhe.bind(this))}},_uZf:function(){this.parent();this.$e.addClass("dhtml-chess-notation-panel")},_ub3:function(a){this.contextMenuMove={uid:jQuery(a).attr("moveId")}},_uc3:function(){return this.contextMenuMove},_uhe:function(b){var a=b.target;if(a.tagName.toLowerCase()=="img"){a=a.parentNode}if(jQuery(a).hasClass("notation-chess-move")){this._uif("_uG8",{uid:jQuery(a).attr("moveId")});this._um9(a)}},_u64:function(){this.clearHighlightedMove();this.$b().scrollTop(0)},_uG8:function(b){var a=b._uz8();if(a){this._um9(jQuery("#"+this._us7[a.uid]))}else{this.clearHighlightedMove()}},_um9:function(a){this.clearHighlightedMove();if(a==undefined){return}jQuery(a).addClass("notation-chess-move-highlighted");this.highlightedMove=jQuery(a).attr("id");this._uX2(a)},clearHighlightedMove:function(){var a;if(a=jQuery("#"+this.highlightedMove)){a.removeClass("notation-chess-move-highlighted")}},_uX2:function(a){if(!a){return}if(a.position==undefined){a=jQuery(a)}if(!a||!a.length){return}var b=a.position().top+this.$b().scrollTop();var c=a.outerHeight();this.__um8(b,c)},__um8:function(d,f){var a=this.$b();var g=a.scrollTop();var c=g+a.height();if((d+f)>c){a.scrollTop(d)}else{if(d<g){a.scrollTop(Math.max(0,d-5))}}},showMoves:function(c){var b=c._uz8();if(b!=undefined){this._umcMoveId=b.uid}this.$b().html("");var a=this._u95(c.getMoves(),c._uvd(),0,0,0);if(this.showResult){a.push(this._u6c(c))}this.$b().html(a.join(""))},_u6c:function(a){var b=a.getResult();var c=[];c.push('<span class="notation-result">');c.push(b==-1?"0-1":b==1?"1-0":b==0.5?"1/2-1/2":"*");c.push("</span>");return c.join("")},_u95:function(n,l,g,d,k){var b=[];if(this.tactics&&!this._umcMoveId){return b}if(this.tactics){g=0}b.push('<span class="notation-branch-depth-'+g+'">');if(g){switch(g){case 1:if(d===0){b.push("[")}break;default:b.push("(")}}b.push('<span class="notation-branch">');var p;var j="</span>";var c=false;for(var f=0;f<n.length;f++){var a=f>0?n[f-1]:undefined;p=f==0?'<span class="dhtml-chess-move-group chess-move-group-first">':'<span class="dhtml-chess-move-group">';var m=n[f][this.notationKey];if(f==0&&l%2!=0&&m){if(c){b.push(j)}b.push(p);b.push('<span class="dhtml-chess-move-number">..'+Math.ceil(l/2)+"</span>");c=true}if((l%2===0||(a&&a.comment&&a.comment.length>0))&&m){if(c){b.push(j)}var o=Math.floor(l/2)+1;b.push(p);c=true;var h=(l%2)==1?"..":"";b.push('<span class="dhtml-chess-move-number">'+o+"."+h+"</span>")}if(m){l++}this._u75++;b.push('<span class="dhtml-chess-move-container-'+n[f].uid+'">');b.push(this._u23(n[f]));b.push("</span>");if(this.tactics&&n[f].uid===this._umcMoveId){f=n.length}else{if(!this.tactics||this._uC(n[f])){if(c&&this.hasVars(n[f])){c=false;b.push(j)}this._uia(n[f],b,l,g)}}}if(c){b.push("</span>")}b.push("</span>");if(g){switch(g){case 1:if(d==k-1){b.push("]")}break;default:b.push(")")}}b.push("</span>");return b},hasVars:function(a){return a.variations&&a.variations.length>0},_uia:function(b,a,d,f){if(b.variations&&b.variations.length>0){for(var c=0;c<b.variations.length;c++){if(b.variations[c].length>0){a.push(this._u95(b.variations[c],d-1,f+1,c,b.variations.length).join(" "))}}}},_uC:function(b){if(this.hasVars(b)){for(var c=0;c<b.variations.length;c++){if(b.variations[c].length>0){var a=b.variations[c];if(a.uid==this._umcMoveId){return true}if(a.variations){return this._uC(a)}}}}return false},showEval:false,_u23:function(move){var ret=[];ret.push('<span id="'+move.uid+'" class="notation-chess-move-c '+move.uid+'" moveId="'+move.uid+'">');if(move[this.notationKey]){ret.push('<span id="move-'+move.uid+'" class="notation-chess-move chess-move-'+move.uid+'" moveId="'+move.uid+'">');if(this.figurines&&move.m.indexOf("O")==-1&&move.p.type!="p"){var p=move.p;var c=p.color.substr(0,1);var t=p.type=="n"?"n":p.type.substr(0,1);var src=ludo.config._uC6()+"/images/"+this.figurines+"45"+c+t+".svg";ret.push('<img class="dc-figurine" width="'+this.figurineHeight+'" height="'+this.figurineHeight+'" style="vertical-align:text-bottom;height:'+this.figurineHeight+'px" src="'+src+'">'+(move.m.substr(p.type=="p"?0:1)))}else{ret.push(move[this.notationKey])}ret.push("</span>")}if(this.showEval&&move.eval){ret.push('<span class="notation-chess-move-eval notation-chess-move-eval-');if(move.eval<0){ret.push("negative")}else{ret.push("positive")
}ret.push('">'+move.eval+"</span>")}if(this.comments&&move.comment){ret.push('<span class="notation-comment">'+move.comment+"</span>")}ret.push("</span>");this.moveMap[move.uid]=move.uid;this._us7[move.uid]="move-"+move.uid;return ret.join("")},updateMove:function(c,a){var b=this.$e.find(".dhtml-chess-move-container-"+a.uid);if(b.length){b.html(this._u23(a))}else{this.showMoves(c)}this._uG8(c)},_u4f:function(d,a){var h=d._uW6InBranch(a);if(h){var f=this._uvb(h);var j=this._u7c+this._u75;this._u75++;var c="";var b=d._uDf(a).length-1||0;if(b%2===0&&b>0){var g=(b/2)+1;c=g+". "}c+=this._u23(a,j);f.html(f.html()+c)}else{this.showMoves(d)}this._uG8(d)},_uvb:function(a){var b=jQuery("#"+this.moveMap[a.uid]);return b.closest(".notation-branch")},getFirstBranch:function(){return this.$b().getElement(".notation-branch")}});chess.view.notation.TacticPanel=new Class({Extends:chess.view.notation.Panel,tactics:true,_uv9:function(a){a.on("nextmove",this.showMoves.bind(this));a.on("newGame",this._uF5.bind(this));this.parent(a)},_uF5:function(){this._umcMoveId=undefined},_uhe:function(a){}});chess.view.notation.Table=new Class({Extends:chess.view.notation.Panel,type:"chess.view.notation.Table",showContextMenu:false,_uZf:function(){this.parent();this.$e.addClass("dhtml-chess-notation-table")},showEval:false,_u95:function(branch,startPly,depth,branchIndex,countBranches){this.comments=false;var ret=[];ret.push("<ol>");var c=0;jQuery.each(branch,function(i,move){if(move.m){var ply=c+startPly;if(c==0&&ply%2==1){ret.push("<li><dt>"+(Math.ceil(ply/2))+"</dt><dd>&nbsp;</dd>")}if((ply%2)==0){if(c>0){ret.push("</li>")}ret.push("<li><dt>"+(1+Math.ceil(ply/2))+"</dt>")}move.eval=((Math.random()*4)-(Math.random()*4));ret.push("<dd>"+this._u23(move)+"</dd>");c++}}.bind(this));ret.push("</li></ol>");return ret},_u4f:function(){this.showMoves(this._uoe._umc);this._uG8(this._uoe._umc)},_uX2:function(a){if(!a){return}if(a.position==undefined){a=jQuery(a)}if(!a.length){return}var b=a.offset().top-this.$b().offset().top+this.$b().scrollTop();var c=a.outerHeight();this.__um8(b,c)},_uia:function(){},_u6c:function(a){return'<p class="game-result">'+this.parent(a)+"</p>"}});chess.view.notation.LastMove=new Class({Extends:ludo.View,module:"chess",type:"chess.view.notation.LastMove",lastIndex:1,figurines:"svg_bw",boxWidth:undefined,curPos:undefined,figurineHeight:20,_ukd:function(a){this.parent(a);this._uWf(a,["figurineHeight","figurines"])},_uv9:function(a){this.parent(a);a.on("fen",this.update.bind(this));a.on("newmove",this.update.bind(this))},update:function(g){var b=g._uT2();var j=b.split(/\s/g);var l=j[j.length-1];var d=l*2;var h=j[j.length-5];if(h=="b"){d++}else{l--}if(d!=this.lastIndex){var n=g._uz8();var k=-1;var f=this._uSa(n,l,h);var a;if(d>this.lastIndex){k=-2;this.els.right.html(f);a=this.els.right}else{k=0;this.els.left.html(f);a=this.els.left}this.animate(k,a);this.lastIndex=d}},animate:function(b,a){this.els.mc.animate({left:b*this.boxWidth},{duration:100,complete:function(){this.els.center.html(a.html());this.els.mc.css("left",-this.boxWidth);this.curPos=b}.bind(this)})},_uSa:function(a,f,b){if(!a){return""}var d="";d+='<span class="dhtml-chess-notation-last-move-num">'+f+"</span>. ";if(b=="w"){d+=" .."}if(this.figurines&&a.m.indexOf("O")==-1&&a.p.type!="p"){var h=a.p;var k=h.color.substr(0,1);var g=h.type=="n"?"n":h.type.substr(0,1);var j=ludo.config._uC6()+"/images/"+this.figurines+"45"+k+g+".svg";d+='<img width="'+this.figurineHeight+'" height="'+this.figurineHeight+'" style="vertical-align:text-bottom;height:'+this.figurineHeight+'px" src="'+j+'">';d+=(a.m.substr(h.type=="p"?0:1))}else{d+=a.m}return d},resize:function(b){this.parent(b);var a=this.$b().width();var c=this.$b().height();this.els.mc.css({"line-height":(c)+"px","font-size":(c*0.4)+"px",left:-a});this.els.left.css({width:a});this.els.center.css({width:a});this.els.right.css({width:a});this.boxWidth=a},__ucf:function(){this.parent();this.$b().addClass("dhtml-chess-notation-last-move");this.els.mc=jQuery("<div></div>");this.els.mc.css({position:"absolute",height:"100%",width:"300%"});this.$b().append(this.els.mc);this.els.left=jQuery("<div></div>");this.els.left.css({height:"100%","float":"left"});this.els.mc.append(this.els.left);this.els.center=jQuery("<div></div>");this.els.center.css({height:"100%","float":"left"});this.els.mc.append(this.els.center);this.els.right=jQuery("<div></div>");this.els.right.css({height:"100%","float":"left"});this.els.mc.append(this.els.right)}});chess.view.notation.LastComment=new Class({Extends:ludo.View,__ucf:function(){this.parent();this.$b().css("overflow-y","auto");this.$b().addClass("dhtml_chess_current_annotation")},_uv9:function(a){this.parent(a);a.on("fen",this.update.bind(this));a.on("newmove",this.update.bind(this))},update:function(b){var a=b._uz8();if(!a&&b.model.moves.length>0&&b.model.moves[0].comment){a=b.model.moves[0]}if(!a){this.$b().html("");return}var d=a.comment?a.comment:"";this.$b().html(d)}});chess.view.board.GUI=new Class({Extends:ludo.View,type:"chess.view.board.GUI",module:"chess",submodule:"board",labels:true,labelPos:"outside",flipped:false,boardLayout:undefined,vAlign:"middle",boardCls:undefined,boardCss:undefined,lowerCaseLabels:false,background:undefined,bg:undefined,padding:undefined,internal:{_uOe:30,piezeSize:30,_uOes:[15,30,45,60,75,90,105],_ug2:0},labelOddStyles:undefined,labelEvenStyles:undefined,labelStyles:undefined,squareStyles_white:undefined,squareStyles_black:undefined,_uke:true,_ukd:function(a){this.parent(a);
this.padding="3.5%";this._uWf(a,["background","_uke","bgColorWhite","bgColorBlack","labels","boardCls","boardCss","boardLayout","lowerCaseLabels","chessSet","vAlign","labelPos","labelStyles","labelOddStyles","labelEvenStyles","padding","bgWhite","bgBlack","squareStyles_white","squareStyles_black"]);if(!jQuery.isPlainObject(this.padding)){this.padding={l:this.padding,t:this.padding,r:this.padding,b:this.padding}}},_uU:function(a,b){if(this.bg){this.bg._uxe(a,b)}},_uO8:function(a,b){this.$b().find(".dhtml-chess-board-label-file").css(a);this.$b().find(".dhtml-chess-board-label-rank").css(b||a)},hideLabels:function(){},setPaddings:function(c,d,f,a){if(arguments.length==1){d=f=a=c}this.padding={l:c,t:d,r:f,b:a};this._ude()},_uZf:function(){this.parent();this.els.labels={};this.$b().css({padding:0,margin:0,border:0});if(this.background&&this.background!="none"){this.bg=new chess.view.board.Background(Object.merge({view:this},this.background))}this._uJ1();if(this._uB5()){this._uN3()}this._u2();this._uge();this._uCa();this._uQ1();if(this._us6()){this._uN3()}if(this.hasLabels()){this._uM3()}if(this._uke){this._uGa()}if(this.boardLayout){this.els._ur8.addClass("dhtml-chess-board-container-"+this.boardLayout)}},_use:function(){this.parent();jQuery(document.documentElement).on("keypress",this._uX1.bind(this))},_uGa:function(){var a=this.els._uV6=jQuery('<div class="dhtml-chess-side-to-move-outer"></div>');this.els._uke=jQuery('<div class="dhtml-chess-side-to-move-board"></div>').appendTo(a);this.els._ur8.append(a);this.els._ur8.css("overflow","visible")},stml:undefined,_uuf:function(){var f=this._uoe.colorToMove();if(f!==this.stml){var b="dhtml-chess-side-to-move-";var a=this.els._uke;a.removeClass(b+"white");a.removeClass(b+"black");a.addClass(b+f);var d=this.els._uV6;d.removeClass(b+"outer-white");d.removeClass(b+"outer-black");d.addClass(b+"outer-"+f);this.stml=f;this.resizeSTM()}},resizeSTM:function(){var g=this.getP("r");var b=Math.min(12,g);var f=Math.ceil(Math.max(2,(g-b)/2));var h=f+b-g;if(h>0){b-=h}b=Math.max(6,b);var c=this.flipped?"black":"white";var k=c==this.stml?"bottom":"top";var j=f;if(g<4&&this.labelPos=="inside"&&k=="bottom"){j+=this._uOe/5}j=Math.round(j);var a={width:b,height:b,right:f,top:"auto",bottom:"auto"};a[k]=j;this.els._uV6.css(a)},_uv9:function(a){this.parent(a);if(this._uke){a.on("newGame",this._uuf.bind(this));a.on("fen",this._uuf.bind(this))}},_uX1:function(a){if(a.control&&a.key==="f"){this.flip()}},__ucf:function(){this.parent();if(this.bgWhite){this.setSquareBg("white",this.bgWhite)}if(this.bgBlack){this.setSquareBg("black",this.bgBlack)}this.resizeSquares();this._ude.delay(50,this);this._u2c()},_uB5:function(){return this.labels&&this.labelPos=="outside"},_us6:function(){return this.labels&&this.labelPos=="inside"},hasLabels:function(){return this.labels},_uJ1:function(){var a=this.els._ur8=jQuery("<div>");a.addClass("dhtml-chess-board-container");if(this.boardCss){a.css(this.boardCss)}if(this.boardCls){a.addClass(this.boardCls)}this.$b().append(a)},_u2:function(){var a=this.els._uH2=jQuery("<div>");a.css("float","left");this.els._ur8.append(a)},_uge:function(){this.els.board=jQuery('<div class="dhtml-chess-board"></div>');this.els.board.css({position:"relative",margin:0,padding:0,width:this.internal._uOe*8,height:this.internal._uOe*8});this.els._uH2.append(this.els.board)},_uCa:function(){var d="abcdefgh";this.els._u1g=[];for(var b=0;b<64;b++){var f=d.substr((b%8),1)+Math.ceil(8-(b/8));var c=this.els._u1g[b]=jQuery('<div class="dhtml-chess-square" style="position:relative"></div>');this.els.board.append(c);var a=Math.round(Math.random()*100)*-1;c.css("backgroundPosition",a+"px "+a+"px")}this._uAa();this.createHitArea()},createHitArea:function(){var a=this.els.hParent=jQuery('<div style="z-index:2;position:absolute;left:0;top:0;width:100%;height:100%"></div>');this.els.board.append(a)},hitArea:function(){return this.els.hParent},getSquares:function(){return this.els._u1g},boardEl:function(){return this.els.board},_uQ1:function(){var a=this.els._uq8=jQuery("<div>");a.css({position:"absolute",left:0,top:0,width:"100%",height:"100%"});this.els.board.append(a)},squareBg_white:undefined,squareBg_black:undefined,setSquareBg:function(a,b){if(a!="white"&&a!="black"){return}this["squareBg_"+a]=b;this._uAa()},_uAa:function(){var d=["white","black"];var a=0;for(var c=0;c<64;c++){a++;if(c%8==0){a++}var b=d[a%2];var f=this.els._u1g[c];f.css("float","left");f.addClass("dhtml-chess-square-"+b);if(this["squareStyles_"+b]!=undefined){f.css(this["squareStyles_"+b])}if(this["squareBg_"+b]!=undefined){f.css("background-image","url("+this["squareBg_"+b]+")")}}},_ufe:function(){var a=[];for(var b=this.els._u1g.length-1;b>=0;b--){this.els.board.append(this.els._u1g[b]);a.push(this.els._u1g[b])}this.els._u1g=a},_uM3:function(){var d=this.els.labels.files=jQuery('<div class="dhtml-chess-board-label-files-container ludo-noselect"></div>');d.css({position:"absolute","z-index":100,bottom:0});if(this.labelPos=="inside"){d.css("bottom",0);
d.addClass("dhtml-chess-board-label-inside")}this.els.files=[];for(var b=0;b<8;b++){var f=b%2==0;var a=this.els.files[b]=jQuery('<div class="dhtml-chess-board-label dhtml-chess-board-label-file"></div>');if(this.labelStyles){a.css(this.labelStyles)}if(f&&this.labelOddStyles){a.css(this.labelOddStyles)}if(!f&&this.labelEvenStyles){a.css(this.labelEvenStyles)}a.addClass("dhtml-chess-board-label-"+(f?"odd":"even"));a.css({width:(100/8)+"%","float":"left",overflow:"hidden"});if(this.labelPos=="inside"){a.css("line-height","120%")}d.append(a)}var c=this.labelPos=="outside"?this.els._ur8:this.els.board;c.append(d)},_uN3:function(){var d=this.els.labels.ranks=jQuery('<div class="dhtml-chess-board-label-ranks-container  ludo-noselect"></div>');if(this.labelPos=="inside"){d.addClass("dhtml-chess-board-label-inside")}d.css({position:"absolute","float":"left",left:"0px",top:"0px",height:"100%","z-index":100});if(this.labelpos=="outside"){d.css("text-align","center")}this.els.ranks=[];for(var b=0;b<8;b++){var f=(b+1)%2==0;var g=this.els.ranks[b]=jQuery('<div class="dhtml-chess-board-label dhtml-chess-board-label-rank"></div>');if(this.labelStyles){g.css(this.labelStyles)}if(f&&this.labelOddStyles){g.css(this.labelOddStyles)}if(!f&&this.labelEvenStyles){g.css(this.labelEvenStyles)}g.addClass("dhtml-chess-board-label-"+((b+1)%2==0?"odd":"even"));g.css({height:(100/8)+"%",overflow:"hidden"});var a=this.labelPos=="outside"?this.internal._uOe+"px":"100%";g.css("line-height",a);d.append(g)}var c=this.labelPos=="outside"?this.els._ur8:this.els.board;c.append(d)},_u2c:function(){if(!this.hasLabels()){return}var c,b;if(!this.isFlipped()){b="abcdefgh";c="87654321"}else{b="hgfedcba";c="12345678"}if(this.lowerCaseLabels){b=b.toLowerCase()}for(var a=0;a<8;a++){this.els.ranks[a].html("<span>"+c.substr(a,1)+"</span>");this.els.files[a].html("<span>"+b.substr(a,1)+"</span>")}},_ukf:function(){this.parent();this.internal._ug2=this.getTimeStamp();this._ude()},_uD6:function(){this._ude()},lastBoardSize:{x:0,y:0},_uX5:function(){var a=this.els._ur8;var d=this.$b().offset();var f=a.offset();var c={left:f.left-d.left,top:f.top-d.top};c.width=a.outerWidth();c.height=a.outerHeight();return c},_ude:function(){ludo.dom._uLe();var f=this.els._ur8;var d=this.getP("l");var k=this.getP("t");var b=this.getP("r");var h=this.getP("b");f.css({"padding-left":d,"padding-top":k,"padding-right":b,"padding-bottom":h});var g=Math.min(this.$b().width()-(f.outerWidth()-f.width()),this.$b().height()-(f.outerHeight()-f.height()));if(g<10||(g==this.lastBoardSize.x&&g==this.lastBoardSize.y)){return}this.lastBoardSize=g;g=Math.max(this.internal._uOes[0]*8,Math.floor(g/8)*8);if(isNaN(g)||g<0){return}var a=0;if(this.vAlign=="middle"){a=Math.max(0,(this.$b().height()-this.$b().width())/2)}else{if(this.vAlign=="bottom"){a=Math.max(0,(this.$b().height()-this.$b().width()))}}this.els._ur8.css({top:a,width:g+"px",height:g+"px"});this.internal.pieceSize=this._uA6();var j=f.width()-(this.els.board.outerWidth()-this.els.board.width());if(Browser.name=="safari"){var c=j%8;if(c>4){c=c-8}j-=c;d+=(c/2);k+=(c/2)}this.internal._uOe=j/8;this.els.board.css({position:"absolute",left:d,top:k,width:j,height:j});this._u1c();this._uJc();this._uif("boardResized",this._uX5());if(this._uke){this.resizeSTM()}},_u1c:function(){if(!this.hasLabels()){return}var d=this.els.labels.ranks;var g=this.els.labels.files;d.css("height",this.els.board.css("height"));g.css("width",this.els.board.css("width"));var a;if(this.labelPos=="outside"){d.css("top",this.els._ur8.css("padding-top"));g.css("line-height",this.getP("b")+"px");d.css("width",this.getP("l"));g.css("height",this.getP("b"));a=Math.ceil(g.height()*(this.labelPos=="outside"?0.65:0.5))}else{a=Math.round(this._u0a()*0.2)}d.css("font-size",a+"px");g.css("font-size",a+"px");var c=this.els.ranks[0].height();for(var b=0;b<8;b++){if(this.labelPos=="outside"){this.els.ranks[b].css("line-height",c+"px")}else{this.els.ranks[b].css({position:"absolute",width:"auto",height:"auto",top:this.internal._uOe*b});this.els.files[b].css({position:"absolute",width:"auto",left:(this.internal._uOe*(b+1))-this.els.files[b].outerWidth(),bottom:0,height:"auto"})}}},getP:function(b){var a=this.padding[b];if(isNaN(a)){a=parseInt(a);return Math.round(Math.min(this.$b().width(),this.$b().height())*a/100)}return a},resizeSquares:function(){for(var a=0;a<64;a++){this.els._u1g[a].css({width:"12.5%",height:"12.5%"})}},_uA6:function(){return this.internal._uOe-this.internal._uOe%15},flip:function(){this.flipped=!this.flipped;this._u2c();this._ufe();this._uif("flip",this)},isFlipped:function(){return this.flipped},getBoard:function(){return this.els._uq8},_u0a:function(){return this.internal._uOe},getTimeStamp:function(){return new Date().getTime()},getHeightOfContainer:function(){return this.$b().height()},_u11:function(b,f){var c=this.internal._uOe;var d=c/2;b+=d;f+=d;b=Math.max(0,b);f=Math.max(0,f);var a=c*8;b=Math.min(a,b);f=Math.min(a,f);b=Math.floor(b/c);f=Math.floor(8-(f/c));
if(this.isFlipped()){b=7-b;f=7-f}return b+f*16},_uV9:function(a){return Math.min(a.width,a.height)},_utc:function(a){return Math.max(a.width,a.height)}});chess.view.board.Board=new Class({Extends:chess.view.board.GUI,type:"chess.view.board.Board",pieces:[],_uYf:{},instructorMode:false,fen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",animationDuration:0.2,pieceLayout:"svg_bw",boardLayout:undefined,_uK8:undefined,_uj4:undefined,ddEnabled:false,plugins:[],_ug5:{index:0,moves:[],duration:0.5,isBusy:false},_ukd:function(a){this.parent(a);this.pieces=[];this._uWf(a,["fen","pieceLayout","animationDuration","plugins"]);if(this.animationDuration){this.animationDuration/=1}if(this.plugins&&Browser.ie&&Browser.version<9){for(var b=0;b<this.plugins.length;b++){if(this.plugins[b].type==="chess.view.highlight.Arrow"){this.plugins[b].type="chess.view.highlight.Square"}}}this._uK8=new chess.parser._uQ9()},inAltMode:false,shiftMode:false,posOnDown:undefined,__ucf:function(){this.createPieces();this._u0g(this.fen);this.parent();var a=this.getEl();var b=jQuery(document.documentElement);a.on("click",function(c){var d=c.pageX+c.pageY;if(Math.abs(d-this.posOnDown)<=2){this.fireDomEvent("clickSquare",c)}}.bind(this));a.on("mousedown",this.onDown.bind(this));b.on("mouseup",function(c){if(this.inAltMode||this.shiftMode){this.fireDomEvent("arrowEnd",c);this.inAltMode=false;this.shiftMode=false}}.bind(this));b.on("mousemove",function(c){if(this.inAltMode||this.shiftMode){this.fireDomEvent("arrowMove",c)}}.bind(this))},onDown:function(a){this.posOnDown=a.pageX+a.pageY;if(a.altKey||a.shiftKey){this.inAltMode=a.altKey;this.shiftMode=a.shiftKey;this.fireDomEvent("arrowStart",a)}},fireDomEvent:function(d,l){var h=this.getBoard();var c=h.offset();var k=h.width()/8;var j=l.pageX-c.left;var g=l.pageY-c.top;j=Math.floor(j/k);g=Math.floor(g/k);if(j>7||j<0||g>7||g<0){return}var a="abcdefgh";var f="87654321";if(this.flipped){j=7-j;g=7-g}var m=a.charAt(j)+f.charAt(g);this._uif(d,[m,l])},createPieces:function(){var d=this.isFlipped();for(var b=0;b<32;b++){var a={square:0,color:"white",pieceType:"p",pieceLayout:this.pieceLayout,_uOe:30,flipped:d,aniDuration:this.animationDuration,board:this};var c=new chess.view.board.Piece(a);c.on("_u84",this._uT3.bind(this));c.on("move",this.makeMove.bind(this));c.on("initdrag",this._uF8.bind(this));this.pieces.push(c);this.getBoard().append(c.getEl())}this._uJc();this.addPieceDragEvents()},_uX8:function(a){jQuery.each(this.pieces,function(b,c){c._uX8(a)})},addPieceDragEvents:function(){this._uCe().on(ludo.util._ub5(),this.dragPiece.bind(this));this._uCe().on(ludo.util._uE7(),this._uN9.bind(this))},_uYb:undefined,_uF8:function(a){this._uYb=a},dragPiece:function(a){if(this._uYb){this._uYb.dragPiece(a)}},_uN9:function(a){if(this._uYb){this._uYb._uN9(a);this._uYb=undefined}},_uv9:function(a){this.parent(a);a.on("newGame",this._uI8.bind(this));a.on("newMove",this._uM.bind(this));a.on("newMove",this._ui5.bind(this));a.on("_u0d",this.showMove.bind(this));a.on("nextmove",this._ui5.bind(this));a.on("_uwd",this._uM.bind(this));a.on("newGame",this._uM.bind(this));a.on("flip",this.flip.bind(this));a.on("beforeLoad",this.beforeLoad.bind(this));a.on("afterLoad",this.afterLoad.bind(this))},beforeLoad:function(){this.shim().show(chess.__("Loading game"))},afterLoad:function(){this.shim().hide()},_uM:function(){this._uif("clearHighlight",this)},enableInstructorMode:function(){this.instructorMode=true;this.ddEnabled=true;this._uj4=this._uK8.getFullSquareMap();this.pieces.forEach(function(a){a._ui4()})},_ui4:function(a){if(this._ug5.isBusy){this._ui4.delay(200,this,a);return}this.ddEnabled=true;var c=a._uT2();this._uK8.setFen(c);this._uj4=this._uK8._uW().moves;this._uE1();for(var b in this._uj4){if(this._uj4.hasOwnProperty(b)){this._uYf[b]._ui4()}}},_uy3:function(){this.ddEnabled=false;this._uE1()},_uE1:function(){for(var a=0;a<this.pieces.length;a++){this.pieces[a]._uy3()}},_ui5:function(d,c){var b=this._ug5;if(!this.animationDuration){this.showMove(d,c);return}if(b.isBusy){this._ui5.delay(200,this,[d,c]);return}this._uif("animationStart");var a=c.moves;b.duration=this._uD(c);b.index=0;b.moves=a;b.isBusy=true;this._unc()},_unc:function(){var a=this._ug5.moves[this._ug5.index];if(a.capture){var c=_uP6.mapping[a.capture];if(c!==a.to){this._uYf[c].hide();this._uYf[c]=null}this._uT3(a)}else{if(a.promoteTo){this._uY4(a.square).promote(a.promoteTo);this._ug5.isBusy=false;this._uif("_u84")}else{if(a.from){var b=this._uY4(a.from);if(b){b.playMove(a.to,this._ug5.duration)}}}}},_uT3:function(a){this._ug5.index++;var b=this._uYf;if(b[a.to]){b[a.to].hide()}b[a.to]=b[a.from];b[a.from]=null;if(this._ug5.index<this._ug5.moves.length){this._unc()}else{this._uif("highlight",this._ug5.moves[0]);this._uif("_u84");this._ug5.isBusy=false}},_uD:function(a){var c=0;for(var b=0;b<a.moves.length;b++){if(a.moves[b].from){c++}}return(this.animationDuration/c)*1000},showMove:function(b,a,c){if(this._ug5.isBusy){c=b._uT2();this.showMove.delay(200,this,[b,a,c]);
return}c=c||b._uT2();this._u0g(c);if(a=b._uz8()){this._um9(a)}},_um9:function(a){if(!a){return}if(a.from&&a.to){this._uif("highlight",a)}},_uI8:function(a){this._u0g(a._uT2())},_u0g:function(b){this._uK8.setFen(b);var h=this._uK8._umf();this._uYf={};for(var d=0,g=h.length;d<g;d++){var a=(h[d].t&8)?"black":"white";var f=_uP6._uSc[h[d].t];var k=this.pieces[d];k.square=h[d].s;k.color=a;k.pieceType=f;k.position();k._uh1();k.show();this._uYf[h[d].s]=k}for(var c=d;c<this.pieces.length;c++){this.pieces[c].hide()}this._uif("fen",b)},_un1:function(){var a=32;for(var b=this.pieces.length-1;b>=0;b--){if(!this.pieces[b].isVisible()){a--}}return a},hidePiece:function(a){if(a){delete this._uYf[a.square];a.hide()}},_uZe:function(){this._u0g("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1");this._uif("resetboard",this)},clearBoard:function(){for(var a=0;a<this.pieces.length;a++){this.pieces[a].hide();this._uYf={}}this._uif("clearboard",this)},makeMove:function(a,d){if(a.from===a.to){return}if(this.instructorMode){var c=_uP6.mapping[a.to];var g=_uP6.mapping[a.from];var b=d.pieceType;if(this._uYf[c]&&this._uYf[c].pieceType==="k"){d.position(g);return}if(b==="p"&&/[18]/.test(a.to)){d.promote("q")}var h=this._uY4(a.to);if(h&&h!==d&&h.pieceType!=="k"){h.hide()}this._uYf[g]=undefined;this._uYf[c]=d;d.square=_uP6.mapping[a.to]}this._uif("move",[a,d])},buildFen:function(){var a=_uP6._u34;var g=0;var b="";for(var d=0;d<a.length;d++){var f=a[d];var h=this._uYf[f];if(d&&d%8===0){if(g){b+=g}b+="/";g=0}if(h){var c=h._uEd();if(h.color==="white"){c=c.toUpperCase()}if(g){b+=g}b+=c;g=0}else{g++}}return b},_urcsForPiece:function(a){return this._uj4[a.square]||[]},_uY4:function(a){return this._uYf[_uP6.mapping[a]]},currentPieceSize:undefined,_uOe:undefined,_uJc:function(){this._uOe=this._u0a();var b=this.pieces;if(!b[0].svg){for(var a=0;a<b.length;a++){b[a].resize(this._uOe)}}},flip:function(){this.parent();for(var a=0,b=this.pieces.length;a<b;a++){this.pieces[a].flip()}},flipTo:function(a){if(a=="white"){this._und()}else{this._ujd()}},_und:function(){if(this.flipped){this.flip()}},_ujd:function(){if(!this.flipped){this.flip()}},_ufc:function(a){this._uif("_ufc",a)},showHint:function(a){this._uif("showHint",a)}});_u6=200;chess.view.board.Piece=new Class({Extends:ludo.Core,type:"chess.view.board.Piece",color:"white",pieceLayout:"alpha",size:null,validSizes:[30,45,60,75,90,105],square:undefined,el:null,flipped:false,toSquare:null,board:undefined,ddEnabled:false,aniDuration:0.25,pieceType:"p",dd:{active:false,el:{x:0,y:0},mouse:{x:0,y:0}},internal:{files:{a:0,b:1,c:2,d:3,e:4,f:5,g:6,h:7}},_uH3:[],svg:false,extension:"pgn",_ukd:function(a){this.parent(a);this.square=a.square;this._uX8(a.pieceLayout);this.numSquare=a.numSquare;this.flipped=a.flipped;this.pieceType=a.pieceType;this.color=a.color;this.board=a.board;this.aniDuration=a.aniDuration!=undefined?a.aniDuration:this.aniDuration;this._unf();this.resize(30);this.position()},_uX8:function(a){this.pieceLayout=a;this.svg=this.pieceLayout.indexOf("svg")===0;this.extension=this.svg?"svg":"png";this.bgUpdated=false;if(this.el){this._uh1()}},_unf:function(){var a=this.el=jQuery("<div>");a.css({position:"absolute",padding:0,margin:0,borders:0,width:"12.5%",height:"12.5%","z-index":200,overflow:"hidden"});a.mouseenter(this._ue6.bind(this));a.mouseleave(this._uy6.bind(this));a.on(ludo.util._uW3(),this._uO9.bind(this));a.addClass("dhtml-chess-piece");this.position()},_ue6:function(){this._uif("mouseenter",this)},_uy6:function(){this._uif("mouseleave",this)},_uy3:function(){this.ddEnabled=false;this.el.css("cursor","default")},_ui4:function(){this.ddEnabled=true;this.el.css("cursor","pointer")},isVisible:function(){return this.el.css("display")!=="none"},hide:function(){this.el.css("display","none")},show:function(){this.el.css("display","")},_uO9:function(b){if(b.altKey||b.shiftKey||b.ctrlKey||b.metaKey){return}if(this.ddEnabled){this._uP8();this._uH3=this.board._urcsForPiece(this);this._uif("initdrag",this);var c=this.el.position();this.el.css({left:c.left,top:c.top});var a=ludo.util.pageXY(b);this.dd={active:true,mouse:{x:a.pageX,y:a.pageY},el:{x:c.left,y:c.top},current:ludo.util.pageXY(b)};if(this.board){this.board.onDown(b)}return false}return undefined},dragPiece:function(b){if(this.dd.active===true){var c=this.dd;var a=ludo.util.pageXY(b);c.current=a;this.el.css({left:(a.pageX+c.el.x-c.mouse.x)+"px",top:(a.pageY+c.el.y-c.mouse.y)+"px"});return false}return undefined},_uN9:function(){var c=this.dd;if(c.active){var b={x:c.current.pageX+c.el.x-c.mouse.x,y:c.current.pageY+c.el.y-c.mouse.y};var a=this._u11(b.x,b.y);if(this._uH3.indexOf(a)>=0){this.position(a);this._uif("move",[{from:_uP6._uI1[this.square],to:_uP6._uI1[a],},this])}else{this.position()}c.active=false}},_u11:function(a,c){var b=this.board._uOe;a+=b/2;c+=b/2;a=Math.max(0,a);c=Math.max(0,c);a=Math.min(b*8,a);c=Math.min(b*8,c);a=Math.floor(a/b);c=Math.floor(8-(c/b));if(this.isFlipped()){a=7-a;c=7-c}return a+c*16},getSquare:function(){return this.square
},promote:function(a){this.pieceType=a;this._uh1()},bgUpdated:false,_uh1:function(){var a=this.svg?45:this.size;var b=this._uMb()+this._uEd();if(this.svg&&b===this.bgUpdated){}else{this.el.css("background-image","url("+ludo.config._uC6()+"/images/"+this.pieceLayout+a+this._uMb()+this._uEd()+"."+this.extension+")")}if(this.svg&&!this.bgUpdated){this.el.css({"background-size":"100% 100%","-moz-background-size":"cover","-o-background-size":"cover","-webkit-background-size":"cover"})}this.bgUpdated=b},resize:function(b){if(this.svg){this.size=b;this._uh1();return}var d=this.validSizes;if(b<d[0]){b=d[0]}if(b>d[d.length-1]){b=d[d-1]}var a=b*1.1;var c=a-a%15;if(c!=this.size){this.size=c;this._uh1()}},position:function(a){var b=this.getPos(a);this.el.css({left:b.x,top:b.y})},playMove:function(b){b=_uP6.mapping[b];if(this._uR3(b)){this.toSquare=b;this._u84()}else{var a=this._uU8(b);this._uP8();this.el.animate({top:a.y+"%",left:a.x+"%"},this.aniDuration*1000,this._u84.bind(this));this.toSquare=b}},_uR3:function(a){var b=this.getPos(a);return b.x==this.el[0].style.left&&b.y===this.el[0].style.top},_uP8:function(){_u6++;this.el.css("zIndex",_u6)},_u84:function(){this._uif("_u84",{from:this.square,to:this.toSquare});this.square=this.toSquare},getPos:function(a){var b=this._uU8(a!==undefined?a:this.square);return{x:b.x+"%",y:b.y+"%"}},_uU8:function(b){var a=(b&15);var c=7-((b&240)/16);if(this.flipped){a=7-a;c=7-c}return{x:(a*12.5),y:(c*12.5)}},getEl:function(){return this.el},_uMb:function(){return this.color=="white"?"w":"b"},_uEd:function(){switch(this.pieceType){case"p":case"r":case"b":case"q":case"k":return this.pieceType.substr(0,1).toLowerCase();case"n":return"n";default:return undefined}},flip:function(){this.flipped=!this.flipped;this.position()},isFlipped:function(){return this.flipped}});chess.view.board.Background=new Class({type:"chess.view.board.Background",view:undefined,paths:{t:undefined,l:undefined,r:undefined,b:undefined},els:undefined,verticalSize:undefined,horizontalSize:undefined,patternSize:undefined,size:undefined,borderRadius:0,paint:undefined,square:true,pattern:undefined,initialize:function(b){this.view=b.view;var a=this.svg=this.view.svg();if(Browser.name=="ie"||Browser.name=="edge"||Browser.name=="safari"){b.horizontal=undefined;b.vertical=undefined;b.paint=b.iePaint?b.iePaint:{fill:"#444"}}a.css("position","absolute");a.css("left","0");a.css("top","0");if(b.square!=undefined){this.square=b.square}if(b.borderRadius!=undefined){this.borderRadius=b.borderRadius}this.view.on("boardResized",this.resize.bind(this));if(b.horizontal=="none"){b.horizontal=undefined}if(b.vertical=="none"){b.vertical=undefined}this.horizontal=b.horizontal;this.vertical=b.vertical;this.pattern=b.pattern;if(!this.horizontal&&!this.pattern){this.horizontal=ludo.config._uC6()+"images/transparent-dot.png";this.vertical=this.horizontal}this.els={};this.paint=b.paint;this.render()},render:function(){this.createClipPath();this.createPattern();this.createPath("t");this.createPath("l");this.createPath("b");this.createPath("r");if(!this.horizontal){if(!this.pattern){this.paths.t.css("display","none")}this.paths.l.css("display","none");this.paths.r.css("display","none");this.paths.b.css("display","none")}if(this.paint&&!this.paint.fill){this.els._upf.toFront()}this._uXb()},createClipPath:function(){var a=this.els.clipPath=this.svg.$("clipPath");this.els.clip=this.svg.$("rect");a.append(this.els.clip);this.svg.appendDef(a);this._uu6(this.borderRadius)},createPath:function(a){this.paths[a]=this.svg.$("path");this.paths[a].clip(this.els.clipPath);this.svg.append(this.paths[a])},_uxe:function(a,b){this._uxeItem(a,this.els.horizontal);this._uxeItem(b,this.els.vertical)},_uxeItem:function(b,a){a.removeAttr("width");a.removeAttr("height");a.set("xlink:href",b)},_uu6:function(a){this.borderRadius=a;if(isNaN(a)){a=parseFloat(a);a=Math.min(this.svg.width,this.svg.height)*(a/100)}this._u14(this.els.clip,a);if(this.els._upf){this._u14(this.els._upf,a)}},_u14:function(b,a){b.set("rx",a);b.set("ry",a)},getPattern:function(g,a,c){var d=this.svg;var f=d.$("pattern");f.set("width",1);f.set("height",1);f.set("x",0);f.set("y",0);var b=this.els[c]=d.$("image");this.loadImage(b,a,g);f.append(b);d.appendDef(f);return f},loadImage:function(c,a,b){var d=this;c.set("opacity",0);c.removeAttr("width");c.removeAttr("height");c.on("load",function(){var f=this.getBBox();d[a]={x:f.width,y:f.height};c.set("width",f.width);c.set("height",f.height);c.set("opacity",1);d._uS3()}.bind(c));c.set("xlink:href",b);return c},createPattern:function(){if(this.paint!=undefined){var a=this.els._upf=this.svg.$("rect");a.css(this.paint);this.svg.append(a);if(!this.paint.fill){a.css("fill-opacity",0)}a.toFront()}if(this.pattern){this.els.pattern=this.getPattern(this.pattern,"patternSize","pattern")}else{if(this.horizontal){this.els.horizontalPattern=this.getPattern(this.horizontal,"horizontalSize","horizontal");this.els.verticalPattern=this.getPattern(this.vertical,"verticalSize","vertical")
}}},_uS3:function(){if(this.size==undefined){this.size={x:1,y:1}}var a=5;if(this.pattern&&this.patternSize!=undefined){this.els.pattern.set("width",Math.min(a,this.patternSize.x/this.size.x));this.els.pattern.set("height",Math.min(a,this.patternSize.y/this.size.y))}if(this.horizontal&&this.horizontalSize!=undefined){this.els.horizontalPattern.set("width",Math.min(a,this.horizontalSize.x/this.size.x));this.els.horizontalPattern.set("height",Math.min(a,this.horizontalSize.y/this.size.y))}if(this.vertical&&this.verticalSize!=undefined){this.els.verticalPattern.set("width",Math.min(a,this.verticalSize.x/this.size.x));this.els.verticalPattern.set("height",Math.min(a,this.verticalSize.y/this.size.y))}},_uXb:function(){var a=this.paths;if(this.els.pattern){a.t._uxe(this.els.pattern)}if(this.els.horizontal){a.t._uxe(this.els.horizontalPattern);a.b._uxe(this.els.horizontalPattern)}if(this.els.vertical){a.l._uxe(this.els.verticalPattern);a.r._uxe(this.els.verticalPattern)}},updateRect:function(c,h,g,b,a,f,d){c.set("x",h);c.set("y",g);c.set("width",b);c.set("height",a)},resize:function(f){var c=0;if(this.paint!=undefined&&this.paint["stroke-width"]){c=parseFloat(this.paint["stroke-width"])}if(this.square){var d=Math.min(f.width,f.height);this.size={x:d,y:d}}else{this.size={x:f.width,y:f.height}}if(this.els._upf){this.updateRect(this.els._upf,f.left+c/2,f.top+c/2,this.size.x-c,this.size.y-c,this.borderRadius,this.borderRadius)}this.updateRect(this.els.clip,f.left,f.top,this.size.x,this.size.y,this.borderRadius,this.borderRadius);var b=f.width/2+f.left;var h=f.height/2+f.top;var a=this.size.x/2;var g=this.size.y/2;a-=c;if(this.pattern){this.paths.t.set("d",["M",b-a,h-g,"L",b-a,h+g,b+a,h+g,b+a,h-g,"Z"].join(" "))}else{this.paths.t.set("d",["M",b,h,"L",b-a,h-g,b+a,h-g,"Z"].join(" "));this.paths.b.set("d",["M",b,h,"L",b-a,h+g,b+a,h+g,"Z"].join(" "));this.paths.l.set("d",["M",b,h,b-a,h-g,b-a,h+g,"Z"].join(" "));this.paths.r.set("d",["M",b,h,"L",b+a,h-g,b+a,h+g,"Z"].join(" "))}this._uu6(this.borderRadius);this._uS3()}});chess.view.board.BoardInteraction=new Class({Extends:Events,flipped:false,board:undefined,surface:undefined,size:undefined,initialize:function(a){this.board=a.board;this.surface=jQuery('<div style="z-index:12002;position:absolute;left:0;top:0;width:100%;height:100%"></div>');this.board.els.board.append(this.surface);this.enable();this.resize();this.board.on("resize",this.resize.bind(this));this.surface.on("click",this.onClick.bind(this))},resize:function(){this.size=this.board.els.board.width()},enable:function(){this.surface.css("z-index",200)},disable:function(){this.surface.css("z-index",1)},onClick:function(b){var a=this.getSquare(b);this._uif("click",a)},getSquare:function(f){var g=this.surface.offset();var d=ludo.util.pageXY(f);var c=d.pageX-g.left;var b=d.pageY-g.top;var a=Math.floor(c/this.size*8);var h=8-Math.floor(b/this.size*8);if(this.board.isFlipped()){a=7-a;h=9-h}return"abcdefgh".substr(a,1)+(h)}});chess.view.highlight.Base=new Class({Extends:ludo.Core,board:undefined,_ukd:function(a){this.parent(a);this._uB6=a._uB6;this._uB6.on("resize",this._uH8.bind(this))},getParent:function(){return this._uB6},_uH8:function(){}});chess.view.highlight.ArrowBase=new Class({Extends:chess.view.highlight.Base,module:"chess",submodule:"arrowHiglight",canvas:undefined,files:["A","B","C","D","E","F","G","H"],arrowPaint:undefined,_usd:undefined,arrowPool:undefined,arrowStyles:{"stroke-linejoin":"round",stroke:"#a7311e",fill:"#a7311e","stroke-opacity":0.8,"fill-opacity":0.5},_ukd:function(a){this.parent(a);if(a.styles!==undefined){this.arrowStyles=Object.merge(this.arrowStyles,a.styles)}if(chess.OVERRIDES!==undefined&&chess.OVERRIDES.arrow_styles!==undefined){var b=chess.OVERRIDES.arrow_styles.split(/;/g);jQuery.each(b,function(c,d){var f=d.split(/:/);this.arrowStyles[f[0]]=f[1]}.bind(this))}this.arrowPool=new chess.view.highlight.ArrowPool({single:true,board:this.getParent(),arrowStyles:this.arrowStyles})},showMove:function(a){this.arrowPool.show(a.from,a.to)},getEl:function(){return this.el},hide:function(){this.arrowPool.hideAll()}});chess.view.highlight.Arrow=new Class({Extends:chess.view.highlight.ArrowBase,_ukd:function(a){this.parent(a);var b=this.getParent();b.on("highlight",this.showMove.bind(this));b.on("clearHighlight",this.hide.bind(this))}});chess.view.highlight.ArrowTactic=new Class({Extends:chess.view.highlight.ArrowBase,delay:1,_ukd:function(a){this.parent(a);if(a.delay!==undefined){this.delay=a.delay}this._uB6.addEvent("_ufc",this._ufc.bind(this))},_ufc:function(a){this.showMove(a);this.hide.delay(this.delay*1000,this)}});chess.view.highlight.SquareTacticHint=new Class({delay:1,squarePool:undefined,board:undefined,initialize:function(a){if(a.delay!==undefined){this.delay=a.delay}this.board=a._uB6;this.board.on("showHint",this.showHint.bind(this))},showHint:function(a){var b=this.pool();b.hideAll();b.show(a.from);b.hide.delay(this.delay*1000,b,a.from)},pool:function(){if(this.squarePool==undefined){this.squarePool=new chess.view.highlight.SquarePool({board:this.board})
}return this.squarePool}});chess.view.highlight.ArrowPool=new Class({type:"chess.view.highlight.ArrowPool",bg:undefined,pool:undefined,hiddenPool:undefined,board:undefined,svgNode:undefined,single:false,autoToggle:false,arrowStyles:{"stroke-linejoin":"round",stroke:"#006064",fill:"#006064","stroke-width":0.8,"stroke-opacity":1,"fill-opacity":0.5},initialize:function(b){this.board=b.board;this.bg=jQuery('<div style="z-index:10000;position:absolute;left:0;top:0;width:100%;height:100%"></div>');this.board.boardEl().append(this.bg);this.pool=[];this.hiddenPool=[];if(b.arrowStyles!==undefined){this.arrowStyles=Object.merge(this.arrowStyles,b.arrowStyles)}if(b.single!==undefined){this.single=b.single}this.board.on("resize",this.resize.bind(this));this.board.on("flip",this.resize.bind(this));this.svgNode=new ludo.svg.Canvas({renderTo:this.bg});this.svgNode.fitParent();var a=jQuery(window);a.on(ludo.util._ub5(),this.dragPiece.bind(this));a.on(ludo.util._uE7(),this._uN9.bind(this));this.bg.on(ludo.util._uW3(),this._uO9.bind(this));this.bg.hide()},dragPiece:function(a){this.board.dragPiece(a)},_uN9:function(a){this.board._uN9(a)},resize:function(){var a=this.bg.width();this.svgNode.fitParent();jQuery.each(this.pool,function(b,c){c.el.showArrow(c.from,c.to,a,this.board.flipped)}.bind(this))},show:function(d,c,a){a=Object.merge(this.arrowStyles,a);this.bg.show();var b=this.getArrow();b.from=d;b.to=c;b.color=a.fill;this.pool.push(b);b.el.show();b.el.showArrow(d,c,this.bg.width(),this.board.flipped);b.el.css(a);return b},update:function(b,a){if(!a){return}b.to=a;b.el.showArrow(b.from,a,this.bg.width(),this.board.flipped)},removeArrow:function(b){var a=this.pool.indexOf(b);if(a>=0){this.pool.splice(a,1)}a=this.hiddenPool.indexOf(b);if(a===-1){this.hiddenPool.push(b)}},hideAll:function(){jQuery.each(this.pool,function(a,b){this.hiddenPool.push(b);b.el.hide()}.bind(this));this.pool=[];this.bg.hide();return this},getArrow:function(){if(this.hiddenPool.length>0){return this.hiddenPool.pop()}else{if(this.single&&this.pool.length>0){return this.pool[0]}}var a=new chess.view.board.ArrowNode();this.svgNode.append(a);return{el:a}},_uO9:function(g){if(this.board.ddEnabled){var j=this.board.getBoard().offset();var f=ludo.util.pageXY(g);var h={x:f.pageX-j.left,y:f.pageY-j.top};var a=this.board._u0a();h.x-=(h.x%a);h.y-=(h.y%a);var d=_uP6._uI1[this.board._u11(h.x,h.y)];var b=this.board._uY4(d);if(b){return b._uO9(g)}}},toString:function(){var b=[];var a="";this.pool.sort(function(d,c){return d.color<c.color?1:-1});this.pool.forEach(function(d){var c=d.from+d.to;if(d.color!==a){a=d.color;c+=";"+d.color}b.push(c)});return b.join(",")}});chess.view.board.ArrowNode=new Class({Extends:ludo.svg.Node,_fromSquare:undefined,_toSquare:undefined,_bs:undefined,_flip:undefined,initialize:function(a){this.parent("path",a)},showArrow:function(b,a,c,d){this._fromSquare=b;this._toSquare=a;this._bs=c;this._flip=d;this._update()},setTo:function(a){this._toSquare=a;this._update()},_update:function(){this.set("d",chess.util.CoordinateUtil.arrowPath(this._fromSquare,this._toSquare,{},this._bs,this._flip))}});chess.view.highlight.SquarePool=new Class({type:"chess.view.board.HighlightPool",Extends:Events,bg:undefined,items:undefined,hiddenItems:undefined,visibleItems:undefined,files:["a","b","c","d","e","f","g","h"],map:undefined,colorMap:undefined,onlySingles:false,autoToggle:false,circular:false,initialize:function(a){this.bg=a.board.hitArea();this.board=a.board;if(a.opacity!==undefined){this.opacity=a.opacity}if(a.onlySingles!==undefined){this.onlySingles=a.onlySingles}if(a.autoToggle!==undefined){this.autoToggle=a.autoToggle}if(a.circular!==undefined){this.circular=a.circular}this.board.on("flip",this.flip.bind(this));this.items=[];this.hiddenItems=[];this.visibleItems=[];this.map={};this.colorMap={}},hideAll:function(){while(this.visibleItems.length>0){var a=this.visibleItems.pop();this._hide(a)}return this},toggle:function(b,a){if(this.isShown(b)){this.hide(b)}else{this.show(b,a)}},toString:function(){var c=[];var a=[];this.visibleItems.forEach(function(f){var d=f.square;a.push({square:d,color:this.colorMap[d]})}.bind(this));a.sort(function(f,d){return f.color<d.color?1:-1});var b="";a.forEach(function(d){var f=d.square;if(d.color!==b){b=d.color;f+=";"+b}c.push(f)});return c.join(",")},lastSquare:undefined,lastBgColor:function(){if(this.lastSquare){var a=this.lastSquare.el;return this.circular?a.css("border-color"):a.css("background-color")}},show:function(d,a){var f=this.isShown(d);if(f&&this.autoToggle){var b=this.colorMap[d]===a;this.hide(d);if(b){return}}if(this.onlySingles&&f){if(a){if(this.circular){this.map[d][0].el.css("border","5px solid "+a)}else{this.map[d][0].el.css("background-color",a)}}return}var c=this.getSquare();this.visibleItems.push(c);if(this.map[d]===undefined){this.map[d]=[]}this.map[d].push(c);this.colorMap[d]=a;var g=this.posBySquare(d);c.el.css({left:g.x,top:g.y});if(a){if(this.circular){c.el.css("border","5px solid "+a);c.el.css("background-color","transparent")
}else{c.el.css("background-color",a)}}c.el.show();c.square=d;this.lastSquare=c;return this},isShown:function(a){return(this.map[a]&&this.map[a].length>0)},hide:function(c){if(this.map[c]){while(this.map[c].length>0){var b=this.map[c].pop();var a=this.visibleItems.indexOf(b);if(a>=0){this.visibleItems.splice(a,1)}this._hide(b);this.colorMap[c]=undefined}}},_hide:function(a){a.el.hide();this.hiddenItems.push(a);var b=this.map[a.square].indexOf(a);if(b>=0){this.map[a.square].splice(b,1)}},posBySquare:function(d){var c=d.substr(0,1);var b=8-d.substr(1,1);var a=this.files.indexOf(c);var g=b;if(this.board.isFlipped()){a=7-a;g=7-g}return{x:(a*12.5)+"%",y:(g*12.5)+"%"}},getSquare:function(){if(this.hiddenItems.length>0){return this.hiddenItems.pop()}var a=jQuery('<div class="dhtml-chess-highlight-square" style="box-sizing:border-box !important;position:absolute;width:12.5%;height:12.5%"></div>');this.bg.append(a);if(this.circular){a.css("border-radius",999)}var b={square:undefined,el:a};this.items.push(b);return b},flip:function(){jQuery.each(this.visibleItems,function(a,b){var c=this.posBySquare(b.square);b.el.css({left:c.x,top:c.y})}.bind(this))},getSquares:function(){var a=[];jQuery.each(this.visibleItems,function(b,c){a.push(c.square)});return a}});chess.view.buttonbar.Bar=new Class({Extends:ludo.View,type:"chess.view.buttonbar.Bar",module:"chess",submodule:"buttonbar.bar",buttons:["start","previous","play","next","end","flip"],styles:undefined,_uWd:undefined,borderRadius:"8%",spacing:10,background:undefined,_uGc:undefined,buttonDown:undefined,disabledButtons:undefined,isAtEndOfBranch:false,defaultStyles:undefined,overlay:undefined,anchor:undefined,pr:undefined,comp:false,_ukd:function(a){this.pr=String.uniqueID();this.parent(a);this.anchor=[0.5,0];this._uWf(a,["name","buttonSize","background","buttons","styles","spacing","anchor","imageStyles","imageStylesDown","imageStylesDisabled","imageStylesOver","borderRadius"]);this.disabledButtons=[];this.defaultStyles={button:{stroke:"#888",fill:"#aeb0b0","stroke-width":1,"fill-opacity":1},image:{fill:"#444"},buttonOver:{stroke:"#777",fill:"#aeb0b0","stroke-width":1},imageOver:{fill:"#222"},buttonDown:{stroke:"#555",fill:"#999","stroke-width":1},imageDown:{fill:"#222"},buttonDisabled:{stroke:"#888",fill:"#aeb0b0","stroke-width":1},imageDisabled:{fill:"#444","fill-opacity":0.4,"stroke-opacity":0.2},buttonPlay:{stroke:"#C8E6C9",fill:"#388E3C","stroke-width":1},imagePlay:{fill:"#C8E6C9"},imageComp:{fill:"#388E3C"},overlay:{"fill-opacity":0,fill:"#000"}};this.styles=this.styles||{};var b=this.styles;var c=this.defaultStyles;b.button=Object.merge(c.button,b.button||{});b.buttonOver=Object.merge(c.buttonOver,b.buttonOver||{});b.buttonDown=Object.merge(c.buttonDown,b.buttonDown||{});b.buttonDisabled=Object.merge(c.buttonDisabled,b.buttonDisabled||{});b.buttonPlay=Object.merge(c.buttonPlay,b.buttonPlay||{});b.buttonComp=Object.merge(c.button,b.button||{});b.image=Object.merge(c.image,b.image||{});b.imageOver=Object.merge(c.imageOver,b.imageOver||{});b.imageDown=Object.merge(c.imageDown,b.imageDown||{});b.imageDisabled=Object.merge(c.imageDisabled,b.imageDisabled||{});b.imagePlay=Object.merge(c.imagePlay,b.imagePlay||{});b.imageComp=Object.merge(c.imageComp,b.imageComp||{});b.overlay=Object.merge(this.defaultStyles.overlay,b.overlay||{});jQuery(document.documentElement).on("mouseup",this.onMouseUp.bind(this))},__ucf:function(){this.parent();this.$b().css("overflow","hidden");this.createStylesheets();this.$b().on("mousedown",function(){return false});if(this.background){this.bg=new chess.view.board.Background(Object.merge({view:this,square:false},this.background))}this.els.buttons={};this.els._u6d={};this.els._u9d={};this.els._uRf={};this.els.clipRects={};jQuery.each(this.buttons,function(b,a){if(a!=="pause"){this.createButton(a);if(a!=="flip"&&a!=="comp"){this._uwa(a)}}}.bind(this))},createStylesheets:function(){var a=this.svg();jQuery.each(this.styles,function(b,c){a.addStyleSheet(this.pr+"dc-"+b,c)}.bind(this))},createButton:function(a){var b=this.svg();var j=b.$("clipPath");var f=b.$("rect");j.append(f);b.appendDef(j);this.els.clipRects[a]=f;var d=b.$("g");d.attr("data-name",a);d.attr("aria-label",a);d.attr("title",a);d.css("cursor","pointer");d.set("x",0);d.set("y",0);b.append(d);this.els.buttons[a]=d;var c=b.$("rect");c.addClass(this.pr+"dc-button");this.els._u6d[a]=c;d.append(c);var k=b.$("path");k.css(this.styles.overlay);k.clip(j);this.els._uRf[a]=k;d.append(k);var h=b.$("path");h.set("line-join","round");h.set("line-cap","round");h.set("fill-rule","even-odd");this.els._u9d[a]=h;h.addClass(this.pr+"dc-image");d.append(h);d.on("mouseenter",this.fn("_uxd",a));d.on("mouseleave",this.fn("_uzd",a));d.on("mousedown",this.fn("downButton",a));d.on("click",this.fn("clickButton",a))},fn:function(c,b){var a=this;return function(){a[c].call(a,b)}},_uxd:function(a){if(!this.isDisabled(a)){this._uyf(a,"Over")}},_uzd:function(a){if(!this.isDisabled(a)){this._uyf(a,"")}},downButton:function(a){if(!this.isDisabled(a)){this._uyf(a,"Down");
this.buttonDown=a}},isDisabled:function(a){return this.disabledButtons.indexOf(a)>=0},onMouseUp:function(){if(this.buttonDown){var a=this.buttonDown;this.els._u6d[a].removeClass(this.pr+"dc-buttonDown");this.els._u9d[a].removeClass(this.pr+"dc-imageDown");this.buttonDown=undefined}},clickButton:function(a){if(!this.isDisabled(a)){this._uyf(a,"");if(a==="play"&&this.autoPlayMode){a="pause"}this._uif(a);if(a==="comp"){this.comp=!this.comp;this._uyf("comp","Comp")}return false}return false},_ua1:function(){var a=this._uoe.compMode?0:1;jQuery.each(this.buttons,function(c,b){if(b!=="comp"&&b!=="flip"){this.els.buttons[b].css({opacity:a})}}.bind(this))},_uyf:function(a,b){if(this.buttons.indexOf(a)===-1){return}if(a==="play"&&this.autoPlayMode){b="Play"}if(a==="comp"&&this._uoe.compMode){b="Comp"}if(this.isDisabled(a)){b="Disabled"}var c=this.els._u6d[a];var d=this.els._u9d[a];c.removeAllClasses();d.removeAllClasses();c.addClass(this.pr+"dc-button"+b);d.addClass(this.pr+"dc-image"+b)},resize:function(a){this.parent(a);this.resizeBar();this._uif("boardResized",{left:0,top:0,width:this.svg().width,height:this.svg().height})},btnSize:undefined,resizeBar:function(){var a=this.svg();this._uWd=a.width>a.height?"horizontal":"vertical";this.size=Math.min(a.width,a.height);if(this._uWd==="horizontal"){this._uP4()}else{this.resizeVertical()}var b=this.getButtonRadius();jQuery.each(this.els._u6d,function(c,d){d.css({rx:b,ry:b})})},overlayPath:function(h){var g=h.y+(h.height*0.55);var a=h.y+h.height;var d=h.x+h.width;var f=h.height*0.05;return["M",h.x,g,"a",h.width,h.height,90,0,1,h.width/2,-f,"a",h.width,h.height,90,0,1,h.width/2,f,"L",d,a,h.x,a,"Z"].join(" ")},getButtonRadius:function(){var a=this.borderRadius;if(isNaN(a)){var a=parseFloat(a);a=Math.min(50,a);return this.btnSize*a/100}return Math.min(this.btnSize/2,a)},_uP4:function(){var c=this.svg();this.btnSize=this.buttonSize(c.height);var b=this.totalSize();var g=(c.width-b)*this.anchor[0];var f=(c.height-this.btnSize)*this.anchor[1];var h=this.btnSize+this.getSpacing();var a={x:0,y:0,width:this.btnSize,height:this.btnSize};var d=this.overlayPath(a);jQuery.each(this.els.buttons,function(j,k){k.setTranslate(g,f);this.els._u6d[j].setAttributes(a);this.els.clipRects[j].setAttributes(a);this.els._uRf[j].set("d",d);this.els._u9d[j].set("d",this.getPath(j).join(" "));this.els._u6d[j].set("title","Testing");g+=h}.bind(this))},toPath:function(j){var k=this.btnSize;var f=k*0.65;var a=k*0.55;var d=(k-f)/2;var c=(k-a)/2;var h=function(l){return d+(f*l/10)};var g=function(l){return c+(a*l/10)};var b=0;jQuery.each(j,function(l,m){if(!isNaN(m)){j[l]=b%2==0?h(m):g(m);b++}else{b=0}});return j},boardPath:function(){var l=9;var k=6;var h=l/k;var b=0;var j=[];for(var a=0;a<k;a++){for(var d=0;d<k;d++){if(b++%2===1){var g=d*h;var f=a*h;j.push("M",g,f);j.push("L",g+h,f);j.push("L",g+h,f+h);j.push("L",g,f+h);j.push("Z")}}b++}return j},getPath:function(a){switch(a){case"board":return this.toPath(this.boardPath());case"start":return this.toPath(["M",0,0,"L",0,10,2,10,2,0,"Z","M",2.5,5,"L",6,1.5,6,3.5,10,3.5,10,6.5,6,6.5,6,8.5,2.5,5,"Z"]);case"pause":return this.toPath(["M",2,1,"L",2,9,4,9,4,1,"Z","M",6,1,"L",6,9,8,9,8,1,"Z"]);case"previous":return this.toPath(["M",0,5,"L",4,1,4,3,9,3,9,7,4,7,4,9,"Z"]);case"enter":return this.toPath(["M",5.5,1.5,"L",9,1.5,9,7,4,7,4,9,1,6,4,3,4,5,7,5,7,3.5,5.5,3.5,"Z"]);case"play":return this.toPath(["M",3,1,"L",8,5,3,9,"Z"]);case"next":return this.toPath(["M",1,3,"L",5,3,5,1,9,5,5,9,5,7,1,7,"Z"]);case"end":return this.toPath(["M",0,3.5,"L",4,3.5,4,1.5,7,5,4,8.5,4,6.5,0,6.5,"Z","M",7.8,0.5,"L",9.8,0.5,9.9,9.5,7.9,9.5]);case"flip":return this.toPath(["M",2.75,0,"L",0.5,3.5,2,3.5,2,9.5,3.5,9.5,3.5,3.5,5,3.5,"Z","M",6,0,"L",6,6,4.5,6,6.75,9.5,9,6,7.5,6,7.5,0,"Z"]);case"comp":return this.toPath(["M",1,1,"L",9,1,9,7,1,7,"M",4,7,"L",6,7,6,8,4,8,4,7,"M",1,8,"L",9,8,9,9,1,9,1,8]);default:return this.toPath(["M",0,0,"L",10,0,10,10,0,10,"Z"])}},resizeVertical:function(){},totalSize:function(){return(this.btnSize*this.buttons.length)+(this.getSpacing()*(this.buttons.length-1))},getSpacing:function(){return this.btnSize*this.spacing/100},_uv9:function(a){this.parent(a);this._uoe._uBf({_uwd:this._uwd.bind(this),_uv8:this._uV4.bind(this),_u8d:this._u8d.bind(this),_ux8:this._ux8.bind(this),_u3a:this._u5a.bind(this),stopAutoplay:this.stopAutoPlay.bind(this),newGame:this.newGame.bind(this),comp:this._ua1.bind(this)})},_uwd:function(){if(this._uoe.compMode){return}this.disButtons(["start","previous"])},_uV4:function(){if(this._uoe.compMode){return}this.enButtons(["start","previous","play"])},_u8d:function(){if(this._uoe.compMode){return}this.disButtons(["end","next","play"]);this.isAtEndOfBranch=true;this.autoPlayMode=false},disButtons:function(a){jQuery.each(a,function(c,b){this._uwa(b)}.bind(this))},enButtons:function(a){jQuery.each(a,function(c,b){this._uOb(b)}.bind(this))},_ux8:function(a){this.isAtEndOfBranch=false;this.enButtons(["end","next"]);if(a&&!a.isInAutoPlayMode()){this.stopAutoPlay();
this._uOb("play")}},autoPlayMode:false,_u5a:function(){if(this.els._u9d.play){this.els._u9d.play.set("d",this.getPath("pause").join(" "))}this._uOb("play");this._uyf("play","Play");this.autoPlayMode=true},stopAutoPlay:function(){if(!this.hasButton("play")){return}this.els._u9d.play.set("d",this.getPath("play").join(" "));if(!this.autoPlayMode){return}this.autoPlayMode=false;this._uyf("play","");if(this.isAtEndOfBranch){this._uwa("play")}},hasButton:function(a){return this.buttons.indexOf(a)!=-1},newGame:function(){},_uwa:function(a){if(!this.hasButton(a)){return}if(!this.isDisabled(a)){this.disabledButtons.push(a);this._uyf(a,"Disabled");this.els._uRf[a].hide()}},_uOb:function(a){if(!this.hasButton(a)){return}if(this.isDisabled(a)){var b=this.disabledButtons.indexOf(a);this.disabledButtons.splice(b,1);this._uyf(a,"");this.els._uRf[a].show()}},buttonSize:function(a){return a*0.9}});chess.view.gamelist.Grid=new Class({Extends:ludo.grid.Grid,type:"chess.view.gamelist.Grid",module:"chess",submodule:"gameList",titleBar:false,_une:{type:"chess._une.GameList",shim:{txt:"Loading games. Please wait"}},resizable:false,statusBar:false,fillview:true,headerMenu:false,cols:undefined,columns:{white:{heading:"White",key:"white",width:120,sortable:true,_uHf:function(a){return a!=undefined?a:""}},black:{heading:"Black",key:"black",width:120,sortable:true,_uHf:function(a){return a!=undefined?a:""}},round:{heading:"Round",key:"round",width:70,sortable:true,_uHf:function(a){return a!=undefined?a:""}},result:{heading:"Result",key:"result",width:70,sortable:true,removable:true,_uHf:function(a){return a!=undefined?a:""}},event:{heading:"Event",key:"event",weight:1,sortable:true,removable:true,_uHf:function(a){return a!=undefined?a:""}},last_moves:{heading:"Last moves",key:"last_moves",weight:1,sortable:true,removable:true,_uHf:function(a){return a!=undefined?a:""}}},databaseId:undefined,_uv9:function(a){this.parent(a);var b=this._up9();a.on("_uH7",this._uH7.bind(this));a.on("_uSf",b.next.bind(b));a.on("_uKc",b.previous.bind(b));a.on("_uzf",this._uzf.bind(this));a.on("gameSaved",this._ure.bind(this))},_ure:function(a){if(a.databaseId){this._uH7({id:a.databaseId})}},_uH7:function(a){this.loadGames(a.id)},_uzf:function(b){var a=this._up9().postData.resource;this._up9().postData.arguments=b;this._up9()._u1e({resource:a,service:"listOfGames",arguments:b})},_ukd:function(a){this.parent(a);this.databaseId=a.databaseId||this.databaseId;jQuery.each(this.columns,function(f,d){d.heading=chess.__(d.heading)});var c=a.cols||this.cols;if(c){this._uxfManager()._uF7();for(var b=0;b<c.length;b++){this._uxfManager()._uJe(c[b])}}},_use:function(){this.parent();this._up9().addEvent("select",this._uKe.bind(this))},__ucf:function(){this.parent();if(this.databaseId){this.loadGames(this.databaseId)}},loadGames:function(a){this.databaseId=a;this._up9()._u1e("games",a)},_uKe:function(a){if(a.gameIndex!==undefined){this._uif("_uKe",[a,this._up9()._uMa()])}else{this._uif("_uKe",a)}}});chess.view.metadata.Game=new Class({Extends:ludo.View,type:"chess.view.metadata.Game",module:"chess",submodule:"metadata.Game",tpl:"",overflow:"hidden",_ukd:function(a){this.parent(a);this.tpl=a.tpl||this.tpl},_uv9:function(a){this._uoe=a;a.on("newGame",this._u08.bind(this))},__ucf:function(){this.parent()},_u08:function(a){var d=a.getMetadata();if(jQuery.isFunction(this.tpl)){this.$b().html(this.tpl.call(this,d));return}var g=this.getTplKeys();var c=this.tpl;var f;for(var b=0;b<g.length;b++){if(d[g[b]]){f=d[g[b]]}else{f=""}c=c.replace("{"+g[b]+"}",f)}this.$b().html(c)},getTplKeys:function(){var b=this.tpl.match(/{([a-z]+?)\}/g);for(var a=0;a<b.length;a++){b[a]=b[a].replace(/[{}]/g,"")}return b}});chess.view.metadata.Move=new Class({Extends:ludo.View,type:"chess.view.metadata.Move",module:"chess",submodule:"metadata.Move",tpl:"",_ukd:function(a){this.parent(a);this.tpl=a.tpl||this.tpl},_uv9:function(a){this._uoe=a;a.on("_u0d",this._u08.bind(this));a.on("nextmove",this._u08.bind(this));a.on("newMove",this._u08.bind(this));a.on("newGame",this._u08.bind(this))},__ucf:function(){this.parent()},_u08:function(a){var d=a._uz8()||"";var g=this.getTplKeys();var c=this.tpl;var f;for(var b=0;b<g.length;b++){if(d[g[b]]){f=d[g[b]]}else{f=""}c=c.replace("{"+g[b]+"}",f)}this.$b().html(c)},getTplKeys:function(){var b=this.tpl.match(/{([a-z]+?)\}/g);for(var a=0;a<b.length;a++){b[a]=b[a].replace(/[{}]/g,"")}return b}});chess.view.metadata.FenField=new Class({Extends:ludo.form.Text,type:"chess.view.metadata.FenField",module:"chess",submodule:"metadata.FenField",stretchField:true,label:chess.__("FEN"),formCss:{"font-size":"10px"},labelWidth:30,_uv9:function(a){this.parent(a);a.on("newGame",this._u0g.bind(this));a.on("_u0d",this._u0g.bind(this));a.on("newMove",this._u0g.bind(this));a.on("nextmove",this._u0g.bind(this))},_u0g:function(b){var a=b._uT2();this._set(a)}});chess.view.message._uj8=new Class({Extends:ludo.View,type:"chess.view.message._uj8",module:"chess",submodule:"_uj8",_uE6:3000,_u41:0,showIntro:true,_ukd:function(a){this.parent(a);
this._uWf(a,["showIntro","_uE6","_u41"])},_uZf:function(){this.parent();this.$e.addClass("dhtml-chess-tactics-message")},_uv9:function(a){this.parent(a);a.on("wrongGuess",this._ul8.bind(this));a.on("correctGuess",this._u06.bind(this));a.on("loadGame",this.newGame.bind(this))},newGame:function(a){if(!this.showIntro){return}var f=this._u41;var b=a.getResult();if(b!=0){if(b==-1){this._uVd(chess.__("You play black"),f)}else{this._uVd(chess.__("You play white"),f)}}else{var c=a._uT8();this._uVd(chess.__(c)+" "+chess.__("to move"),f)}},_ul8:function(){this._uVd(chess.__("Wrong move - please try again"),this._uE6)},_u06:function(){},_uVd:function(a,b){this.show();this.$b().animate({opacity:1},{duration:300});this.$b().html(a);if(b){this._uh6.delay(b,this)}},_uh6:function(){this.$b().animate({opacity:0},{duration:500,complete:function(){this.hide()}.bind(this)})}});chess.view.dialog.Dialog=new Class({Extends:ludo.dialog.Dialog,_uwe:function(){if(this._uoe.views.board){this.layout.centerIn=this._uoe.views.board.getEl();this._usf()._uZd().clearFn();this._usf()._uZd().resize()}this.show();if(!this._uoe.views.board){this.center()}}});chess.view.dialog._uVb=new Class({type:"chess.view.dialog._uVb",Extends:ludo.dialog.Confirm,layout:{width:250,height:150},css:{"text-align":"center"},buttonConfig:"OkClose",_ukd:function(a){a.title=a.title||chess.__("Well done - Puzzle complete");a.html=a.html||chess.__("Good job! You have solved this puzzle. Click OK to load next game.");this.parent(a)}});chess.view.dialog.Promote=new Class({Extends:chess.view.dialog.Dialog,module:"chess",submodule:"dialogPromote",layout:{type:"grid",columns:2,rows:2,width:300,height:330},hidden:true,title:"Promote to",pieces:[],move:undefined,autoRemove:false,__children:function(){var a="chess.view.dialog._ulc";return[{type:a,piece:"q",layout:{x:0,y:0}},{type:a,piece:"r",layout:{x:1,y:0}},{type:a,piece:"b",layout:{x:0,y:1}},{type:a,piece:"n",layout:{x:1,y:1}}]},_ukd:function(a){this.parent(a)},_uv9:function(a){this.parent(a);this._uoe.on("verifyPromotion",this._uwe.bind(this))},__ucf:function(){this.parent();for(var a=0;a<this.children.length;a++){this.children[a].addEvent("click",this._usc.bind(this))}},_uTf:function(a){for(var b=0;b<this.children.length;b++){this.children[b]._uTf(a)}},_usc:function(a){this.move.promoteTo=a;this._uif("promote",this.move);this.hide()},_uwe:function(b,a){this.parent();this.move=a;this._uTf(b._uT8())}});chess.view.dialog._ulc=new Class({Extends:ludo.View,type:"chess.view.dialog._ulc",piece:undefined,framed:true,_ukd:function(a){this.parent(a);this.piece=a.piece},__ucf:function(){this.parent();this.$e.addClass("dhtml-chess-promote-piece");this.$e.on("click",this._usc.bind(this))},_uTf:function(a){var c=this.$e;var b=this.piece;c.removeClass("dhtml-chess-promote-white-"+b);c.removeClass("dhtml-chess-promote-black-"+b);c.addClass("dhtml-chess-promote-"+a+"-"+b)},_usc:function(){this._uif("click",this.piece)}});chess.view.dialog.Comment=new Class({Extends:chess.view.dialog.Dialog,module:"chess",submodule:"dialogComment",layout:"rows",width:300,height:330,hidden:true,title:chess.__("Add comment"),move:undefined,autoRemove:false,buttonConfig:"OkCancel",commentPos:undefined,css:{padding:0},children:[{type:"form.Textarea",name:"comment",weight:1,css:{padding:0}}],_uv9:function(a){this.parent(a);this._uoe.addEvent("_uLc",this._uLc.bind(this));this._uoe.addEvent("_uBa",this._uBa.bind(this))},_use:function(){this.parent();this.addEvent("ok",this.sendComment.bind(this))},__ucf:function(){this.parent()},sendComment:function(){var a=this.commentPos=="before"?"_uBa":"_uLc";var b=this.child.comment.getValue().trim();this._uif(a,[b,this.move])},_uBa:function(b,a){this.commentPos="before";this._uwe(b,a)},_uLc:function(b,a){this.commentPos="after";this._uwe(b,a)},_uwe:function(b,a){this.parent();this.move=b.getMove(a);var c=this.commentPos=="before"?b._uO4(this.move):b._ub6(this.move);this.child.comment.setValue(c);this._uUf(this._uo8())},_uo8:function(){return chess.__(this.commentPos=="before"?"_ur5":"_uO6")+" ("+this.move.lm+")"}});chess.view.button.TacticHint=new Class({Extends:ludo.form.Button,type:"chess.view.button.TacticHint",module:"chess",submodule:"buttonTacticHint",value:chess.__("Hint"),width:80,_use:function(){this.parent();this.addEvent("click",this.showHint.bind(this))},showHint:function(){this._uif("showHint")}});chess.view.button.TacticSolution=new Class({Extends:ludo.form.Button,type:"chess.view.button.TacticSolution",module:"chess",submodule:"buttonTacticSolution",value:chess.__("Solution"),width:80,_use:function(){this.parent();this.addEvent("click",this._ufc.bind(this))},_ufc:function(){this._uif("_ufc")}});chess.view.button.NextGame=new Class({Extends:ludo.form.Button,type:"chess.view.button.NextGame",module:"chess",submodule:"buttonNextGame",value:">",width:30,_use:function(){this.parent();this.addEvent("click",this._uSf.bind(this))},_uSf:function(){this._uif("_uSf")}});chess.view.button.PreviousGame=new Class({Extends:ludo.form.Button,type:"chess.view.button.NextGame",module:"chess",submodule:"buttonPreviousGame",value:"<",width:30,_use:function(){this.parent();
this.addEvent("click",this._uKc.bind(this))},_uKc:function(){this._uif("_uKc")}});if(chess.view.pgn===undefined){chess.view.pgn={}}chess.view.pgn.Grid=new Class({Extends:ludo.grid.Grid,type:"chess.view.gamelist.Grid",module:"chess",submodule:"list-of-pgn-files",titleBar:false,_une:{type:"chess._une.PgnList"},resizable:false,statusBar:false,fillview:true,columns:{file:{heading:chess.__("Pgn files"),key:"file",width:120,sortable:true}},databaseId:undefined,_uv9:function(a){this.parent(a)},_ukd:function(a){this.parent(a);this.databaseId=a.databaseId||this.databaseId;if(a.cols){this._uxfManager()._uF7();for(var b=0;b<a.cols.length;b++){this._uxfManager()._uJe(a.cols[b])}}},_use:function(){this.parent();this._up9().on("select",this._uzfFile.bind(this))},loadGames:function(a){this.databaseId=a;this._up9()._u1e("games",a)},_uzfFile:function(a){this._uif("_uzf",a.file)}});chess.view.score.Bar=new Class({Extends:ludo.View,submodule:"score.Bar",borderRadius:undefined,_ukd:function(a){this.parent(a);this._uWf(a,["borderRadius","whiteColor","blackColor","markerColor","markerTextColor","stroke","range"]);this.layout.type="Canvas"},__children:function(){return[{name:"scoreBar",type:"chess.view.score.BarBackground",layout:{height:"matchParent",width:"matchParent"},borderRadius:this.borderRadius,whiteColor:this.whiteColor,blackColor:this.blackColor,markerColor:this.markerColor,markerTextColor:this.markerTextColor,stroke:this.stroke,range:this.range}]},setScore:function(a){this.child.scoreBar.setScore(a)}});chess.view.score.BarBackground=new Class({Extends:ludo.svg.Group,range:3,backgroundB:undefined,backgroundW:undefined,markerGroup:undefined,marker:undefined,textNode:undefined,borderRadius:undefined,score:0,scoreRectGroups:undefined,scoreRects:undefined,scoreRectTexts:undefined,strokeRect:undefined,debugCircle:undefined,whiteColor:"#d2d2d2",blackColor:"#333333",markerColor:"#B71C1C",markerTextColor:"#FFFFFF",stroke:"#ddd",_ukd:function(a){this.parent(a);this._uWf(a,["borderRadius","whiteColor","blackColor","markerColor","markerTextColor","stroke","range"])},__ucf:function(){this.backgroundW=this.$("path");this.backgroundW.css("fill",this.whiteColor);this.append(this.backgroundW);this.backgroundB=this.$("path");this.backgroundB.css("fill",this.blackColor);this.append(this.backgroundB);this.createScoreRects();this.markerGroup=this.$("g");this.append(this.markerGroup);this.marker=this.$("path");this.markerGroup.append(this.marker);this.marker.css("fill",this.markerColor);this.textNode=this.$("text");this.textNode.set("text-anchor","middle");this.textNode.text("0,0");this.textNode.css("fill",this.markerTextColor);this.markerGroup.append(this.textNode);this.textNode.attr("alignment-baseline","central");this.strokeRect=this.$("path");this.strokeRect.css("fill-opacity",0);this.strokeRect.css("stroke",this.stroke);this.append(this.strokeRect);this.markerGroup.toFront();this.resizeItems();this.updateScore()},createScoreRects:function(){var c=new ludo.color.Color();this.scoreRects=[];this.scoreRectGroups=[];this.scoreRectTexts=[];var p=this.scoreArea();var o=c.offsetBrightness(this.whiteColor,-(this.range*15));var b=this.range;var l=this.scoreAreaStart();var q=this.blackColor;for(var d=0;d<this.range*2;d++){if(d==this.range){o=c.offsetBrightness(this.blackColor,(this.range*10));q=this.whiteColor}var k=d%this.range;var m=d>=this.range?this.range-1-k:k;m=(m/this.range)/(this.range/3);var j=this.$("g");this.append(j);var f=(this.height/2)-(this.height*d/24);var a=this.$("rect",{x:0,y:0,height:f,width:p/(this.range*2)});a.css("fill-opacity",m);a.css("fill",o);j.append(a);var n=this.$("text");n.set("text-anchor",d<this.range?"start":"end");n.set("font-size",this.height/4);n.set("x",p/6);n.css("fill",q);n.attr("alignment-baseline","after-edge");n.text(b);j.append(n);this.scoreRectGroups.push(j);this.scoreRects.push(a);this.scoreRectTexts.push(n);j.setTranslate(l,0);l+=p/6;b--;if(b==0){b=-1}}this.scoreRectGroups[2].toFront();this.scoreRectGroups[3].toFront();this.scoreRectGroups[5].toFront();this.scoreRectGroups[4].toFront()},resizeRects:function(){var k=this.scoreArea();var a=this.scoreAreaStart();var c=this.scoreRectWidth();var b=k/2;var g=(this.range*2);for(var f=0;f<this.range*2;f++){var d=f%this.range;if(f==this.range){b=k/g}if(f>=this.range){d=this.range-1-d}var j=(c)-(this.height*d/g);b=Math.max(b,10);j=Math.max(j,10);this.scoreRectGroups[f].setTranslate(a,c-j);this.scoreRects[f].set("width",b);this.scoreRects[f].set("height",j);this.scoreRectTexts[f].set("x",f>=this.range?b-2:2);this.scoreRectTexts[f].set("y",j-1);if(f<this.range){b-=k/g;a+=k/g}else{b+=k/g}}},scoreAreaStart:function(){return this.height/2},scoreArea:function(){return this.width-this.height},scoreRectWidth:function(){return this.height*0.7},resize:function(a){this.parent(a);if(this.backgroundB){this.resizeItems()}},xPos:function(){var a=this.scoreArea();var b=ludo.util.clamp(this.score,-this.range,this.range);return(this.width/2)+(-b*a/(this.range*2))},lastScore:undefined,updateScore:function(){if(this.score!==this.lastScore){this.textNode.text(Math.abs(this.score).toFixed(1));
this.markerGroup.animate({translate:[this.xPos(),0]});this.lastScore=this.score}this.updateScore.delay(500,this)},resizeItems:function(){var j=this.width/2;var b=this.scoreRectWidth();var d=this.borderRadius?this.borderRadius:b/2;var a=this.width-d;var g=d;var f=["M",g,0,"L",j,0,j,b,g,b,"A",d,d,0,0,1,0,b-d,"L",0,d,"A",d,d,0,0,1,g,0];this.backgroundW.set("d",f.join(" "));f=["M",j,0,"L",a,0,"A",d,d,0,0,1,this.width,d,"L",this.width,b-d,"A",d,d,0,0,1,a,b,"L",j,b,j,0];this.backgroundB.set("d",f.join(" "));f=["M",g,0,"L",a,0,"A",d,d,0,0,1,this.width,d,"L",this.width,b-d,"A",d,d,0,0,1,a,b,"L",g,b,"A",d,d,0,0,1,0,b-d,"L",0,d,"A",d,d,0,0,1,g,0];this.strokeRect.set("d",f.join(" "));d=b/2;f=["M",0,0,"L",-d/2,d,"A",d,d,0,1,0,d/2,d,"L",0,0];this.marker.set("d",f.join(" "));this.markerGroup.setTranslate(this.xPos(),0);this.textNode.setTranslate(0,(d/2)+this.height/2);this.textNode.css("font-size",d/1.5);this.textNode.css("line-height",d/1.5);this.resizeRects()},setScore:function(a){if(jQuery.type(a)=="string"&&a.indexOf("#")!=-1){a=a.replace(/[^0-9\-]/g,"");a=parseInt(a)*100}a=ludo.util.clamp(a,-100,100);this.score=Math.round(a*10)/10}});chess.action.Handler=new Class({board:undefined,arrowPool:undefined,_uK9:undefined,arrowStyles:{stroke:"#BF360C",fill:"#0288D1"},_uBe:undefined,_ui9:undefined,colors:undefined,initialize:function(a){this.board=a.board;this.colors={R:"#F44336",G:"#4CAF50",B:"#2196F3"};a._uoe.on("clearActions",this.clear.bind(this));a._uoe.on("action",this.receiveAction.bind(this));if(chess.OVERRIDES!==undefined){if(chess.OVERRIDES.arrow_styles_actions!==undefined){var b=chess.OVERRIDES.arrow_styles_actions.split(/;/g);jQuery.each(b,function(c,d){var f=d.split(/:/);this.arrowStyles[f[0]]=f[1]}.bind(this))}if(chess.OVERRIDES.clr_R){this.colors.R=chess.OVERRIDES.clr_R}if(chess.OVERRIDES.clr_G){this.colors.G=chess.OVERRIDES.clr_G}if(chess.OVERRIDES.clr_B){this.colors.B=chess.OVERRIDES.clr_B}}if(a.arrowStyles){this.arrowStyles=Object.merge(this.arrowStyles,a.arrowStyles)}this._uBe={}},clear:function(){if(this._uK9){this._uK9.hideAll()}if(this.arrowPool){this.arrowPool.hideAll()}},receiveAction:function(a,b){switch(b.type){case"highlight":this.highlight(b);break;case"arrow":this.showArrow(b);break;default:}},highlight:function(a){if(this._uK9===undefined){this._uK9=new chess.view.highlight.SquarePool({board:this.board})}this._uK9.show(a.square,a.color||this._ui9);if(a.color){this._ui9=a.color}else{a.color=this._uK9.lastBgColor()}},showArrow:function(c){if(this.arrowPool===undefined){this.arrowPool=new chess.view.highlight.ArrowPool({board:this.board,arrowStyles:this.arrowStyles})}if(c.color){var b=this.toRgb(c.color);this._uBe={fill:b,stroke:b}}else{if(this._uBe&&this._uBe.fill){c.color=this._uBe.fill}else{c.color=this.arrowPool.arrowStyles.fill}}var a=Object.merge(this.arrowStyles,this._uBe);this.arrowPool.show(c.from,c.to,a)},toRgb:function(a){return this.colors[a]?this.colors[a]:a}});chess.util.CoordinateUtil={files:["a","b","c","d","e","f","g","h"],_uj9:function(d,c,f){var a=this._u83(d,c,f);var b=c/16;a.x+=b;a.y+=b;return a},_u83:function(d,c,f){var a={x:this.files.indexOf(d.substr(0,1)),y:8-d.substr(1,1)};if(f){a.x=7-a.x;a.y=7-a.y}var b=(c/8);a.x*=b;a.y*=b;return a},arrowPath:function(s,d,h,g,f){var r={start:this._uj9(s,g,f),end:this._uj9(d,g,f)};if(s===d){return""}r.oposite=r.start.y-r.end.y;r.adjacent=r.end.x-r.start.x;r.hyp=Math.sqrt(r.oposite*r.oposite+r.adjacent*r.adjacent);r.cos=this.getCos(r);r.sin=this.getSin(r);if(r.cos<0&&r.sin>=0){r.angle=Math.acos(r.cos)}else{if(r.cos<0){r.angle=Math.acos(r.cos)*-1}else{r.angle=Math.asin(r.sin)}}var m=g/8;var a=h.lineWidth||m*0.12;var q=h.arrowHeight||m*0.65;var l=h.arrowWidth||m*0.45;var u=h.roundEdgeSize||a/1.5;var p=h.arrowOffset||0.5;var o=h.offsetEnd||m*0;var j=h.offsetStart||m*-0.1;var t=[];var b=Math.cos(r.angle+Math.PI/2);var n=Math.sin(r.angle+Math.PI/2);if(o!=0){r.end.x-=o*Math.cos(r.angle);r.end.y+=o*Math.sin(r.angle)}if(j!=0){r.start.x+=j*Math.cos(r.angle);r.start.y-=j*Math.sin(r.angle)}t.push("M");t.push(r.end.x);t.push(r.end.y);t.push("L");t.push(r.end.x-q*r.cos+(l/2*b));t.push(r.end.y+q*r.sin-(l/2*n));t.push(r.end.x-(q-p)*r.cos+(a/2*b));t.push(r.end.y+(q-p)*r.sin-(a/2*n));t.push(r.start.x+(a/2*b));t.push(r.start.y-(a/2*n));var k="L";if(u>0){t.push("C");t.push(r.start.x-(u*r.cos)+(a/2*b));t.push(r.start.y+(u*r.sin)-(a/2*n));t.push(r.start.x-(u*r.cos)-(a/2*b));t.push(r.start.y+(u*r.sin)+(a/2*n));t.push(r.start.x-(a/2*b));t.push(r.start.y+(a/2*n));k="M"}t.push(k);t.push(r.start.x-(a/2*b));t.push(r.start.y+(a/2*n));t.push("L");t.push(r.end.x-(q-p)*r.cos-(a/2*b));t.push(r.end.y+(q-p)*r.sin+(a/2*n));t.push(r.end.x-q*r.cos-(l/2*b));t.push(r.end.y+q*r.sin+(l/2*n));t.push(r.end.x);t.push(r.end.y);return t.join(" ")},getSin:function(a){return(a.start.y-a.end.y)/a.hyp},getCos:function(a){return(a.end.x-a.start.x)/a.hyp}};chess.sound.Sound=new Class({Extends:ludo.Core,type:"chess.sound.Sound",singleton:true,sounds:{},_ukd:function(a){this.parent(a);this.sounds={capture:["capture1.mp3","capture2.mp3"],move:["move1.mp3","move2.mp3"],castle:["castle1.mp3","castle2.mp3"]};
this._uZb()},add:function(a){a.on("_u84",this._uH9.bind(this))},_uH9:function(b){var a=b._usd;if(a!=undefined&&a.m!=undefined){this.playSound(a.m)}},playSound:function(a){this.getSound(a).play()},getSound:function(b){var c;if(b.indexOf("x")>0){c="capture"}else{if(b.indexOf("O-0")>=0){c="castle"}else{c="move"}}var d=this.sounds[c];var a=d.length;return d[Math.floor(Math.random()*a)]},_uZb:function(){jQuery.each(this.sounds,function(b,a){jQuery.each(a,function(d,f){var c=ludo.config._uC6()+"sound/"+f;this.sounds[b][d]=new Audio(c)}.bind(this))}.bind(this))}});ludo.factory.createAlias("chess.sound.Sound",chess.sound.Sound);_uP6={_u1g:["a1","b1","c1","d1","e1","f1","g1","h1","a2","b2","c2","d2","e2","f2","g2","h2","a3","b3","c3","d3","e3","f3","g3","h3","a4","b4","c4","d4","e4","f4","g4","h4","a5","b5","c5","d5","e5","f5","g5","h5","a6","b6","c6","d6","e6","f6","g6","h6","a7","b7","c7","d7","e7","f7","g7","h7","a8","b8","c8","d8","e8","f8","g8","h8"],_uHe:["a8","b8","c8","d8","e8","f8","g8","h8","a7","b7","c7","d7","e7","f7","g7","h7","a6","b6","c6","d6","e6","f6","g6","h6","a5","b5","c5","d5","e5","f5","g5","h5","a4","b4","c4","d4","e4","f4","g4","h4","a3","b3","c3","d3","e3","f3","g3","h3","a2","b2","c2","d2","e2","f2","g2","h2","a1","b1","c1","d1","e1","f1","g1","h1"],_u34:[112,113,114,115,116,117,118,119,96,97,98,99,100,101,102,103,80,81,82,83,84,85,86,87,64,65,66,67,68,69,70,71,48,49,50,51,52,53,54,55,32,33,34,35,36,37,38,39,16,17,18,19,20,21,22,23,0,1,2,3,4,5,6,7],fenNotations:{white:{p:"P",n:"N",b:"B",r:"R",q:"Q",k:"K"},black:{p:"p",n:"n",b:"b",r:"r",q:"q",k:"k"}},fen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",fenPieces:{p:"blackPawns",b:"blackBishops",n:"blackKnights",r:"blackRooks",q:"blackQueens",k:"blackKing",P:"whitePawns",B:"whiteBishops",N:"whiteKnights",R:"whiteRooks",Q:"whiteQueens",K:"whiteKing"},_uU2:{w:"white",b:"black"},_u99:{white:"black",black:"white"},mapping:{a1:0,b1:1,c1:2,d1:3,e1:4,f1:5,g1:6,h1:7,a2:16,b2:17,c2:18,d2:19,e2:20,f2:21,g2:22,h2:23,a3:32,b3:33,c3:34,d3:35,e3:36,f3:37,g3:38,h3:39,a4:48,b4:49,c4:50,d4:51,e4:52,f4:53,g4:54,h4:55,a5:64,b5:65,c5:66,d5:67,e5:68,f5:69,g5:70,h5:71,a6:80,b6:81,c6:82,d6:83,e6:84,f6:85,g6:86,h6:87,a7:96,b7:97,c7:98,d7:99,e7:100,f7:101,g7:102,h7:103,a8:112,b8:113,c8:114,d8:115,e8:116,f8:117,g8:118,h8:119},_uI1:{"0":"a1","1":"b1","2":"c1","3":"d1","4":"e1","5":"f1","6":"g1","7":"h1","16":"a2","17":"b2","18":"c2","19":"d2","20":"e2","21":"f2","22":"g2","23":"h2","32":"a3","33":"b3","34":"c3","35":"d3","36":"e3","37":"f3","38":"g3","39":"h3","48":"a4","49":"b4","50":"c4","51":"d4","52":"e4","53":"f4","54":"g4","55":"h4","64":"a5","65":"b5","66":"c5","67":"d5","68":"e5","69":"f5","70":"g5","71":"h5","80":"a6","81":"b6","82":"c6","83":"d6","84":"e6","85":"f6","86":"g6","87":"h6","96":"a7","97":"b7","98":"c7","99":"d7","100":"e7","101":"f7","102":"g7","103":"h7","112":"a8","113":"b8","114":"c8","115":"d8","116":"e8","117":"f8","118":"g8","119":"h8"},_ug8:{"0":0,"1":1,"2":2,"3":3,"4":4,"5":5,"6":6,"7":7,"8":16,"9":17,"10":18,"11":19,"12":20,"13":21,"14":22,"15":23,"16":32,"17":33,"18":34,"19":35,"20":36,"21":37,"22":38,"23":39,"24":48,"25":49,"26":50,"27":51,"28":52,"29":53,"30":54,"31":55,"32":64,"33":65,"34":66,"35":67,"36":68,"37":69,"38":70,"39":71,"40":80,"41":81,"42":82,"43":83,"44":84,"45":85,"46":86,"47":87,"48":96,"49":97,"50":98,"51":99,"52":100,"53":101,"54":102,"55":103,"56":112,"57":113,"58":114,"59":115,"60":116,"61":117,"62":118,"63":119},pieces:{P:1,N:2,K:3,B:5,R:6,Q:7,p:9,n:10,k:11,b:13,r:14,q:15},_uYfping:{1:"P",2:"N",3:"K",5:"B",6:"R",7:"Q",9:"p",10:"n",11:"k",13:"b",14:"r",15:"q"},_uQc:{1:1,2:3,3:100,5:3,6:5,7:9,9:1,10:3,11:100,13:3,14:5,15:9},_udf:{Q:"q",R:"r",N:"n",B:"b"},_uSc:{1:"p",2:"n",3:"k",5:"b",6:"r",7:"q",9:"p",10:"n",11:"k",13:"b",14:"r",15:"q"},_uu7:{1:"",2:"N",3:"K",5:"B",6:"R",7:"Q",9:"",10:"N",11:"K",13:"B",14:"R",15:"Q"},_uP1:{1:"white",2:"white",3:"white",5:"white",6:"white",7:"white",9:"black",10:"black",11:"black",13:"black",14:"black",15:"black"},_uy2:{p:1,n:2,N:2,k:3,b:5,B:5,r:6,R:6,q:7,Q:7},_uHc:{p:"black",n:"black",b:"black",r:"black",q:"black",k:"black",P:"white",N:"white",B:"white",R:"white",Q:"white",K:"white"},castle:{"-":0,K:8,Q:4,k:2,q:1},_uL9:{0:"-",1:"q",2:"k",3:"kq",4:"Q",5:"Qq",6:"Qk",7:"Qkq",8:"K",9:"Kq",10:"Kk",11:"Kkq",12:"KQ",13:"KQq",14:"KQk",15:"KQkq"},_ux1:{"-":0,q:1,k:2,kq:3,Q:4,Qq:5,Qk:6,Qkq:7,K:8,Kq:9,Kk:10,Kkq:11,KQ:12,KQq:13,KQk:14,KQkq:15},numbers:{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":0},_uub:{1:[16,32,15,17],9:[-16,-32,-15,-17],5:[-15,-17,15,17],13:[-15,-17,15,17],6:[-1,1,-16,16],14:[-1,1,-16,16],7:[-15,-17,15,17,-1,1,-16,16],15:[-15,-17,15,17,-1,1,-16,16],2:[-33,-31,-18,-14,14,18,31,33],10:[-33,-31,-18,-14,14,18,31,33],3:[-17,-16,-15,-1,1,15,16,17],11:[-17,-16,-15,-1,1,15,16,17]},distances:{"241":1,"242":2,"243":3,"244":4,"245":5,"246":6,"247":7,"272":1,"273":1,"274":2,"275":3,"276":4,"277":5,"278":6,"279":7,"304":2,"305":2,"306":2,"307":3,"308":4,"309":5,"310":6,"311":7,"336":3,"337":3,"338":3,"339":3,"340":4,"341":5,"342":6,"343":7,"368":4,"369":4,"370":4,"371":4,"372":4,"373":5,"374":6,"375":7,"400":5,"401":5,"402":5,"403":5,"404":5,"405":5,"406":6,"407":7,"432":6,"433":6,"434":6,"435":6,"436":6,"437":6,"438":6,"439":7,"464":7,"465":7,"466":7,"467":7,"468":7,"469":7,"470":7,"471":7,"239":1,"271":1,"303":2,"335":3,"367":4,"399":5,"431":6,"463":7,"238":2,"270":2,"302":2,"334":3,"366":4,"398":5,"430":6,"462":7,"237":3,"269":3,"301":3,"333":3,"365":4,"397":5,"429":6,"461":7,"236":4,"268":4,"300":4,"332":4,"364":4,"396":5,"428":6,"460":7,"235":5,"267":5,"299":5,"331":5,"363":5,"395":5,"427":6,"459":7,"234":6,"266":6,"298":6,"330":6,"362":6,"394":6,"426":6,"458":7,"233":7,"265":7,"297":7,"329":7,"361":7,"393":7,"425":7,"457":7,"208":1,"209":1,"210":2,"211":3,"212":4,"213":5,"214":6,"215":7,"207":1,"206":2,"205":3,"204":4,"203":5,"202":6,"201":7,"176":2,"177":2,"178":2,"179":3,"180":4,"181":5,"182":6,"183":7,"175":2,"174":2,"173":3,"172":4,"171":5,"170":6,"169":7,"144":3,"145":3,"146":3,"147":3,"148":4,"149":5,"150":6,"151":7,"143":3,"142":3,"141":3,"140":4,"139":5,"138":6,"137":7,"112":4,"113":4,"114":4,"115":4,"116":4,"117":5,"118":6,"119":7,"111":4,"110":4,"109":4,"108":4,"107":5,"106":6,"105":7,"80":5,"81":5,"82":5,"83":5,"84":5,"85":5,"86":6,"87":7,"79":5,"78":5,"77":5,"76":5,"75":5,"74":6,"73":7,"48":6,"49":6,"50":6,"51":6,"52":6,"53":6,"54":6,"55":7,"47":6,"46":6,"45":6,"44":6,"43":6,"42":6,"41":7,"16":7,"17":7,"18":7,"19":7,"20":7,"21":7,"22":7,"23":7,"15":7,"14":7,"13":7,"12":7,"11":7,"10":7,"9":7},_uPc:["a","b","c","d","e","f","g","h"],_uRc:{0:1,16:2,32:3,48:4,64:5,80:6,96:7,112:8},files:{a:0,b:1,c:2,d:3,e:4,f:5,g:6,h:7}};
chess.parser._uQ9=new Class({madeMoves:[],bc:_uP6,lan:undefined,initialize:function(a){this.lan=chess.language.pieces;if(a){this.setFen(a)}},setFen:function(a){this.c={_uPf:{},board:[],white:[],black:[],whiteSliding:[],blackSliding:[],k:{white:undefined,black:"undefined"}};this.fen=a;this._u69(a);this._uGf();this.madeMoves=[]},_u69:function(){var a=this.fen.split(" ");this.c._uPf={pieces:a[0],color:a[1],castleCode:this.bc._ux1[a[2]],enPassant:a[3],halfMoves:a[4],fullMoves:a[5]}},_uGf:function(){var j=0;var a=this.bc._uHe;var f,h,k;for(var c=0,g=this.c._uPf.pieces.length;c<g;c++){var b=this.c._uPf.pieces.substr(c,1);if(this.bc.fenPieces[b]){f=this.bc.mapping[a[j]];h=this.bc.pieces[b];k={t:h,s:f};this.c.board[f]=h;this.c[this.bc._uHc[b]].push(k);if(this.bc._uSc[h]=="k"){this.c["k"+((k.t&8)>0?"black":"white")]=k}j++}else{if(c<g-1&&this.bc.numbers[b]){var d=this.c._uPf.pieces.substr(c+1,1);if(!isNaN(d)){b=[b,d].join("")}j+=parseInt(b)}}}},_umf:function(){return this.c.white.append(this.c.black)},getKing:function(a){return this.c["k"+a]},_uQ3:function(a){return this.c[a]},_ud3:function(){var a=this.c._uPf.enPassant;if(a!="-"){return a}return undefined},_uV2:function(a){this.c._uPf.enPassant=a},_uV5:function(a){return this.c[a+"Sliding"]},_u9c:function(){return this.c._uPf.halfMoves},_uWb:function(){return this.c._uPf.fullMoves},_u04:function(a){var b=a==="white"?this.bc.castle.K:this.bc.castle.k;return this.c._uPf.castleCode&b},_u73:function(a){var b=a==="white"?this.bc.castle.Q:this.bc.castle.q;return this.c._uPf.castleCode&b},getColor:function(){return this.bc._uU2[this.c._uPf.color]},_uMb:function(){return this.c._uPf.color},_uY4:function(b){var a=this.c.board[b];if(a){return{square:this.bc._uI1[b],type:this.bc._uSc[a],color:(a&8)>0?"black":"white",sliding:(a&4)>0}}return undefined},getPieceTypeOnSquare:function(a){return this.c.board[a]},_u5c:function(b,a){return(b&240)===(a&240)},rank:function(a){if(a.substr!=undefined){a=this.bc.mapping[a]}return(a&240)/16},_u4c:function(b,a){return(b&15)===(a&15)},_u0c:undefined,_uje:function(b,a){if(this._u0c==undefined){this._u0c=new chess.parser._uQ9()}var d=this._u0c;d.setFen(b);d.move(a);var c=d.notation;return c.indexOf("#")>0?c:undefined},_uD2:function(){var d=this._uW();var a=d.moves;var c=[];var b=["R","N","B","Q"];jQuery.each(a,function(h,g){var f=this.bc._uI1[h];jQuery.each(g,function(k,j){var n=false;var o=this.rank(j);if(o==0||o==7){var m=this._uY4(h);if(m.type=="p"){n=true}}var l=this.bc._uI1[j];if(n){jQuery.each(b,function(p,q){c.push({from:f,to:l,promoteTo:q})})}else{c.push({from:f,to:l})}}.bind(this))}.bind(this));return c},_uV1:function(){var b=this.getFen();var a=this._uD2();var c=[];jQuery.each(a,function(f,d){var g=this._uL2(d);if(this._uje(b,d)){c.push(g+"#")}}.bind(this));return c},_uW:function(q){q=q||this.getColor();var w={},j;var n=this._ud3();if(n){n=this.bc.mapping[n]}var p=this._u04(q);var t=this._u73(q);var s=q==="white"?"black":"white";var u=q==="white";var c=this._ug(s);var d=this._ug9(q,c);var b=[],g,o;if(d===2){g=[this.getKing(q)]}else{g=this.c[q];b=this.getPinned(q);if(d===1){o=this._uc1(q)}}var l=0,v,k;for(var r=0;r<g.length;r++){var f=g[r];var m=[];switch(f.t){case 1:if(!b[f.s]||(b[f.s]&&this._u4c(f.s,b[f.s].by))){if(!this.c.board[f.s+16]){m.push(f.s+16);if(f.s<32){if(!this.c.board[f.s+32]){m.push(f.s+32)}}}}if(!b[f.s]||(b[f.s]&&b[f.s].by===f.s+15)){if(n==f.s+15||(this.c.board[f.s+15])&&(this.c.board[f.s+15]&8)>0){m.push(f.s+15)}}if(!b[f.s]||(b[f.s]&&b[f.s].by===f.s+17)){if(n==f.s+17||(this.c.board[f.s+17])&&(this.c.board[f.s+17]&8)>0){m.push(f.s+17)}}break;case 9:if(!b[f.s]||(b[f.s]&&this._u4c(f.s,b[f.s].by))){if(!this.c.board[f.s-16]){m.push(f.s-16);if(f.s>87){if(!this.c.board[f.s-32]){m.push(f.s-32)}}}}if(!b[f.s]||(b[f.s]&&b[f.s].by===f.s-15)){if(n==f.s-15||(this.c.board[f.s-15])&&(this.c.board[f.s-15]&8)===0){m.push(f.s-15)}}if(!b[f.s]||(b[f.s]&&b[f.s].by===f.s-17)){if(n==f.s-17||(this.c.board[f.s-17])&&(this.c.board[f.s-17]&8)===0){m.push(f.s-17)}}break;case 5:case 7:case 6:case 13:case 14:case 15:j=this.bc._uub[f.t];if(b[f.s]){if(j.indexOf(b[f.s].direction)>=0){j=[b[f.s].direction,b[f.s].direction*-1]}else{j=[]}}for(v=0;v<j.length;v++){k=f.s+j[v];while((k&136)===0){if(this.c.board[k]){if((u&&(this.c.board[k]&8)>0)||(!u&&(this.c.board[k]&8)===0)){m.push(k)}break}m.push(k);k+=j[v]}}break;case 2:case 10:if(b[f.s]){break}j=this.bc._uub[f.t];for(v=0;v<j.length;v++){k=f.s+j[v];if((k&136)===0){if(this.c.board[k]){if((u&&(this.c.board[k]&8)>0)||(!u&&(this.c.board[k]&8)===0)){m.push(k)}}else{m.push(k)}}}break;case 3:case 11:j=this.bc._uub[f.t];for(v=0;v<j.length;v++){k=f.s+j[v];if((k&136)===0){if(c.indexOf(k)==-1){if(this.c.board[k]){if((u&&(this.c.board[k]&8)>0)||(!u&&(this.c.board[k]&8)===0)){m.push(k)}}else{m.push(k)}}}}if(p&&!this.c.board[f.s+1]&&!this.c.board[f.s+2]&&c.indexOf(f.s)==-1&&c.indexOf(f.s)==-1&&c.indexOf(f.s+2)==-1){m.push(f.s+2)}if(t&&!this.c.board[f.s-1]&&!this.c.board[f.s-2]&&!this.c.board[f.s-3]&&c.indexOf(f.s)==-1&&c.indexOf(f.s-1)==-1&&c.indexOf(f.s-2)==-1){m.push(f.s-2)
}break}if(o&&f.t!=3&&f.t!=11){m=this._uu1(m,o)}w[f.s]=m;l+=m.length}var h=0;if(d&&!l){h=q==="black"?1:-1}else{if(!d&&!l){h=0.5}}return{moves:w,result:h,check:d}},fullMap:undefined,getFullSquareMap:function(){if(!this.fullMap){this.fullMap={};var b=_uP6._u34;for(var a=0;a<b.length;a++){this.fullMap[b[a]]=b}}return this.fullMap},_uI:function(p){p=p||this.getColor();var j;var m=this._ud3();if(m){m=this.bc.mapping[m]}var o=this._u04(p);var s=this._u73(p);var r=p==="white"?"black":"white";var t=p==="white";var c=this._ug(r);var d=this._ug9(p,c);var b=[],g,n;if(d===2){g=[this.getKing(p)]}else{g=this.c[p];b=this.getPinned(p);if(d===1){n=this._uc1(p)}}var u,k;var l=[];for(var q=0;q<g.length;q++){var f=g[q];switch(f.t){case 1:if(!b[f.s]||(b[f.s]&&this._u4c(f.s,b[f.s].by))){if(!this.c.board[f.s+16]){l.push([f.s,f.s+16]);if(f.s<32){if(!this.c.board[f.s+32]){l.push([f.s,f.s+32])}}}}if(!b[f.s]||(b[f.s]&&b[f.s].by===f.s+15)){if(m==f.s+15||(this.c.board[f.s+15])&&(this.c.board[f.s+15]&8)>0){l.push([f.s,f.s+15])}}if(!b[f.s]||(b[f.s]&&b[f.s].by===f.s+17)){if(m==f.s+17||(this.c.board[f.s+17])&&(this.c.board[f.s+17]&8)>0){l.push([f.s,f.s+17])}}break;case 9:if(!b[f.s]||(b[f.s]&&this._u4c(f.s,b[f.s].by))){if(!this.c.board[f.s-16]){l.push([f.s,f.s-16]);if(f.s>87){if(!this.c.board[f.s-32]){l.push([f.s,f.s-32])}}}}if(!b[f.s]||(b[f.s]&&b[f.s].by===f.s-15)){if(m==f.s-15||(this.c.board[f.s-15])&&(this.c.board[f.s-15]&8)===0){l.push([f.s,f.s-15])}}if(!b[f.s]||(b[f.s]&&b[f.s].by===f.s-17)){if(m==f.s-17||(this.c.board[f.s-17])&&(this.c.board[f.s-17]&8)===0){l.push([f.s,f.s-17])}}break;case 5:case 7:case 6:case 13:case 14:case 15:j=this.bc._uub[f.t];if(b[f.s]){if(j.indexOf(b[f.s].direction)>=0){j=[b[f.s].direction,b[f.s].direction*-1]}else{j=[]}}for(u=0;u<j.length;u++){k=f.s+j[u];while((k&136)===0){if(this.c.board[k]){if((t&&(this.c.board[k]&8)>0)||(!t&&(this.c.board[k]&8)===0)){l.push([f.s,k])}break}l.push([f.s,k]);k+=j[u]}}break;case 2:case 10:if(b[f.s]){break}j=this.bc._uub[f.t];for(u=0;u<j.length;u++){k=f.s+j[u];if((k&136)===0){if(this.c.board[k]){if((t&&(this.c.board[k]&8)>0)||(!t&&(this.c.board[k]&8)===0)){l.push([f.s,k])}}else{l.push([f.s,k])}}}break;case 3:case 11:j=this.bc._uub[f.t];for(u=0;u<j.length;u++){k=f.s+j[u];if((k&136)===0){if(c.indexOf(k)==-1){if(this.c.board[k]){if((t&&(this.c.board[k]&8)>0)||(!t&&(this.c.board[k]&8)===0)){if(!n||n.indexOf(k)>=0){l.push([f.s,k])}}}else{if(!n||n.indexOf(k)>=0){l.push([f.s,k])}}}}}if(o&&!this.c.board[f.s+1]&&!this.c.board[f.s+2]&&c.indexOf(f.s)==-1&&c.indexOf(f.s)==-1&&c.indexOf(f.s+2)==-1){if(!n||n.indexOf(k)>=0){l.push([f.s,f.s+2])}}if(s&&!this.c.board[f.s-1]&&!this.c.board[f.s-2]&&!this.c.board[f.s-3]&&c.indexOf(f.s)==-1&&c.indexOf(f.s-1)==-1&&c.indexOf(f.s-2)==-1){if(!n||n.indexOf(k)>=0){l.push([f.s,f.s-2])}}break}}var h=0;if(d&&!l.length>0){h=p==="black"?1:-1}else{if(!d&&l.length===0){h=0.5}}return{moves:l,result:h,check:d}},_uu1:function(a,d){var b=[];for(var c=0;c<a.length;c++){if(d.indexOf(a[c])>=0){b.push(a[c])}}return b},_ug:function(d){var g=[],h,k,j;var c=this.c[d];var b=this.getKing(d==="white"?"black":"white").s;for(var f=0;f<c.length;f++){var l=c[f];switch(l.t){case 1:if(((l.s+15)&136)===0){g.push(l.s+15)}if(((l.s+17)&136)===0){g.push(l.s+17)}break;case 9:if(((l.s-15)&136)===0){g.push(l.s-15)}if(((l.s-17)&136)===0){g.push(l.s-17)}break;case 5:case 7:case 6:case 13:case 14:case 15:h=this.bc._uub[l.t];for(j=0;j<h.length;j++){k=l.s+h[j];while((k&136)===0){if(this.c.board[k]&&k!==b){g.push(k);break}g.push(k);k+=h[j]}}break;case 2:case 10:h=this.bc._uub[l.t];for(j=0;j<h.length;j++){k=l.s+h[j];if((k&136)===0){g.push(k)}}break;case 3:case 11:h=this.bc._uub[l.t];for(j=0;j<h.length;j++){k=l.s+h[j];if((k&136)===0){g.push(k)}}break}}return g},_ua:function(c){var d=[];var b=this.c["k"+(c==="white"?"black":"white")];var j=this.c[c];for(var f=0;f<j.length;f++){var g=j[f];if((g.t&4)>0){var h=b.s-g.s;var a=(b.s-g.s)/this._u5d(b.s,g.s);switch(g.t){case 5:case 13:if(h%15===0||h%17===0){d.push({s:g.s,direction:a})}break;case 6:case 14:if(h%16===0){d.push({s:g.s,direction:a})}else{if(this._u5c(g.s,b.s)){d.push({s:g.s,direction:h>0?1:-1})}}break;case 7:case 15:if(h%15===0||h%17===0||h%16===0){d.push({s:g.s,direction:a})}else{if(this._u5c(g.s,b.s)){d.push({s:g.s,direction:h>0?1:-1})}}break}}}return d},getPinned:function(d){var g={};var b=this._ua((d==="white"?"black":"white"));var c=d==="white";var a=this.c["k"+d];var f=0;while(f<b.length){var l=b[f];var k=l.s+l.direction;var j=0;var h="";while(k!==a.s&&j<2){if(this.c.board[k]){j++;if((!c&&(this.c.board[k]&8)>0)||(c&&(this.c.board[k]&8)===0)){h=k}else{break}}k+=l.direction}if(j===1&&h){g[h]={by:l.s,direction:l.direction}}f++}if(g.length===0){return null}return g},_uC4:function(a){var c=this.getPinned(a);var b=[];jQuery.each(c,function(d,g){var f={king:this.bc._uI1[this.getKing(a).s],pinned:this.bc._uI1[d],by:this.bc._uI1[g.by]};b.push(f)}.bind(this));return b},_u85:function(a){var c=this._uC4(a);var b=[];jQuery.each(c,function(d,f){b.push(f.pinned)
});return b},_uc1:function(f){var h=[],d;var b=this.c["k"+f];var c=this.c[f==="white"?"black":"white"];var n=this._ud3();if(n){n=this.bc.mapping[n]}for(var g=0;g<c.length;g++){var m=c[g];switch(m.t){case 1:if(b.s===m.s+15||b.s===m.s+17){var h=[m.s];if(n==m.s-16){h.push(n)}return h}break;case 9:if(b.s===m.s-15||b.s===m.s-17){var h=[c.s];if(n==m.s+16){h.push(n)}return h}break;case 2:case 10:if(this._u5d(m.s,b.s)===2){var j=this.bc._uub[m.t];for(var k=0;k<j.length;k++){var l=m.s+j[k];if(l===b.s){return[m.s]}}}break;case 5:case 13:d=this._uf3(m,b);if(d){return d}break;case 6:case 14:d=this._uk5(m,b);if(d){return d}break;case 7:case 15:d=this._uk5(m,b);if(d){return d}d=this._uf3(m,b);if(d){return d}break}}return h},_uf3:function(c,b){if((b.s-c.s)%15===0||(b.s-c.s)%17===0){var f=(b.s-c.s)/this._u5d(c.s,b.s);var d=c.s+f;var g=false;var a=[c.s];while(d!==b.s&&!g){a.push(d);if(this.c.board[d]){g=true}d+=f}if(!g){return a}}return null},_uk5:function(c,b){var f=null;if(this._u4c(c.s,b.s)){f=(b.s-c.s)/this._u5d(c.s,b.s)}else{if(this._u5c(c.s,b.s)){f=b.s>c.s?1:-1}}if(f){var d=c.s+f;var g=false;var a=[c.s];while(d!==b.s&&!g){a.push(d);if(this.c.board[d]){g=true}d+=f}if(!g){return a}}return undefined},_ug9:function(d,a){var b=this.c["k"+d];var c=a.indexOf(b.s);if(c>=0){if(a.indexOf(b.s,c+1)>=0){return 2}return 1}return 0},_u5d:function(b,a){return this.bc.distances[a-b+(a|7)-(b|7)+240]},_uS:function(a){var c=[{from:a.from,to:a.to}];var d;a={from:this.bc.mapping[a.from],to:this.bc.mapping[a.to],promoteTo:a.promoteTo};var b=(this.c.board[a.from]&8)?"black":"white";if(this._uA7(a.from,a.to)){if(b=="black"){d=a.to+16}else{d=a.to-16}c.push({capture:this.bc._uI1[d]})}if(this._u3c(a)){if((a.from&15)<(a.to&15)){c.push({from:"h"+(b=="white"?1:8),to:"f"+(b=="white"?1:8)})}else{c.push({from:"a"+(b=="white"?1:8),to:"d"+(b=="white"?1:8)})}}if(a.promoteTo){c.push({promoteTo:a.promoteTo,square:this.bc._uI1[a.to]})}return c},_uA7:function(b,a){if((this.c.board[b]===1||this.c.board[b]==9)){if(!this.c.board[a]&&((b-a)%17===0||(b-a)%15===0)){return true}}return false},_u3c:function(a){if((this.c.board[a.from]===3||this.c.board[a.from]==11)){if(this._u5d(a.from,a.to)===2){return true}}return false},makeMoveByNotation:function(a){this._u55(this._u01(a))},_u55:function(a){this.makeMove(this.bc.mapping[a.from],this.bc.mapping[a.to],a.promoteTo?this.bc._uy2[a.promoteTo]:undefined);this.fen=undefined},_uV:function(f){if(!f||f.length===0){return false}var a={};for(var c=0;c<f.length;c++){var b=this._u3(f[c]);if(a[b]===undefined){a[b]=0}a[b]++}var d=this._u3(f[f.length-1]);return a[d]>=2},_u3:function(a){return a.split(/\s/g).slice(0,3).join(" ")},_u52:function(b){if(b.indexOf("=")>0){var a=b.replace(/^.*?=([QRBN]).*$/,"$1");return this.bc._udf[a]}if(b.match(/[a-h][18][NBRQ]/)){b=b.replace(/[^a-h18NBRQ]/g,"");return this.bc._udf[b.substr(b.length-1,1)]}return""},_u01:function(o){var l={promoteTo:this._u52(o)};var f=this.getColor();var g=0;if(f==="black"){g=112}var k=this._uW().moves;var h=[],d,a,j;if(o==="OO"){o="O-O"}if(o==="OOO"){o="O-O-O"}if(o.length===2){var s=this.bc.mapping[o];l.to=this.bc.mapping[o];var p=f==="white"?-16:16;if(this.c.board[s+p]){h.push(s+p)}else{h.push(s+(p*2))}}else{var r=this._uB1(o);var n=this._ut1(o);o=o.replace(/=[QRBN]/,"");o=o.replace(/[\+#!\?]/g,"");o=o.replace(/^(.*?)[QRBN]$/g,"$1");var b=this._ud1(o,f);var q=o.indexOf("x")>0;l.to=this._uw1(o);switch(b){case 1:case 9:if(f==="black"){d=q?[15,17]:[16];if(l.to>48){d.push(32)}}else{d=q?[-15,-17]:[-16];if(l.to<64){d.push(-32)}}for(j=0;j<d.length;j++){a=l.to+d[j];if(this.c.board[a]&&this.c.board[a]===b&&k[a].indexOf(l.to)>=0){h.push(a)}}break;case 3:case 11:if(o==="O-O"){h.push(g+4);l.to=g+6}else{if(o==="O-O-O"){h.push(g+4);l.to=g+2}else{h.push(this.getKing(f).s)}}break;case 2:case 10:var m=this.bc._uub[b];for(j=0;j<m.length;j++){a=l.to+m[j];if((a&136)===0){if(this.c.board[a]&&this.c.board[a]===b&&k[a].indexOf(l.to)>=0){h.push(a);if(r===null&&n===null){break}}}}break;default:var c=this.bc._uub[b];for(j=0;j<c.length;j++){a=l.to+c[j];while((a&136)===0){if(this.c.board[a]&&this.c.board[a]===b&&k[a].indexOf(l.to)>=0){h.push(a);if(r===null&&n===null){break}}a+=c[j]}}break}}if(h.length===1){l.from=h[0]}else{if(r>=0&&r!==null){for(j=0;j<h.length;j++){if(this._u5c(h[j],r)){l.from=h[j];break}}}else{if(n>=0&&n!==null){for(j=0;j<h.length;j++){if(this._u4c(h[j],n)){l.from=h[j];break}}}}}l.from=this.bc._uI1[l.from];l.to=this.bc._uI1[l.to];return l},_uB1:function(a){a=a.replace(/^.+([0-9]).+[0-9].*$/g,"$1");if(a.length>1){return null}return(a-1)*16},_ut1:function(a){a=a.replace(/^.*([a-h]).*[a-h].*$/g,"$1");if(a.length>1){return null}return this.bc.files[a]},_uw1:function(a){return this.bc.mapping[a.replace(/.*([a-h][1-8]).*/g,"$1")]},_ud1:function(b,a){b=b.replace(/=[NBRQ]/,"");if(b==="O-O-O"||b==="O-O"){b="K"}else{b=b.replace(/.*?([NRBQK]).*/g,"$1");if(!b||b.length>1){b="P"}}b=this.bc.pieces[b];if(a==="black"){b+=8}return b},move:function(a){if(ludo.util.isString(a)){a=this._u01(a)}if(!a.promoteTo&&a.m&&a.m.indexOf("=")>=0){a.promoteTo=this._u52(a.m)
}this.fen=undefined;this.piecesInvolved=this._uS(a);this.notation=this._uL2(a);this.longNotation=this._uT(a,this.notation);this.makeMove(this.bc.mapping[a.from],this.bc.mapping[a.to],a.promoteTo?this.bc._uy2[a.promoteTo]:undefined);var b=this._uW();if(b.result===1||b.result===-1){this.notation+="#";this.longNotation+="#"}else{if(b.check){this.notation+="+";this.longNotation+="+"}}},setNewColor:function(){this.c._uPf.color=(this.c._uPf.color=="w")?"b":"w"},getCastle:function(){return this.bc._uL9[this.c._uPf.castleCode]},_uW2:[],getCopyOfColoredPieces:function(a){var b=[];for(var c=0;c<this.c[a].length;c++){b.push({s:this.c[a][c].s,t:this.c[a][c].t})}return b},makeMove:function(g,f,a){this._uW2=[{key:"white",value:this.getCopyOfColoredPieces("white")},{key:"black",value:this.getCopyOfColoredPieces("black")},{key:"castle",value:this.c._uPf.castleCode},{key:"halfMoves",value:this._u9c()},{key:"fullMoves",value:this._uWb()},{key:"color",value:this.c._uPf.color},{key:"enPassant",value:this.c._uPf.enPassant}];if(!this.c.board[f]&&(this.c.board[g]!==1&&this.c.board[g]!==9)){this._uF3()}else{this._u39()}var b="-";switch(this.c.board[g]){case 3:case 11:var d,c;this._uM9(g);this.c["k"+this.bc._uP1[this.c.board[g]]].s=f;if(this._u5d(g,f)>1){if(this.c.board[g]===3){d=6;c=0}else{d=14;c=112}if(g<f){this._uTc(7+c,5+c);this.movePiece(7+c,5+c)}else{this._uTc(0+c,3+c);this.movePiece(0+c,3+c)}}break;case 1:case 9:if(this._uA7(g,f)){if(this.bc._uP1[this.c.board[g]]=="black"){this._uUc(f+16);this.c.board[f+16]=undefined}else{this._uUc(f-16);this.c.board[f-16]=undefined}}if(this._u5d(g,f)>1&&(this.c.board[f-1]||this.c.board[f+1])){b=f>g?g+16:g-16;b=this.bc._uI1[b]}if(a){if(this.c.board[g]>8){a+=8}this._uk7(g,a)}break;case 6:if(g===0){this._uU3(this.bc.castle.Q)}if(g===7){this._uU3(this.bc.castle.K)}break;case 14:if(g===this.bc.mapping.a8){this._uU3(this.bc.castle.q)}if(g===this.bc.mapping.h8){this._uU3(this.bc.castle.k)}break}this._uV2(b);this._uTc(g,f);if(this.c.board[f]){this._uUc(f);this._uW2.push({key:"addToBoard",square:f,type:this.c.board[f]})}this.movePiece(g,f);if(a){this.c.board[f]=a}if(this.c._uPf.color==="b"){this._uG3()}this.setNewColor();this.madeMoves.push(this._uW2)},movePiece:function(b,a){this._uW2.push({key:"addToBoard",square:b,type:this.c.board[b]});this._uW2.push({key:"removeFromBoard",square:a});this.c.board[a]=this.c.board[b];delete this.c.board[b]},_uVe:function(){var b=this.madeMoves.pop();for(var a=b.length-1;a>=0;a--){var c=b[a];switch(c.key){case"white":this.c.white=c.value;break;case"black":this.c.black=c.value;break;case"color":this.c._uPf.color=c.value;break;case"castle":this.c._uPf.castleCode=c.value;break;case"halfMoves":this.c._uPf.halfMoves=c.value;break;case"fullMoves":this.c._uPf.fullMoves=c.value;break;case"enPassant":this.c._uPf.enPassant=c.value;break;case"addToBoard":this.c.board[c.square]=c.type;break;case"removeFromBoard":this.c.board[c.square]=undefined;break}}},isValid:function(b){var a=this._uW().moves;return a[this.bc.mapping[b.from]]!=undefined&&a[this.bc.mapping[b.from]].indexOf(this.bc.mapping[b.to])>=0},_uTc:function(d,c){var a=this.bc._uP1[this.c.board[d]];for(var b=0;b<this.c[a].length;b++){if(this.c[a][b].s===d){this.c[a][b]={s:c,t:this.c[a][b].t};return}}},_uk7:function(d,c){var a=this.bc._uP1[this.c.board[d]];for(var b=0;b<this.c[a].length;b++){if(this.c[a][b].s===d){this.c[a][b]={s:this.c[a][b].s,t:c};return}}},_uUc:function(c){var a=this.bc._uP1[this.c.board[c]];for(var b=0;b<this.c[a].length;b++){if(this.c[a][b].s===c){this.c[a].splice(b,1);return}}},_uM9:function(b){var a=this.c.board[b]<9?[4,8]:[1,2];this._uU3(a[0]);this._uU3(a[1])},_uU3:function(a){if((this.c._uPf.castleCode&a)>0){this.c._uPf.castleCode-=a}},_uG3:function(){this.c._uPf.fullMoves++},_uF3:function(){this.c._uPf.halfMoves++},_u39:function(){this.c._uPf.halfMoves=0},_uj:function(){return this.piecesInvolved},_uad:function(){return this.notation},_uz7:function(){return this.longNotation},getFen:function(){if(!this.fen){this.fen=this._uAf()}return this.fen},_uT:function(b,h){if(!h){return""}if(h.indexOf("O-")>=0){return h}var d=b.from;var a=b.to;var f=this.c.board[this.bc.mapping[b.from]];f=this.bc._uSc[f];var g=h.indexOf("x")>=0?"x":"-";var c=this.lan[f]+d+g+a;if(b.promoteTo){c+="="+this.lan[b.promoteTo]}return c},_uL2:function(a){a={from:this.bc.mapping[a.from],to:this.bc.mapping[a.to],promoteTo:a.promoteTo};var d=this.c.board[a.from];var c=this.lan[this.bc._uSc[this.c.board[a.from]]];switch(d){case 1:case 9:if(this._uA7(a.from,a.to)||this.c.board[a.to]){c+=this.bc._uPc[a.from&15]+"x"}c+=this.bc._uPc[a.to&15]+""+this.bc._uRc[a.to&240];if(a.promoteTo){var g=this.lan[a.promoteTo]!=undefined?this.lan[a.promoteTo]:a.promoteTo;c+="="+g}break;case 2:case 5:case 6:case 7:case 10:case 13:case 14:case 15:var b=this._uW();for(var f in b.moves){if(f!=a.from&&this.c.board[f]===d){if(b.moves[f].indexOf(a.to)>=0){if((f&15)!=(a.from&15)){c+=this.bc._uPc[a.from&15]}else{if((f&240)!=(a.from&240)){c+=this.bc._uRc[a.from&240]
}}}}}if(this.c.board[a.to]){c+="x"}c+=this.bc._uPc[a.to&15]+""+this.bc._uRc[a.to&240];break;case 3:case 11:if(this._u3c(a)){if(a.to>a.from){c="O-O"}else{c="O-O-O"}}else{if(this.c.board[a.to]){c+="x"}c+=this.bc._uPc[a.to&15]+""+this.bc._uRc[a.to&240]}break}return c},_uAf:function(){var d=this.c.board;var a="";var f=0;for(var g=7;g>=0;g--){for(var c=0;c<8;c++){var b=(g*8)+c;if(d[this.bc._ug8[b]]){if(f){a+=f}a+=this.bc._uYfping[d[this.bc._ug8[b]]];f=0}else{f++}}if(g){if(f){a+=f}a+="/";f=0}}if(f){a+=f}return[a,this._uMb(),this.getCastle(),this.c._uPf.enPassant,this._u9c(),this._uWb()].join(" ")},_uOc:function(){var b=this._uq3("white");var a=this._uq3("black");return b/(b+a)},_uq3:function(b){var f=0;var a=this._uW(b).moves;for(var d in a){if(a.hasOwnProperty(d)){f+=a[d].length}}return f},evaluate:function(){var a=this._uZ4();a+=this._uOc()*2;return a},_uo5:function(d){var f=[];var a=this._uW(d);var h=this._ug(d);var b=this.getKing(d);for(var g in a.moves){if(a.moves.hasOwnProperty(g)){if(g!=b.s&&h.indexOf(parseInt(g))===-1){f.push(g)}}}return f},_ui:function(a){var c=this._uo5(a);for(var b=0;b<c.length;b++){c[b]=this.bc._uI1[c[b]]}return c},_uZ4:function(){return this._u25("white")-this._u25("black")},_u25:function(a){var b=0;var d=this._uQ3(a);for(var c=0;c<d.length;c++){b+=this.bc._uQc[d[c].t]}return b}});chess.parser.Move0x88=new Class({newFen:"",originalFen:"",removedSquares:[],parser:undefined,initialize:function(){this.parser=new chess.parser._uQ9()},moveConfig:{added:{},removed:{}},_uV:function(a){return this.parser._uV(a)},_uA4:function(a,b){this.parser.setFen(b);return this.parser._u01(a)},isValid:function(b,c){if(b.fen){return true}this.parser.setFen(c);var d=this.parser._uW();if(d.result!==0){return false}var a=d.moves[this._ucc(b.from)];return a&&a.indexOf(this._ucc(b.to))>=0},_ucc:function(a){return _uP6.mapping[a]},_uU9:function(move,fen){if(move.m!==undefined&&move.m&&move.m==="--"){var newFen=this._uP(fen);this.parser.setFen(newFen);return{notation:move.m,moves:[],fen:newFen}}this.parser.setFen(fen);var p=this.parser._uY4(_uP6.mapping[move.from]);this.parser.move(move);var n=move.m;var grade="";if(/[\!\?]/.test(n)){grade=n.replace(/.+?([\?\!]{1,2})/,"$1")}return{fen:move.fen?move.fen:this.parser.getFen(),m:this.parser._uad()+grade,lm:this.parser._uz7()+grade,moves:this.parser._uj(),p:p,from:move.from,promoteTo:move.promoteTo,comment:move.comment,clk:move.clk,actions:move.actions,eval:move.eval,to:move.to,variations:move.variations||[]}},_uP:function(a){if(a.indexOf(" w ")>=0){a=a.replace(" w "," b ")}else{a=a.replace(" b "," w ")}return a},_ug7:function(a,c){this.parser.setFen(c);var f=this._ucc(a.from);var d=this._ucc(a.to);var b=this.parser.getColor();if(b==="white"&&(f&240)/16==6&&(d&240)/16==7){return this._uD8(f)}if(b==="black"&&(f&240)/16==1&&(d&240)/16==0){return this._uD8(f)}return false},_uD8:function(b){var a=this.parser._uY4(b);return a.type==="p"},_uOc:function(a){this.parser.setFen(a);return this.parser._uOc()}});chess.parser.PositionValidator=new Class({Extends:chess.parser._uQ9,isValid:function(b){try{this.setFen(b)}catch(c){return false}if(!this.hasBothKings()){return false}var a=this._uW(this.getOppositeColor());return a.check?false:true},_uW:function(a){if(!this.getKing("white")||!this.getKing("black")){return{moves:[],result:0,check:0}}return this.parent(a)},hasBothKings:function(){return this.getKing("white")&&this.getKing("black")},getOppositeColor:function(){return this.getColor()==="white"?"black":"white"}});chess._uoe.Controller=new Class({Extends:ludo._uoe.Controller,models:[],applyTo:undefined,_umc:null,_uV8:15,views:{},_u29:{},pgn:undefined,debug:false,_module:undefined,isBusy:false,sound:false,eventHandler:undefined,_ukd:function(b){this.applyTo=b.applyTo||["eventHandler","chess","user.menuItemNewGame","user.saveGame","user.menuItemSaveGame"];this.parent(b);this._uWf(b,["arrowStylesSec","debug","pgn","theme","sound"]);if(b.applyTo!=undefined){this._module=b.applyTo[0]}this.theme=this.theme||chess.THEME||{};this._uv3();this._uk3();if(this.sound){var a=ludo._new("chess.sound.Sound");a.add(this)}},_uv3:function(){if(chess.view.dialog!=undefined){if(chess.view.dialog.OverwriteMove){this.createView("chess.view.dialog.OverwriteMove")}this.createView("chess.view.dialog.Promote");if(chess.view.dialog.Comment){this.createView("chess.view.dialog.Comment")}}if(this.views.board){new chess.action.Handler({board:this.views.board,_uoe:this,arrowStyles:this.arrowStylesSec})}},createView:function(a){var b=this.theme[a]||{};b.type=a;if(this._module!=undefined){b.module=this._module}return ludo.factory.create(b)},_uk3:function(){var a=this._ubd();this.models[0]=a;this._umc=a;a.newGame();a.setClean()},addView:function(a){if(this.views[a.submodule]!==undefined){if(this.debug){ludo.util.log("submodule "+a.submodule+" already registered in _uoe")}}this.views[a.submodule]=a;switch(a.submodule){case window.chess.Views.buttonbar.bar:a.on("play",this.playMoves.bind(this));a.on("start",this.toStart.bind(this));
a.on("end",this.toEnd.bind(this));a.on("previous",this._udc.bind(this));a.on("next",this.nextMove.bind(this));a.on("pause",this.pauseGame.bind(this));a.on("flip",this.flipBoard.bind(this));a.on("comp",this.compClick.bind(this));break;case window.chess.Views.buttonbar.game:a.on("play",this.playMoves.bind(this));a.on("tostart",this.toStart.bind(this));a.on("toend",this.toEnd.bind(this));a.on("previous",this._udc.bind(this));a.on("next",this.nextMove.bind(this));a.on("pause",this.pauseGame.bind(this));a.on("flip",this.flipBoard.bind(this));break;case"list-of-pgn-files":a.on("_uzf",this._uzf.bind(this));break;case"gameList":a.on("_uKe",this._uKe.bind(this));break;case"menuItemSaveGame":case"saveGame":a.on("saveGame",function(){this._umc.save()}.bind(this));break;case"dialogNewGame":a.on("newGame",function(b){this._umc=this._ubd({metadata:b});this._umc.activate()}.bind(this));break;case"menuItemNewGame":a.on("newGame",function(){this._uif("newGameDialog")}.bind(this));break;case"commandLine":a.on("move",this.addMove.bind(this));a.on("_u0d",this._u0d.bind(this));a.on("load",this._uKe.bind(this));a.on("flip",this.flipBoard.bind(this));a.on("grade",this._u66.bind(this));break;case"board":a.on("move",this.addMove.bind(this));a.on("animationStart",this.setBusy.bind(this));a.on("_u84",this._uQ5.bind(this));break;case"notation":a.on("_uG8",this._uG8.bind(this));a.on("_uof",this._uof.bind(this));a.on("_uBa",this._uI2.bind(this));a.on("_uLc",this._uI3.bind(this));a.on("deleteMove",this._uBd.bind(this));break;case"dialogOverwriteMove":a.on("overwriteMove",this.overwriteMove.bind(this));a.on("_uec",this._uec.bind(this));a.on("_uN6",this._uN6.bind(this));break;case"dialogPromote":a.on("promote",this.addMove.bind(this));break;case"buttonTacticHint":a.on("showHint",this.showHint.bind(this));break;case"buttonTacticSolution":a.on("_ufc",this._ufc.bind(this));break;case"buttonNextGame":a.on("_uSf",this._uCc.bind(this));break;case"buttonPreviousGame":a.on("_uKc",this._up5.bind(this));break;case"eco.VariationTree":a.on("selectMove",this.addMove.bind(this));break;case"positionSetup":a.on("_u0d",this._u0d.bind(this));break;case"dialogComment":a.on("_uBa",this._ur5.bind(this));a.on("_uLc",this._uO6.bind(this));break}return true},compClick:function(){},_uBd:function(a){this._umc.deleteMove(a)},_uCc:function(){this._uif("_uSf")},_up5:function(){this._uif("_uKc")},showHint:function(){var a=this._umc._uud();if(a){this.views.board.showHint(a)}},_ufc:function(){var a=this._umc._uud();if(a){this.views.board._ufc(a)}},_u0d:function(a){this._umc._u0d(a)},overwriteMove:function(a,b){this._umc.overwriteMove(a,b)},_uec:function(b,c){var a=this._umc;a._uG8(b);a._uec(c)},_uN6:function(){this._umc.re_u0d()},_uG8:function(a){this._umc.goToMove(a)},flipBoard:function(){this._uif("flip")},addMove:function(b){var a=this._umc;if(this.eventHandler!=undefined){this.eventHandler.apply(this,["boardMove",a,this,b])}else{a._u4f(b)}},_uof:function(a,b){this._umc._uof(a,b)},_u66:function(c){var a=this._umc;var b=a._uz8();if(b){a._uof(b,c)}},_uI2:function(a){this._uif("_uBa",[this._umc,a])},_uI3:function(a){this._uif("_uLc",[this._umc,a])},_ur5:function(b,a){this._umc._uN5(b,a)},_uO6:function(b,a){this._umc._uU6(b,a)},toStart:function(){this.pauseGame();if(!this.isBusy){this._umc.toStart()}},toEnd:function(){this.pauseGame();if(!this.isBusy){this._umc.toEnd()}},_udc:function(){this.pauseGame();if(!this.isBusy){this._umc._udc()}},nextMove:function(){this.pauseGame();if(!this.isBusy){this._umc.nextMove()}},playMoves:function(){if(!this.isBusy){this._umc._u5a()}},pauseGame:function(){this._umc.stopAutoPlay()},getAnimationDuration:function(){return this.views.board.animationDuration},setBusy:function(){this.isBusy=true},_uQ5:function(){this._u48("_u84",this._umc,undefined);this._umc._uQ5();this.isBusy=false},_uKe:function(a,c){var b;if(b=this.getModelFromCache(a)){this._umc=b;this._umc.activate()}else{this._umc=this._ubd(a,c)}},_uzf:function(a){this._uif("_uzf",a)},getModelFromCache:function(a){for(var b=0;b<this.models.length;b++){if(this.models[b].isModelFor(a)){return this.models[b]}}return null},_ubd:function(b,f){b=b||{};if(f){b.pgn=f}var c=new chess.model.Game(b);this._uBfToModel(c);var a=this.models;a.push(c);if(a.length>this._uV8){a[0]._uwc();delete a[0];for(var d=0;d<a.length-1;d++){a[d]=a[d+1]}a.length=a.length-1}return c},_uBfToModel:function(b){for(var a in window.chess.events.game){if(window.chess.events.game.hasOwnProperty(a)){if(this._u29[a]===undefined){b.addEvent(window.chess.events.game[a],this._u48.bind(this))}}}},_u48:function(b,a,c){if(a.getId()==this._umc.getId()){if(this.debug){ludo.util.log(b)}this._uif(b,[a,c]);this._u67(b,a,c)}},_u67:function(b,a){if(this.eventHandler){this.eventHandler.apply(this,[b,a,this])}},_ui7:function(){return this._umc},_u58:function(){this._umc._u71(this.pgn)},_ur1:function(b,a){this.pgn=b;this._umc._ur1(b,a)},_uw:function(b,a){this.pgn=b;this._umc._ur1(b,a)},_um1:function(a){if(arguments.length>0){this.pgn=a}this._umc._ur3(a)
},_u45:function(a){if(this.pgn){this._umc._uY8(this.pgn,a)}},_uCcFromFile:function(){if(this.pgn){this._umc._ur3(this.pgn)}},_uF:function(){if(this.pgn){this._umc._u21(this.pgn)}},colorToMove:function(){return this._umc._uT8()},keyNext:function(){this._umc.nextMove()},keyBack:function(){this._umc._udc()}});chess._uoe.TacticController=new Class({Extends:chess._uoe.Controller,_ut9:200,_u29:{_uL1:1},dialog:{},_uH:false,startingColor:undefined,myColor:"white",_ukd:function(a){this.parent(a);if(!a.noDialogs){this.dialog.puzzleComplete=this.getDialogPuzzleComplete()}if(a._uH!==undefined){this._uH=a._uH}if(a._ut9!=undefined){this._ut9=a._ut9}if(a._uf9!=undefined){this._uf9=a._uf9}},getDialogPuzzleComplete:function(){var a={autoRemove:false,layout:{centerIn:this.views.board},hidden:true,listeners:{ok:function(){if(this._uf9!=undefined){this._uf9.apply(this,[this])}else{this._u58()}}.bind(this)}};if(this.theme["chess.view.dialog._uVb"]!=undefined){a=Object.merge(a,this.theme["chess.view.dialog._uVb"])}return new chess.view.dialog._uVb(a)},addViewFeatures:function(){},addMove:function(a){this._umc.tryNextMove(a)},_u67:function(g,d){var h,b;var a=this._umc.getMoves();if(a.length==0){return}if(g==="newGame"){var j;b=d.getResult();if(this._uH){j=d._uT8()}else{if(b!=0){j=b==-1?"black":"white"}else{var f=a.length==1?0:Math.random();if(f>0.5){j="black"}else{j="white"}}}if(j=="white"){this.views.board._und()}else{this.views.board._ujd()}this.myColor=j}if(g==="_u0d"||g==="nextmove"){h=d._uT8();if(h==this.myColor){this.views.board._ui4(d)}else{d.nextMove.delay(this._ut9,d)}}if(g==="wrongGuess"){d.re_u0d.delay(200,d)}},_uZ:function(b,a){return b!=this.myColor}});chess._uoe.TacticControllerGui=new Class({Extends:chess._uoe.TacticController,_uf9:undefined,_uwe:undefined,_ukd:function(a){this.parent(a);this._uwe=a._uwe!==undefined?a._uwe:true},_u67:function(b,a){this.parent(b,a);if(b==="endOfGame"||b==="_u8d"){if(this._uwe&&this.dialog.puzzleComplete){this.dialog.puzzleComplete.show.delay(300,this.dialog.puzzleComplete)}else{if(this._uf9){this._uf9.apply(this,[this])}}}}});chess._uoe.PlayStockFishController=new Class({Extends:chess._uoe.Controller,stockfish:undefined,history:undefined,_uic:{},whiteTime:1000*60,blackTime:1000*60,whiteIncrement:1,blackIncrement:1,playerColor:"white",elo:undefined,clock:undefined,_u87:undefined,_uhc:undefined,gameType:undefined,turn:undefined,isPlaying:false,clockAndElo:true,startFen:undefined,autoFlip:true,_ukd:function(a){if(a.playerColor!=undefined){this.playerColor=a.playerColor}if(a.stockfish!=undefined){this.stockfish=a.stockfish}if(a.thinkingTime!=undefined){this.thinkingTime=a.thinkingTime}if(this.clockAndElo){this.elo=new chess.computer.Elo();this.clock=new chess.computer.Clock();this.clock.on("end",this.onTimesUp.bind(this))}this.parent(a);this.history=[]},addView:function(a){this.parent(a);switch(a.submodule){case"chess.computer.gamedialog":a.on("newGame",this._uS8.bind(this));break;case"computer.clockview":if(!a._uNf()){if(a.pos=="top"){this.views.clockTop=a}else{this.views.clockBottom=a}}break;case"chess.computer.gameoverdialog":a.on("newgame",function(){this._uif("newgamedialog")}.bind(this));break}},getSkillLevel:function(){if(this._uhc<1400){return 0}var a=this._uhc;if(a>2800){return 20}if(a>2700){return 19}if(a>2600){return 17}if(a>2500){return 15}if(a>2400){return 13}if(a>2300){return 11}if(a>2200){return 10}if(a>2100){return 9}if(a>2000){return 8}if(a>1900){return 6}if(a>1800){return 5}if(a>1700){return 4}if(a>1600){return 3}if(a>1500){return 2}return 1},_uS8:function(a){this.turn="white";this.playerColor=a.color;this._uhc=a.elo;this.history=[];this.clock.setTime(a.time*60,a.inc);this.clock.start();this._umc.newGame();this.gameType=this.elo._uCd(a.time*60,a.inc);this._u87=this.elo.getEloByTime(a.time*60,a.inc);this.isPlaying=true;this._uS1();this.prepareBoard(a);this.prepareMove()},_uS1:function(){this.uciCmd("setoption name Mobility (Middle Game) value 150");this.uciCmd("setoption name Mobility (Endgame) value 150");this.uciCmd("setoption name Contempt Factor value 0");this.uciCmd("setoption name UCI_LimitStrength value 1200");this.uciCmd("setoption name Skill Level value "+this.getSkillLevel());this.uciCmd("ucinewgame")},prepareBoard:function(a){if(a.color=="white"){this.views.board._und();this.views.clockTop._uTf("black");this.views.clockBottom._uTf("white")}else{this.views.board._ujd();this.views.clockTop._uTf("white");this.views.clockBottom._uTf("black")}},promotion:function(a){},engineLoaded:function(){return this._uic.engineLoaded},createEngine:function(){try{var b=this;this._uif("createngine");this.engine=new Worker(this.stockfish);this._uif("enginestatus",chess.__("loading StockfishJS"));this.uciCmd("uci");this.uciCmd("ucinewgame");this.engine.onmessage=function(h){var c=h.data;if(c=="uciok"){b._uif("enginestatus",chess.__("StockfishJS loaded. Loading Opening Book"));if(!b._uic.engineLoaded){b._uic.engineLoaded=true;jQuery.ajax({url:ludo.config.getUrl()+"/stockfish-js/book.bin",complete:function(m){this.engine.postMessage({book:m.responseText});
this._uif("enginestatus",[chess.__("Stockfish Ready"),true]);this._uif("newgamedialog")}.bind(b)})}}else{if(c=="readyok"){b._uic.engineReady=true}else{var g=c.match(/^bestmove ([a-h][1-8])([a-h][1-8])([qrbk])?/);if(g){if(b.turn!=b.playerColor){b._umc.move({from:g[1],to:g[2],promoteTo:g[3]})}}if(g=c.match(/^info .*\bscore (\w+) (-?\d+)/)){var f=c.replace(/.*pv(.+?)$/g,"$1").trim();var l=c.replace(/.*nps.*?([0-9]+?)[^0-9].+/g,"$1");var k=c.replace(/.*?depth ([0-9]+?)[^0-9].*/g,"$1").trim();var d={depth:k,bestMoves:f,nps:l,mate:false,currentPly:b.currentPly};if(g[1]=="cp"){var j=parseInt(g[2])*(b._colorToMove=="white"?1:-1);j=(j/100).toFixed(2)}else{if(g[1]=="mate"){d.mate=g[2]*(b._colorToMove=="white"?1:-1);j="#"+Math.abs(parseInt(d.mate))}}d.score=j;d.scoreLiteral=!isNaN(j)&&j>0?"+"+j:j;b._uif("engineupdate",d)}}}};this.engine.error=function(c){this._uif("message","Error from background worker:"+c.message)}.bind(this)}catch(a){this.backgroundEngineValid=false}},newGame:function(){this.history=[];this._umc.newGame();this.start();this.prepareMove()},start:function(){this.uciCmd("ucinewgame");this.uciCmd("isready");this._uic.engineReady=false;this._uic.search=null;this.prepareMove()},prepareMove:function(){var b=this._umc.turn();if(b!=this.playerColor){if(this.history==undefined){this.history=[]}var a=this.startFen?"position fen "+this.startFen:"position startpos";this.uciCmd(a+" moves "+this.history.join(" "));if(this._u87<=1200){this.uciCmd("go depth "+this._u47())}else{this.uciCmd("go wtime "+this.getWTime()+" winc "+this.getInc("white")+" btime "+this.getBTime()+" binc "+this.getInc("black"))}}},getWTime:function(){if(this.playerColor=="white"){return this.clock.wTime()}return this._ue9()},getBTime:function(){if(this.playerColor=="black"){return this.clock.bTime()}return this._ue9()},_ue9:function(){var a=this._uhc;if(a<=800){return 500}if(a<=1000){return 1000}if(a<=1200){return 2000}if(a<=1400){return 3000}if(a<=1500){return 4000}if(a<=1600){return 5000}if(a<=1700){return 7000}if(a<=1800){return 9000}if(a<=1900){return 12000}return 20000},getInc:function(a){if(this.clock&&this.playerColor==a){return this.clock.inc()}return 0},_u47:function(){var b=this._uhc;var c;for(var a in this._uL3){if(b<=a){c=this._uL3[a];break}}if(c==undefined){c=20}return c},_uL3:{800:1,900:2,1000:3,1200:4,1300:5,1400:6,1600:8,1700:10,1800:12,1900:13,2000:14,2100:16,2200:18,2250:20,2300:21,2400:22,2500:23,2600:23},uciCmd:function(a){this.engine.postMessage(a)},_u67:function(d,c,b){if(d==="newMove"||d=="newGame"){if(d=="newGame"){if(this.autoFlip){if(this.playerColor=="white"){this.views.board._und()}else{this.views.board._ujd()}}if(this.engine==undefined){this.createEngine()}}var f=this._colorToMove=c.turn();if(d=="newMove"){if(this.clock){this.clock.tap()}this.turn=this.turn=="white"?"black":"white";if(this.history==undefined){this.history=[]}this.history.push(b.from+b.to+(b.promoteTo?b.promoteTo:""));this.start();if(f!=this.playerColor){this.prepareMove()}}if(c.getResult()!=0){var a=c.getResult();this.onGameOver(a);return}if(f===this.playerColor){this.views.board._ui4(c)}else{this.views.board._uy3();if(d=="newGame"){this.prepareMove()}}}},onGameOver:function(a){if(!this.isPlaying){return}this.views.board._uy3();this.elo.saveResult(a,this._uhc,this.gameType,this.playerColor);var c=Math.round(this.elo.getElo(this.gameType));var b=this.playerColor=="black"?a*-1:a;this._uP3.delay(300,this,[b,Math.round(this._u87),c]);this.clock.stop();this.isPlaying=false},_uP3:function(b,c,a){this._uif("gameover",[b,c,a])},onTimesUp:function(a){this.onGameOver(a=="white"?-1:1)},claimDraw:function(){if(this._umc.canClaimDraw()){this.onGameOver(0)}},resign:function(){this.onGameOver(this.playerColor=="white"?-1:1)}});chess._uoe.ComputerController=new Class({Extends:chess._uoe.PlayStockFishController,gameModel:undefined,_u97:undefined,clockAndElo:false,compMode:false,autoFlip:false,w:undefined,b:undefined,_ukd:function(a){this.parent(a);this.w=chess.__("white");this.b=chess.__("black");this.on("enginestatus",this._us2.bind(this));this.on("engineupdate",this._up2.bind(this))},_up2:function(b){var a=this._umc._uz8();if(a&&b.scoreLiteral!="#0"){this._umc._uU6(b.scoreLiteral,a)}},_us2:function(){if(this.engineLoaded()){this.newGame()}},prepareBoard:function(){},onGameOver:function(a){this._uif("compGameOver",[a,this.playerColor])},enableEngine:function(){},_uEa:function(){},compClick:function(){this._um3()},_um3:function(){if(this.compMode){this.views.board._uy3();this.compMode=false;this._umc=this.gameModel;this._umc.activate()}else{this.compMode=true;this._uS8()}this._uif("comp")},getWTime:function(){return 60000},getBTime:function(){return 60000},_uS8:function(){if(this.gameModel==undefined){this.gameModel=this._umc}this.playerColor=this.turn=this._umc.turn();if(this._u97==undefined){this._u97=this._ubd()}this._umc=this._u97;this.history=[];this.startFen=this.gameModel.fen();var b=Object.clone(this.gameModel.getMetadata());b.fen=this.startFen;b.result="*";
this._u97._u0d(this.startFen);this._u97.setMetadata(b);var d=this.playerColor=="white"?this.w:this.b;var a=chess.__("You play {color} vs StockFishJS").replace("{color}",d);this._u97.setGameComment(a);this._umc.activate();if(this.engineLoaded()){this.newGame()}else{this.createEngine()}},newGame:function(){this.history=[];this.start();this._uS1();this.prepareMove()},_u67:function(c,b,a){if(!this.compMode){return}this.parent(c,b,a)}});chess._uoe.AnalysisController=new Class({Extends:chess._uoe.Controller,useEngine:false,_ukd:function(a){this.parent(a);this._uWf(a,["useEngine"])},_u67:function(b,a,c){if(b==="_u0d"||b==="nextmove"||b==="newMove"){if(this.views&&this.views.board){this.views.board._ui4(a)}}}});chess._uoe.StockfishEngineController=new Class({Extends:chess._uoe.AnalysisController,dialog:{},engine:undefined,analyzing:true,backgroundEngineValid:true,allMoves:[],chessModel:undefined,thinkingTime:40,stockfish:"../stockfish-js/stockfish.js",fen:undefined,stopped:true,debug:false,startFen:undefined,examine:true,_uic:{},_colorToMove:undefined,autoStopEngineOnNewGame:true,colorToMove:function(){return this._colorToMove},_ukd:function(a){if(a.stockfish!=undefined){this.stockfish=a.stockfish}if(a.autoStopEngineOnNewGame!=undefined){this.autoStopEngineOnNewGame=a.autoStopEngineOnNewGame}this._uic={};this._uWf(a,["stopped","examine"]);if(a.thinkingTime!=undefined){this.thinkingTime=a.thinkingTime}this.parent(a)},_u67:function(b,a,c){this.parent(b,a,c);this.chessModel=a;if(b=="newGame"&&this.autoStopEngineOnNewGame){this.stopEngine();this.startFen=this._umc.model.startFen}if(b==="_u0d"||b==="nextmove"||b=="newMove"){if(this.examine){this.views.board._ui4(a)}}if(b==="fen"){this.fen=c;if(a.getResult()!=0){this._uif("gameover",a.getResult());return}if(!this.stopped){this.updateEngine()}}},updateEngine:function(){this.searchAndRedraw()},stopEngine:function(){console.log("stop");this.stopped=true;this.uciCmd("stop")},_restartTimer:undefined,restartEngine:function(){if(this._restartTimer){clearTimeout(this._restartTimer)}this.stopEngine();var a=function(){this.startEngine();this._restartTimer=undefined}.bind(this);this._restartTimer=setTimeout(a,1500)},startEngine:function(){this.stopped=false;console.log("start");if(!this.engine){this.initializeBackgroundEngine()}this.searchAndRedraw()},searchAndRedraw:function(){if(this.analyzing){this._colorToMove=this._ui7()._uT8();this.currentPly=this._ui7()._uRa();this.uciCmd("ucinewgame");this.uciCmd("position fen "+this._ui7().fen());this.uciCmd("go infinite")}},uciCmd:function(a){if(this.engine){this.engine.postMessage(a)}},initializeBackgroundEngine:function(){if(!this.backgroundEngineValid){return false}if(!this.engine){this.backgroundEngineValid=true;try{var b=this;this.engine=new Worker(this.stockfish);this.uciCmd("uci");this.uciCmd("ucinewgame");this.engine.onmessage=function(h){var c=h.data;if(c=="uciok"){b._uic.engineLoaded=true}else{if(c=="readyok"){b._uic.engineReady=true}else{var g=c.match(/^bestmove ([a-h][1-8])([a-h][1-8])([qrbk])?/);if(g){}else{if(g=c.match(/^info .*\bdepth (\d+) .*\bnps (\d+)/)){b._uic.search="Depth: "+g[1]+" Nps: "+g[2]}}if(!b.stopped&&(g=c.match(/^info .*\bscore (\w+) (-?\d+)/))){var f=c.replace(/.*pv(.+?)$/g,"$1").trim();if(!b.isValidEngineMoveForCurrentPosition(f)){return false}var l=c.replace(/.*nps.*?([0-9]+?)[^0-9].+/g,"$1");var k=c.replace(/.*?depth ([0-9]+?)[^0-9].*/g,"$1").trim();var d={depth:k,bestMoves:f,nps:l,mate:false,currentPly:b.currentPly};if(g[1]=="cp"){var j=parseInt(g[2])*(b.colorToMove()=="white"?1:-1);j=(j/100).toFixed(2)}else{if(g[1]=="mate"){d.mate=g[2]*(b.colorToMove()=="white"?1:-1);j="#"+g[2]}}d.score=j;b._uif("engineupdate",d)}}}};this.engine.error=function(c){console.log("Error from background worker:"+c.message)};this.searchAndRedraw()}catch(a){this.backgroundEngineValid=false}jQuery.ajax({url:ludo.config._uC6()+"/stockfish-js/book.bin",complete:function(c){this.engine.postMessage({book:c.responseText})}.bind(this)})}return this.backgroundEngineValid},isValidEngineMoveForCurrentPosition:function(b){if(this.parser==undefined){this.parser=new chess.parser._uQ9()}this.parser.setFen(this.fen);var a={from:_uP6.mapping[b.substr(0,2)],to:_uP6.mapping[b.substr(2,2)]};var c=this.parser._uW().moves;if(c[a.from]&&c[a.from].indexOf(a.to)>=0){return true}return false},getFen:function(){return this.fen?this.fen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"},color:function(){return this.models[0]._uT8()},newGame:function(){this._umc.newGame()},_up7:function(a){this.thinkingTime=a}});chess._uoe.DummyController=new Class({Extends:chess._uoe.StockfishEngineController,_uK8:undefined,fen:undefined,isValid:false,_colorToMove:"white",_moves:undefined,_movePointer:undefined,_buttonBar:undefined,_inited:false,_persistant:true,_ukd:function(c){this.parent(c);if(c.persistent!==undefined){this._persistant=c.persistent!=="0"}this.circleColors=["#E53935","#43A047"];this._uK8=new chess.parser._uQ9();var a=this.views.board;this.squarePool=new chess.view.highlight.SquarePool({board:a});
this.circlePool=new chess.view.highlight.SquarePool({board:a,circular:true});this.arrowPool=new chess.view.highlight.ArrowPool({board:a});this.loadFromLocalStore();this._onNav();setTimeout(function(){this._onNav();if(this._flipped&&this.views.board){this.views.board._ujd()}}.bind(this),300);this._inited=true},resetMoves:function(){this._moves=[{fen:_uP6.fen}];this._movePointer=0;this.updateLocalStore()},updateLocalStore:function(){if(!this._inited||!this._persistant){return}var a=ludo._uZ6();a.save("inst",{moves:this._moves,movePointer:this._movePointer,color:this._colorToMove,flipped:this.views.board.isFlipped()})},loadFromLocalStore:function(){if(!this._persistant){return}var a=ludo._uZ6().get("inst");if(a){this._moves=a.moves;this._movePointer=a.movePointer;this._colorToMove=a.color;this._flipped=a.flipped}},createView:function(a){var b=this.theme[a]||{};b.type=a;if(this._module!=undefined){b.module=this._module}return ludo.factory.create(b)},_uv3:function(){if(this.views.board){new chess.action.Handler({board:this.views.board,_uoe:this,arrowStyles:this.arrowStylesSec})}},_u67:function(b,a,c){},updateFen:function(a,d){var b=this.views.board.buildFen();var f=d==="white"?"b":"w";this.fen=[b,f,"KQkq","-","0",f==="w"?2:1].join(" ");this.validate();if(this.isValid){this.onFenUpdated()}if(this.lastMove){this.squarePool.hideAll().show(this.lastMove.from,this.circleColors[0]).show(this.lastMove.to,this.circleColors[0])}},onFenUpdated:function(){var a=this.fen.split(" ");this._colorToMove=a[1]==="w"?"white":"black";this._uif("instructorFen",[undefined,this.fen]);this.views.board._uuf();if(this.arrowPool){this.squarePool.hideAll();this.circlePool.hideAll();this.arrowPool.hideAll()}this.restartEngine()},validateFen:function(a){try{this._uK8.setFen(a);var g=this._uK8.getKing("white");var c=this._uK8.getKing("black");var f=this._uK8.getColor()==="white"?"black":"white";var b=this._uK8._uW(f);return g&&c&&!b.check&&b.result===0}catch(d){}return false},validate:function(){this.isValid=this.validateFen(this.fen);try{this._uK8.setFen(this.fen);var f=this._uK8.getKing("white");var b=this._uK8.getKing("black");var d=this._uK8.getColor()==="white"?"black":"white";var a=this._uK8._uW(d);this.isValid=f&&b&&!a.check&&a.result===0}catch(c){}if(this.isValid){if(this.compMode){this.searchAndRedraw()}}else{this.stopEngine();if(console){console.log("invalid fen")}this._uif("comp")}},compMode:false,color:function(){return this._colorToMove},colorToMove:function(){return this._colorToMove},searchAndRedraw:function(){if(this.compMode){this.currentPly=this._colorToMove==="white"?0:1;this.uciCmd("ucinewgame");this.uciCmd("position fen "+this.fen);this.uciCmd("go infinite")}},toggleCompMode:function(){this.compMode=!this.compMode;if(this.compMode){this.startEngine()}else{this.stopEngine()}},clickSquare:function(c,b){var a=b.shiftKey?this.circleColors[1]:this.circleColors[0];this.circlePool.toggle(c,a);b.preventDefault()},_arrow:undefined,arrowStart:function(c,b){var a=b.altKey?0:1;this._arrow=this.arrowPool.show(c,c,{fill:this.circleColors[a],stroke:this.circleColors[a]})},arrowMove:function(b,a){if(this._arrow){this._arrow.el.setTo(b)}},arrowEnd:function(b,a){if(this._arrow){this._arrow.el.setTo(b)}this._arrow=undefined},_onMove:function(){},keyNext:function(){if(this._movePointer<this._moves.length-1){this._movePointer++;this._onNav(true)}},keyBack:function(){if(this._movePointer>0){this._movePointer--;this._onNav(true)}},toStart:function(){if(this._movePointer>0){this._movePointer=0;this._onNav(true)}},toEnd:function(){if(this._movePointer<this._moves.length-1){this._movePointer=this._moves.length-1;this._onNav(true)}},_onNav:function(b){this._uif(this._movePointer===0?"_uwd":"_uv8");this._uif(this._movePointer===this._moves.length-1?"_u8d":"_ux8");var a=this._moves[this._movePointer];this.lastMove=a.move;this.fen=a.fen;this.views.board._u0g(this.fen);this.onFenUpdated();this.updateFen(a.move,a.color);this._uif("move",a);if(b){this.updateLocalStore()}},restartEngine:function(){if(this._restartTimer){clearTimeout(this._restartTimer)}if(!this.compMode){return}this.stopEngine();var a=function(){if(this.compMode){this.startEngine()}this._restartTimer=undefined}.bind(this);this._restartTimer=setTimeout(a,1500)},addView:function(a){this.views[a.submodule]=a;switch(a.submodule){case"wordpress.computereval":a.on("error",this.restartEngine.bind(this));break;case"board":a.enableInstructorMode();a.on("move",function(b,c){this.lastMove=b;this.updateFen(b,c.color);this._moves=this._moves.slice(0,this._movePointer+1);this._moves.push({fen:this.fen,move:b,color:c.color});this._movePointer=this._moves.length-1;this._uif("_uv8");this._uif("move",b);this.updateLocalStore();this.restartEngine()}.bind(this));a.on("fen",function(b){if(b!==this.fen){this.fen=b;this.resetMoves();this.onFenUpdated();this.lastMove=undefined;this._uif("_uwd");this._uif("_u8d")}}.bind(this));a.on("clickSquare",this.clickSquare.bind(this));a.on("arrowStart",this.arrowStart.bind(this));
a.on("arrowEnd",this.arrowEnd.bind(this));a.on("arrowMove",this.arrowMove.bind(this));break;case"metadata.FenField":this._fenField=a;a.on("change",function(b,c){if(this.validateFen(b)){}else{c.val(this.defFen)}}.bind(this));break;case window.chess.Views.buttonbar.bar:if(!a.name){this._buttonBar=a;a.on("comp",function(){this.toggleCompMode()}.bind(this));a.on("flip",function(){this.views.board._u0g(this.fen);this.views.board.flip()}.bind(this));a.on("previous",this.keyBack.bind(this));a.on("next",this.keyNext.bind(this));a.on("start",this.toStart.bind(this));a.on("end",this.toEnd.bind(this));a.on("board",function(){this.views.board._u0g(this.defFen)}.bind(this));a._uOb("board")}else{a._uOb("enter");a.on("enter",function(){var b=this._fenField.val();if(this.validateFen(b)){this.views.board._u0g(b)}}.bind(this))}break}return true},_fenField:undefined,defFen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"});chess.model.Game=new Class({Extends:Events,moveParser:undefined,model:{},_usd:null,_uxa:[],_ugf:{},defaultFen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",gameReader:null,dirty:false,_uFa:{},_uw9:{},_u57:{},gameIndex:-1,countGames:-1,INCLUDE_COMMENT_MOVES:true,startFen:undefined,state:{autoplay:false},id:undefined,initialize:function(b){b=b||{};this.moveParser=new chess.parser.Move0x88();var a=this.gameReader=new chess.remote.GameReader();a.on("beforeLoad",this.beforeLoad.bind(this));a.on("load",this.afterLoad.bind(this));a.on("load",this.populate.bind(this));a.on("newMove",this.appendRemoteMove.bind(this));a.on("saved",this.gameSaved.bind(this));this._uc7();if(b.id||b.pgn){if(window.chess.isWordPress&&b.pgn){this.loadGame.delay(20,this,[b.id,b.pgn])}else{if(b.pgn){this._uY8.delay(20,this,[b.pgn,b.gameIndex])}else{this.loadGame.delay(20,this,b.id)}}}else{this.setDirty()}if(b.metadata!==undefined){this.setMetadata(b.metadata)}if(b.databaseId!==undefined){this.databaseId=b.databaseId}},beforeLoad:function(){this.fire("beforeLoad")},afterLoad:function(){this.fire("afterLoad")},getId:function(){return this.model.id},loadGame:function(a,b){this.gameReader.loadGame(a,b)},_ur1:function(b,a){this.gameReader.loadGame(a,b)},_uw:function(b,a){this.gameIndex=a;this.gameReader._uY8(b,a)},_um1:function(a){if(this.gameIndex==-1){this.gameIndex=0}else{this.gameIndex++}this.gameReader._uY8(a,this.gameIndex)},_uY8:function(b,a){this.gameReader._uY8(b,a)},_ur3:function(a){if(this.gameIndex==-1){this.gameIndex=0}else{this.gameIndex++}this.gameReader._uY8(a,this.gameIndex)},_u21:function(a){if(this.gameIndex==-1){this.gameIndex=0}else{this.gameIndex--}this.gameIndex=Math.max(0,this.gameIndex);this.gameReader._uY8(a,this.gameIndex)},_uzc:function(){return this.gameIndex},_uBc:function(a){this.gameIndex=a},_u58:function(a){this.gameReader._u58(a)},_u71:function(a){this.gameReader._u71(a)},_uq9:function(){var a=this._uG1();this.gameReader._uq9(a)},appendRemoteMove:function(a){this.toEnd();this._u4f(a)},isModelFor:function(a){if(a.gameIndex){return a.gameIndex===this.model.gameIndex}if(a.id){return a.id===this.model.id}return false},newGame:function(){this._u0d(this.defaultFen)},activate:function(){this.fire("newGame");this.fire("_u0d")},_u0d:function(a){this._uc7();this.model.metadata.fen=a;this.fire("noMoves");this.fire("newGame");this.fire("_u0d")},undoRedo:function(a){if(!a){return}this.populate(a.model);this.goToMove(a._usd)},populate:function(a){this._uc7();a=this._uv5(a);this.model.id=a.id||a.metadata.id||this.model.id;this.model.gameIndex=a.gameIndex||undefined;this.model.metadata.fen=a.fen||a.metadata.fen;this.startFen=this.model.metadata.fen;this.model.result=this.getResult();this.model.moves=a.moves||[];this.model.metadata=a.metadata||{};this.databaseId=a.databaseId;this._uxa=this.model.moves;this._usd=undefined;this._upcs(this.model.moves,this.model.metadata.fen);if(a.games!=undefined){this.countGames=a.games.c;this.gameIndex=a.games.i}this.fire("loadGame",a);this.fire("newGame");this.toStart()},reservedMetadata:["actions","clk","event","site","date","round","white","black","result","annotator","termination","fen","plycount","database_id","id","pgn","pgn_id","draft_id","eval"],_uv5:function(a){if(a.metadata&&jQuery.isArray(a.metadata)){a.metadata={}}a.metadata=a.metadata||{};for(var c=0;c<this.reservedMetadata.length;c++){var b=this.reservedMetadata[c];if(a[b]!==undefined){a.metadata[b]=a[b];delete a[b]}}return a},getModel:function(){return this.model},hasShortFormat:function(a){for(var b=0;b<a.length;b++){if(a[b].n){return true}}return false},_upcs:function(b,g,f){var a;b=b||[];if(this.hasShortFormat(b)){this.toLongFormat(b)}for(var d=0;d<b.length;d++){a=b[d];if(this._uyd(a)){a=this._urc(a,g);if(a.variations&&a.variations.length>0){for(var c=0;c<a.variations.length;c++){this._upcs(a.variations[c],g,a)}}g=a.fen}if(a.uid==undefined){a.uid="move-"+String.uniqueID()}this._ugf[a.uid]=a;a.index=d;if(f){this._uY3(a,f)}this._u54(a,b);if(d>0){this._ut2(a,b[d-1])}b[d]=a}},toLongFormat:function(a){this.branchToLongFormat(a)
},branchToLongFormat:function(a){a.forEach(function(b){if(b.n){b.from=b.n.substr(0,2);b.to=b.n.substr(2,2);if(b.v){b.v.forEach(function(c){this.branchToLongFormat(c)}.bind(this))}b.variations=b.v;b.n=undefined;b.v=undefined}}.bind(this))},_ut2:function(a,b){this._u57[a.uid]=b},_uY3:function(a,b){this._uw9[a.uid]=b},_u54:function(a,b){this._uFa[a.uid]=b},_uDf:function(a){return this._uFa[a.uid]},_uc7:function(){this._ugf={};this.model={id:"temp-id-"+String.uniqueID(),metadata:{fen:this.defaultFen,result:"*"},moves:[]};this._uxa=this.model.moves;this._usd=undefined},fen:function(){return this._uT2()},setMetadata:function(a){jQuery.each(a,function(b,c){this._ux5(b,c)}.bind(this))},_ux5:function(a,b){this.model.metadata[a]=b;this.fire("_u08",{key:a,value:b})},getMetadata:function(){return this.model.metadata},_uy5:function(a){return this.model.metadata[a]},getMoves:function(){return this.model.moves||[]},_uz5:function(){return this.model.metadata.fen},tryNextMove:function(a){var d=this._uT2();if(!a.promoteTo&&this.moveParser._ug7(a,d)){this.fire("verifyPromotion",a);return true}var c=this._ud7(this._usd);for(var b=0;b<c.length;b++){if(this.isCorrectGuess(a,c[b])){if(c[b].promoteTo){a.promoteTo=c[b].promoteTo}this.goToMove(c[b]);this.fire("correctGuess",c[b]);return true}}this.fire("wrongGuess");return false},isCorrectGuess:function(b,a){if(a.from==b.from&&a.to==b.to){return !(b.promoteTo&&!this._uA5(a,b.promoteTo))}return false},_uA5:function(c,a){var b=c.moves;for(var d=0;d<b.length;d++){if(b[d].promoteTo&&b[d].promoteTo==a){return true}}return false},getResult:function(){if(this.model.result!==undefined&&this.model.result!==0){return this.model.result}var a=this._uy5("result");if(a=="1-0"){this.model.result=1;return 1}if(a=="0-1"){this.model.result=-1;return -1}if(a=="1/2-1/2"){this.model.result=0.5;return 0.5}var b=this._uf4();if(b&&b.fen){var d=new chess.parser._uQ9();d.setFen(b.fen);var c=d._uW();this.model.result=c.result;return c.result}return 0},canClaimDraw:function(){return this.moveParser._uV(this.getAllFens())},getAllFens:function(){var a=this.getMoves();var b=[];for(var c=0;c<a.length;c++){if(a[c].fen!==undefined){b.push(a[c].fen)}}return b},_uf4:function(){if(this.model.moves.length>0){return this.model.moves[this.model.moves.length-1]}return undefined},_uG1:function(){if(this.model.moves.length>0){return this.model.moves[this.model.moves.length-1].fen}return this.model.metadata.fen},_ud7:function(d){d=d||this._usd;var f;if(this.model.moves.length==0){return[]}if(!d){f=this.model.moves[0]}else{f=this._uud(d)}var b=[];if(f){b.push(f)}if(f.variations.length>0){for(var c=0;c<f.variations.length;c++){var a=f.variations[c][0];b.push(a)}}return b},countMoves:function(){return this.model.moves.length},appendLine:function(h,k){h=h.trim();if(h.length==0){return undefined}var c=h.split(/\s/g);var d=new chess.parser._uQ9(this._uT2());var a=true;jQuery.each(c,function(o,n){c[o]=this.stringToMove(n);c[o]=this._urc(c[o],d.getFen());if(c[o]){d.move(c[o])}else{a=false;return undefined}}.bind(this));if(!a){return undefined}var j=Object.clone(this._uW6(this._usd));var g=this._uud();var f=false;var l=this._uxa;if(this._usd&&k){l=this._uA3(this._usd);var b=Object.clone(this._usd);b.uid=undefined;this._upc(b,undefined,l);this._ut2(b,j);j=b;f=true}jQuery.each(c,function(o,n){if(g&&!f){if(g.from==n.from&&g.to==n.to&&!k){g=this._uud(g)}else{l=this._uA3(g);f=true;this._upc(n,undefined,l)}}else{this._upc(n,undefined,l)}if(f){this._uC1(n,g,j)}j=n}.bind(this));this.setDirty();this.fire("newMoves");return j},stringToMove:function(a){return{from:a.substr(0,2),to:a.substr(2,2),promoteTo:(a.length==5)?a.substr(4,1):undefined}},move:function(a){return this._u4f(a)},_u4f:function(a){var d=this._uT2();if(ludo.util.isString(a)){a=this.moveParser._uA4(a,d)}if(!a.promoteTo&&this.moveParser._ug7(a,d)){this.fire("verifyPromotion",a);return false}var b=this._uud(this._usd);if(b){if(a.from!==b.from||a.to!=b.to){var c;if(c=this._un(a)){this.goToMove(c);return false}if(a=this._urc(a,d)){this.fire("_uL1",{newMove:a,oldMove:b});return false}}else{this.nextMove();return false}}if(a=this._urc(a,d)){this._upc(a);this._uG8(a);this.fire("newMove",a);this.fire("_u8d");if(this._uUa()){this.fire("endOfGame")}return true}else{this.fire("invalidMove",a);return false}},overwriteMove:function(b,c){var a=this.findMove(b);if(a){this.deleteMove(b);this._u4f(c)}},_urc:function(a,b){if(this.moveParser.isValid(a,b)){return this.moveParser._uU9(a,b)}else{if(window.console!=undefined){console.log("Parse error on move",a,b);console.log(a);console.trace()}}return null},_uC1:function(a,b,c){this._uY3(a,b);if(c){this._ut2(a,c)}},_uec:function(c){if(this._uy(c)){this.goToMove(this._uud(this._usd));return undefined}var b=this._ui2();if(b){if(c=this._urc(c,b)){this._uxa=this._uA3();var a=this._uW6(this._usd);this._upc(c);this._uG8(c);this._uC1(c,this._usd,a);this.fire("_uec",this._uLa(c));this.fire("newMove",c);this.fire("_u8d")}else{this.fire("invalidMove",c)}}},_uy:function(a){return this._un(a)?true:false
},_un:function(a){var c;if(c=this._uud(this._usd)){var f=c.variations;for(var b=0;b<f.length;b++){var d=f[b][0];if(d.from===a.from&&d.to===a.to){return d}}}return undefined},_uA3:function(b){b=b||this._usd;b.variations=b.variations||[];var a=[];b.variations.push(a);return b.variations[b.variations.length-1]},_uT2:function(){if(this._usd&&this._usd.fen){return this._usd.fen}return this.model.metadata.fen},_ui2:function(){if(this._usd){var a=this._uW6(this._usd);if(a){return a.fen}else{return this.model.metadata.fen}}return this.model.metadata.fen},deleteMove:function(b){var a=this.findMove(b);if(a){var d=this._uW6(a);var c=this._uA1(a);this._uz3(this._uDf(a),a.index);if(b.action){this.fire("deleteAction",a)}else{this.fire("deleteMove",a);this.fire("_u8d");if(this._uUa()){this.fire("endOfGame")}else{this.fire("_uMc")}if(!this._uE5(this._uDf(a))){this.fire("noMoves")}if(d){this._uG8(d)}else{this._uF5()}if(c){this.fire("deleteVariation",a)}}}},_uA1:function(a){var c=this._uLa(a);if(c!==undefined){var b=this._uDf(a);if(b.length===0){return true}if(a===b[0]){return true}}return false},_uUa:function(){if(this.model.moves.length===0){return true}return this._usd&&this._usd.uid==this.model.moves[this.model.moves.length-1].uid},_uE5:function(b){if(b.length===0){return false}for(var a=0;a<b.length;a++){if(b[a].m){return true}}return false},_uz3:function(c,b){for(var a=b;a<c.length;a++){delete this._ugf[c[a].uid]}c.length=b},findMove:function(a){return a!=undefined&&this._ugf[a.uid]?this._ugf[a.uid]:this._uA(a)},_uA:function(a){if(!a||!a.fen||!a.lm){return null}if(!this.model.moves){return null}return this._ud(a,this.model.moves)},_ud:function(f,d){for(var c=0;c<d.length;c++){var a=d[c];if(a.fen==f.fen&&a.lm==f.lm){return a}if(a.variations&&a.variations.length>0){for(var b=0;b<a.variations.length;b++){return this._ud(f,a.variations[b])}}}},_uF5:function(){this._usd=undefined;this._uxa=this.model.moves;this.fire("_uF5")},to:function(a){if(this._uG8(a)){this.fire("_u0d",a)}},goToMove:function(a){return this.to(a)},forward:function(a){var d=this._uxa||this.model.moves;var c=this._usd?d.indexOf(this._usd):0;var b=d[c+a];if(b){this.goToMove(b)}},back:function(a){if(!this._usd){return undefined}a=a||1;var g=this._uxa;var d=g.indexOf(this._usd);var c;var b={};var f;while(d>=0&&a>0){d--;if(d<0&&a>0){f=this._uLa(b);if(f){b=f;g=this._uDf(b);d=g.indexOf(b);d--}}if(d>=0){b=g[d];if(this._uyd(b)){c=b;a--}}}if(this._uyd(c)){return this._uG8(c)}return false},getMove:function(a){return this.findMove(a)},re_u0d:function(){if(this._usd){this.goToMove(this._usd)}else{this.toStart()}},_uG8:function(b){var a=this.findMove(b);if(a){this._usd=a;this._uxa=this._uDf(a);this.fire("_uv8");if(this._uud(a)){this.fire("_ux8");this.fire("_uMc")}else{this.fire("_u8d");if(this._uUa()){this.fire("endOfGame")}}return true}return false},turn:function(){var b=this._uT2().split(" ");var a={w:"white",b:"black"};return a[b[1]]},_uT8:function(){return this.turn()},_uvd:function(){return this._ply(this.model.metadata.fen)},_uRa:function(){return this._ply(this._uT2())},_ply:function(c){var d=c.split(/\s/g);var b=d.pop();var a=(b-1)*2;if(d[1]=="b"){a++}return a},_uz8:function(){return this._usd},_uJ5:function(){return this._uJ5()},_udc:function(){var a=this._uW6(this._usd);if(a){this._uG8(a);this.fire("_u0d",a)}else{this.toStart()}},nextMove:function(){var a;if(this.hasCurrentMove()){a=this._uud(this._usd)}else{a=this.getFirstMoveInGame()}if(a){this._uG8(a);this.fire("nextmove",a)}},toStart:function(){this.fire("_uwd");this._uF5();this.fire("_u0d");if(this.model.moves.length>0){this.fire("_ux8");this.fire("_uMc")}else{this.fire("_u8d");this.fire("endOfGame")}},handleActions:function(){this.fire("clearActions");if(this._usd){this.fireAction(this._usd)}else{var a=this.model.moves;if(a&&a.length&&!a[0].m){this.fireAction(a[0])}}},fireAction:function(b){if(b.actions&&b.actions.length){var c=b.actions;jQuery.each(c,function(a,d){this.fire("action",d)}.bind(this))}},toEnd:function(){if(this.model.moves.length>0){this._usd=this.model.moves[this.model.moves.length-1];this.fire("_u0d");this.fire("_u8d");this.fire("_uv8");this.fire("endOfGame")}},toEndOfCurrentBranch:function(){if(this._uxa.length>0){this._usd=this._uxa[this._uxa.length-1];this.fire("_u0d");this.fire("_u8d");this.fire("_uv8");if(this._uUa()){this.fire("endOfGame")}}},hasCurrentMove:function(){return this._usd?true:false},getFirstMoveInGame:function(){for(var b=0;b<this.model.moves.length;b++){var a=this.model.moves[b];if(this._uyd(a)){return a}}return null},_uLa:function(a){a=this.findMove(a);if(a){return this._uw9[a.uid]}return undefined},_uW6InBranch:function(a){if(a.index>0){var b=a.index-1;var c=this._uDf(a);var d=c[b];while(!this._uyd(d)&&b>0){b--;d=c[b]}if(this._uyd(d)){return d}}return null},_uW6:function(a,d){d=d||false;a=this.findMove(a);if(a){var g=this._u57[a.uid];if(g){if(d&&g.comment){return g}if(!g.from){return this._uW6(g)}return g}if(a.index>0){var c=this._uDf(a);var f=c[a.index-1];g=this._u57[a.uid];
if(d&&g&&g.comment){return g}if(!f.from&&!d){return this._uW6(f)}return c[a.index-1]}var b=this._uLa(a);if(b){return this._uW6(b)}}return undefined},nextOf:function(a){a=a||this._usd;if(!a){if(!this._usd&&this.model.moves.length>0){a=this.model.moves[0];if(!this._uyd(a)){return this._uud(a)}return this.model.moves[0]}return undefined}a=this.findMove(a);if(a){var b=this._uDf(a);if(a.index<b.length-1){return b[a.index+1]}}return undefined},_uud:function(a){return this.nextOf(a)},addAction:function(b){b=Object.clone(b);if(this._usd){var a=this._usd.index+1;this._upc(b,a)}else{this._upc(b)}this.fire("newaction")},_uof:function(a,b){a=this.findMove(a);if(a){a.m=a.m.replace(/[!\?]/g,"");a.lm=a.lm.replace(/[!\?]/g,"");b=b.replace(/[^!\?]/g,"");if(b||b==""){a.m=a.m+b;a.lm=a.lm+b;this.fire("updateMove",a)}}},_upc:function(a,b,c){c=c||this._uxa;a.uid=a.uid!=undefined?a.uid:"move-"+String.uniqueID();this._ugf[a.uid]=a;this._u54(a,c);if(b){a.index=b;this._u22(c,b,a)}else{a.index=c.length;c.push(a)}},_u22:function(c,b,d){b=b||0;c.splice(b,0,d);for(var a=0;a<c.length;a++){c[a].index=a}},_uO4:function(a){a=this.findMove(a);if(a){var b;if(b=this._uW6(a,this.INCLUDE_COMMENT_MOVES)){return b.comment?b.comment:""}}return""},_ub6:function(a){a=this.findMove(a);if(a){return a.comment?a.comment:""}return""},setGameComment:function(c){if(this.model.moves.length>0){var b=this.model.moves[0];if(b.m==undefined){this._uU6(c,b)}else{this._uN5(c,b)}}else{var a={comment:c,index:0,uid:"move-"+String.uniqueID()};this._upc(a);this.fire("updateMove",this.model.moves[0])}},_uN5:function(d,a){a=this.findMove(a);if(a){var c=this._uW6(a,this.INCLUDE_COMMENT_MOVES);if(c){this.setComment(c,d)}else{a=this.findMove(a);var b=this._uDf(a);this._u22(b,0,{comment:d,index:0,uid:"move-"+String.uniqueID()});this._ugf[a.uid]=a;this._ut2(a,b[0]);this.fire("updateMove",b[0])}}},_uU6:function(b,a){a=this.findMove(a);if(a){this.setComment(a,b)}},setEval:function(eval,move){move=move||this._usd;move=this.findMove(move);if(move){move.eval=eval;this.fire("updateMove",move)}},setComment:function(a,b){a.comment=b;this.fire("updateMove",a)},_uyd:function(a){return((a.from&&a.to)||(a.m&&a.m=="--"))?true:false},_uP5:"",fire:function(a,c){if(a==="updateMove"||a=="newMove"||a=="_u08"){this.setDirty()}var b=chess.events.game[a]||a;this._uif(b,[b,this,c]);if(b=="_u0d"||b=="newGame"||b=="newMove"||b=="newMove"||b=="nextmove"){if(!this._usd||this._uP5!=this._usd){this._uif("fen",["fen",this,this._uT2()]);this.handleActions();this._uP5=this._usd}}},_u5a:function(){this.state.autoplay=true;this.fire("_u3a");this._uQ5()},stopAutoPlay:function(){if(this.state.autoplay){this.state.autoplay=false;this.fire("stopAutoplay")}},_uQ5:function(){if(this.state.autoplay){var a=this._uud(this._usd);if(a){this.nextMove.delay(1000,this)}else{this.stopAutoPlay()}}},isInAutoPlayMode:function(){return this.state.autoplay},getDatabaseId:function(){return this.databaseId},setDirty:function(){this.dirty=true;this._uif("dirty",this)},setClean:function(){this.dirty=false;this._uif("clean",this)},isDirty:function(){return this.dirty},save:function(){this.gameReader.save(this.modelForServer());this.setClean()},modelForServer:function(){return this._us3(this.model)},_us3:function(a){a=Object.clone(a);a.metadata=a.metadata||{};for(var c=0;c<this.reservedMetadata.length;c++){var b=this.reservedMetadata[c];if(a.metadata[b]!==undefined){a[b]=a.metadata[b];delete a.metadata[b]}}if(!a.result){a.result="*"}return a},gameSaved:function(a){new ludo.Notification({html:chess.__("Game saved successfully"),duration:1,_u79:0.5});if(a.id){this.model.id=a.id}this.fire("gameSaved",this.model)},_uOc:function(){return this.moveParser._uOc(this._uT2())}});chess.remote.Reader=new Class({Extends:Events,onLoadEvent:undefined,query:function(a){this.onLoadEvent=a.eventOnLoad||"load";jQuery.ajax({url:ludo.config.getUrl(),method:"post",cache:false,dataType:"json",data:a,success:function(b){this._uif(this.onLoadEvent,b.response!=undefined?b.response:b)}.bind(this),fail:function(c,b){this._uif("fail",[c,b,this])}.bind(this)})},_remoteHandler:undefined,remoteHandler:function(a){if(this._remoteHandler===undefined){this._remoteHandler=new ludo.remote.JSON({resource:a,listeners:{success:function(b){this._uif(this.onLoadEvent,b.getResponseData())}.bind(this)}})}this._remoteHandler.setResource(a);return this._remoteHandler},getOnLoadEvent:function(){return this.onLoadEvent}});chess.remote.GameReader=new Class({Extends:chess.remote.Reader,loadGame:function(c,b){this._uif("beforeLoad");var a={eventOnLoad:"load"};if(window.chess.isWordPress){a.action="game_by_id";a.pgn=b;a.id=c}else{a.resource="Game";a.service="read";a.arguments=c}this.query(a)},_uY8:function(c,a){this._uif("beforeLoad");var b={eventOnLoad:"load"};if(window.chess.isWordPress){b.action="game_by_index";b.pgn=c;b.index=a}else{b.resource="ChessFs";b.service="getGame";b.arguments=c;b.data=a}this.query(b)},save:function(a){if(this.hasDummyId(a)){delete a.id}var b={resource:"Game",service:"save",eventOnLoad:"saved","arguments":a.id,data:a};
if(window.chess.isWordPress){b.action="save_game";b.id=a.id;b.game=a}else{b.resource="Game";b.service="save";b.arguments=a.id;b.data=a}this.query(b)},hasDummyId:function(a){return/[a-z]/g.test(a.id||"")},_u58:function(a){this._uif("beforeLoad");this.query({resource:"Database","arguments":a,service:"randomGame"})},_u71:function(a){this._uif("beforeload");if(window.chess.isWordPress){this.query({action:"random_game",pgn:a})}else{this.query({resource:"ChessFS","arguments":a,service:"getRandomGame"})}},_uq9:function(a){this.query({resource:"ChessEngine","arguments":a,service:"getMove",eventOnLoad:"newMove"})}});chess._une.GameList=new Class({Extends:ludo._une.JSONArray,type:"chess._une.GameList",autoload:false,singleton:true,resource:"Database",postData:{resource:"Database"},_ukd:function(a){this.url=ludo.config.getUrl();this.parent(a)}});chess._une.PgnGames=new Class({Extends:ludo._une.JSONArray,type:"chess._une.PgnGames",autoload:true,singleton:true,resource:"ChessFS",service:"listOfGames",_uze:"index",postData:{resource:"ChessFS",service:"listOfGames","arguments":undefined},_uMa:function(){return this.postData.arguments},_ukd:function(a){this.url=ludo.config.getUrl();if(a.pgn!=undefined){this.postData.arguments=a.pgn}this.parent(a)},loadFile:function(a){this.postData.arguments=a;this._u1e(this.service,a)},getPgnFileName:function(){return this.postData.arguments}});chess.wordpress.GameListGrid=new Class({Extends:chess.view.gamelist.Grid,headerMenu:false,submodule:"wordpress.gamelist",_une:undefined,emptyText:chess.__("No games"),_uDd:chess.__("Loading games..."),cols:["white","black","round","result","last_moves"],_ukd:function(a){this._une={id:"editor_game_list_ds",type:"ludo._une.JSONArray",autoload:false,postData:{action:"list_of_games"},paging:{size:25}};this.parent(a)},__ucf:function(){this.parent();this.loadGames();this.on("show",this.loadGames.bind(this))},_uv9:function(a){this.parent(a);a.on("publish",function(){if(this._uoe.pgn){this._up9().load()}}.bind(this));a.on("imported",function(){if(this._uoe.pgn){this._up9().load()}}.bind(this))},loadGames:function(){if(this._uoe){if(this._uoe.pgn&&this._uoe.pgn!==this._up9().postData.pgn){this.load()}}else{if(this._up9().postData.pgn){this.load()}}},load:function(){if(this._uoe&&this._uoe.pgn){this.getParent()._uUf(chess.__("PGN:")+" "+this._uoe.pgn.pgn_name);this._up9().postData.pgn=this._uoe.pgn.id;this._up9().load()}else{if(this._up9().postData.pgn){this._up9().load()}}},_uKe:function(a){this._uif("_uKe",[a,this._up9().postData.pgn])}});chess.wordpress.GameList=new Class({Extends:ludo._une.JSONArray,type:"chess.wordpress.GameList",autoload:false,singleton:true,resource:"Database",postData:{action:"list_of_games"},_ukd:function(a){if(a.singleton!==undefined){this.singleton=a.singleton}this.url=ludo.config.getUrl();this.parent(a);this.sortFn=this.sortFn||{};this.sortFn.round={asc:function(d,c){return this.compareRound(d,c,1)}.bind(this),desc:function(d,c){return this.compareRound(d,c,0)}.bind(this)}},compareRound:function(d,c,g){var j=this.sortVal(d);var h=this.sortVal(c);var f=j<h?1:-1;if(!g){f*=-1}return f},sortVal:function(b){var a=b.round;if(!a){return 1}var c=a.split(/\./g);if(c.length==1){return parseInt(c[0])}return parseInt(c[0]*1000)+parseInt(c[1])},loadPgn:function(a){this.postData.pgn=a;this._u1e(this.service,a)}});chess.computer.Elo=new Class({K:30,PROVISIONAL:8,db:undefined,MIN_ELO:800,clearAll:function(){this.db.empty()},initialize:function(){this.db=ludo._uZ6()},_uT6:function(){return this.db.get("played","0")=="1"},_uCd:function(a,c){var b=a+(c*30);if(b<60*3){return"bullet"}if(b<=60*8){return"blitz"}return"classical"},getEloByTime:function(b,a){return this.getElo(this._uCd(b,a))},getElo:function(a){return Math.max(this.MIN_ELO,this.db.getNumeric("elo"+a,1200))},saveResult:function(n,a,m,b){this.db.save("played","1");var j=this.incrementGames(m);var d;if(j<=this.PROVISIONAL){var k=this.db.get("provisional"+m,[]);var h=n==-1?a-400:n==0?a:a+400;h=Math.max(this.MIN_ELO,h);k.push(h);this.db.save("provisional"+m,k);var g=0;jQuery.each(k,function(c,o){g+=o});d=Math.max(this.MIN_ELO,g/k.length)}else{var f=this.getElo(m);if(b=="black"){a*=1.05}else{a-=(a*0.05)}var l=this._uq2(f,a,n);d=f+l}return this.db.save("elo"+m,d)},_uq2:function(c,b,a){a+=1;a/=2;var d=this.getExpectedScore(c,b);return this.K*(a-d)},getExpectedScore:function(a,d){var c=Math.pow(10,a/400);var b=Math.pow(10,d/400);return c/(c+b)},incrementGames:function(a){var b=this.countGames(a)+1;this.db.save("games"+a,b);return b},countGames:function(a){return this.db.getNumeric("games"+a,0)}});chess.computer.Clock=new Class({Extends:Events,time:undefined,increment:undefined,turn:"white",savedTime:undefined,started:false,initialize:function(){this.tick()},tick:function(){if(this.started){this._u8c();this.onChange()}this.tick.delay(100,this)},stop:function(){this.time[this.turn]=this.getTime(this.turn);this.started=false;this.savedTime=new Date().getTime();this.onChange()},_u8c:function(){var a=this.getTime(this.turn);
if(a==0){this.time[this.turn]=this.getTime(this.turn);this.onChange();this._uif("end",this.turn);this.started=false}},wTime:function(){return this.getTime("white")},bTime:function(){return this.getTime("black")},inc:function(){return this.increment},setTime:function(b,a){a=a||0;this.time={};this.time.white=b*1000;this.time.black=b*1000;this.increment=a*1000;this.onChange()},start:function(b,a){if(arguments.length==2){this.setTime(b,a)}this.turn="white";this.savedTime=new Date().getTime();this.started=true;this.onChange()},tap:function(){this.time[this.turn]=this.getTime(this.turn)+this.increment;this.turn=this.turn=="white"?"black":"white";this.savedTime=new Date().getTime();this.onChange()},getTime:function(a){var b=this.time[a];if(this.turn==a&&this.started){b-=new Date().getTime()-this.savedTime}return Math.max(0,b)},onChange:function(){this._uif("change",[this.turn,this.timeAsObject("white"),this.timeAsObject("black")])},timeAsObject:function(c){var g=this.getTime(c);var b=g<10000?parseInt((g/100)%10):undefined,h=parseInt((g/1000)%60),f=parseInt((g/(1000*60))%60),a=parseInt((g/(1000*60*60))%24);var d={h:a,m:this.pad(f,2),s:this.pad(h,2),d:b,totalSeconds:g/1000};d.string=(d.h>0?d.h+":":"")+d.m+":"+d.s+(d.totalSeconds<10?":"+d.d:"");return d},pad:function(a,b){var c=a+"";while(c.length<b){c="0"+c}return c}});chess.computer.ClockView=new Class({Extends:ludo.View,color:undefined,module:"chess",submodule:"computer.clockview",elo:undefined,pos:undefined,lastColor:undefined,_ukd:function(a){this.parent(a);this.color=a.color;this.pos=a.pos},_uTf:function(a){this.color=a;this.$b().removeClass("clock-turn");this.lastColor=undefined},__ucf:function(){this.parent();this.$e.addClass("dhtml-chess-clock");this.showTime()},_uv9:function(a){this.parent(a);if(a.clock){a.clock.on("change",this.update.bind(this))}this.elo=a.elo},update:function(b,a,c){var d=this.color=="white"?a:c;if(b!=this.lastColor){this.$b().removeClass("clock-turn");if(b==this.color){this.$b().addClass("clock-turn")}}this.$b().html(d.string);this.lastColor=b},resize:function(a){this.parent(a);this.getBody().css({"line-height":a.height+"px","font-size":(a.height*0.6)+"px"})},showTime:function(a){if(a==undefined){this.getBody().html("00:00")}else{}}});chess.computer.GameDialog=new Class({Extends:ludo.dialog.Dialog,module:"chess",submodule:"chess.computer.gamedialog",autoRemove:false,layout:{width:300,height:300,type:"table",simple:true,columns:[{weight:1},{width:50},{weight:1},{width:50}]},css:{padding:10},buttonConfig:"Ok",elo:undefined,color:undefined,modal:false,_ukd:function(a){a=a||{};a.title=chess.__("New Game");this.parent(a);this.elo=new chess.computer.Elo()},__ucf:function(){this.parent();this.$b().addClass("dhtml-chess-comp-dialog");this.on("ok",this.onNewGame.bind(this));this.selectColor("white");this.child["color-white"].$b().on("click",function(){this.selectColor("white")}.bind(this));this.child["color-black"].$b().on("click",function(){this.selectColor("black")}.bind(this))},selectColor:function(b){this.color=b;var a="dhtml-chess-comp-dialog-selected-color";this.child["color-black"].$b().removeClass(a);this.child["color-white"].$b().removeClass(a);this.child["color-"+b].$b().addClass(a)},__children:function(){return[{type:"form.Label",label:chess.__("Your color:"),layout:{colspan:4}},{name:"color-white",layout:{colspan:2,height:50},elCss:{margin:2},css:{"border-radius":"5px","background-color":"#CCC",color:"#444",cursor:"pointer","line-height":"45px",border:"2px solid transparent","text-align":"center"},html:chess.__("White")},{name:"color-black",layout:{colspan:2,height:50},elCss:{margin:"2px"},css:{"border-radius":"5px",cursor:"pointer","background-color":"#777",color:"#fff","line-height":"45px",border:"3px solid transparent","text-align":"center"},html:chess.__("Black")},{type:"form.Label",label:chess.__("Opponent rating:"),labelFor:"name",layout:{colspan:2}},{type:"form.Number",name:"_uhc",placeholder:chess.__("ex: 1400")},{layout:{colspan:1}},{layout:{colspan:4,height:20}},{type:"form.Label",label:chess.__("Time"),css:{"font-size":"1.3em"},layout:{colspan:2}},{type:"form.Label",label:chess.__("Increment"),layout:{colspan:2}},{type:"form.Select",name:"game-time",value:5,_une:{data:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,20,30,45,60,90,120]},listeners:{change:this.onTimeChange.bind(this)}},{html:chess.__("min"),css:{padding:5}},{type:"form.Select",name:"game-inc",value:3,_une:{data:[0,1,2,3,5,10,12,15,30]},listeners:{change:this.onTimeChange.bind(this)}},{html:chess.__("sec"),css:{padding:5}},{elCss:{"margin-top":10},css:{"text-align":"center"},name:"your-elo",layout:{colspan:4},html:chess.__("Your rating")}]},onTimeChange:function(){var b=this.child["game-time"].val()/1;var d=this.child["game-inc"].val()/1;var a=this.elo._uCd(b*60,d);var c=Math.round(this.elo.getElo(a));this.child["your-elo"].html(chess.__("Your rating")+": "+c+" ("+a+")");this.child._uhc.val(c)},_uv9:function(a){this.parent(a);this._uoe.on("newgamedialog",this.show.bind(this))
},show:function(){this.parent();this.onTimeChange()},onNewGame:function(){this._uif("newGame",{time:this.child["game-time"].val()/1,inc:this.child["game-inc"].val()/1,elo:this.child._uhc.val()/1,color:this.color})}});chess.computer.DialogTimeButton=new Class({Extends:ludo.View,_ukd:function(a){this.parent(a);this.time=a.time}});chess.computer.ComputerStatusDialog=new Class({Extends:ludo.dialog.Dialog,module:"chess",modal:true,submodule:"chess.computer.computerstatusdialog",updateFn:undefined,layout:{type:"relative",width:300,height:100},css:{"text-align":"center"},_ukd:function(a){a.title=a.html=chess.__("Loading Stockfish JS");this.parent(a)},__children:function(){return[{name:"status",layout:{width:"matchParent",_uL7:true},css:{"text-align":"center"}}]},_uv9:function(a){this.parent(a);this.updateFn=function(c,b){this.child.status.html(c);if(b){this.hide.delay(100,this)}}.bind(this);a.on("enginestatus",this.updateFn)},remove:function(){if(this.updateFn){this._uoe.off("enginestatus",this.updateFn);this.updateFn=undefined}this.parent()}});chess.computer.GameOverDialog=new Class({Extends:ludo.dialog.Dialog,module:"chess",submodule:"chess.computer.gameoverdialog",autoRemove:false,hidden:true,layout:{width:300,height:200,type:"linear",_uWd:"vertical"},buttonBar:{children:[{name:"rematch",value:chess.__("Rematch")},{value:chess.__("Exit")}]},__children:function(){return[{name:"title",css:{"margin-top":15,"text-align":"center","font-weight":"bold","font-size":"1.5em","line-height":"25px"},layout:{height:50}},{css:{"text-align":"center"},name:"rating"}]},__ucf:function(){this.parent();this.getButton("rematch").on("click",this._u68.bind(this))},_u68:function(){this._uif("newgame")},_uv9:function(a){this.parent(a);a.on("gameover",this.onGameOver.bind(this))},onGameOver:function(f,c,d){this.show();var h=f==1?chess.__("You Won"):f==0?chess.__("Game Drawn"):chess.__("You lost");this._uUf(h);var a=this.child.title.$b();a.removeClass("title-win");a.removeClass("title-draw");a.removeClass("title-loss");this.child.title.html(h);var g=d-c;if(f==0){a.addClass("title-draw")}else{if(f==1){a.addClass("title-win")}else{a.addClass("title-loss")}}if(g>1){g='<span class="rating-change-win">+'+g+"</span>"}else{if(g==0){g='<span class="rating-change-draw">'+g+"</span>"}else{g='<span class="rating-change-loss">'+g+"</span>"}}this.child.rating.html(chess.__("New rating")+': <span class="new-rating">'+d+"</span> ("+g+")")}});chess.wordpress.PgnStandings=new Class({submodule:"wordpress.pgnstandings",Extends:ludo.grid.Grid,currentPgn:undefined,_une:undefined,headerMenu:false,sofiaRules:false,pgnId:undefined,_uX6:false,__columns:function(){return{player:{heading:chess.__("Player"),sortable:true,width:200,key:"player"},w:{heading:chess.__("Wins"),sortable:true,width:50},d:{heading:chess.__("Draw"),sortable:true,width:50},l:{heading:chess.__("Loss"),sortable:true,width:50},score:{heading:chess.__("Score"),sortable:true,_uHf:function(b,a){if(this.sofiaRules){return(a.w*3)+a.d}return a.w+(a.d/2)}.bind(this)}}},_ukd:function(a){this._une={type:"_une.JSONArray",autoload:false,postData:{action:"get_standings"}};this.parent(a);this._uWf(a,["sofiaRules","pgnId"])},__ucf:function(){this.parent();this._up9()._uvf("score",{desc:function(d,c){var g=d.w+(d.d/2);var f=c.w+(c.d/2);return g<f?1:-1},asc:function(d,c){var g=d.w+(d.d/2);var f=c.w+(c.d/2);return g<f?-1:1}});this._up9().on("load",this.autoSort.bind(this));this.on("show",this._uC7.bind(this));if(this.pgnId){this._up9()._uuc("pgn",this.pgnId);this._up9().load()}},_uv9:function(a){this.parent(a);a.on("pgn",this.setPgn.bind(this))},setPgn:function(a){if(a!=this.currentPgn){this.currentPgn=a}this._uC7()},autoSort:function(){this._up9().by("score").descending().sort()},_uC7:function(){if(!this.currentPgn){return}if(this._uoe&&this._uoe.pgn&&this._uoe.pgn.id!=this.currentPgn){return}this._up9()._uuc("pgn",this.currentPgn);this._up9().load()}});chess.wordpress.ComputerEval=new Class({Extends:ludo.View,submodule:"wordpress.computereval",started:false,fen:undefined,layout:{type:"linear",_uWd:"vertical"},parser:undefined,bestLine:undefined,bestLineString:undefined,currentEval:undefined,buttons:true,appendBtn:true,showNodes:true,showBar:true,__children:function(){var a=[{name:"eval",layout:{weight:1},css:{padding:4}},{name:"buttons",layout:{height:30,type:"linear",_uWd:"horizontal"},children:[{name:"startStopEngine",value:chess.__("Start"),type:"form.Button"},{visible:this.appendBtn&&!this.hideButton,name:"appendLine",value:chess.__("Append Line"),type:"form.Button"},{visible:this.appendBtn,name:"appendEval",value:chess.__("Save Eval"),type:"form.Button"},{layout:{weight:1},css:{"text-align":"right","font-style":"italic","font-size":"0.9em","padding-right":"4px"},html:'<a href="https://github.com/nmrugg/stockfish.js" onclick="var w = window.open(this.href); return false">'+chess.__("StockFish.JS Engine")+"</a>"}]}];if(this.showBar){a.unshift({name:"scoreBar",css:{margin:5},type:"chess.view.score.Bar",layout:{height:60},borderRadius:5,blackColor:"#444444",whiteColor:"#EEEEEE",markerColor:"#B71C1C",markerTextColor:"#FFF",stroke:"#222222",range:3})
}return a},hideButton:false,_ukd:function(a){this.parent(a);this.parser=new chess.parser._uQ9();if(a.showBar!==undefined){this.showBar=a.showBar}if(a.buttons!==undefined){this.buttons=a.buttons}if(a.appendBtn!==undefined){this.appendBtn=a.appendBtn}if(a.hideButton!==undefined){this.hideButton=a.hideButton}if(a.showNodes!==undefined){this.showNodes=a.showNodes}this.bestLine=[]},_uv9:function(a){this.parent(a);a.on("engineupdate",this._up2.bind(this));a.on("fen",this.onPositionUpdate.bind(this));a.on("instructorFen",this.onPositionUpdate.bind(this));a.on("newGame",this.clearView.bind(this))},_up2:function(g){if(g.mate){var b=g.mate<0?-100:100;if(this.child.scoreBar){this.child.scoreBar.setScore(b)}g.score="Mate in "+Math.abs(g.mate)}else{if(this.child.scoreBar){this.child.scoreBar.setScore(g.score)}}this.currentEval=g.score;this.bestLineString=g.bestMoves;var d=g.depth;var c=g.nps;var f=g.score>0?"+":"";var a=this.showNodes?"<br>Nodes/s: "+c:"";this.child["eval"].html("Depth: "+d+a+'<br><div class="dhtml-chess-comp-eval"><span class="dhtml-chess-comp-eval-score">'+f+g.score+"</span> "+this.getMoveLine(g)+"</div>")},clearView:function(){if(this.child["eval"]){this.child["eval"].html("");if(this.child.scoreBar){this.child.scoreBar.setScore(0)}}this.bestLineString="";this.bestLine=[];if(this.child.buttons&&this.buttons){this.child.buttons.child.appendLine.hide();this.child.buttons.child.appendEval.hide()}},getMoveLine:function(g){try{this.parser.setFen(this.fen);var h=g.bestMoves.split(/\s/g);this.bestLine=[];var n=g.currentPly;n+=2;var w='<span class="dhtml-chess-comp-eval-mn">';var l='<span class="dhtml-chess-comp-eval-notation">';var d=ludo.config._uC6()+"/images/svg_bw45";var o=n%2==1?(w+".. "+Math.floor(n/2)+". </span>"):"";this.bestLine.push(o);var u=n;for(var k=0;k<h.length;k++){if(u%2==0){if(k>0){this.bestLine.push("</span>")}this.bestLine.push('<span class="dhtml-chess-comp-eval-group">');this.bestLine.push(w+(u/2)+". </span>")}var b=h[k];var p=b.substr(0,2);var v=b.substr(2,2);var j={from:p,to:v};if(b.length==5){j.promoteTo=b.substr(4,1)}this.parser.move(j);var s=this.parser._uad();if(/[QRBN]/.test(s.substr(0,1))){var r=u%2==0?"w":"b";this.bestLine.push('<img style="vertical-align:text-bottom;height:18px" src="'+d+r+s.substr(0,1).toLocaleLowerCase()+'.svg">');s=l+s.substr(1)+"</span>"}else{s=l+s+"</span>"}this.bestLine.push(s);u++}this.bestLine.push("</span>")}catch(q){this._uif("error")}return this.bestLine.join(" ")},__ucf:function(){this.parent();this.on("hide",this.stopEngine.bind(this));var a=this.child.buttons;a.child.startStopEngine.on("click",this.toggleEngine.bind(this));a.child.appendLine.on("click",this.appendLine.bind(this));a.child.appendEval.on("click",this.appendEval.bind(this));a.child.appendLine.hide();a.child.appendEval.hide();if(this.hideButton){a.hide()}},appendEval:function(){this._uoe._ui7().setEval(this.currentEval)},appendLine:function(){if(this.bestLineString){if(this.started){this.stopEngine()}this._uif("appendLine",this.bestLineString)}},onPositionUpdate:function(b,a){this.fen=a;this.parser.setFen(a);this.bestLine=[];if(this.started){this.stopEngine(true);this.startEngine.delay(200,this)}},toggleEngine:function(){if(this.started){this.stopEngine()}else{this.startEngine()}},stopEngine:function(a){if(!this.started){return}this.child.buttons.child.startStopEngine.val("Start");this.started=false;if(!this._uoe){this._uif("stop");return}this._uoe.stopEngine();if(!a){this._uoe.sendMessage(chess.__("Engine stopped"))}},startEngine:function(){this.child.buttons.child.startStopEngine.val("Stop");this.started=true;if(!this._uoe){this._uif("start");return}this._uoe.startEngine();if(this.buttons){this.child.buttons.child.appendLine.show();this.child.buttons.child.appendEval.show()}}});chess.WPTemplate=new Class({Extends:Events,renderTo:undefined,module:undefined,_ready:true,_loadCounter:0,th:undefined,themeObject:undefined,_uoe:undefined,heading_tpl:undefined,wpm_h:20,nav:true,sound:false,boardId:undefined,_p:false,compToggle:false,pgn:undefined,pgnAll:undefined,animationDuration:0.2,arrowSolution:undefined,board:undefined,arrow:undefined,hint:undefined,dr:undefined,url:undefined,lp:undefined,navH:undefined,to_end:false,forward:0,mobile:undefined,custom:false,chessButtons:undefined,initialize:function(a){var b=window.screen.width;this.mobile=ludo.isMobile&&(b)<600;this.renderTo=jQuery(a.renderTo);this.animationDuration=0.2;if(a.animation_duration!==undefined){this.animationDuration=a.animation_duration}this.prep(a)},prep:function(b){if(this.render===undefined){return}var a=this.renderTo.width();if(a===0){this.prep.delay(50,this,b);return}this._ukd(b)},_ukd:function(b){if(b.docRoot){ludo.config.setDocumentRoot(b.docRoot)}this.navH=this.mobile?38:40;this.lp=this.mobile?"inside":"outside";this.dr=ludo.config._uC6();this.url=ludo.config.getUrl();this.module=String.uniqueID();this.boardId="dhtml_chess"+String.uniqueID();this.board=b.board||{};this.arrow=b.arrow||{};this.arrowSolution=b.arrowSolution||{};
this.hint=b.hint||{};this.to_end=b.to_end||false;this.forward=b.forward||0;if(b.buttons){this.buttons=this.configureButtons(b.buttons)}if(b.pgn!==undefined){if(jQuery.isArray(b.pgn)){this.pgn=b.pgn[0];this.pgnAll=b.pgn}else{this.pgn=b.pgn;this.pgnAll=[b.pgn]}}if(b.comp_toggle){this.compToggle=b.comp_toggle}if(b._p!==undefined){this._p=b._p}if(this._p){this.wpm_h=0}this.th=b.theme||b.defaultTheme;this.th="dc-"+this.th;if(b.sound!==undefined){this.sound=b.sound}if(b.heading_tpl!==undefined){this.heading_tpl=b.heading_tpl}if(b.css){var f=b.css.split(/;/g);jQuery.each(f,function(h,j){if(j){var g=j.split(/:/);this.renderTo.css(g[0],g[1])}}.bind(this))}var a;if(b.width_mobile){a=b.width_mobile}else{if(!this.mobile){a=b.width}}if(a){this.renderTo.css("width",a);if(b["float"]){this.renderTo.css("float",b["float"])}}chess.THEME_OVERRIDES=undefined;var d=b.theme||b.defaultTheme;if(d==="custom"){this.custom=true;chess.THEME=chess.CUSTOMTHEME;this.themeObject=Object.clone(chess.CUSTOMTHEME)}chess.THEMES=chess.THEMES||{};chess.CSSLOADED=chess.CSSLOADED||{};if(d&&d!=="custom"){this._ready=false;if(!chess.CSSLOADED[d]){jQuery("<link/>",{rel:"stylesheet",type:"text/css",href:this.dr+"themes/"+d+".css",complete:function(){chess.CSSLOADED[d]=true;this.onload()}.bind(this)}).appendTo("head")}else{this.onload()}if(chess.THEMES[d]!==undefined){this.themeObject=chess.THEMES[d];this.onload()}else{jQuery.ajax({url:this.dr+"themes/"+d+".js",dataType:"script",complete:function(){this.themeObject=Object.clone(chess.THEME);chess.THEMES[d]=this.themeObject;this.onload()}.bind(this)})}}if(this.nav){var c=ludo._new("chess.WPManager");c.add(this)}},configureButtons:function(a){var c=a.split(/,/g);var b=[];c.forEach(function(d){d=d.toLowerCase().substr(0,2);switch(d){case"st":b.push("start");break;case"pr":b.push("previous");break;case"pl":b.push("play");break;case"ne":b.push("next");break;case"en":b.push("end");break;case"fl":b.push("flip");break;case"co":b.push("comp");break}});return b},beforeRender:function(){if(this.canRender()){this.render()}},renderWidth:function(){return this.renderTo.width()},_un4:function(a){if(this.compToggle){a.push("comp")}},_uoeType:function(){return this._p?"ComputerController":"Controller"},randomPgn:function(){var a=Math.floor(Math.random()*this.pgnAll.length);return this.pgnAll[a]},curModel:function(){return this._uoe._umc},allPgnIdsString:function(){var a=[];jQuery.each(this.pgnAll,function(b,c){a.push(c.id)});return a.join("_")},isValidPgn:function(a){for(var b=0;b<this.pgnAll.length;b++){if(this.pgnAll[b].id==a){return true}}return false},onload:function(){this._loadCounter++;if(!this._ready&&this._loadCounter==2&&this.render!==undefined){this.render()}this._ready=this._loadCounter==2},canRender:function(){return this._ready},createController:function(){var a=this._uoe;a.on("enginestatus",this._ub1.bind(this));a.on("compGameOver",this.onGameOver.bind(this));a.on("comp",this.hideOverlays.bind(this))},hideOverlays:function(){if(this.game_over_div){this.game_over_div.hide()}},onGameOver:function(b){if(this.game_over_div==undefined){var c=this.game_over_div=jQuery('<div class="dhtml_chess_overlay_parent"><div class="dhtml_chess_overlay"></div><div class="dhtml_chess_game_over_text"></div></div>');ludo.$(this.boardId).boardEl().append(c)}var a=b==1?"1 - 0":b==-1?"0 - 1":"0.5 - 0.5";var d=this.game_over_div.height();this.game_over_div.find(".dhtml_chess_game_over_text").css("line-height",d+"px").css("font-size",Math.round(d/4)+"px").html(a);this.game_over_div.show()},_ub1:function(){var a=this.computerDialog();if(this._uoe.engineLoaded()){a.hide()}else{a.show()}},cs_dialog:undefined,computerDialog:function(){if(this.cs_dialog==undefined){var a=jQuery('<div class="dhtml_chess_loading"><div class="dhtml_chess_overlay"></div><div class="dhtml_chess_centered_bg dhtml_chess_loading_image"></div></div>');ludo.$(this.boardId).boardEl().append(a);this.cs_dialog=a}return this.cs_dialog}});chess.WPGameGrid=new Class({Extends:chess.view.gamelist.Grid,headerMenu:false,_une:{type:"ludo._une.JSONArray",autoload:false,postData:{action:"list_of_games"}},emptyText:chess.__("No games"),_uDd:chess.__("Loading games..."),cols:["white","black","round","result","last_moves"],_ukd:function(a){this.cols=a.cols||this.cols;this.parent(a)},loadGames:function(){if(this._up9().postData.pgn){this.load()}},_uKe:function(a){this._uif("_uKe",[a,this._up9().postData.pgn])}});chess.WPManager=new Class({Extends:ludo.Core,type:"chess.WPManager",singleton:true,views:undefined,activeView:undefined,_ukd:function(a){this.parent(a);this.views=[];this.addKeyEvents()},add:function(a){this.views.push(a);var b=function(){this.activeView=a}.bind(this);a.renderTo.on("click",b)},addKeyEvents:function(){jQuery(document).keydown(function(b){if(b.target){var a=(b.target.tagName||"").toLowerCase();if(a==="input"||a==="select"||a==="textarea"){return}}if(this.activeView){var d=this.activeView._uoe;if(b.key==="ArrowRight"&&!d.isBusy){d.keyNext();return false}else{if(b.key==="ArrowLeft"&&!d.isBusy){d.keyBack();
return false}}}}.bind(this))}});ludo.factory.createAlias("chess.WPManager",chess.WPManager);chess.WPComMessage=new Class({Extends:ludo.View,css:{"font-size":"12px","line-height":"20px","text-align":"right","padding-right":4},layout:{height:20},_html:'Powered by <a href="https://wordpresschess.com">WordPressChess.com</a>'});window.chess.isWordPress=true;chess.WPGameTemplate=new Class({Extends:chess.WPTemplate,fen:undefined,_ukd:function(a){this.parent(a);this.model=a.model||undefined;this.gameId=a.gameId;if(a.fen){this.fen=a.fen}if(!this.model&&!this.gameId&&!this.fen){this.gameId=2}},createController:function(){this._uoe=new chess._uoe[this._uoeType()]({applyTo:[this.module],stockfish:ludo.config._uC6()+"/stockfish-js/stockfish.js",sound:this.sound});if(this.fen){this._uoe._u0d(this.fen)}this.parent();this.loadGame()},loadGame:function(){if(this.gameId){jQuery.ajax({url:ludo.config.getUrl(),method:"post",cache:false,dataType:"json",data:{action:"game_by_id",id:this.gameId},complete:function(c,a){this._uoe._umc.afterLoad();if(a==="success"){var f=c.responseJSON;if(f.success){var b=f.response;var d=this._uoe._umc;d.populate(b);if(this.to_end){d.toEnd()}if(this.forward){d.forward(this.forward)}}}else{this._uif("wperrror",chess.__("Could not load game. Try again later"))}}.bind(this),fail:function(b,a){this._uif(a)}.bind(this)})}else{if(this.model){this._uoe._umc.populate(this.model)}}}});window.chess.isWordPress=true;chess.WPGame1=new Class({Extends:chess.WPGameTemplate,boardSize:undefined,buttonSize:45,_ukd:function(b){this.parent(b);var a=this.renderWidth();if(this.mobile){this.renderTo.css({height:Math.ceil(a+this.wpm_h+this.navH),position:"relative"});this.boardSize=a-200}else{var c=Math.ceil(a-200+45+45+this.wpm_h);this.renderTo.css({height:c,position:"relative"});this.boardSize=a-200}this.buttons=this.buttons||["start","previous","play","next","end","flip"];this._un4(this.buttons);this.bs=this.boardSize>400?this.boardSize:a;this.beforeRender()},render:function(){this.board=Object.merge({boardLayout:undefined,id:this.boardId,type:"chess.view.board.Board",animationDuration:this.animationDuration,module:this.module,overflow:"hidden",pieceLayout:"svg3",boardCss:{border:0},labelPos:this.lp,layout:{weight:1,height:"wrap"},plugins:[Object.merge({type:"chess.view.highlight.Arrow"},this.arrow)]},this.board);new chess.view.Chess({renderTo:this.renderTo,cls:this.th,theme:this.themeObject,layout:{type:"linear",_uWd:"vertical",height:"matchParent",width:"matchParent"},children:this.mobile?this._u18():this._uB7()});this.createController()},_uB7:function(){return[{layout:{height:35,width:this.mobile?"matchParent":this.boardSize},module:this.module,type:"chess.view.metadata.Game",tpl:this.heading_tpl||"{white} - {black}",cls:"metadata",css:{"text-align":"center","overflow-y":"auto","font-weight":"bold"}},{layout:{type:"linear",_uWd:"horizontal",height:this.boardSize},children:[this.board,{id:this.module+"-panel",name:"notation-panel",type:"chess.view.notation.Table",layout:{width:200},elCss:{"margin-left":"2px"},module:this.module}]},{css:{"margin-top":5},type:"chess.view.buttonbar.Bar",buttons:this.buttons,layout:{height:45,width:this.bs},module:this.module},{type:"chess.WPComMessage",hidden:this._p}]},_u18:function(){return[this.board,{layout:{type:"linear",_uWd:"horizontal",height:this.navH},elCss:{"margin-top":10},children:[{weight:1},{anchor:[0.5,0.5],type:"chess.view.buttonbar.Bar",buttons:["start","previous"],module:this.module,layout:{width:(this.navH)*3},buttonSize:function(a){return a*0.9}},{type:"chess.view.notation.LastMove",module:this.module,layout:{width:this.navH*2},css:{border:"none"}},{anchor:[0.5,0.5],type:"chess.view.buttonbar.Bar",buttons:["next","end"],module:this.module,layout:{width:(this.navH)*2,height:this.navH},buttonSize:function(a){return a*0.9}},{weight:1}]},{type:"chess.WPComMessage",hidden:this._p}]}});chess.WPGame2=new Class({Extends:chess.WPGameTemplate,boardSize:undefined,_ukd:function(b){this.parent(b);var a=this.renderWidth();this.renderTo.css("height",a+235+this.navH+this.wpm_h);this.boardSize=a;this.buttons=this.buttons||["start","previous","play","next","end","flip"];this._un4(this.buttons);this.beforeRender()},render:function(){new chess.view.Chess({theme:this.themeObject,renderTo:this.renderTo,cls:this.th,layout:{type:"linear",_uWd:"vertical",height:"matchParent",width:"matchParent"},children:[{layout:{height:35,width:this.boardSize},module:this.module,type:"chess.view.metadata.Game",tpl:this.heading_tpl||"{white} - {black}",cls:"metadata",css:{"text-align":"center"}},Object.merge({boardLayout:undefined,id:this.boardId,animationDuration:this.animationDuration,type:"chess.view.board.Board",module:this.module,overflow:"hidden",pieceLayout:"svg3",boardCss:{border:0},labelPos:this.lp,layout:{weight:1,height:"wrap"},plugins:[Object.merge({type:"chess.view.highlight.Arrow"},this.arrow)]},this.board),{type:"chess.view.buttonbar.Bar",buttons:this.buttons,elCss:{"padding-top":2},layout:{height:this.navH,width:this.boardSize},module:this.module},{id:this.module+"-panel",name:"notation-panel",type:"chess.view.notation.Panel",layout:{height:200},elCss:{"margin-left":"2px"},module:this.module},{type:"chess.WPComMessage",hidden:this._p}]});
this.createController()}});window.chess.isWordPress=true;chess.WPGame3=new Class({Extends:chess.WPGameTemplate,boardSize:undefined,_ukd:function(b){this.parent(b);var a=this.renderWidth();if(this.mobile){this.renderTo.css("height",a+275+this.wpm_h);this.boardSize=a}else{this.boardSize=a*2/3;this.renderTo.css("height",a-150+42+35+this.wpm_h)}this.board=Object.merge({boardLayout:undefined,id:this.boardId,type:"chess.view.board.Board",animationDuration:this.animationDuration,module:this.module,overflow:"hidden",pieceLayout:"svg3",boardCss:{border:0},labelPos:this.lp,layout:{weight:2,height:"wrap"},plugins:[Object.merge({type:"chess.view.highlight.Arrow"},this.arrow)]},this.board);this.lastButtons=["flip"];this._un4(this.lastButtons);this.beforeRender()},render:function(){new chess.view.Chess({renderTo:this.renderTo,theme:this.themeObject,cls:this.th,layout:{type:"linear",_uWd:"vertical",height:"matchParent",width:"matchParent"},children:this.mobile?this._u18():this._uB7()});this.createController()},_u18:function(){return[{layout:{height:35},module:this.module,type:"chess.view.metadata.Game",tpl:this.heading_tpl||"{white} - {black}",cls:"metadata",css:{"text-align":"center"}},this.board,{layout:{type:"linear",_uWd:"horizontal",height:this.navH,width:this.boardSize},css:{"margin-top":5},children:[{type:"chess.view.buttonbar.Bar",module:this.module,buttons:["start","end"],width:85,buttonSize:function(a){return a}},{weight:1},{type:"chess.view.notation.LastMove",width:80,module:this.module},{type:"chess.view.buttonbar.Bar",module:this.module,buttons:["play"],width:45,buttonSize:function(a){return a}}]},{css:{"margin-top":4},layout:{height:200},type:"chess.view.notation.LastComment",module:this.module},{type:"chess.WPComMessage",hidden:this._p}]},_uB7:function(){return[{layout:{height:35,width:this.boardSize},module:this.module,type:"chess.view.metadata.Game",tpl:this.heading_tpl||"{white} - {black}",cls:"metadata",css:{"text-align":"center","overflow-y":"auto","font-size":"1em","font-weight":"bold"}},{layout:{type:"linear",_uWd:"horizontal",height:this.boardSize},children:[this.board,{id:this.module+"-panel",name:"notation-panel",type:"chess.view.notation.LastComment",layout:{weight:1},elCss:{"margin-left":"2px"},module:this.module}]},{layout:{type:"linear",_uWd:"horizontal",height:40,width:this.boardSize},css:{"margin-top":5},children:[{weight:1},{type:"chess.view.buttonbar.Bar",module:this.module,buttons:["start","previous"],width:85,buttonSize:function(a){return a}},{type:"chess.view.notation.LastMove",width:80,module:this.module},{type:"chess.view.buttonbar.Bar",module:this.module,buttons:["next","end"],width:85,buttonSize:function(a){return a}},{weight:1},{type:"chess.view.buttonbar.Bar",module:this.module,buttons:this.lastButtons,width:42*this.lastButtons.length,buttonSize:function(a){return a}}]},{type:"chess.WPComMessage",hidden:this._p}]}});window.chess.isWordPress=true;chess.WPGame4=new Class({Extends:chess.WPGameTemplate,boardSize:undefined,_ukd:function(b){this.parent(b);var a=this.renderWidth();this.renderTo.css("height",a+40+35+20);this.boardSize=a;this.lastButtons=["flip"];this._un4(this.lastButtons);this.beforeRender()},render:function(){new chess.view.Chess({renderTo:this.renderTo,theme:this.themeObject,cls:this.th,layout:{type:"linear",_uWd:"vertical",height:"matchParent",width:"matchParent"},children:[{layout:{height:35,width:this.boardSize},module:this.module,type:"chess.view.metadata.Game",tpl:this.heading_tpl||"{white} - {black}",cls:"metadata",css:{"text-align":"center"}},{layout:{type:"linear",_uWd:"horizontal",height:this.boardSize},children:[Object.merge({animationDuration:this.animationDuration,boardLayout:undefined,id:this.boardId,type:"chess.view.board.Board",module:this.module,overflow:"hidden",pieceLayout:"svg3",boardCss:{border:0},labelPos:this.lp,layout:{weight:1,height:"wrap"},plugins:[Object.merge({type:"chess.view.highlight.Arrow"},this.arrow)]},this.board)]},{layout:{type:"linear",_uWd:"horizontal",height:this.navH,width:this.boardSize},css:{"margin-top":5},children:this.mobile?[{type:"chess.view.buttonbar.Bar",module:this.module,buttons:["play"],width:45,buttonSize:function(a){return a}},{type:"chess.view.notation.LastMove",weight:1,module:this.module},{type:"chess.view.buttonbar.Bar",module:this.module,buttons:["start","end","flip"],width:125,buttonSize:function(a){return a}}]:[{weight:1},{type:"chess.view.buttonbar.Bar",module:this.module,buttons:["start","previous"],width:85,buttonSize:function(a){return a}},{type:"chess.view.notation.LastMove",width:80,module:this.module},{type:"chess.view.buttonbar.Bar",module:this.module,buttons:["next","end"],width:85,buttonSize:function(a){return a}},{weight:1},{type:"chess.view.buttonbar.Bar",module:this.module,buttons:this.lastButtons,width:42*this.lastButtons.length,buttonSize:function(a){return a}}]},{type:"chess.WPComMessage",hidden:this._p}]});this.createController()}});window.chess.isWordPress=true;chess.WPGame5=new Class({Extends:chess.WPGameTemplate,boardSize:undefined,buttonSize:45,boardWeight:1,notationWeight:1,_ukd:function(b){this.parent(b);
var c=this.renderTo;var a=this.renderWidth();if(this.mobile){this.notationWeight=0}this.boardSize=(a/(this.boardWeight+this.notationWeight));if(this.mobile){c.css("height",a+235+this.navH+this.wpm_h)}else{c.css("height",this.boardSize+this.buttonSize+this.wpm_h+30)}c.css("position","relative");if(!this.buttons){if(!b.admPreview){this.buttons=this.mobile?["start","previous","next","end"]:["start","previous","next","end","flip"]}else{this.buttons=["start","previous","play","next","end","flip","comp"]}}this._un4(this.buttons);this.configure();this.beforeRender()},configure:function(){this.board=Object.merge({boardLayout:undefined,animationDuration:this.animationDuration,vAlign:top,id:this.boardId,type:"chess.view.board.Board",module:this.module,overflow:"hidden",pieceLayout:"svg_bw",background:{borderRadius:0},boardCss:{border:0},labelPos:this.lp,layout:{weight:this.boardWeight,height:"wrap"},plugins:[Object.merge({type:"chess.view.highlight.Arrow"},this.arrow)]},this.board);if(!this.custom){chess.THEME_OVERRIDES={"chess.view.board.Board":{background:{borderRadius:"1%"}},"chess.view.buttonbar.Bar":{borderRadius:"10%",styles:{button:{"fill-opacity":0,"stroke-opacity":0},image:{fill:"#777"},buttonOver:{"fill-opacity":0,"stroke-opacity":0},imageOver:{fill:"#555"},buttonDown:{"fill-opacity":0,"stroke-opacity":0},imageDown:{fill:"#444"},buttonDisabled:{"fill-opacity":0,"stroke-opacity":0},imageDisabled:{fill:"#555","fill-opacity":0.3}}}}}},render:function(){new chess.view.Chess({renderTo:this.renderTo,cls:this.th,theme:this.themeObject,layout:{type:"linear",_uWd:"vertical",height:"matchParent",width:"matchParent"},children:this.mobile?this._u18():this._uB7()});this.createController()},_uB7:function(){return[{module:this.module,type:"chess.view.metadata.Game",tpl:"{white} - {black}",cls:"metadata",css:{"text-align":"center","font-weight":"bold"},height:30},{layout:{height:this.boardSize,type:"linear",_uWd:"horizontal"},children:this.mobile?[this.board]:[this.board,{id:this.module+"-panel",name:"notation-panel",type:"chess.view.notation.Panel",layout:{weight:this.notationWeight,height:"matchParent"},elCss:{"margin-left":"2px"},module:this.module}]},{layout:{type:"linear",_uWd:"horizontal",height:this.buttonSize},elCss:{"margin-top":10},children:[{weight:1},{anchor:[1,0.5],type:"chess.view.buttonbar.Bar",buttons:this.buttons,module:this.module,layout:{width:(this.buttonSize-10)*this.buttons.length},buttonSize:function(a){return a*0.9}}]},{type:"chess.WPComMessage",hidden:this._p}]},_u18:function(){return[{layout:{height:35,width:this.boardSize},module:this.module,type:"chess.view.metadata.Game",tpl:this.heading_tpl||"{white} - {black}",cls:"metadata",css:{"text-align":"center"}},Object.merge({boardLayout:undefined,id:"tactics_board",type:"chess.view.board.Board",module:this.module,overflow:"hidden",pieceLayout:"svg3",boardCss:{border:0},labels:!this.mobile,labelPos:this.lp,layout:{weight:1,height:"wrap"},plugins:[Object.merge({type:"chess.view.highlight.Arrow"},this.arrow)]},this.board),{layout:{type:"linear",_uWd:"horizontal",height:this.navH,width:this.boardSize},children:[{type:"chess.view.buttonbar.Bar",layout:{height:this.navH,weight:1},module:this.module}]},{id:this.module+"-panel",name:"notation-panel",type:"chess.view.notation.Panel",layout:{height:200},elCss:{"margin-left":"2px"},module:this.module},{type:"chess.WPComMessage",hidden:this._p}]}});window.chess.isWordPress=true;chess.WPGame6=new Class({Extends:chess.WPGameTemplate,boardSize:undefined,buttonSize:45,boardWeight:1,notationWeight:1,_ukd:function(b){this.parent(b);var a=this.renderWidth();var c=this.comp?this.navH:0;this.renderTo.css("height",a+c+this.wpm_h);if(b.highlight!==undefined){this.highlight=b.highlight}if(b.arrows!==undefined){this.arrows=b.arrows}this.beforeRender()},render:function(){new chess.view.Chess({cls:this.th,theme:this.themeObject,renderTo:this.renderTo,layout:{type:"linear",_uWd:"vertical"},children:[{module:this.module,type:"chess.view.board.Board",animationDuration:this.animationDuration,id:this.boardId,fen:this.fen,_uke:false,labelPos:this.lp,layout:{width:"matchParent",weight:1}},{height:this.navH,hidden:!this.compToggle,module:this.module,type:"chess.view.buttonbar.Bar",buttons:["flip","comp"]},{type:"chess.WPComMessage",hidden:this._p}]});if(this.highlight!==undefined){var g=new chess.view.highlight.SquarePool({board:ludo.$(this.boardId)});var a=this.highlight.split(/\,/g);var d=undefined;jQuery.each(a,function(h,j){var k=j.split(/;/g);if(k.length>1){d=k[1]}g.show(k[0],d)})}if(this.arrows!==undefined){var f=new chess.view.highlight.ArrowPool({board:ludo.$(this.boardId)});var c=this.arrows.split(/,/g);var b;jQuery.each(c,function(j,l){var m=l.split(/;/g);if(m.length>1){if(b===undefined){b={}}b.fill=b.stroke=m[1]}var k=m[0].substr(0,2);var h=m[0].substr(2,2);f.show(k,h,b)})}this.createController()}});chess.WPViewerTemplate=new Class({Extends:chess.WPTemplate,pgn:undefined,createController:function(){this._uoe=new chess._uoe[this._uoeType()]({applyTo:[this.module],sound:this.sound,pgn:this.pgn.id,stockfish:ludo.config._uC6()+"/stockfish-js/stockfish.js"});
this.parent()}});window.chess.isWordPress=true;chess.WPViewer1=new Class({Extends:chess.WPViewerTemplate,showLabels:undefined,boardSize:undefined,_ukd:function(b){this.parent(b);var c=this.renderTo;var a=this.renderWidth();if(this.mobile){this.boardSize=a;c.css("height",Math.round(this.boardSize+300+this.navH+this.wpm_h))}else{this.boardSize=a-150;c.css("height",Math.round(this.boardSize+335+this.navH+this.wpm_h))}this.lastButtons=["next","end"];this._un4(this.lastButtons);if(!this.buttons){this.buttons=this.mobile?["start","previous","next","end"]:["start","previous","next","end","flip"]}this._un4(this.buttons);this.showLabels=!this.mobile;this.beforeRender()},render:function(){new chess.view.Chess({cls:this.th,theme:this.themeObject,renderTo:jQuery(this.renderTo),layout:{type:"fill",height:"matchParent",width:"matchParent"},children:this.mobile?this._u18():this._uB7()});this.createController()},_uB7:function(){return[{layout:{type:"linear",_uWd:"vertical"},children:[{layout:{height:35,width:this.boardSize},module:this.module,type:"chess.view.metadata.Game",tpl:this.heading_tpl||"{white} - {black}",cls:"metadata",css:{"text-align":"center"}},{layout:{type:"linear",_uWd:"horizontal",height:this.boardSize},children:[Object.merge({animationDuration:this.animationDuration,boardLayout:undefined,id:this.boardId,type:"chess.view.board.Board",module:this.module,overflow:"hidden",pieceLayout:"svg3",boardCss:{border:0},labelPos:this.lp,layout:{weight:1,height:"wrap"},plugins:[Object.merge({type:"chess.view.highlight.Arrow"},this.arrow)]},this.board),{id:this.module+"-panel",name:"notation-panel",type:"chess.view.notation.Table",layout:{width:150},elCss:{"margin-left":"2px"},module:this.module}]},{layout:{height:this.navH,width:this.boardSize,type:"linear",_uWd:"horizontal"},children:[{anchor:[0.5,1],type:"chess.view.buttonbar.Bar",buttons:this.buttons,module:this.module,layout:{height:"matchParent",width:(this.boardSize-40)},buttonSize:function(a){return a*0.9}}]},{title:this.pgn.name,module:this.module,layout:{height:300},type:"chess.WPGameGrid",css:{"overflow-y":"auto"},cols:["white","black","result"],_une:{id:"gameList"+this.module,type:"chess.wordpress.GameList",singleton:false,module:this.module,autoload:true,postData:{pgn:this.pgn.id},listeners:{select:function(){ludo.$(this.module+"-panel").show()}.bind(this),load:function(a){if(a.length){ludo.get("gameList"+this.module)._upb(a[0])}}},shim:{txt:""}}},{type:"chess.WPComMessage",hidden:this._p}]}]},_u18:function(){return[{layout:{type:"linear",_uWd:"vertical"},children:[Object.merge({boardLayout:undefined,id:"tactics_board",type:"chess.view.board.Board",module:this.module,overflow:"hidden",pieceLayout:"svg3",boardCss:{border:0},labels:!this.mobile,labelPos:this.lp,layout:{height:this.boardSize},plugins:[Object.merge({type:"chess.view.highlight.Arrow"},this.arrow)]},this.board),{layout:{height:this.navH,type:"linear",_uWd:"horizontal"},children:[{weight:1},{type:"chess.view.buttonbar.Bar",layout:{height:this.navH,width:90},module:this.module,buttons:["start","previous"],buttonSize:function(a){return a*0.9}},{type:"chess.view.notation.LastMove",module:this.module,layout:{width:70},css:{"padding-top":4,"padding-bottom":4,border:"none"}},{type:"chess.view.buttonbar.Bar",layout:{height:this.navH,width:45*this.lastButtons.length},module:this.module,buttons:this.lastButtons,buttonSize:function(a){return a*0.9}},{weight:1}]},{title:this.pgn.name,module:this.module,layout:{height:300},type:"chess.WPGameGrid",css:{"overflow-y":"auto"},cols:["white","black","result"],_une:{id:"gameList",type:"chess.wordpress.GameList",singleton:false,module:this.module,autoload:true,postData:{pgn:this.pgn.id},listeners:{load:function(a){if(a.length){ludo.get("gameList")._upb(a[0])}}},shim:{txt:""}}}]}]}});window.chess.isWordPress=true;chess.WPViewer2=new Class({Extends:chess.WPViewerTemplate,showLabels:undefined,boardSize:undefined,sofia:false,width:undefined,_ukd:function(b){this.parent(b);var c=this.renderTo;var a=this.width=c.width();this.boardSize=this.mobile?a:a/2;c.css("height",Math.round(this.boardSize+335+this.navH+this.wpm_h));if(b.sofia){this.sofia=true}this.showLabels=!this.mobile;if(!this.buttons){this.buttons=this.mobile?["start","previous","next","end"]:["start","previous","next","end","flip"]}this._un4(this.buttons);this.gameListDsId="gamelist"+String.uniqueID();this.standingsId="standingsId"+String.uniqueID();this.beforeRender()},render:function(){new chess.view.Chess({cls:this.th,theme:this.themeObject,renderTo:jQuery(this.renderTo),layout:{type:"fill",height:"matchParent",width:"matchParent"},children:[{layout:{type:"linear",_uWd:"vertical"},children:this.mobile?this._u18():this._uB7()}]});this.createController()},_uB7:function(){return[{layout:{height:35,width:this.boardSize},module:this.module,type:"chess.view.metadata.Game",tpl:this.heading_tpl||"{white} - {black}",cls:"metadata",css:{"text-align":"center","overflow-y":"auto","font-weight":"bold"}},{layout:{type:"linear",_uWd:"horizontal",height:this.boardSize},children:[Object.merge({boardLayout:undefined,id:this.boardId,type:"chess.view.board.Board",animationDuration:this.animationDuration,module:this.module,overflow:"hidden",pieceLayout:"svg3",boardCss:{border:0},labelPos:this.lp,layout:{weight:1,height:"wrap"},plugins:[Object.merge({type:"chess.view.highlight.Arrow"},this.arrow)]},this.board),{id:this.module+"-panel",name:"notation-panel",type:"chess.view.notation.Panel",layout:{weight:1},elCss:{"margin-left":"2px"},module:this.module}]},{layout:{height:40,type:"linear",_uWd:"horizontal",width:"matchParent"},children:[{anchor:[1,0.5],type:"chess.view.buttonbar.Bar",buttons:this.buttons,module:this.module,layout:{height:"matchParent",width:this.width-40},buttonSize:function(a){return a*0.9
}}]},{height:300,layout:{type:"tabs"},cls:"ludo-light-gray",css:{border:"1px solid #aeb0b0"},children:[{layout:{type:"linear",_uWd:"vertical"},title:chess.__("Games"),children:[{module:this.module,layout:{weight:1},type:"chess.WPGameGrid",css:{"overflow-y":"auto"},cols:["round","white","black","result"],_une:{id:this.gameListDsId,type:"chess.wordpress.GameList",module:this.module,singleton:false,autoload:true,postData:{pgn:this.pgn.id},listeners:{select:function(){ludo.$(this.module+"-panel").show()}.bind(this),load:function(a){if(a.length){ludo.$(this.gameListDsId)._upb(a[0])}}.bind(this)},shim:{txt:""}}},{type:"form.Text",placeholder:chess.__("Search"),css:{"border-top":"1px solid #aeb0b0"},layout:{height:30},listeners:{key:function(a){this.search(a)}.bind(this)}}]},{id:this.standingsId,type:"chess.wordpress.PgnStandings",module:this.module,pgnId:this.pgn.id,layout:{weight:1},title:chess.__("Standings")}]},{type:"chess.WPComMessage",hidden:this._p}]},_u18:function(){return[Object.merge({boardLayout:undefined,id:"tactics_board",type:"chess.view.board.Board",module:this.module,overflow:"hidden",pieceLayout:"svg3",boardCss:{border:0},labels:!this.mobile,labelPos:this.lp,layout:{weight:1,height:"wrap"},plugins:[Object.merge({type:"chess.view.highlight.Arrow"},this.arrow)]},this.board),{layout:{height:40,type:"linear",_uWd:"horizontal"},children:[{weight:1},{type:"chess.view.buttonbar.Bar",layout:{height:40,width:90},module:this.module,buttons:["start","previous"],buttonSize:function(a){return a*0.9}},{type:"chess.view.notation.LastMove",module:this.module,layout:{width:70},css:{"padding-top":4,"padding-bottom":4,border:"none"}},{type:"chess.view.buttonbar.Bar",layout:{height:this.navH,width:90},module:this.module,buttons:["next","end"],buttonSize:function(a){return a*0.9}},{weight:1}]},{height:300,layout:{type:"tabs"},cls:"ludo-light-gray",css:{border:"1px solid #aeb0b0"},children:[{layout:{type:"linear",_uWd:"vertical"},title:chess.__("Games"),children:[{module:this.module,layout:{weight:1},type:"chess.WPGameGrid",css:{"overflow-y":"auto"},keys:["white","black","result"],_une:{id:this.gameListDsId,type:"chess.wordpress.GameList",module:this.module,singleton:false,autoload:true,postData:{pgn:this.pgn.id},listeners:{load:function(a){if(a.length){ludo.$(this.gameListDsId)._upb(a[0])}}.bind(this)},shim:{txt:""}}},{type:"form.Text",placeholder:chess.__("Search"),css:{"border-top":"1px solid #aeb0b0"},layout:{height:30},listeners:{key:function(a){this.search(a)}.bind(this)}}]},{id:this.standingsId,type:"chess.wordpress.PgnStandings",module:this.module,sofiaRules:this.sofia,pgnId:this.pgn.id,keys:["player","score"],layout:{weight:1},title:chess.__("Standings")}]},{type:"chess.WPComMessage",hidden:this._p}]},search:function(a){ludo.$(this.gameListDsId).search(a)}});window.chess.isWordPress=true;chess.WPViewer3=new Class({Extends:chess.WPViewerTemplate,showLabels:undefined,boardSize:undefined,_ukd:function(b){this.parent(b);var c=this.renderTo;var a=this.renderWidth();if(this.mobile){this.boardSize=a;c.css("height",Math.round(this.boardSize+300+this.navH+this.wpm_h))}else{this.boardSize=a/2;c.css("height",Math.round(this.boardSize+335+this.navH+this.wpm_h))}if(!this.buttons){this.buttons=this.mobile?["start","previous","next","end"]:["start","previous","next","end","flip"]}this._un4(this.buttons);this.showLabels=!this.mobile;this.beforeRender()},render:function(){new chess.view.Chess({cls:this.th,theme:this.themeObject,renderTo:jQuery(this.renderTo),layout:{type:"fill",height:"matchParent",width:"matchParent"},children:this.mobile?this._u18():this._uB7()});this.createController()},_uB7:function(){return[{layout:{type:"linear",_uWd:"vertical"},children:[{layout:{height:35,width:this.boardSize},module:this.module,type:"chess.view.metadata.Game",tpl:this.heading_tpl||"{white} - {black}",cls:"metadata",css:{"text-align":"center","font-size":"1em","font-weight":"bold"}},{layout:{type:"linear",_uWd:"horizontal",height:this.boardSize},children:[Object.merge({boardLayout:undefined,id:this.boardId,type:"chess.view.board.Board",module:this.module,overflow:"hidden",animationDuration:this.animationDuration,pieceLayout:"svg3",boardCss:{border:0},labels:!this.mobile,labelPos:this.lp,layout:{weight:1,height:"wrap"},plugins:[Object.merge({type:"chess.view.highlight.Arrow"},this.arrow)]},this.board),{id:this.module+"-panel",name:"notation-panel",type:"chess.view.notation.Panel",layout:{weight:1},elCss:{"margin-left":"2px"},module:this.module}]},{layout:{height:this.navH,type:"linear",_uWd:"horizontal"},children:[{anchor:[1,0.5],type:"chess.view.buttonbar.Bar",buttons:this.buttons,module:this.module,layout:{height:"matchParent",weight:1},buttonSize:function(a){return a*0.9}}]},{title:this.pgn.name,module:this.module,layout:{height:300},type:"chess.WPGameGrid",css:{"overflow-y":"auto"},cols:["white","black","result"],_une:{id:"gameList"+this.module,type:"chess.wordpress.GameList",singleton:false,module:this.module,autoload:true,postData:{pgn:this.pgn.id},listeners:{select:function(){ludo.$(this.module+"-panel").show()
}.bind(this),load:function(a){if(a.length){ludo.get("gameList"+this.module)._upb(a[0])}}},shim:{txt:""}}},{type:"chess.WPComMessage",hidden:this._p}]}]},_u18:function(){return[{layout:{type:"linear",_uWd:"vertical"},children:[Object.merge({boardLayout:undefined,id:"tactics_board",type:"chess.view.board.Board",module:this.module,overflow:"hidden",pieceLayout:"svg3",boardCss:{border:0},labelPos:this.lp,layout:{height:this.boardSize},plugins:[Object.merge({type:"chess.view.highlight.Arrow"},this.arrow)]},this.board),{layout:{height:this.navH,type:"linear",_uWd:"horizontal"},children:[{weight:1},{type:"chess.view.buttonbar.Bar",layout:{height:this.navH,width:(this.navH*2)},module:this.module,buttons:["start","previous"],buttonSize:function(a){return a}},{type:"chess.view.notation.LastMove",module:this.module,layout:{width:(this.navH*2)+10,height:this.navH},css:{"padding-top":4,"padding-bottom":4,border:"none"}},{type:"chess.view.buttonbar.Bar",layout:{height:this.navH,width:(this.navH*2)},module:this.module,buttons:["next","end"],buttonSize:function(a){return a}},{weight:1}]},{title:this.pgn.name,module:this.module,layout:{height:300},type:"chess.WPGameGrid",css:{"overflow-y":"auto"},cols:["white","black","result"],_une:{id:"gameList"+this.module,type:"chess.wordpress.GameList",module:this.module,singleton:false,autoload:true,postData:{pgn:this.pgn.id},listeners:{load:function(a){if(a.length){ludo.get("gameList"+this.module)._upb(a[0])}}},shim:{txt:""}}}]}]}});window.chess.isWordPress=true;chess.WPComp1=new Class({Extends:chess.WPTemplate,boardId:undefined,boardSize:undefined,isPreview:false,nav:false,initialize:function(b){this.parent(b);var f=this.renderTo;var a=f.width();var d=(a+50)/(a+200+this.wpm_h);var c=this.mobile?a+150+this.wpm_h:a*d;f.css("height",Math.round(c));if(b.isPreview){this.isPreview=b.isPreview}this.boardSize=this.mobile?a:a-200;this.boardId="dhtml-chess-"+String.uniqueID();if(this.canRender()){this.render()}},render:function(){new chess.view.Chess({theme:this.themeObject,renderTo:jQuery(this.renderTo),layout:{width:"matchParent",height:"matchParent",type:"linear",_uWd:"vertical"},children:[{hidden:!this.mobile,type:"chess.computer.ClockView",module:this.module,color:"white",pos:"top",css:{"text-align":"center"},layout:{height:50,width:150,anchor:0.5,alignTop:"board",rightOf:"board"}},{layout:{weight:1,type:"linear",_uWd:"horizontal"},children:[{id:this.boardId,type:"chess.view.board.Board",animationDuration:this.animationDuration,pieceLayout:"svg_egg",boardLayout:"wood",module:this.module,padding:this.mobile?"1%":"2.5%",labels:!this.mobile,background:{borderRadius:"1%",paint:{fill:"#444"}},layout:{height:"matchParent",weight:1},plugins:[{type:"chess.view.highlight.Arrow"}]},{width:205,hidden:this.mobile,css:{"margin-left":5},layout:{type:"linear",_uWd:"vertical"},children:[{id:"clockTop",module:this.module,type:"chess.computer.ClockView",color:"white",pos:"top",layout:{height:50,alignTop:"board",rightOf:"board"}},{weight:1},{id:"clockBottom",module:this.module,type:"chess.computer.ClockView",color:"black",pos:"bottom",layout:{height:50,alignBottom:"board",rightOf:"board"}}]}]},{hidden:!this.mobile,type:"chess.computer.ClockView",module:this.module,color:"white",pos:"bottom",css:{"text-align":"center"},layout:{anchor:0.5,height:50,width:150,alignTop:"board",rightOf:"board"}},{css:{"margin-top":5},layout:{height:35,width:this.boardSize,type:"linear",_uWd:"horizontal"},children:[{weight:1},{type:"form.Button",module:this.module,value:"Draw",listeners:{click:function(){this._uoe.claimDraw()}.bind(this)}},{type:"chess.view.notation.LastMove",module:this.module,css:{"border-radius":"999px","background-color":"#ddd",color:"#444","border-color":"1px solid "+ludo.$C("border")},layout:{width:100,height:40}},{type:"form.Button",value:"Resign",module:this.module,listeners:{click:function(){this._uoe.resign()}.bind(this)}},{weight:1}]},{module:this.module,submodule:"message",layout:{height:30}},{type:"chess.WPComMessage",hidden:this._p}]});this._uoe=new chess._uoe.PlayStockFishController({applyTo:[this.module],sound:this.sound,stockfish:ludo.config._uC6()+"/stockfish-js/stockfish.js",playerColor:"white",listeners:{start:this.onNewGame.bind(this),engineupdate:this.updateMove.bind(this)},thinkingTime:3000});if(!this.isPreview){new chess.computer.GameOverDialog({module:this.module,layout:{centerIn:ludo.$(this.boardId)},movable:false,resizable:false});new chess.computer.GameDialog({module:this.module,hidden:true,layout:{centerIn:ludo.$(this.boardId)},movable:false,resizable:false});var a=new chess.computer.ComputerStatusDialog({module:this.module,layout:{centerIn:ludo.$(this.boardId)},movable:false,resizable:false});a.show()}},_up7:function(a){this._uoe._up7(a)},updateMove:function(a){},onNewGame:function(c){var a=ludo.get(this.boardId);if(c=="black"){a._ujd()}else{a._und()}}});chess.WPPinned=new Class({Extends:chess.WPTemplate,renderTo:undefined,pgn:undefined,_uoe:undefined,module:undefined,random:false,color:undefined,parser:undefined,pinnedMsgId:undefined,arrowPool:undefined,solved:false,_ukd:function(b){this.parent(b);
this.renderTo=b.renderTo;var c=jQuery(this.renderTo);c.addClass("ludo-twilight");var a=this.renderWidth();c.css("height",Math.round(a+65+this.wpm_h));this.boardSize=a;if(b.random!==undefined){this.random=b.random}this.board=b.board||{};this.arrow=b.arrow||{};this.arrowSolution=b.arrowSolution||{};this.hint=b.hint||{};this.module=String.uniqueID();this.pinnedMsgId="dc-"+String.uniqueID();this.showLabels=!this.mobile;if(this.renderTo.substr&&this.renderTo.substr(0,1)!="#"){this.renderTo="#"+this.renderTo}this.beforeRender()},render:function(){new chess.view.Chess({cls:this.th,theme:this.themeObject,renderTo:jQuery(this.renderTo),layout:{type:"fill",height:"matchParent",width:"matchParent"},children:[{layout:{type:"linear",_uWd:"vertical"},children:[{id:this.pinnedMsgId,module:this.module,css:{"text-align":"center","line-height":"30px"},layout:{height:30}},Object.merge({boardLayout:undefined,id:this.boardId,type:"chess.view.board.Board",module:this.module,overflow:"hidden",pieceLayout:"svg3",boardCss:{border:0},labelPos:this.lp,layout:{height:this.boardSize}},this.board),{css:{"padding-top":5},layout:{height:35,type:"linear",_uWd:"horizontal"},children:[{weight:1},{type:"form.Button",value:"Solve",listeners:{click:this.sendSolution.bind(this)}},{type:"form.Button",value:chess.__("Hint"),listeners:{click:this.showHint.bind(this)}},{type:"form.Button",value:chess.__("Next"),listeners:{click:function(){this._uoe._uCcFromFile()}.bind(this)}},{weight:1}]},{type:"chess.WPComMessage",hidden:this._p}]}]});var c="wp_"+this.pgn.id+"_pinned";new chess.view.message._uj8({renderTo:document.body,module:this.module,showIntro:false,hidden:true,_u41:20,css:{"background-color":"#eee","border-radius":5},layout:{width:200,height:50,centerIn:ludo.$("chess-board-pinned-pieces")}});this._uoe=new chess._uoe.Controller({applyTo:[this.module],pgn:this.pgn.id,_uf9:function(d){if(this.random){d._u58()}else{d._uCcFromFile()}}.bind(this),listeners:{loadGame:this.findPinned.bind(this),_uwd:function(){ludo._uZ6().save(c,this._uoe._ui7()._uzc())}.bind(this)}});var b=this._uoe;var a=ludo._uZ6().get(c,0);if(isNaN(a)){a=0}a=Math.max(0,a);if(a!=undefined){b._ui7()._uBc(a)}else{a=0}if(this.random){this._uoe._u58()}else{this._uoe._u45(a)}this.hPool=new chess.view.highlight.SquarePool({board:ludo.$(this.boardId)});this.interaction=new chess.view.board.BoardInteraction({board:ludo.$(this.boardId)});this.interaction.on("click",function(d){this.hPool.toggle(d,undefined)}.bind(this));this.arrowPool=new chess.view.highlight.ArrowPool({board:ludo.$(this.boardId)})},findPinned:function(){if(this.parser==undefined){this.parser=new chess.parser._uQ9()}this.parser.setFen(this._uoe._umc.fen());var b=this.parser.getColor();this.color=b=="white"?"black":"white";this.hPool.hideAll();var a=this.parser._u85(this.color);if(a.length==0){_uoe._u45()}else{ludo.$(this.boardId).flipTo(b);this._ux7()}},sendSolution:function(){var a=this.parser._u85(this.color)||[];var b=this.hPool.getSquares()||[];var c=true;if(a.length!=b.length){c=false}if(b.length==0){this.showToast()}if(!c){var f=function(h,g){return h<g?-1:1};a.sort(f);b.sort(f);for(var d=0;d<a.length;d++){if(c&&a[d]!=b[d]){c=false}}}if(!c){this._uoe._uif("wrongGuess")}else{this.showSolvedDialog()}},toast:undefined,getToast:function(){if(this.toast==undefined){this.toast=new ludo.Notification({autoRemove:false,duration:2,layout:{centerIn:this.boardId,height:30},css:{"text-align":"center"},html:chess.__("Click _u1g to solve the puzzles")})}return this.toast},showToast:function(){this.getToast().show(chess.__("Click _u1g to solve the puzzles"))},_ux7:function(){this.solved=false;this.arrowPool.hideAll();var a=chess.__("Click on all "+this.color+"'s pinned pieces");this.getToast().show(a);ludo.$(this.pinnedMsgId).html(a)},showHint:function(){if(this.solved){return}var a=this.parser._u85(this.color);this.getToast().show(chess.__("There are {0} pinned pieces".replace("{0}",a.length)))},overlay:undefined,showSolvedDialog:function(){this.solved=true;if(this.overlay==undefined){this.overlay=jQuery('<div class="dhtml_chess_game_solved"><div class="dhtml_chess_game_solved_overlay"></div><div class="dhtml_chess_game_solved_image"></div></div>');ludo.$(this.boardId).boardEl().append(this.overlay)}this.overlay.css("opacity",1);this.overlay.show();this.hideOverlay.delay(2000,this);var a=this.parser._uC4(this.color);jQuery.each(a,function(c,b){this.arrowPool.show(b.by,b.king)}.bind(this))},hideOverlay:function(){this.overlay.animate({opacity:0},{duration:700,complete:function(){this.overlay.hide()}.bind(this)})}});chess.WPStandings1=new Class({Extends:chess.WPTemplate,_ukd:function(a){this.parent(a);jQuery.ajax({url:ludo.config.getUrl(),method:"post",cache:false,dataType:"json",data:{action:"get_standings",pgn:this.pgn.id},complete:function(d,c){if(c==="success"){var b=d.responseJSON.response;new chess.wordpress.PgnStandings({renderTo:this.renderTo,layout:{height:"auto"},_une:{data:b}})}}.bind(this),fail:function(c,b){this._uif(b)}.bind(this)})
}});chess.WPInstructor=new Class({Extends:chess.WPTemplate,_uoe:undefined,_pers:true,_ukd:function(a){this.parent(a);if(a.persistent!==undefined){this._pers=a.persistent}if(this.canRender()){this.render()}},render:function(){var a=this.renderTo.width();this.renderTo.css("height",a+200);new chess.view.Chess({cls:this.th,theme:this.themeObject,renderTo:jQuery(this.renderTo),layout:{type:"linear",_uWd:"vertical",height:"matchParent",width:"matchParent"},children:[{module:this.module,type:"chess.view.board.Board",id:this.boardId,fen:this.fen,layout:{width:"matchParent",weight:1},plugins:["chess.view.highlight.Square"]},{layout:{type:"linear",_uWd:"horizontal"},height:40,children:[{type:"chess.view.metadata.FenField",module:this.module,name:"fenField",layout:{weight:1}},{name:"fenNav",type:"chess.view.buttonbar.Bar",buttons:["enter"],module:this.module,width:60}]},{height:40,type:"chess.view.buttonbar.Bar",buttons:["board","start","previous","next","end","flip","comp"],module:this.module},{height:170,module:this.module,showBar:false,type:"chess.wordpress.ComputerEval",hideButton:true,showNodes:false}]});this._uoe=new chess._uoe.DummyController({applyTo:[this.module],stockfish:ludo.config._uC6()+"/stockfish-js/stockfish.js",sound:this.sound,persistent:this._pers})}});window.chess.isWordPress=true;chess.WPTactics1=new Class({Extends:chess.WPTemplate,renderTo:undefined,pgn:undefined,_uoe:undefined,showLabels:undefined,module:undefined,boardSize:undefined,random:false,nav:false,history:undefined,historySize:20,historyKey:undefined,_uj7:undefined,_uyc:0,_uJ4:false,_ue5:undefined,_ukd:function(b){this.parent(b);var c=this.renderTo;var a=this.renderWidth();c.css("height",Math.round(a+165+this.wpm_h));this.boardSize=a;if(b.random!==undefined){this.random=b.random}this._ue5="dc-"+String.uniqueID();this.historyKey="tactics-history-"+this.pgn.id;this._uj7="tactics-history-index"+this.pgn.id;var d=ludo._uZ6().get(this.historyKey,"");this.history=d.length>0?d.split(/,/g):[];this._uyc=ludo._uZ6().get(this._uj7,0)/1;this.showLabels=!this.mobile;if(this.renderTo.substr&&this.renderTo.substr(0,1)!=="#"){this.renderTo="#"+this.renderTo}var f=String.uniqueID();this.colorViewId="clr"+f;this.beforeRender()},_uKc:function(){this._uJ4=true;if(this.random){if(this.history.length>1&&this._uyc>0){this._uyc--;this._uw7()}}else{this._uoe._uF(this.pgn)}},_uSf:function(){this._uJ4=false;if(this.random){if(this._uyc<this.history.length-1){this._uyc++;this._uw7()}else{this._uoe._u58()}}else{this._uoe._uCcFromFile()}},_uw7:function(){this._uJ4=true;this._ud5();var a=this.history[this._uyc];this._uoe._ur1(this.pgn.id,a)},render:function(){new chess.view.Chess({cls:this.th,theme:this.themeObject,renderTo:jQuery(this.renderTo),layout:{type:"fill",height:"matchParent",width:"matchParent"},children:[{layout:{type:"linear",_uWd:"vertical"},children:[{height:35,module:this.module,type:"chess.view.metadata.Game",tpl:this.heading_tpl||"#{index} - {white}",cls:"metadata",css:{"text-align":"center"}},{layout:{type:"linear",_uWd:"horizontal"},css:{"margin-top":2},height:30,children:[{weight:1},{module:this.module,layout:{width:this.mobile?40:80},type:"chess.view.button.TacticHint",value:this.mobile?"?":chess.__("Hint")},{module:this.module,hidden:this.mobile,layout:{width:80},type:"chess.view.button.TacticSolution",value:chess.__("Solution")},{module:this.module,layout:{width:80},type:"form.Button",value:chess.__("Next"),listeners:{click:this._uSf.bind(this)}},{id:this._ue5,module:this.module,layout:{width:80},type:"form.Button",value:chess.__("Previous"),listeners:{click:this._uKc.bind(this)}},{weight:1}]},Object.merge({boardLayout:undefined,animationDuration:this.animationDuration,id:this.boardId,type:"chess.view.board.Board",module:this.module,overflow:"hidden",pieceLayout:"svg3",boardCss:{border:0},labelPos:this.lp,layout:{height:this.boardSize},plugins:[Object.merge({type:"chess.view.highlight.Arrow"},this.arrow),Object.merge({type:"chess.view.highlight.ArrowTactic"},this.arrowSolution),Object.merge({type:"chess.view.highlight.SquareTacticHint"},this.hint)]},this.board),{height:50,module:this.module,comments:false,figurines:"svg_egg",type:"chess.view.notation.TacticPanel"},{layout:{height:34},id:this.colorViewId,type:"chess.ColorView"},{type:"chess.WPComMessage",hidden:this._p}]}]});var b="wp_"+this.pgn.id+"_tactics";new chess.view.message._uj8({renderTo:jQuery(document.body),module:this.module,_uE6:1000,hidden:true,_u41:1000,css:{"background-color":"#fff","border-radius":"5px","line-height":"50px"},layout:{centerIn:this.boardId,width:300,height:50}});this._uoe=new chess._uoe.TacticControllerGui({applyTo:[this.module],pgn:this.pgn.id,sound:this.sound,_ut9:400,_uwe:false,_uf9:this._uf9.bind(this),listeners:{loadGame:function(){var d=this._uoe._ui7().model.id;var c=this._uoe._ui7()._uzc();ludo._uZ6().save(b,c);if(!this._uJ4&&this.random){this._uAc(d)}if(this.random&&this._uyc==0){ludo.$(this._ue5).disable()}else{ludo.$(this._ue5).enable()}}.bind(this)}});
var a=ludo._uZ6().get(b,0);if(isNaN(a)){a=0}a=Math.max(0,a);if(a!==undefined){this._uoe._ui7()._uBc(a)}else{a=0}if(this.random){if(this.history.length>0){this._uw7()}else{this._uoe._u58()}}else{this._uoe._u45(a)}},_uf9:function(){var b=ludo.$(this.colorViewId);b.showView();b.colorCls("wpc-tactics-solved");b.icon(this.dr+"images/solved-icon-white.png");var a=function(){ludo.$(this.colorViewId).hideView();this._uSf()};a.delay(1000,this)},_uAc:function(a){this.history.push(a);if(this.history.length>this.historySize){this.history.shift()}this._uyc=this.history.length-1;this.saveHistory()},saveHistory:function(){ludo._uZ6().save(this.historyKey,this.history.join(","))},_ud5:function(){ludo._uZ6().save(this._uj7,this._uyc)}});window.chess.isWordPress=true;chess.WPTactics2=new Class({Extends:chess.WPTemplate,boardSize:undefined,random:false,gameFinished:false,startTime:undefined,lastGameId:undefined,gameIndex:0,storageKey:undefined,_uR4:false,storage:undefined,movesSolved:0,inHintMode:false,_ukd:function(b){this.parent(b);var c=this.renderTo;var a=this.renderWidth();c.css("height",Math.round(a+164+this.wpm_h));this.boardSize=a;if(b.random!==undefined){this.random=b.random}if(this.renderTo.substr&&this.renderTo.substr(0,1)!=="#"){this.renderTo="#"+this.renderTo}var d=String.uniqueID();this.avId="av"+d;this.eloId="elo"+d;this.nextBtnId="btn"+d;this.reloadBtnId="btn_r"+d;this.hintBtnId="hint"+d;this.clockId="clk"+d;this.iconId="icon"+d;this.colorViewId="clr"+d;this.beforeRender()},_uSf:function(){this._uJ4=false;if(this.random){this._uoe._u58()}else{this._uCc()}},render:function(){new chess.view.Chess({cls:this.th,theme:this.themeObject,renderTo:jQuery(this.renderTo),layout:{type:"fill",height:"matchParent",width:"matchParent"},children:[{layout:{type:"linear",_uWd:"vertical"},children:[{layout:{height:34},id:this.colorViewId,type:"chess.ColorView"},Object.merge({boardLayout:undefined,id:this.boardId,animationDuration:this.animationDuration,type:"chess.view.board.Board",module:this.module,overflow:"hidden",pieceLayout:"svg3",boardCss:{border:0},labelPos:this.lp,layout:{height:this.boardSize},plugins:[Object.merge({type:"chess.view.highlight.Arrow"},this.arrow),Object.merge({type:"chess.view.highlight.ArrowTactic"},this.arrowSolution),Object.merge({type:"chess.view.highlight.SquareTacticHint"},this.hint)]},this.board),{height:48,cls:"wpc-user-info-panel",layout:{type:"linear",_uWd:"horizontal"},children:[{type:"chess.UserAvatarView",id:this.avId,auto:false,layout:{width:48,height:"matchParent"}},{module:this.module,type:"chess.UserElo",id:this.eloId,css:{"line-height":"40px"},layout:{weight:1,height:"matchParent"}},{id:this.clockId,type:"chess.Clock",layout:{weight:1,height:"matchParent"}}]},{layout:{height:48,type:"linear",_uWd:"horizontal"},children:[{id:this.iconId,type:"chess.IconView",layout:{width:48,height:"matchParent"}},{weight:1},{id:this.reloadBtnId,type:"chess.ImageButton",img:this.dr+"images/reload.png",layout:{width:80,height:"matchParent"},btnVisible:false,listeners:{click:this.reloadGame.bind(this)}},{id:this.nextBtnId,type:"chess.ImageButton",img:this.dr+"images/btn-next.png",layout:{width:80,height:"matchParent"},btnVisible:false,listeners:{click:this._uSf.bind(this)}},{id:this.hintBtnId,type:"chess.ImageButton",img:this.dr+"images/hint.png",layout:{width:80,height:"matchParent"},btnVisible:false,listeners:{click:this._ufc.bind(this)}}]}]}]});this.storageKey="wordpresschess_user_tactics"+this.pgnAll.map(function(a){return a.id}).join("_");this._uoe=new chess._uoe.Controller({applyTo:[this.module],pgn:this.pgnId(),sound:this.sound,_ut9:400,noDialogs:true,eventHandler:this.eventHandler.bind(this)});this.loadUserInfo()},_ufc:function(){this.inHintMode=true;ludo.$(this.hintBtnId).hideButton();ludo.$(this.clockId).stop();this._uoe.playMoves()},_uCc:function(){this._uR4=true;this.loadGame(this.getIndex()+1)},getIndex:function(){return this._ute("index",0)},loadGame:function(a){jQuery.ajax({url:this.url,method:"post",cache:false,dataType:"json",data:{action:"game_by_index_strict",pgn:this.pgnId(),index:a},complete:function(c,f){this.gameFinished=false;if(f){var d=c.responseJSON;if(d.success){this._uDc(d.response)}else{var b=this.nextPgnId();this.pgnId(b);this._ub8("index",0);this.loadGame(0)}}}.bind(this)})},_uDc:function(c){this.inHintMode=false;var d=c.id;var a=c.pgn_id;var b=c.index;this.curModel().populate(c);ludo.$(this.eloId).clearIncs();ludo.$(this.hintBtnId).showButton();this._ub8("id",d);this.pgnId(a);this._ub8("index",b);this.movesSolved=0;this._uE4()},_uE4:function(){jQuery.ajax({url:this.url,method:"post",cache:false,dataType:"json",data:{action:"wpc_save_tactics_data",pgn:this.pgnId(),gameId:this._ute("id"),index:this._ute("index")}})},pgnId:function(a){if(arguments.length===1){this._ub8("pgn",a);return}return this._ute("pgn",this.pgn.id)},nextPgnId:function(){var b=this.pgnId();var a=0;jQuery.each(this.pgnAll,function(c,d){if(d.id==b){a=c}});if(a<this.pgnAll.length-1){a++}else{a=0}return this.pgnAll[a].id
},reloadGame:function(){this.curModel().toStart();ludo.$(this.iconId).animateOut();var a=ludo.$(this.clockId);ludo.$(this.hintBtnId).showButton();a.reset();a.start()},myColor:undefined,eventHandler:function(h,f,g,d){var c=g.views.board;if(h==="correctGuess"){this.movesSolved++}if(h==="boardMove"){g._umc.tryNextMove(d)}if(h==="newGame"){var a=f.getResult();if(a==-1){c._ujd();this.myColor="black"}else{c._und();this.myColor="white"}if(f.model.moves.length>0){var j=ludo.$(this.clockId);j.reset();j.start()}ludo.$(this.iconId).animateOut();ludo.$(this.nextBtnId).hideButton();ludo.$(this.reloadBtnId).hideButton();ludo.$(this.colorViewId).hideView()}if(!this.inHintMode&&(h==="_u0d"||h==="nextmove")){colorToMove=f._uT8();if(colorToMove===this.myColor){c._ui4(f)}else{f.nextMove.delay(200,f)}}if(h==="wrongGuess"){this.onGameEnd(true)}if(h==="_u8d"){this.onGameEnd()}},getStorage:function(){if(this.storage===undefined){var a=ludo._uZ6().get(this.storageKey);this.storage=a?a:{}}return this.storage},_ub8:function(a,c){var b=this.getStorage();b[a]=c;ludo._uZ6().save(this.storageKey,b)},_ute:function(a,c){var b=this.getStorage();return b[a]!==undefined?b[a]:c},onGameEnd:function(d){if(!d){this.movesSolved++}ludo.$(this.hintBtnId).hideButton();var h=d?"incorrect-icon.png":this.inHintMode?"solved-skipped.png":"solved-icon.png";ludo.$(this.iconId).setIcon(this.dr+"images/"+h);if(this.gameFinished){return}var g=ludo.$(this.clockId);g.stop();this.gameFinished=true;var b=this._uoe._ui7().model.moves.length;var f=g.elapsed();var a=!d;var c=ludo.$(this.colorViewId);c.showView();if(a){c.colorCls(this.inHintMode?"wpc-tactics-skipped":"wpc-tactics-solved");c.icon(this.dr+"images/solved-icon-white.png")}else{c.colorCls("wpc-tactics-failed");c.icon(this.dr+"images/incorrect-icon-white.png")}jQuery.ajax({url:this.url,method:"post",cache:false,dataType:"json",data:{action:"wpc_puzzle_complete",moves:b,solvedMoves:this.inHintMode?b/2:this.movesSolved,rated:!this.inHintMode,solved:a&&!this.inHintMode?1:0,ms:f,puzzleId:this._uoe._umc.getId()},complete:function(j,m){this.gameFinished=false;if(m){var k=j.responseJSON;var l=k.response;ludo.$(this.eloId).val(l);ludo.$(this.nextBtnId).showButton();ludo.$(this.reloadBtnId).showButton()}}.bind(this)});this.inHintMode=false},showStartButton:function(){var a=this.startButton=jQuery('<div class="dhtml_chess_overlay_parent"><div class="dhtml_chess_overlay"></div><div class="dhtml_chess_overlay_image wpc-start-button-large"></div></div>');ludo.$(this.boardId).boardEl().append(a);a.on("click",this.loadFirstGame.bind(this))},showLogOnWarning:function(){ludo.$(this.clockId).reset();var a=jQuery('<div class="dhtml_chess_overlay_parent"><div class="dhtml_chess_overlay"></div><div class="dhtml_chess_overlay_image wpc-login-image"></div></div>');ludo.$(this.boardId).boardEl().append(a);a.css("cursor","pointer");a.on("click",function(){location.href=ludo.config.wpRoot+"?redirect_to="+encodeURI(location.href)})},loadFirstGame:function(){this.startButton.remove();if(this.random){this._uoe._u58()}else{this.loadGame(this.getIndex())}},loadUserInfo:function(){jQuery.ajax({url:this.url,method:"post",cache:false,dataType:"json",data:{action:"wpc_userinfo",size:32},complete:function(a,d){if(d){var c=a.responseJSON.response;if(c.id===0){this.showLogOnWarning();return}if(c.tactics){var b=c.tactics;if(b.pgn&&this.isValidPgn(b.pgn)){this.pgnId(b.pgn);this._ub8("id",b.gameId);this._ub8("index",b.index)}}ludo.$(this.avId).setAvatar(c.avatar);ludo.$(this.eloId).val(c.puzzleelo);this.showStartButton()}else{}}.bind(this)})}});chess.WPTacticsGame1=new Class({Extends:chess.WPTemplate,nav:false,_ukd:function(b){this.parent(b);var c=this.renderTo;var a=this.renderWidth();this.model=b.model||undefined;c.css("height",a+this.wpm_h);this.boardId="board"+String.uniqueID();this.beforeRender()},render:function(){new chess.view.Chess({cls:this.th,theme:this.themeObject,renderTo:this.renderTo,layout:{type:"linear",_uWd:"vertical"},children:[{module:this.module,id:this.boardId,animationDuration:this.animationDuration,type:"chess.view.board.Board",fen:this.fen,layout:{width:"matchParent",weight:1}},{type:"chess.WPComMessage",hidden:this._p}]});this._uoe=new chess._uoe.TacticControllerGui({applyTo:[this.module],_ut9:400,sound:this.sound,noDialogs:true,_uf9:this.onGameEnd.bind(this)});this._uoe._umc.populate(this.model)},onGameEnd:function(){var a=jQuery('<div class="dhtml_chess_game_solved"><div class="dhtml_chess_overlay"></div><div class="dhtml_chess_overlay_image dhtml_chess_game_solved_image"></div></div>');ludo.$(this.boardId).boardEl().append(a)}});chess.Clock=new Class({Extends:ludo.View,startTime:0,endTime:0,cv:undefined,stopped:true,interval:undefined,__ucf:function(){this.parent();this.$b().addClass("wpc-clock");this.cv=jQuery('<div class="wpc-clock-digits"></div>').appendTo(this.$b());this.reset();this.showTime()},createInterval:function(){if(this.interval){clearInterval(this.interval)}this.interval=setInterval(this.showTime.bind(this),1000)
},reset:function(){this.stopped=true;this.startTime=this.endTime=new Date().getTime()},start:function(){this.stopped=false;this.createInterval();this.showTime()},stop:function(){this.stopped=true;this.endTime=new Date().getTime()},elapsed:function(){if(this.stopped){return this.endTime-this.startTime}return new Date().getTime()-this.startTime},timeAsString:function(){var a=this.elapsed();var c=Math.floor(a/1000);var b=Math.floor(c/60);c=c%60;var d=c<10?"0":"";return b+":"+d+c},showTime:function(){this.cv.html(this.timeAsString())},resize:function(a){this.parent(a);var b=this.$b().height();this.cv.css({"margin-top":Math.floor(b*0.05)+"px","font-size":b});if(!this.mobile){this.cv.css("line-height",b+"px")}}});chess.ColorView=new Class({Extends:ludo.View,colorView:undefined,ccls:undefined,__ucf:function(){this.parent();this.colorView=jQuery('<div class="wpc-color-view"></div>').appendTo(this.$b());this.$b().addClass("wpc-color-view-parent")},colorCls:function(a){if(this.ccls){this.colorView.removeClass(this.ccls)}this.colorView.addClass(a);this.ccls=a},color:function(a){this.colorView.css("background-color",a)},icon:function(a){this.colorView.css("background-image","url("+a+")")},hideView:function(){this.animateOut()},showView:function(){this.animateIn()},animateIn:function(){this.colorView.css("top",this.$e.height());this.colorView.animate({top:0})},animateOut:function(){this.colorView.animate({top:this.$e.height()})}});chess.IconView=new Class({Extends:ludo.View,iconView:undefined,__ucf:function(){this.parent();this.iconView=jQuery('<div class="wpc-icon-view"></div>');this.$b().append(this.iconView)},setIcon:function(a){this.iconView.css("background-image","url("+a+")");this.animateIn()},animateIn:function(){this.iconView.css("top",this.$e.height());this.iconView.animate({top:0})},animateOut:function(){this.iconView.animate({top:this.$e.height()})}});chess.ImageButton=new Class({Extends:ludo.View,img:undefined,btnVisible:true,elCss:{padding:2},_ukd:function(a){this.parent(a);this._uWf(a,["img","btnVisible"])},__ucf:function(){this.parent();var a=this.$b();a.addClass("wpc-image-button");this.bg(this.img);a.mouseenter(this.onEnter.bind(this));a.mouseleave(this.onLeave.bind(this));if(!this.btnVisible){this.hideButton()}var c=function(){this._uif("click")}.bind(this);this.$b().on("click",c)},onEnter:function(){this.$b().addClass("wpc-image-button-over")},onLeave:function(){this.$b().removeClass("wpc-image-button-over")},bg:function(a){this.$b().css("background-image","url("+a+")")},hideButton:function(){this.$b().css("visibility","hidden");this.hide()},showButton:function(){if(this.hidden){this.show()}this.$b().css("visibility","visible")}});chess.UserAvatarView=new Class({Extends:ludo.View,avatarSize:32,auto:true,_ukd:function(a){this.parent(a);if(a.avatarSize!=undefined){this.avatarSize=a.avatarSize}if(a.auto!=undefined){this.auto=a.auto}},setAvatar:function(a){var b=a.replace(/.*?src=["']([^"']+?)["'].*/gi,"$1");this.$b().css("background-image","url("+b+")")},__ucf:function(){this.parent();this.$b().addClass("wpc-avatar");if(this.auto){this.loadAvatar()}},loadAvatar:function(){jQuery.ajax({url:ludo.config.getUrl(),method:"post",cache:false,dataType:"json",data:{action:"wpc_userinfo",size:this.avatarSize},complete:function(a,c){if(c){var b=a.responseJSON;this.setAvatar(b.response.avatar)}else{}}.bind(this)})}});chess.UserElo=new Class({Extends:ludo.View,elo:undefined,cls:"wpc-user-info-elo",suffix:undefined,val:function(d){d=Math.floor(d);if(!this.elo){this.elo=d}var b="";if(this.elo&&d!=this.elo){var c=d-this.elo;b=c>0?"+"+c:c;var a=c>0?"wpc-positve-elo":"wpc-negative-elo";b=' (<span class="'+a+'">'+b+"</span>)"}this.html(this.elo+b);if(d!=this.elo){this.animateElo(this.elo,d)}this.elo=d;this.suffix=b},animateElo:function(b,a){this.html(Math.round(b)+this.suffix);if(b!=a){b+=a>b?1:-1;this.animateElo.delay(17,this,[b,a])}},clearIncs:function(){if(this.elo){this.val(this.elo)}}});wpchess={};wpchess.WPScriptQueueInitialized=false;wpchess.WpScriptQueue=new Class({initialize:function(){var a=window.wpchess_snippets;if(a!==undefined&&window.chess!==undefined){jQuery.each(a,function(b,c){c.call()});window.wpchess_snippets=[]}if(!wpchess.WPScriptQueueInitialized){wpchess.WPScriptQueueInitialized=true;jQuery(document).ready(function(){new wpchess.WpScriptQueue()})}}});new wpchess.WpScriptQueue();